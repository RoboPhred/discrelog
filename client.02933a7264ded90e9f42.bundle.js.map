{"version":3,"sources":["webpack://discrelog/./src/actions/node-interact.ts","webpack://discrelog/./src/elements/constants.ts","webpack://discrelog/./src/elements/definitions/input-momentary.ts","webpack://discrelog/./src/elements/definitions/input-toggle.ts","webpack://discrelog/./src/elements/definitions/logic-and.ts","webpack://discrelog/./src/elements/definitions/logic-buffer.ts","webpack://discrelog/./src/elements/definitions/logic-nand.ts","webpack://discrelog/./src/elements/definitions/logic-nor.ts","webpack://discrelog/./src/elements/definitions/logic-not.ts","webpack://discrelog/./src/elements/definitions/logic-or.ts","webpack://discrelog/./src/elements/definitions/logic-xor.ts","webpack://discrelog/./src/elements/definitions/output-led.ts","webpack://discrelog/./src/elements/definitions/output-seg7.ts","webpack://discrelog/./src/elements/definitions/pin-high.ts","webpack://discrelog/./src/geometry.ts","webpack://discrelog/./src/history.ts","webpack://discrelog/./src/services/circuit-editor-drag/state.ts","webpack://discrelog/./src/services/circuits/constants.ts","webpack://discrelog/./src/services/circuit-editors/constants.ts","webpack://discrelog/./src/services/circuit-editors/state.ts","webpack://discrelog/./src/services/circuits/state.ts","webpack://discrelog/./src/services/clipboard/state.ts","webpack://discrelog/./src/services/dialog/state.ts","webpack://discrelog/./src/services/node-graph/state.ts","webpack://discrelog/./src/services/node-layout/state.ts","webpack://discrelog/./src/services/project/state.ts","webpack://discrelog/./src/services/selection/state.ts","webpack://discrelog/./src/services/simulator/state.ts","webpack://discrelog/./src/services/simulator-control/state.ts","webpack://discrelog/./src/utils.ts","webpack://discrelog/./src/styles/sizing.module.css?9a43","webpack://discrelog/./src/styles/flex.module.css?f6f1","webpack://discrelog/./src/components/Tessel/types.ts","webpack://discrelog/./src/hooks/useRefValue.ts","webpack://discrelog/./src/components/Tessel/Tessel.module.css?d43a","webpack://discrelog/./src/components/Tessel/TesselSplit.tsx","webpack://discrelog/./src/components/Tessel/TesselContext.tsx","webpack://discrelog/./src/components/Tessel/TesselSplitFrame.tsx","webpack://discrelog/./src/components/Tessel/TesselFrame.tsx","webpack://discrelog/./src/arrays.ts","webpack://discrelog/./src/hooks/useComponentBounds.ts","webpack://discrelog/./src/components/Tessel/drag-items/tessel-window.tsx","webpack://discrelog/./src/components/Tessel/TesselDropCapture.tsx","webpack://discrelog/./src/components/Tessel/utils.ts","webpack://discrelog/./src/components/Tessel/Tessel.tsx","webpack://discrelog/./src/components/Tessel/index.ts","webpack://discrelog/./src/pages/ProjectEditorPage/windows/CircuitEditorWindow/tessel-window.ts","webpack://discrelog/./src/services/ui-layout/state.ts","webpack://discrelog/./src/services/ui-settings/state.ts","webpack://discrelog/./src/services/state.ts","webpack://discrelog/./src/undo/state.ts","webpack://discrelog/./src/store/state.ts","webpack://discrelog/./src/env.ts","webpack://discrelog/./src/actions/init.ts","webpack://discrelog/./src/actions/circuit-add.ts","webpack://discrelog/./src/actions/circuit-delete.ts","webpack://discrelog/./src/actions/circuit-rename.ts","webpack://discrelog/./src/actions/node-add.ts","webpack://discrelog/./src/actions/node-delete.ts","webpack://discrelog/./src/actions/node-rename.ts","webpack://discrelog/./src/actions/selection-align-to-grid.ts","webpack://discrelog/./src/actions/selection-delete.ts","webpack://discrelog/./src/actions/selection-move.ts","webpack://discrelog/./src/actions/wire-attach.ts","webpack://discrelog/./src/actions/wire-detatch.ts","webpack://discrelog/./src/actions/wire-joint-add.ts","webpack://discrelog/./src/actions/wire-joint-move.ts","webpack://discrelog/./src/actions/wire-joint-delete.ts","webpack://discrelog/./src/actions/clipboard-paste.ts","webpack://discrelog/./src/actions/circuit-editor-drag-end.ts","webpack://discrelog/./src/actions/undo.ts","webpack://discrelog/./src/actions/redo.ts","webpack://discrelog/./src/actions/project-new.ts","webpack://discrelog/./src/actions/project-receive.ts","webpack://discrelog/./src/project-mutation-actions.ts","webpack://discrelog/./src/services/service-state-utils.ts","webpack://discrelog/./src/services/circuit-editors/utils.ts","webpack://discrelog/./src/services/circuit-editors/selectors/editor.ts","webpack://discrelog/./src/undo/utils.ts","webpack://discrelog/./src/store/utils.ts","webpack://discrelog/./src/actions/circuit-editor-drag-abort.ts","webpack://discrelog/./src/services/circuit-editor-drag/utils.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-abort.ts","webpack://discrelog/./src/actions/circuit-editor-drag-continue.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-continue.ts","webpack://discrelog/./src/selection-mode.ts","webpack://discrelog/./src/actions/select-region.ts","webpack://discrelog/./src/services/node-graph/utils.ts","webpack://discrelog/./src/services/node-graph/selectors/nodes.ts","webpack://discrelog/./src/services/circuits/utils.ts","webpack://discrelog/./src/services/circuits/selectors/nodes.ts","webpack://discrelog/./src/services/node-layout/utils.ts","webpack://discrelog/./src/services/node-layout/selectors/node-positions.ts","webpack://discrelog/./src/nodes/definitions/integrated-circuits/utils.ts","webpack://discrelog/./src/services/circuits/selectors/circuits.ts","webpack://discrelog/./src/nodes/definitions/integrated-circuits/index.tsx","webpack://discrelog/./src/nodes/definitions/interaction/index.ts","webpack://discrelog/./src/nodes/definitions/index.ts","webpack://discrelog/./src/nodes/definitions/logic/index.ts","webpack://discrelog/./src/nodes/definitions/output/index.ts","webpack://discrelog/./src/nodes/definitions/pins/index.ts","webpack://discrelog/./src/services/node-types/selectors/node-types.ts","webpack://discrelog/./src/services/node-graph/types.ts","webpack://discrelog/./src/services/node-layout/selectors/node-pin-positions.ts","webpack://discrelog/./src/services/circuit-editor-drag/selectors/snap.ts","webpack://discrelog/./src/actions/circuit-editor-drag-start-joint.ts","webpack://discrelog/./src/actions/select-wire-joints.ts","webpack://discrelog/./src/services/selection/utils.ts","webpack://discrelog/./src/services/selection/selectors/selection.ts","webpack://discrelog/./src/services/circuits/selectors/connections.ts","webpack://discrelog/./src/actions/circuit-editor-drag-start-newjoint.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-start-newjoint.ts","webpack://discrelog/./src/actions/circuit-editor-drag-start-node.ts","webpack://discrelog/./src/actions/select-nodes.ts","webpack://discrelog/./src/actions/circuit-editor-drag-start-select.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-start-select.ts","webpack://discrelog/./src/actions/circuit-editor-drag-start-wire.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-start-wire.ts","webpack://discrelog/./src/actions/circuit-editor-mouse-leave.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/index.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-end.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-start-joint.ts","webpack://discrelog/./src/services/circuits/selectors/joints.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-start-node.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/mouse-leave.ts","webpack://discrelog/./src/services/circuit-editors/reducer/circuit-delete.ts","webpack://discrelog/./src/actions/circuit-editor-receive-focus.ts","webpack://discrelog/./src/services/circuit-editors/reducer/editor-focus.ts","webpack://discrelog/./src/actions/view-circuit.ts","webpack://discrelog/./src/services/circuit-editors/reducer/view-circuit.ts","webpack://discrelog/./src/services/circuit-editors/reducer/index.ts","webpack://discrelog/./src/services/circuits/reducer/circuit-add.ts","webpack://discrelog/./src/actions/circuit-import.ts","webpack://discrelog/./src/services/savedata/types.ts","webpack://discrelog/./src/services/node-graph/selectors/connections.ts","webpack://discrelog/./src/services/node-graph/selectors/node-def.ts","webpack://discrelog/./src/services/node-layout/selectors/wires.ts","webpack://discrelog/./src/services/savedata/errors.ts","webpack://discrelog/./src/services/savedata/api.ts","webpack://discrelog/./src/services/circuits/reducer/circuit-rename.ts","webpack://discrelog/./src/services/circuits/reducer/node-add.ts","webpack://discrelog/./src/services/circuits/reducer/node-delete.ts","webpack://discrelog/./src/services/circuits/reducer/index.ts","webpack://discrelog/./src/services/circuits/reducer/circuit-delete.ts","webpack://discrelog/./src/services/circuits/reducer/circuit-import.ts","webpack://discrelog/./src/services/circuits/reducer/project-new.ts","webpack://discrelog/./src/actions/clipboard-copy.ts","webpack://discrelog/./src/services/node-graph/selectors/pins.ts","webpack://discrelog/./src/services/clipboard/utils.ts","webpack://discrelog/./src/services/clipboard/reducer/index.ts","webpack://discrelog/./src/services/clipboard/reducer/clipboard-copy.ts","webpack://discrelog/./src/services/clipboard/reducer/clipboard-paste.ts","webpack://discrelog/./src/actions/dialog-response-accept.ts","webpack://discrelog/./src/services/dialog/utils.ts","webpack://discrelog/./src/services/dialog/reducer/dialog-response-accept.ts","webpack://discrelog/./src/actions/dialog-response-cancel.ts","webpack://discrelog/./src/services/dialog/reducer/dialog-response-cancel.ts","webpack://discrelog/./src/actions/dialog-show.ts","webpack://discrelog/./src/services/dialog/reducer/index.ts","webpack://discrelog/./src/services/dialog/reducer/dialog-show.ts","webpack://discrelog/./src/store/priorities.ts","webpack://discrelog/./src/services/node-graph/reducer/node-add.ts","webpack://discrelog/./src/services/node-graph/reducer/node-delete.ts","webpack://discrelog/./src/services/node-graph/reducer/operations/node-delete.ts","webpack://discrelog/./src/services/node-graph/reducer/node-rename.ts","webpack://discrelog/./src/services/node-graph/reducer/index.ts","webpack://discrelog/./src/services/node-graph/reducer/project-new.ts","webpack://discrelog/./src/services/node-graph/reducer/wire-attach.ts","webpack://discrelog/./src/services/node-graph/reducer/wire-detatch.ts","webpack://discrelog/./src/services/node-layout/reducer/node-add.ts","webpack://discrelog/./src/services/node-layout/reducer/node-delete.ts","webpack://discrelog/./src/services/node-layout/reducer/operations/node-delete.ts","webpack://discrelog/./src/actions/node-move.ts","webpack://discrelog/./src/services/node-layout/reducer/node-move.ts","webpack://discrelog/./src/services/node-layout/reducer/index.ts","webpack://discrelog/./src/services/node-layout/reducer/project-new.ts","webpack://discrelog/./src/services/node-layout/reducer/wire-attach.ts","webpack://discrelog/./src/services/node-layout/reducer/wire-detatch.ts","webpack://discrelog/./src/services/node-layout/reducer/wire-joint-add.ts","webpack://discrelog/./src/services/node-layout/reducer/wire-joint-delete.ts","webpack://discrelog/./src/services/node-layout/reducer/wire-joint-move.ts","webpack://discrelog/./src/services/project/reducer/autosave.ts","webpack://discrelog/./src/services/project/utils.ts","webpack://discrelog/./src/services/project/reducer/project-modified.ts","webpack://discrelog/./src/services/project/reducer/project-new.ts","webpack://discrelog/./src/actions/project-rename.ts","webpack://discrelog/./src/services/project/reducer/project-rename.ts","webpack://discrelog/./src/actions/project-save.ts","webpack://discrelog/./src/services/project/reducer/index.ts","webpack://discrelog/./src/services/project/reducer/init.ts","webpack://discrelog/./src/services/project/reducer/project-receive.ts","webpack://discrelog/./src/services/project/reducer/project-save-success.ts","webpack://discrelog/./src/services/selection/reducer/node-delete.ts","webpack://discrelog/./src/services/selection/reducer/project-new.ts","webpack://discrelog/./src/actions/select-all.ts","webpack://discrelog/./src/services/selection/reducer/select-all.ts","webpack://discrelog/./src/actions/select-clear.ts","webpack://discrelog/./src/services/selection/reducer/select-clear.ts","webpack://discrelog/./src/services/selection/reducer/select-joints.ts","webpack://discrelog/./src/services/selection/reducer/select-nodes.ts","webpack://discrelog/./src/services/node-layout/selectors/node-bounds.ts","webpack://discrelog/./src/services/selection/reducer/select-region.ts","webpack://discrelog/./src/actions/select-wires.ts","webpack://discrelog/./src/services/selection/reducer/select-wires.ts","webpack://discrelog/./src/actions/selection-copy.ts","webpack://discrelog/./src/services/selection/reducer/index.ts","webpack://discrelog/./src/services/selection/reducer/selection-align-to-grid.ts","webpack://discrelog/./src/services/selection/reducer/selection-copy.ts","webpack://discrelog/./src/services/selection/reducer/selection-delete.ts","webpack://discrelog/./src/services/selection/reducer/selection-move.ts","webpack://discrelog/./src/services/selection/reducer/wire-detatch.ts","webpack://discrelog/./src/services/simulator/utils.ts","webpack://discrelog/./src/services/simulator/reducer/element-graph-invalidated.ts","webpack://discrelog/./src/elements/definitions/index.ts","webpack://discrelog/./src/services/simulator-graph/utils.ts","webpack://discrelog/./src/services/simulator-graph/graph-production.ts","webpack://discrelog/./src/nodes/types/element-production.ts","webpack://discrelog/./src/services/simulator-graph/types.ts","webpack://discrelog/./src/services/simulator-graph/selectors/graph.ts","webpack://discrelog/./src/services/simulator-graph/selectors/nodes.ts","webpack://discrelog/./src/services/simulator-graph/selectors/connections.ts","webpack://discrelog/./src/services/simulator/reducer/utils.ts","webpack://discrelog/./src/services/simulator/reducer/node-interact.ts","webpack://discrelog/./src/actions/sim-start.ts","webpack://discrelog/./src/services/simulator/reducer/sim-start.ts","webpack://discrelog/./src/actions/sim-step.ts","webpack://discrelog/./src/actions/sim-tick.ts","webpack://discrelog/./src/actions/sim-stop.ts","webpack://discrelog/./src/services/simulator/reducer/sim-stop.ts","webpack://discrelog/./src/services/simulator/reducer/index.ts","webpack://discrelog/./src/services/simulator/reducer/sim-step.ts","webpack://discrelog/./src/services/simulator/reducer/sim-tick.ts","webpack://discrelog/./src/services/simulator-control/utils.ts","webpack://discrelog/./src/services/simulator-control/reducers/element-graph-invalidated.ts","webpack://discrelog/./src/actions/sim-pause.ts","webpack://discrelog/./src/services/simulator-control/selectors/run.ts","webpack://discrelog/./src/services/simulator-control/reducers/index.ts","webpack://discrelog/./src/services/simulator-control/reducers/sim-pause.ts","webpack://discrelog/./src/services/simulator-control/reducers/sim-start.ts","webpack://discrelog/./src/services/simulator-control/reducers/sim-step.ts","webpack://discrelog/./src/services/simulator-control/reducers/sim-stop.ts","webpack://discrelog/./src/services/ui-layout/utils.ts","webpack://discrelog/./src/services/ui-layout/reducer/circuit-delete.ts","webpack://discrelog/./src/actions/layout-rearrange.ts","webpack://discrelog/./src/services/ui-layout/reducer/layout-rearrange.ts","webpack://discrelog/./src/services/ui-layout/reducer/view-circuit.ts","webpack://discrelog/./src/actions/view-reset.ts","webpack://discrelog/./src/services/ui-layout/reducer/index.ts","webpack://discrelog/./src/services/ui-layout/reducer/view-reset.ts","webpack://discrelog/./src/actions/view-node-names.ts","webpack://discrelog/./src/services/ui-settings/utils.ts","webpack://discrelog/./src/services/ui-settings/reducer/index.ts","webpack://discrelog/./src/services/ui-settings/reducer/view-node-names.ts","webpack://discrelog/./src/store/reducer.ts","webpack://discrelog/./src/services/reducer.ts","webpack://discrelog/./src/store/devtool-sanitizer.ts","webpack://discrelog/./src/services/dialog/api.ts","webpack://discrelog/./src/actions/project-export-link.ts","webpack://discrelog/./src/services/project/saga/project-export-link.ts","webpack://discrelog/./src/actions/project-import-circuits.ts","webpack://discrelog/./src/services/project/saga/project-import-circuits.ts","webpack://discrelog/./src/actions/project-import-link.ts","webpack://discrelog/./src/services/project/saga/project-import-link.ts","webpack://discrelog/./src/actions/project-load.ts","webpack://discrelog/./src/services/project/saga/project-load.ts","webpack://discrelog/./src/services/project/selectors/project.ts","webpack://discrelog/./src/services/project/saga/project-save.ts","webpack://discrelog/./src/services/project/saga/index.ts","webpack://discrelog/./src/services/simulator-control/saga/mode-run.ts","webpack://discrelog/./src/services/simulator-control/saga/index.ts","webpack://discrelog/./src/store/saga.ts","webpack://discrelog/./src/store/store.ts","webpack://discrelog/./src/undo/reducer/index.ts","webpack://discrelog/./src/undo/reducer/undo.ts","webpack://discrelog/./src/undo/reducer/redo.ts","webpack://discrelog/./src/undo/reducer/capture-undo-state.ts","webpack://discrelog/./src/hooks/useSelector.ts","webpack://discrelog/./src/hooks/useNativeEvent.ts","webpack://discrelog/./src/services/saga.ts","webpack://discrelog/./src/services/ui-layout/selectors/layout.ts","webpack://discrelog/./src/components/TitleBar/index.ts","webpack://discrelog/./src/components/TitleBar/TitleBar.tsx","webpack://discrelog/./src/components/TitleBar/TitleBar.module.css?c6e3","webpack://discrelog/./src/components/Popover/PopoverChildContext.tsx","webpack://discrelog/./src/components/Popover/index.ts","webpack://discrelog/./src/components/Popover/Popover.tsx","webpack://discrelog/./src/hooks/useArrayState.ts","webpack://discrelog/./src/hooks/useOutsideMouseEvent.ts","webpack://discrelog/./src/components/Menus/MenuCloseContext.ts","webpack://discrelog/./src/components/AutoPopover.tsx","webpack://discrelog/./src/components/Button/Button.module.css?a282","webpack://discrelog/./src/components/Button/Button.tsx","webpack://discrelog/./src/components/Button/index.ts","webpack://discrelog/./src/hooks/useAction.ts","webpack://discrelog/./src/components/Menus/Menus.module.css?27a7","webpack://discrelog/./src/components/Menus/Menu.tsx","webpack://discrelog/./src/components/Menus/MenuItem.tsx","webpack://discrelog/./src/components/Menus/DividerMenuItem.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/components/FileMenu.tsx","webpack://discrelog/./src/runtime-env.ts","webpack://discrelog/./src/undo/selectors.ts","webpack://discrelog/./src/pages/ProjectEditorPage/components/EditMenu.tsx","webpack://discrelog/./src/services/ui-settings/selectors/node-name.ts","webpack://discrelog/./src/components/Checkbox/index.ts","webpack://discrelog/./src/components/Checkbox/Checkbox.tsx","webpack://discrelog/./src/components/Checkbox/Checkbox.module.css?4fe9","webpack://discrelog/./src/components/Menus/CheckboxMenuItem.tsx","webpack://discrelog/./src/components/Menus/SubMenuItem.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/components/ViewMenu.tsx","webpack://discrelog/./src/services/simulator/selectors/performance.ts","webpack://discrelog/./src/components/Icons/Icons.module.css?682c","webpack://discrelog/./src/components/Icons/Play.tsx","webpack://discrelog/./src/components/Icons/Stop.tsx","webpack://discrelog/./src/components/Icons/Pause.tsx","webpack://discrelog/./src/components/Icons/Step.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/components/SimControls/SimControls.module.css?e05b","webpack://discrelog/./src/pages/ProjectEditorPage/components/SimControls/index.ts","webpack://discrelog/./src/pages/ProjectEditorPage/components/SimControls/SimControls.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/components/ProjectEditorTitleBar/index.ts","webpack://discrelog/./src/pages/ProjectEditorPage/components/ProjectEditorTitleBar/ProjectEditorTitleBar.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/components/ProjectEditorTitleBar/ProjectEditorTitleBar.module.css?4065","webpack://discrelog/./src/components/CircuitNodeBreadcrumb/CircuitNodeBreadcrumb.module.css?4319","webpack://discrelog/./src/components/CircuitNodeBreadcrumb/CircuitNodeBreadcrumb.tsx","webpack://discrelog/./src/components/CircuitNodeBreadcrumb/index.ts","webpack://discrelog/./src/services/node-layout/selectors/field.ts","webpack://discrelog/./src/components/ContextMenu.tsx","webpack://discrelog/./src/components/CircuitEditor/components/ContextMenuItems.tsx","webpack://discrelog/./src/components/CircuitEditor/components/FieldContextMenu.tsx","webpack://discrelog/./src/components/CircuitEditor/drag-items/new-node.ts","webpack://discrelog/./src/components/CircuitEditor/contexts/viewport-context.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/contexts/fieldSvgElement.tsx","webpack://discrelog/./src/components/CircuitEditor/contexts/circuit-editor-context.tsx","webpack://discrelog/./src/components/CircuitEditor/utils.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/hooks/useMouseCoords.ts","webpack://discrelog/./src/styles/interaction.module.css?621c","webpack://discrelog/./src/services/simulator/selectors/nodes.ts","webpack://discrelog/./src/nodes/visuals/node-visuals.module.css?b45e","webpack://discrelog/./src/nodes/visuals/index.tsx","webpack://discrelog/./src/nodes/visuals/IntegratedCircuitNode.tsx","webpack://discrelog/./src/nodes/visuals/MomentaryInteractionNode.tsx","webpack://discrelog/./src/nodes/visuals/ToggleInteractionNode.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/NodeVisual.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/DragNewNodeLayer.tsx","webpack://discrelog/./src/services/circuit-editor-drag/selectors/drag.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/DragNodePreviewLayer.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WireJointVisual/WireJointVisual.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WireJointVisual/index.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WireJointVisual/WireJointVisual.module.css?d60b","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/DragJointPreviewLayer.tsx","webpack://discrelog/./src/hooks/useMouseDragDetector.ts","webpack://discrelog/./src/modifier-keys.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/DragSelectLayer.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/GridBackground.tsx","webpack://discrelog/./src/components/AtomicTextInput.tsx","webpack://discrelog/./src/components/EditableText.tsx","webpack://discrelog/./src/components/Menus/EditableTextMenuItem.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/NodeContextMenu.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/Node/Node.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/Node/index.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/NodesLayer.tsx","webpack://discrelog/./src/services/simulator/selectors/wires.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WireSegment.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WireJoint.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/Wire/index.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/Wire/Wire.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/Wire/Wire.module.css?e4ef","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WiresLayer.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/NodePin/NodePin.module.css?5531","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/NodePin/index.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/NodePin/NodePin.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/NodePins.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/NodePinsLayer.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/DragAttachWirePreviewLayer.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/EditorDragReceiver.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/index.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/CircuitFieldSurface.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/CircuitFieldSurface.module.css?4f8f","webpack://discrelog/./src/components/CircuitEditor/CircuitEditor.tsx","webpack://discrelog/./src/components/CircuitEditor/index.ts","webpack://discrelog/./src/components/CircuitEditor/CircuitEditor.module.css?a428","webpack://discrelog/./src/components/Icons/Close.tsx","webpack://discrelog/./src/components/Tessel/TesselWindow.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/windows/CircuitEditorWindow/keymap.ts","webpack://discrelog/./src/pages/ProjectEditorPage/windows/CircuitEditorWindow/CircuitEditorWindow.tsx","webpack://discrelog/./src/components/SelectionList/SelectionList.tsx","webpack://discrelog/./src/components/SelectionList/SelectionList.module.css?89a4","webpack://discrelog/./src/components/SelectionList/index.ts","webpack://discrelog/./src/pages/ProjectEditorPage/windows/CircuitsTreeWindow/CircuitsTreeWindow.tsx","webpack://discrelog/./src/components/Tooltip/index.ts","webpack://discrelog/./src/components/Tooltip/Tooltip.tsx","webpack://discrelog/./src/components/Tooltip/Tooltip.module.css?a017","webpack://discrelog/./src/pages/ProjectEditorPage/windows/NodeTrayWindow/NodeTrayWindow.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/windows/NodeTrayWindow/NodeTrayWindow.module.css?31ef","webpack://discrelog/./src/pages/ProjectEditorPage/ProjectEditorPage.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/windows/CircuitsTreeWindow/CircuitsTreeWindow.module.css?916b","webpack://discrelog/./src/pages/ProjectEditorPage/index.ts","webpack://discrelog/./src/pages/ProjectImporterPage/index.ts","webpack://discrelog/./src/pages/ProjectImporterPage/ProjectImporterPage.tsx","webpack://discrelog/./src/router.tsx","webpack://discrelog/./src/services/dialog/selectors/dialog.ts","webpack://discrelog/./src/components/Modal/Modal.module.css?d409","webpack://discrelog/./src/components/Modal/index.ts","webpack://discrelog/./src/components/Modal/Modal.tsx","webpack://discrelog/./src/components/Dialog/index.ts","webpack://discrelog/./src/components/Dialog/Dialog.tsx","webpack://discrelog/./src/components/Dialog/Dialog.module.css?a332","webpack://discrelog/./src/dialogs/dialog-types/export-project-link/ExportProjectLinkDialog.tsx","webpack://discrelog/./src/dialogs/dialog-types/export-project-link/ExportProjectLinkDialog.module.css?13e0","webpack://discrelog/./src/dialogs/dialog-types/import-project-circuits/ImportProjectCircuitsDialog.tsx","webpack://discrelog/./src/dialogs/dialog-types/import-project-circuits/ImportProjectCircuitsDialog.module.css?16e9","webpack://discrelog/./src/components/DialogManager/DialogManager.tsx","webpack://discrelog/./src/components/DialogManager/index.ts","webpack://discrelog/./src/dialogs/renderer.tsx","webpack://discrelog/./src/index.tsx","webpack://discrelog/./src/components/App/App.tsx","webpack://discrelog/./src/nodes/definitions/interaction/momentary.tsx","webpack://discrelog/./src/nodes/definitions/interaction/toggle.tsx","webpack://discrelog/./src/nodes/definitions/logic/and.tsx","webpack://discrelog/./src/nodes/definitions/logic/buffer.tsx","webpack://discrelog/./src/nodes/definitions/logic/nand.tsx","webpack://discrelog/./src/nodes/definitions/logic/nor.tsx","webpack://discrelog/./src/nodes/definitions/logic/not.tsx","webpack://discrelog/./src/nodes/definitions/logic/or.tsx","webpack://discrelog/./src/nodes/definitions/logic/xor.tsx","webpack://discrelog/./src/nodes/definitions/output/led.ts","webpack://discrelog/./src/nodes/definitions/output/seg7.ts","webpack://discrelog/./src/nodes/definitions/pins/high.tsx","webpack://discrelog/./src/nodes/definitions/pins/input.tsx","webpack://discrelog/./src/nodes/definitions/pins/output.tsx","webpack://discrelog/./src/nodes/visuals/ShapePathNode.tsx","webpack://discrelog/./src/nodes/visuals/static-node-visual.tsx","webpack://discrelog/./src/svg.ts"],"names":["ACTION_NODE_INTERACT","interactNode","circuitNodeIdPath","data","type","payload","isInteractNodeAction","action","ELEMENT_TRANSISTER_RESPONSE_TIME","inputPins","outputPins","interact","state","undefined","transitions","tickOffset","valuesByPin","OUT","Math","round","defaultToggleState","toggleState","nextState","Object","assign","evolve","_","inputs","A","B","IN","value","pointSchema","shape","x","required","y","ZeroPoint","freeze","ZeroRect","p1","p2","boundsToRect","bounds","snapPoint","p","snap","magnitude","v","sqrt","normalize","m","dotProduct","a","b","scale","scaler","normalizeRectangle","args","length","r","min","max","offsetRectangle","rect","offset","pointAdd","pointSubtract","pointEquals","pointIntersects","calcSize","width","height","union","r1","r2","intersects","defaultCircuitEditorDragServiceState","dragMode","ROOT_CIRCUIT_ID","DEFAULT_CIRCUIT_EDITOR_ID","circucitEditorsById","circuitId","activeEditorId","defaultCircuitEditorServiceState","circuitNamesByCircuitId","nodeIdsByCircuitId","defaultCircuitsServiceState","defaultClipboardServiceState","clipboardNodes","clipboardPasteOrigin","defaultDialogServiceState","dialogType","defaultNodeGraphServiceState","nodesById","connectionsById","defaultNodeLayoutServiceState","nodePositionsById","wireJointIdsByConnectionId","wireJointPositionsByJointId","defaultProjectServiceState","projectName","projectModified","defaultSelectionServiceState","selectedNodeIds","selectedConnectionIds","selectedJointIds","defaultSimulatorServiceState","initialized","tick","lastTickProcessingTimeMs","nodeStatesByNodeId","nodeOutputValuesByNodeId","transitionsById","transitionWindows","defaultSimulatorControlServiceState","mode","ticksPerSecond","cls","values","filter","Boolean","join","fpSet","fpSetByArray","slice","map","String","target","path","firstPaths","lastPath","newData","clone","rollingTarget","seg","obj","Array","isArray","isTruthy","windowId","isTesselWindow","item","normalizeTesselDivision","firstPercent","isTesselPercentDivision","isTesselFixedDivision","useRefValue","ref","current","top","left","bottom","right","toJSON","direction","onChangePercentage","pointerCaptureRef","directionRef","onChangePercentageRef","onHandlePointerMove","e","parentRect","parentElement","getBoundingClientRect","percentage","position","pageX","isNaN","pageY","leading","onPointerMove","persist","onPointerDown","defaultPrevented","preventDefault","setPointerCapture","pointerId","onPointerUp","releasePointerCapture","className","tesselPathContext","useTesselPath","TesselPathProvider","pathKey","children","newPath","Provider","noop","tesselInteractionContext","moveWindow","closeWindow","useTesselInteraction","TesselInteractionProvider","context","applyDivisionChange","division","percent","absolute","secondSize","firstSize","renderWindow","onLayoutChange","first","second","divisionValue","sizeDirection","onFirstLayoutChange","onSecondLayoutChange","firstFix","secondFix","firstSizeDiv","secondSizeDiv","style","asArray","arrayEquals","every","i","dropIndexFp","array","index","newArray","push","useComponentBounds","size","setSize","observer","el","observe","disconnect","TESSEL_WINDOW_DRAG_OBJECT","tesselWindowDragObject","isTesselWindowDragObject","forwardRef","tesselPath","dropPos","setDropPos","onHover","monitor","isOver","shallow","pos","getClientOffset","xPercent","yPercent","onDrop","draggingPath","draggingSelf","dropRef","useDrop","accept","collect","getItem","hover","drop","dropMarkerClassname","divRef","filterTesselValues","normalized","pruneEmptyTesselValues","rootItem","from","to","newRoot","movingElement","newItem","Error","CIRCUIT_FIELD_WINDOW_ID","circuitEditorTesselWindow","circuitEditorId","windowProps","editorId","isCircuitEditorTesselWindow","layout","defaultUiLayoutServiceState","defaultUiSettingsState","nodeNameMode","_defaultServiceState","circuitEditorDrag","circuitEditors","nodeGraph","nodeLayout","circuits","clipboard","dialog","project","selection","simulator","simulatorControl","uiLayout","uiSettings","defaultServicesState","UndoServicesStateKeys","_defaultAppState","services","undo","undoStack","redoStack","defaultAppState","rootUrlBuilder","URL","window","location","origin","pathname","rootUrl","toString","ACTION_INIT","ACTION_CIRCUIT_ADD","addCircuit","circuitName","edit","ACTION_CIRCUIT_DELETE","isDeleteCircuitAction","ACTION_CIRCUIT_RENAME","ACTION_NODE_ADD","addNode","nodeType","opts","nodeId","isAddNodeAction","ACTION_NODE_DELETE","deleteNode","nodeIds","isDeleteNodeAction","ACTION_NODE_RENAME","ACTION_SELECTION_ALIGN_TO_GRID","ACTION_SELECTION_DELETE","deleteSelection","ACTION_SELECTION_MOVE","ACTION_WIRE_ATTACH","attachWire","connectionId","joints","isAttachWireAction","ACTION_WIRE_DETATCH","isDetatchWireAction","ACTION_WIRE_JOINT_ADD","ACTION_WIRE_JOINT_MOVE","moveWireJoint","jointId","jointIds","relative","snapMode","ACTION_WIRE_JOINT_DELETE","ACTION_PASTE","ACTION_CIRCUIT_EDITOR_DRAG_END","ACTION_UNDO","isUndoAction","ACTION_REDO","redo","isRedoAction","ACTION_PROJECT_NEW","newProject","isNewProjectAction","ACTION_PROJECT_RECEIVE","receiveProject","fileName","saveData","PROJECT_MUTATION_ACTIONS","isProjectMutationAction","indexOf","createServiceReducerCreator","service","reducer","newState","createServiceSelectorCreator","selector","appSelector","s","local","createCircuitEditorsReducer","createCircuitEditorsSelector","circuitEditorStateFromIdSelector","circuitIdForEditorIdSelector","editorState","activeCircuitEditorIdSelector","activeCircuitEditorStateSelector","editorIdsFromCircuitIdSelector","keys","id","captureUndoState","viewCircuitId","activeEditor","serviceStates","concatReducers","reducers","concat","ACTION_CIRCUIT_EDITOR_DRAG_ABORT","circuitEditorDragAbort","createCircuitEditorDragReducer","createCircuitEditorDragSelector","isCircuitEditorDragAbortAction","ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE","isCircuitEditorDragContinueAction","dragPos","modifierKeys","dragEnd","dragEndEditorId","dragModifierKeys","getSelectMode","modifiers","defaultMode","shiftKey","ctrlMetaKey","combineSelection","selectedIds","chosenIds","chosen","ACTION_SELECT_REGION","createNodeGraphReducer","createNodeGraphSelector","nodesByNodeIdSelector","nodeIdsSelector","nodeTypesByNodeIdSelector","nodeFromNodeIdSelector","nodeIdsFromTypeSelector","desiredType","nodeTypeFromNodeIdSelector","node","nodeNamesByNodeIdSelector","nodeName","nodeNameOrDefaultFromNodeIdSelector","substr","nodeNameFromNodeIdSelector","createCircuitsReducer","createCircuitsSelector","nodeIdsByCircuitIdSelector","nodeIdsFromCircuitIdSelector","circuitIdFromNodeIdSelector","createNodeLayoutReducer","createNodeLayoutSelector","nodePositionsByNodeIdSelector","nodePositionFromNodeIdSelector","circuitIdToNodeType","nodeTypeToCircuitId","startsWith","getICBorderPath","inputPinCount","outputPinCount","circuitIdsSelector","circuitNamesByIdSelector","circuitNameFromIdSelector","circuitIdForNodeIdSelector","circuitIds","circuitWouldRecurseSelector","targetCircuitId","targetCircuitNodeType","some","targetContainingCircuitId","circuitPinPosition","pinIndex","nodeTypesByNodeId","nodePositionsByNodeId","circuitNamesById","circuitNodeIds","pinNodeIds","circuitNodeId","pins","inputPinIds","outputPinIds","pinNodeId","componentProps","category","displayName","elementProduction","visual","hitRect","trayComponent","stroke","strokeWidth","fill","x1","y1","x2","y2","component","cachedNodeDefinitionsSelector","nodeDefinitionsSelector","nodeDefinitions","source","resolved","resolveSources","def","nodeDefinitionsByTypeSelector","defs","defsByType","nodeDefinitionFromTypeSelector","definitions","nodePinSchema","pinId","nodePinEquals","nodePinPositionsByPinIdByNodeIdSelector","nodeDefsByType","nodePinPositionsByPinIdByNodeId","nodePinPositionsByPinId","nodePosition","elementType","pinIds","relPinPosition","pinPosition","cachedPinFromPoint","nodePinFromPointSelector","point","pinPositionsByPinByNode","pinPositionsByPinId","pin","gridNodeSnapSelector","gridJointSnapSelector","applyGridNodeSnapSelector","applyGridJointSnapSelector","ACTION_CIRCUIT_EDITOR_DRAG_START_JOINT","ACTION_SELECT_WIRE_JOINTS","selectWireJoints","createSelectionReducer","createSelectionSelector","selectedNodeIdsSelector","isNodeSelectedFromNodeIdSelector","isWireSelectedFromConnectionIdSelector","selectedJointIdsSelector","isJointSelectedFromJointIdSelector","connectionIdsByCircuitIdSelector","inputPin","outputPin","includes","circuitIdFromConnectionIdSelector","conn","ACTION_CIRCUIT_EDITOR_DRAG_START_NEWJOINT","appState","isCircuitEditorDragStartNewJointAction","addAfterJointId","dragStart","dragStartEditorId","dragNewJointConnectionId","dragNewJointAfterJointId","ACTION_CIRCUIT_EDITOR_DRAG_START_NODE","ACTION_SELECT_NODES","selectNodes","ACTION_CIRCUIT_EDITOR_DRAG_START_SELECT","isCircuitEditorDragStartSelectAction","ACTION_CIRCUIT_EDITOR_DRAG_START_WIRE","rootState","isCircuitEditorDragStartWireAction","nodeIdsByCircuit","circuitIdForNode","dragWireSource","ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE","isCircuitEditorDragEndAction","dragState","selectionMode","region","selectRegion","moveBy","hasNodes","offsetX","offsetY","moveSelection","addWireJoint","endPin","isCircuitEditorDragStartJointAction","find","connId","circuitIdFromJointIdSelector","isCircuitEditorDragStartNodeAction","isCircuitEditorMouseLeaveAction","keepIds","ACTION_CIRCUIT_EDITOR_RECEIVE_FOCUS","isCircuitEditorReceiveFocusAction","ACTION_VIEW_CIRCUIT","viewCircuit","newWindowId","newWindow","isViewCircuitAction","targetWindowId","findActiveEditorId","isAddCircuitAction","ACTION_CIRCUIT_IMPORT","saveCircuitSchema","saveNodeSchema","nullable","saveWireSchema","output","input","of","saveDataSchema","nodes","wires","connectionsByIdSelector","connectionIdsSelector","connectionFromConnectionIdSelector","connectionsSelector","connectionIdFromInputPinSelector","connectionIds","nodeInputConnectionIdsFromNodeIdSelector","nodeOutputConnectionIdsFromNodeIdSelector","nodeConnectionIdsFromNodeIdSelector","outputs","nodeDefFromNodeIdSelector","startPositionCacheByConnectionId","endPositionCacheByConnectionId","wireJointIdsByConnectionIdSelector","wireJointIdsFromConnectionIdSelector","wireJointPositionFromJointIdSelector","wireJointPositionsByJointIdSelector","SaveFormatError","message","super","this","code","createSave","jointPositions","wire","loadSave","save","validateSync","reduce","console","error","isRenameCircuitAction","trimmedName","trim","nodeIdsInCircuit","remainingCircuitIds","serviceState","isImportCircuitAction","existingCircuits","importCircuits","c","importNodes","importCircuitsFromSave","ACTION_COPY_NODES","nodePinsFromPinNodeSelector","icNodeType","icNodeId","createClipboardReducer","isCopyNodesAction","copyIds","rootPosition","copyNodes","connections","nodeDef","outputConnections","result","connection","nodeOutputSourcesByPinIdFromNodeIdSelector","conns","nodeIsSelected","isPasteAction","gridSnap","pastePosition","pasteIds","sourceId","targetCopyId","targetPin","targetId","ACTION_DIALOG_RESPONSE_ACCEPT","acceptDialog","createDialogReducer","createDialogSelector","isAcceptDialogAction","ACTION_DIALOG_RESPONSE_CANCEL","cancelDialog","isCancelDialogAction","ACTION_DIALOG_SHOW","isShowDialogAction","reducerPriority","priority","weight","priorityBefore","remainingNodeIds","removedIcPins","nodeDelete","isRenameNodeAction","p1Node","p2Node","p1Def","p2Def","p1Pin","p2Pin","pinsToConnection","remainingIds","removingNodeConnectionIds","removingPinConnectionIds","removedPin","removingJointIds","remainingConnectionIds","remainingJointIds","ACTION_NODE_MOVE","moveNode","isMoveNodeAction","movedNodePositions","movedP","isAddWireJointAction","wireJoints","insertionIndex","isDeleteWireJointAction","isMoveWireJointAction","movedJoints","localStorage","setItem","JSON","stringify","createProjectReducer","createProjectSelector","removeItem","ACTION_PROJECT_RENAME","isRenameProjectAction","ACTION_PROJECT_SAVE","saveProject","ACTION_PROJECT_SAVE_SUCCESS","autosave","isInitAction","str","parse","loadAutosave","isReceiveProjectAction","isSaveProjectSuccessAction","ACTION_SELECT_CLEAR","selectAll","isSelectAllAction","wireJointIdsFromConnectionId","isClearSelectionAction","isSelectWireJointsAction","isSelectNodesAction","nodeRectsByIdSelector","positionsById","nodeTypesById","isSelectRegionAction","rects","chosenNodeIds","chosenJointIds","jointIdsFromCircuitIdSelector","ACTION_SELECT_WIRES","isSelectWiresAction","ACTION_SELECTION_COPY","isSelectionAlignToGridAction","nodePositions","nodePos","snappedPos","jointPos","isCopySelectionAction","selectedNodes","isDeleteSelectionAction","detatchWire","deleteWireJoint","isMoveSelectionAction","nodeSnapMode","jointSnapMode","createSimulatorReducer","createSimulatorSelector","asElementDef","module","default","ElementDefinitionsByType","getSimulatorNodeIdFromCircuitNodeIdPath","simulatorNodeIdPath","pop","simulatorNodeIdItem","simulatorNodeId","EMPTY_PRODUCTION","simulatorNodesById","simulatorNodeIdsByCircuitNodeId","inputElementPinsByCircuitPinId","outputElementPinsByCircuitPinId","produceCircuitGraph","dependencies","inputCircuitNodeIds","outputCircuitNodeIds","circuitNodeInputPinsByPinIdByNodeId","circuitNodeOutputPinsByPinIdByNodeId","productionResult","produceNode","circuitConnectionsById","outputSimPin","inputSimPins","outputSimNode","outputsByOutputPin","outputsByPin","inputSimPin","inputsByPin","production","subCircuitIds","produceElementNode","circuitProuction","produceCircuitNode","EmptySimulatorGraph","elementTypeFromSimulatorNodeId","simulatorNode","elementDefFromSimulatorNodeId","EmptyPinArray","EmptyPinInputs","simInit","simulatorNodeIdsSelector","outputValues","forEach","initNode","collectNodeTransitions","tickWindow","readonlyState","transitionIds","updatedNodes","Set","tid","valuesByOutputPin","updates","key","outputSimulatorNodeIdsFromSimulatorNodeIdSelector","add","inputSourcesByPin","inputPinsByPinIdFromSimulatorNodeIdSelector","inputConn","sourceNodeId","sourcePinId","collectNodeInputs","applyEvolutionResult","evolutionResult","nodeState","transition","defaultMerger","transitionMerger","transitionTick","isNodeTransition","transitionId","transitionWindowIndex","transitionWindow","tickWindowTransitionIndex","removeTransitionById","removeTransitionsByNodeId","newTransition","splice","addTransition","applyOutputTransition","simulatorNodeIdFromCircuitNodeIdSelector","ACTION_SIM_START","startSim","isStartSimAction","ACTION_SIM_STEP","stepSim","isStepSimAction","ACTION_SIM_TICK","tickSim","tickCount","ACTION_SIM_STOP","stopSim","isStopSimAction","simState","windowTick","isTickSimAction","start","performance","now","endTick","saftyCount","shift","simTick","updateTime","createSimulatorControlReducer","createSimulatorControlSelector","ACTION_SIM_PAUSE","pauseSim","isSimActiveSelector","isSimRunningSelector","isSimPausedSelector","ticksPerSecondSelector","isPauseSimAction","runMode","createUiLayoutReducer","createUiLayoutSelector","removedWindowIds","ACTION_LAYOUT_REARRANGE","isRearrangeLayoutAction","inserted","replace","doWork","newValue","VIEW_RESET","resetView","isResetViewAction","VIEW_NODE_NAMES","viewNodeNames","createUiSettingsReducer","createUiSettingsSelector","isViewNodeNamesAction","finalizedList","finalizeReducerList","actionsBlacklist","displayDialogSaga","showDialog","response","ACTION_PROJECT_EXPORT_LINK","exportProjectLink","projectExportLinkSaga","onExportLink","saveText","encoded","encodedText","urlData","encodeURIComponent","projectLink","search","ACTION_PROJECT_IMPORT_CIRCUITS","importCircuitFromProject","projectImportCircuitsSaga","handleProjectImportCircuits","file","contents","text","bind","scanCircuitIds","targetCircuitIds","nodeCircuitId","nodeIcCircuitId","ACTION_PROJECT_IMPORT_LINK","projectImportLinkSaga","onImportLink","dewrapped","decodeURIComponent","deflated","ACTION_PROJECT_LOAD","loadProject","projectLoadSaga","name","lastIndexOf","warn","projectNameSelector","projectModifiedSelector","projectSaveSaga","showSaveFilePicker","saveNativeFileApi","saveLegacy","fileHandle","suggestedName","types","description","getFile","renameProject","writable","createWritable","write","close","blob","Blob","saveAs","saveDataSaga","runModeSaga","handleRunSim","tps","timeToWait","ceil","simulatorSaga","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","actionSanitizer","stateSanitizer","sagaMiddleware","store","stackItem","undoReducer","redoReducer","undoState","captureUndoStateReducer","useSelector","useNativeEvent","listener","options","listenTarget","addEventListener","removeEventListener","run","dispatch","layoutSelector","title","noopPopoverChildContext","registerPopoverChild","unregisterPopoverChild","PopoverChildContext","PopoverChildContextProvider","contextRegister","contextUnregister","parent","parentRegister","parentUnregister","element","providedContext","isOpen","anchorEl","placement","onRequestClose","popoverRef","setPopoverRef","attributes","styles","usePopper","popoverContext","ctxRef","usePopoverChild","popoverChildren","defaultValue","items","setItems","addItem","useArrayState","onOutsideEvent","when","onEvent","elements","contains","document","useOutsideMouseEvent","createPortal","popper","body","MenuCloseContext","useMenuCloseContext","MenuCloseContextProvider","content","open","setOpen","onClick","onClose","variant","props","useAction","actionCreator","preBind","useClickAction","disabled","secondary","requestMenuClose","onItemClick","onNewProject","onSaveProject","onLoadProject","onImportProjectCircuits","keyboardIsMac","test","os","keyboardCommandModifier","canUndoSelector","canRedoSelector","canUndo","onUndo","canRedo","onRedo","nodeNameModeSelector","onChange","checked","d","ElementNamesMenu","onAlwaysVisible","onNamedOnly","onHidden","onResetView","averageMsecsPerTickSelector","isActive","isPaused","avgMsecsPerTick","onPlayClick","onStopClick","onPauseClick","onStepClick","onMuteMouseDown","toFixed","Stop","onMouseDown","Play","Step","Pause","CircuitNodeBreadcrumbRootItem","rootCircuitName","CircuitNodeBreadcrumbItem","elementPath","MinFieldRect","fieldRectSelector","nodeRectsById","wireJointsById","ContextMenu","useContextMenu","ctxPos","setCtxPos","openContextMenu","onCloseContextMenu","renderContextMenu","onAlignToGrid","onDelete","NEW_NODE_DRAG_OBJECT","newNodeDragObject","isNewNodeDragObject","viewportContext","zoomFactor","zoom","useViewportContext","ViewportContextProvider","setZoomFactor","delta","nullRef","fieldSvgElementContext","svgRef","scalerRef","ContextProvider","FieldSvgElementProvider","circuitEditorContext","useCircuitEditor","CircuitEditorProvider","getFieldCoord","field","ctm","getScreenCTM","pt","createSVGPoint","translated","matrixTransform","inverse","useMouseCoords","nodeOutputsFromCircuitNodeIdSelector","nodeOutputsBySimulatorNodeId","NamedNodeComponents","circuitNodePath","nodeNamesById","borderPath","onViewCircuit","alignmentBaseline","fontSize","textAnchor","onDoubleClick","isSimActive","circuitIdPath","onPress","onRelease","onColor","onTextColor","onMouseUp","onMouseLeave","cx","cy","elementState","offColor","ErrorComponent","componentName","getNodeVisualElement","nodeProps","Component","EmptyState","transform","getMouseCoords","dragType","setDragType","setDragPos","dropTargetWouldRecurse","coords","snapDragPos","opacity","dragModeSelector","isEditorDraggingSelector","isDraggingSelector","dragStartSelector","dragEndSelector","selectionRectSelector","cachedDragMoveOffset","dragMoveOffsetSelector","dragNewJointPositionSelector","dragDropTargetPinSelector","selectedNodePositionsByIdSelector","selectedNodeTypesByIdSelector","isDragging","selectedNodePositionsById","selectedNodeTypesById","dragMoveOffset","interactable","selected","mouseOver","setMouseOver","onMouseOver","onMouseOut","selectedJointPositionsByIdSelector","jointPositionsById","newJointPosition","newJointElement","useMouseDragDetector","dragThreshold","onDragStart","isTracking","setTracking","mouseDownRef","onMouseMove","abs","startTracking","getModifiers","ctrlKey","altKey","metaKey","selectionRect","counterScale","getCoords","button","originalPoint","circuitEditorDragStartSelect","strokeDasharray","gridId","gridSize","xmlns","patternUnits","autoFocus","onBeginEdit","onCommit","onCancel","onBlur","onKeyUp","editValue","setEditValue","onInputChange","onInputKeyUp","onInputBlur","textClassname","inputClassname","label","isEditing","onRequestEdit","inputRef","onSpanDoubleClick","select","onEditableCommit","isRenaming","setIsRenaming","onRename","onRenameCancel","onRenameCommit","renameNode","onOpenCircuitInNewWindow","fontWeight","Node","nodeStatesBySimulatorNodeId","nodeStateFromCircuitNodeIdSelector","isSelected","onContextMenu","circuitEditorDragStartNode","NodeName","nodeFieldDisplayNameFromNodeId","textScale","textYOffset","nodeElements","wireValueFromConnectionIdSelector","icNodePath","nextIcNodePath","nextPin","nextConnectionId","startJointId","endJointId","cacheData","inputNodeDef","inputNodePosition","outputPosition","wireStartPositionFromConnectionIdSelector","end","wireEndPositionFromConnectionIdSelector","mousePos","setMousePos","origionalPoint","circuitEditorDragStartNewJoint","selectWires","onJointInsertMouseDown","insertJointPos","lineDir","circuitEditorDragStartJoint","onJointMouseDown","isPowered","segmentElements","jointElements","connectorElements","highlight","setHighlight","nodePinPositions","nodePinPositionFromNodePinSelector","pinDef","pinDirectionFromNodePinSelector","dragTargetPin","circuitEditorDragStartWire","stopPropagation","onMouseEnter","isDragTarget","pinVisual","isEditorDragging","useEventMouseCoords","buttons","circuitEditorDragContinue","circuitEditorDragEnd","focus","isDraggingNewNode","dragRef","tabIndex","ZoomingCircuitFieldSurface","sizeRef","componentWidth","componentHeight","fieldRect","fieldWidth","fieldHeight","deltaY","passive","onCloseWindow","dragSourceRef","useDrag","Close","KEYMAP_SIM_STEP","KEYMAP_SELECT_ALL","KEYMAP_COPY","KEYMAP_PASTE","KEYMAP_DELETE","KEYMAP_UNDO","KEYMAP_REDO","FillParent","SelectionListItemNode","onItemSelected","CircuitTreeNodeCircuitLabel","onRequestRename","onCancelRename","newName","renameCircuit","onOpenNewWindow","deleteCircuit","CircuitTreeContextMenu","onNewCircuit","arrowRef","setArrowRef","popperStyles","role","arrow","CategoryNames","logic","TrayCategory","TrayNode","liRef","setLiRef","showTooltip","setShowTooltip","onShowTooltip","onHideTooltip","nodeTrayVisual","viewBox","TrayComponent","NodeTrayErrorComponent","WindowsById","categories","keyHandlers","createEventDispatcher","onViewActivated","circuitEditorReceiveFocus","HotKeys","keyMap","handlers","onFocus","onCircuitSelected","listItems","rearrangeLayout","classList","importError","setImportError","searchParams","URLSearchParams","get","importProjectLink","exact","dialogTypeSelector","dialogDataSelector","onClickOutside","onEscapeKey","AutoFocusInside","acceptText","cancelText","onAccept","footer","onCloseDialog","dialogData","onCopy","navigator","writeText","catch","dialogFooter","ImportCircuitCheckbox","onSetSelectedIds","setSelectedIds","onAcceptDialog","DialogComponent","unknownDialog","getDialogComponent","rootEl","getElementById","DndProvider","backend","history","hitPath","fillRule","OFFSET","createSeg","points","C","D","E","F","G","ShapePathNode","shapePath","normalizeVisuals","TrayShapePathNode","TrayShapePadding","createShapePathVisual","createStaticNodeVisual","TrayComponentPadding","describeArc","radius","startAngle","endAngle","polarToCartesian","largeArcFlag","centerX","centerY","angleInDegrees","angleInRadians","PI","cos","sin"],"mappings":"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","file":"client.02933a7264ded90e9f42.bundle.js","sourcesContent":["import { AnyAction } from \"redux\";\n\nexport const ACTION_NODE_INTERACT = \"@node/interact\" as const;\nexport const interactNode = (circuitNodeIdPath: string[], data?: any) => ({\n  type: ACTION_NODE_INTERACT,\n  payload: { circuitNodeIdPath, data },\n});\nexport type InteractNodeAction = ReturnType<typeof interactNode>;\nexport function isInteractNodeAction(\n  action: AnyAction\n): action is InteractNodeAction {\n  return action.type === ACTION_NODE_INTERACT;\n}\n","export const ELEMENT_TRANSISTER_RESPONSE_TIME = 4;\n","import { EvolutionResult } from \"@/logic\";\n\nimport { ELEMENT_TRANSISTER_RESPONSE_TIME } from \"../constants\";\nimport { ElementDefinition } from \"../types\";\n\nconst inputMomentaryElementDefinition: ElementDefinition = {\n  inputPins: [],\n  outputPins: [\"OUT\"],\n  interact(state: any, data: any): EvolutionResult {\n    if (data === undefined) {\n      return {\n        transitions: [\n          {\n            tickOffset: 1,\n            valuesByPin: { OUT: true },\n          },\n          {\n            tickOffset: 1 + Math.round(ELEMENT_TRANSISTER_RESPONSE_TIME * 1.5),\n            valuesByPin: { OUT: false },\n          },\n        ],\n      };\n    } else if (data) {\n      return {\n        transitions: {\n          tickOffset: 1,\n          valuesByPin: { OUT: true },\n        },\n      };\n    } else {\n      return {\n        transitions: {\n          tickOffset: 1,\n          valuesByPin: { OUT: false },\n        },\n      };\n    }\n  },\n};\nexport default inputMomentaryElementDefinition;\n","import { ElementDefinition } from \"../types\";\n\nexport interface ToggleElementState {\n  toggleState: boolean;\n}\nconst defaultToggleState: ToggleElementState = {\n  toggleState: false,\n};\n\nconst buttonToggleElementDefinition: ElementDefinition = {\n  inputPins: [],\n  outputPins: [\"OUT\"],\n  interact(state: ToggleElementState = defaultToggleState) {\n    const nextState = !state.toggleState;\n    return {\n      state: Object.assign({}, state, {\n        toggleState: nextState,\n      }),\n      transitions: {\n        tickOffset: 1,\n        valuesByPin: { OUT: nextState },\n      },\n    };\n  },\n  evolve: (state: ToggleElementState = defaultToggleState) => {\n    return {\n      state,\n      transitions: {\n        tickOffset: 1,\n        valuesByPin: { OUT: state.toggleState },\n      },\n    };\n  },\n};\nexport default buttonToggleElementDefinition;\n","import { ELEMENT_TRANSISTER_RESPONSE_TIME } from \"../constants\";\nimport { ElementDefinition } from \"../types\";\n\nconst andElementDefinition: ElementDefinition = {\n  inputPins: [\"A\", \"B\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: ELEMENT_TRANSISTER_RESPONSE_TIME,\n        valuesByPin: { OUT: inputs.A && inputs.B },\n      },\n    };\n  },\n};\nexport default andElementDefinition;\n","import { ELEMENT_TRANSISTER_RESPONSE_TIME } from \"../constants\";\nimport { ElementDefinition } from \"../types\";\n\nconst bufferElementDefinition: ElementDefinition = {\n  inputPins: [\"IN\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: ELEMENT_TRANSISTER_RESPONSE_TIME,\n        valuesByPin: { OUT: inputs.IN },\n      },\n    };\n  },\n};\nexport default bufferElementDefinition;\n","import { ELEMENT_TRANSISTER_RESPONSE_TIME } from \"../constants\";\nimport { ElementDefinition } from \"../types\";\n\nconst nandElementDefinition: ElementDefinition = {\n  inputPins: [\"A\", \"B\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: ELEMENT_TRANSISTER_RESPONSE_TIME,\n        valuesByPin: { OUT: !(inputs.A && inputs.B) },\n      },\n    };\n  },\n};\nexport default nandElementDefinition;\n","import { ELEMENT_TRANSISTER_RESPONSE_TIME } from \"../constants\";\nimport { ElementDefinition } from \"../types\";\n\nconst norElementDefinition: ElementDefinition = {\n  inputPins: [\"A\", \"B\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: ELEMENT_TRANSISTER_RESPONSE_TIME,\n        valuesByPin: { OUT: !(inputs.A || inputs.B) },\n      },\n    };\n  },\n};\nexport default norElementDefinition;\n","import { ELEMENT_TRANSISTER_RESPONSE_TIME } from \"../constants\";\nimport { ElementDefinition } from \"../types\";\n\nconst notElementDefinition: ElementDefinition = {\n  inputPins: [\"IN\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: ELEMENT_TRANSISTER_RESPONSE_TIME,\n        valuesByPin: { OUT: !inputs.IN },\n      },\n    };\n  },\n};\nexport default notElementDefinition;\n","import { ELEMENT_TRANSISTER_RESPONSE_TIME } from \"../constants\";\nimport { ElementDefinition } from \"../types\";\n\nconst orElementDefinition: ElementDefinition = {\n  inputPins: [\"A\", \"B\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: ELEMENT_TRANSISTER_RESPONSE_TIME,\n        valuesByPin: { OUT: inputs.A || inputs.B },\n      },\n    };\n  },\n};\nexport default orElementDefinition;\n","import { ELEMENT_TRANSISTER_RESPONSE_TIME } from \"../constants\";\nimport { ElementDefinition } from \"../types\";\n\nconst xorElementDefinition: ElementDefinition = {\n  inputPins: [\"A\", \"B\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: ELEMENT_TRANSISTER_RESPONSE_TIME,\n        valuesByPin: { OUT: (inputs.A || inputs.B) && inputs.A != inputs.B },\n      },\n    };\n  },\n};\nexport default xorElementDefinition;\n","import { ElementDefinition } from \"../types\";\n\nexport interface LedElementState {\n  value: boolean;\n}\n\nconst ledElementDefinition: ElementDefinition = {\n  inputPins: [\"IN\"],\n  outputPins: [],\n  evolve(_, inputs) {\n    return {\n      state: {\n        value: inputs.IN,\n      },\n    };\n  },\n};\nexport default ledElementDefinition;\n","import { ElementDefinition } from \"../types\";\n\nconst seg7ElementDefinition: ElementDefinition = {\n  inputPins: [\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\"],\n  outputPins: [],\n  evolve(_, inputs) {\n    return {\n      state: { ...inputs },\n    };\n  },\n};\nexport default seg7ElementDefinition;\n","import { ElementDefinition } from \"../types\";\n\nconst pinHighElementDefinition: ElementDefinition = {\n  inputPins: [],\n  outputPins: [\"OUT\"],\n  evolve() {\n    return {\n      transitions: {\n        tickOffset: 1,\n        valuesByPin: { OUT: true },\n      },\n    };\n  },\n};\nexport default pinHighElementDefinition;\n","import * as yup from \"yup\";\n\nexport interface Point {\n  x: number;\n  y: number;\n}\nexport const pointSchema = yup.object().shape({\n  x: yup.number().required(),\n  y: yup.number().required(),\n});\n\nexport interface Size {\n  width: number;\n  height: number;\n}\n\nexport interface Rectangle {\n  p1: Point;\n  p2: Point;\n}\n\n// Bit silly to have two ways of tracking a rectangular region, but this is inherited from svg-path-bounds\nexport type Bounds = [left: number, top: number, right: number, bottom: number];\n\nexport const ZeroPoint = Object.freeze({ x: 0, y: 0 });\nexport const ZeroRect = Object.freeze({ p1: ZeroPoint, p2: ZeroPoint });\n\nexport function boundsToRect(bounds: Bounds): Rectangle {\n  return {\n    p1: { x: bounds[0], y: bounds[1] },\n    p2: { x: bounds[2], y: bounds[3] },\n  };\n}\n\nexport function snapPoint(p: Point, snap: number) {\n  return {\n    x: Math.round(p.x / snap) * snap,\n    y: Math.round(p.y / snap) * snap,\n  };\n}\n\nexport function magnitude(v: Point): number {\n  return Math.sqrt(v.x * v.x + v.y * v.y);\n}\nexport function normalize(p: Point): Point {\n  const m = magnitude(p);\n  return {\n    x: p.x / m,\n    y: p.y / m,\n  };\n}\n\nexport function dotProduct(a: Point, b: Point): number {\n  return a.x * b.x + a.y * b.y;\n}\n\nexport function scale(p: Point, scaler: number) {\n  return { x: p.x * scaler, y: p.y * scaler };\n}\n\nexport function normalizeRectangle(p1: Point, p2: Point): Rectangle;\nexport function normalizeRectangle(r: Rectangle): Rectangle;\nexport function normalizeRectangle(...args: any[]): Rectangle {\n  let p1: Point;\n  let p2: Point;\n  if (args.length === 1) {\n    const r = args[0] as Rectangle;\n    p1 = r.p1;\n    p2 = r.p2;\n  } else {\n    p1 = args[0] as Point;\n    p2 = args[1] as Point;\n  }\n  return {\n    p1: {\n      x: Math.min(p1.x, p2.x),\n      y: Math.min(p1.y, p2.y),\n    },\n    p2: {\n      x: Math.max(p1.x, p2.x),\n      y: Math.max(p1.y, p2.y),\n    },\n  };\n}\n\nexport function offsetRectangle(rect: Rectangle, offset: Point) {\n  return {\n    p1: pointAdd(rect.p1, offset),\n    p2: pointAdd(rect.p2, offset),\n  };\n}\n\nexport function pointAdd(p1: Point, p2: Point): Point {\n  return {\n    x: p1.x + p2.x,\n    y: p1.y + p2.y,\n  };\n}\nexport function pointSubtract(p1: Point, p2: Point): Point {\n  return {\n    x: p1.x - p2.x,\n    y: p1.y - p2.y,\n  };\n}\nexport function pointEquals(p1: Point, p2: Point): boolean {\n  return p1.x === p2.x && p1.y === p2.y;\n}\n\nexport function pointIntersects(p: Point, r: Rectangle): boolean {\n  r = normalizeRectangle(r);\n\n  if (r.p1.x > p.x || r.p2.x < p.x) {\n    return false;\n  }\n\n  if (r.p1.y > p.y || r.p2.y < p.y) {\n    return false;\n  }\n\n  return true;\n}\n\nexport function calcSize(r: Rectangle): Size {\n  r = normalizeRectangle(r);\n  return {\n    width: r.p2.x - r.p1.x,\n    height: r.p2.y - r.p1.y,\n  };\n}\n\nexport function union(r1: Rectangle, r2: Rectangle): Rectangle {\n  r1 = normalizeRectangle(r1);\n  r2 = normalizeRectangle(r2);\n  return {\n    p1: {\n      x: Math.min(r1.p1.x, r2.p1.x),\n      y: Math.min(r1.p1.y, r2.p1.y),\n    },\n    p2: {\n      x: Math.max(r1.p2.x, r2.p2.x),\n      y: Math.max(r1.p2.y, r2.p2.y),\n    },\n  };\n}\n\nexport function intersects(r1: Rectangle, r2: Rectangle): boolean {\n  r1 = normalizeRectangle(r1);\n  r2 = normalizeRectangle(r2);\n\n  // r1 starts after p2's extent, or does not reach r2's start.\n  if (r1.p1.x > r2.p2.x || r1.p2.x < r2.p1.x) {\n    return false;\n  }\n\n  // r1 starts after p2's extent, or does not reach r2's start.\n  if (r1.p1.y > r2.p2.y || r1.p2.y < r2.p1.y) {\n    return false;\n  }\n\n  return true;\n}\n","import { createHashHistory } from \"history\";\n\nconst history = createHashHistory();\n\nexport default history;\n","import { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nimport { NodePin } from \"../node-graph/types\";\n\nexport interface CircuitEditorDragNullState {\n  dragMode: null;\n}\n\nexport interface CircuitEditorDragActiveState {\n  /**\n   * The editor this drag operation started in.\n   */\n  dragStartEditorId: string;\n\n  /**\n   * The start of the drag operation.\n   */\n  dragStart: Point;\n\n  /**\n   * The editor the drag operation is currently in.\n   */\n  dragEndEditorId: string | null;\n\n  /**\n   * The current end point for the drag operation.  This does not indicate the final\n   * drag position, but the current most up to date position.\n   */\n  dragEnd: Point | null;\n}\n\nexport interface CircuitEditorDragMoveState\n  extends CircuitEditorDragActiveState {\n  dragMode: \"move\";\n\n  /**\n   * The modifier keys in play for the drag operation.\n   */\n  dragModifierKeys: ModifierKeys;\n}\n\nexport interface CircuitEditorDragSelectState\n  extends CircuitEditorDragActiveState {\n  dragMode: \"select\";\n\n  /**\n   * The modifier keys in play for the drag operation.\n   */\n  dragModifierKeys: ModifierKeys;\n}\n\nexport interface CircuitEditorDragNewJointState\n  extends CircuitEditorDragActiveState {\n  dragMode: \"new-joint\";\n\n  /**\n   * The modifier keys in play for the drag operation.\n   */\n  dragModifierKeys: ModifierKeys;\n\n  /**\n   * The connection id to create the joint on.\n   */\n  dragNewJointConnectionId: string | null;\n\n  /**\n   * The joint id to add the new joint after.\n   */\n  dragNewJointAfterJointId: string | null;\n}\n\nexport interface CircuitEditorDragWireState\n  extends CircuitEditorDragActiveState {\n  dragMode: \"wire\";\n\n  /**\n   * If drag mode is \"wire\", this is the source pin being wired by the drag.\n   */\n  dragWireSource: NodePin | null;\n}\n\nexport type CircuitEditorDragServiceState =\n  | CircuitEditorDragNullState\n  | CircuitEditorDragMoveState\n  | CircuitEditorDragSelectState\n  | CircuitEditorDragNewJointState\n  | CircuitEditorDragWireState;\n\nconst _defaultState: CircuitEditorDragServiceState = {\n  dragMode: null,\n};\n\nexport const defaultCircuitEditorDragServiceState = Object.freeze(\n  _defaultState\n);\n","export const ROOT_CIRCUIT_ID = \"root\";\n","export const DEFAULT_CIRCUIT_EDITOR_ID = \"root-editor\";\n","import { ROOT_CIRCUIT_ID } from \"../circuits/constants\";\n\nimport { DEFAULT_CIRCUIT_EDITOR_ID } from \"./constants\";\n\nexport interface CircuitEditorState {\n  circuitId: string;\n  circuitNodeIdPath: string[];\n}\n\nexport interface CircuitEditorsServiceState {\n  circucitEditorsById: Record<string, CircuitEditorState>;\n  activeEditorId: string | null;\n}\n\nconst _defaultState: CircuitEditorsServiceState = {\n  circucitEditorsById: {\n    [DEFAULT_CIRCUIT_EDITOR_ID]: {\n      circuitId: ROOT_CIRCUIT_ID,\n      circuitNodeIdPath: [],\n    },\n  },\n  activeEditorId: null,\n};\n\nexport const defaultCircuitEditorServiceState = Object.freeze(_defaultState);\n","import { ROOT_CIRCUIT_ID } from \"./constants\";\n\nexport interface CircuitsServiceState {\n  /**\n   * The user-provided names for circuits by circuit id.\n   */\n  circuitNamesByCircuitId: Record<string, string>;\n\n  /**\n   * Arrays of node ids contained in a circuit by the containing circuit id.\n   */\n  nodeIdsByCircuitId: Record<string, string[]>;\n}\n\nconst _defaultState: CircuitsServiceState = {\n  circuitNamesByCircuitId: {\n    [ROOT_CIRCUIT_ID]: \"Root\",\n  },\n  nodeIdsByCircuitId: {\n    [ROOT_CIRCUIT_ID]: [],\n  },\n};\n\nexport const defaultCircuitsServiceState = Object.freeze(_defaultState);\n","import { Point, ZeroPoint } from \"@/geometry\";\n\nimport { ClipboardNode } from \"./types\";\n\nexport interface ClipboardServiceState {\n  clipboardNodes: ClipboardNode[];\n  clipboardPasteOrigin: Point;\n}\n\nexport const defaultClipboardServiceState: Readonly<ClipboardServiceState> = Object.freeze(\n  {\n    clipboardNodes: [],\n    clipboardPasteOrigin: ZeroPoint,\n  }\n);\n","// FIXME: There has got to be a better way of typing these, so api and selectors are type safe.\n\nimport { DialogType } from \"@/dialogs/types\";\n\nexport interface DialogServiceState {\n  dialogType: DialogType | null;\n  data: any;\n}\n\nconst _defaultState: DialogServiceState = {\n  dialogType: null,\n  data: null,\n};\n\nexport const defaultDialogServiceState: Readonly<DialogServiceState> = Object.freeze(\n  _defaultState\n);\n","import { Node, Connection } from \"./types\";\n\nexport interface NodeGraphServiceState {\n  /**\n   * A map of nodes by node id.\n   */\n  nodesById: Record<string, Node>;\n\n  /**\n   * A map of connections between nodes, by connection id.\n   */\n  connectionsById: Record<string, Connection>;\n}\n\nconst _defaultState: NodeGraphServiceState = {\n  nodesById: {},\n  connectionsById: {},\n};\n\nexport const defaultNodeGraphServiceState = Object.freeze(_defaultState);\n","import { Point } from \"@/geometry\";\n\nexport interface NodeLayoutServiceState {\n  nodePositionsById: Record<string, Point>;\n  wireJointIdsByConnectionId: Record<string, string[]>;\n  wireJointPositionsByJointId: Record<string, Point>;\n}\n\nconst _defaultState: NodeLayoutServiceState = {\n  nodePositionsById: {},\n  wireJointIdsByConnectionId: {},\n  wireJointPositionsByJointId: {},\n};\n\nexport const defaultNodeLayoutServiceState: Readonly<NodeLayoutServiceState> = Object.freeze(\n  _defaultState\n);\n","export interface ProjectServiceState {\n  projectName: string;\n  projectModified: boolean;\n}\n\nconst _defaultProps: ProjectServiceState = {\n  projectName: \"New Project\",\n  projectModified: false,\n};\n\nexport const defaultProjectServiceState = Object.freeze(_defaultProps);\n","export interface SelectionServiceState {\n  selectedNodeIds: string[];\n  selectedConnectionIds: string[];\n  selectedJointIds: string[];\n}\n\nconst _defaultState: SelectionServiceState = {\n  selectedNodeIds: [],\n  selectedConnectionIds: [],\n  selectedJointIds: [],\n};\n\nexport const defaultSelectionServiceState = Object.freeze(_defaultState);\n","import { SimNodePinTransition, SimTransitionWindow } from \"./types\";\n\nexport interface SimulatorServiceState {\n  /**\n   * Whether the simulator has been initialized.\n   */\n  initialized: boolean;\n\n  /**\n   * The current tick the simulator is on.\n   */\n  tick: number;\n\n  /**\n   * The time it took in milliseconds to process the last tick.\n   */\n  lastTickProcessingTimeMs: number;\n\n  /**\n   * A map of node states by node id.\n   */\n  nodeStatesByNodeId: Record<string, any>;\n\n  /**\n   * A map of output-to-value maps by node id.\n   */\n  nodeOutputValuesByNodeId: Record<string, Record<string, boolean>>;\n\n  /**\n   * A map of pending transitions by id.\n   */\n  transitionsById: Record<string, SimNodePinTransition>;\n\n  /**\n   * Transition windows in ascending order of tick.\n   */\n  transitionWindows: SimTransitionWindow[];\n}\n\nconst _defaultState: SimulatorServiceState = {\n  initialized: false,\n  tick: 0,\n  lastTickProcessingTimeMs: 0,\n  nodeStatesByNodeId: {},\n  nodeOutputValuesByNodeId: {},\n  transitionsById: {},\n  transitionWindows: [],\n};\n\nexport const defaultSimulatorServiceState = Object.freeze(_defaultState);\n","export interface SimulatorControlServiceState {\n  /**\n   * The overall application mode.\n   * Might not belong in simulator state?\n   *\n   * - edit: User is editing, no simulator is running\n   * - step: Sim is paused and only ticks on user command\n   * - run: Sim is actively running and ticking forwards on its own.\n   */\n  mode: \"edit\" | \"pause\" | \"run\";\n\n  /**\n   * Tick speed in ticks per second when running.\n   */\n  ticksPerSecond: number;\n}\n\nconst _defaultState: SimulatorControlServiceState = {\n  mode: \"edit\",\n  ticksPerSecond: 1000,\n};\n\nexport const defaultSimulatorControlServiceState = Object.freeze(_defaultState);\n","export function cls(...values: (string | false | undefined)[]): string {\n  return values.filter((x) => Boolean(x) && x != \"\").join(\" \");\n}\n\nexport function typedKeys<T extends Record<string, unknown>>(\n  obj: T\n): (keyof T)[] {\n  return Object.keys(obj) as (keyof T)[];\n}\n\nexport type ValueSetter<T> = T | ((old: T) => T);\n\nexport function fpSet<\n  Target extends Record<string, any> | any[],\n  P1 extends keyof Target,\n  T extends Target[P1]\n>(target: Target, p1: P1, value: ValueSetter<T>): Target;\nexport function fpSet<\n  Target extends Record<string, any> | any[],\n  P1 extends keyof Target,\n  P2 extends keyof Target[P1],\n  T extends Target[P1][P2]\n>(target: Target, p1: P1, p2: P2, value: ValueSetter<T>): Target;\nexport function fpSet<\n  Target extends Record<string, any> | any[],\n  P1 extends keyof Target,\n  P2 extends keyof Target[P1],\n  P3 extends keyof Target[P1][P2],\n  T extends Target[P1][P2][P3]\n>(target: Target, p1: P1, p2: P2, p3: P3, value: ValueSetter<T>): Target;\nexport function fpSet(...args: any[]): any {\n  const target = args[0];\n  const path = args.slice(1, args.length - 1).map(String);\n  const value = args[args.length - 1];\n  return fpSetByArray(target, path, value);\n}\n\nexport function fpSetByArray<T extends Record<string, any>>(\n  target: T,\n  path: (string | number)[],\n  value: ValueSetter<any>\n): T {\n  if (path.length === 0) {\n    if (typeof value === \"function\") {\n      return value(target);\n    }\n    return value;\n  }\n\n  const firstPaths = path.slice(0, path.length - 1).map(String);\n  const lastPath = path[path.length - 1];\n\n  const newData = clone(target);\n\n  let rollingTarget: any = newData;\n\n  for (const seg of firstPaths) {\n    rollingTarget[seg] = clone(rollingTarget[seg]);\n    rollingTarget = rollingTarget[seg];\n  }\n\n  if (typeof value === \"function\") {\n    rollingTarget[lastPath] = value(rollingTarget[lastPath]);\n  } else {\n    rollingTarget[lastPath] = value;\n  }\n\n  return newData;\n}\n\nfunction clone<T extends Record<string, unknown> | any[]>(obj: T): T {\n  if (Array.isArray(obj)) {\n    return obj.slice() as T;\n  }\n  return Object.assign({}, obj);\n}\n\nexport function isTruthy<T>(value: T | null | undefined | false): value is T {\n  return Boolean(value);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"fill-parent\":\"fill-parent--3pw6U\"};","// extracted by mini-css-extract-plugin\nexport default {\"flex-row\":\"flex-row--sHjOY\",\"flex-column\":\"flex-column--2LT64\",\"flex-reverse\":\"flex-reverse--2Vn7L\",\"flexitem-shrink\":\"flexitem-shrink--2U9EV\",\"flexitem-fix\":\"flexitem-fix--1ARxk\"};","import has from \"lodash/has\";\n\nexport type TesselWindowRenderer = (\n  window: TesselWindowItem\n) => React.ReactElement | null;\n\nexport interface TesselWindowItem<P = Record<string, any>> {\n  windowId: string;\n  windowProps?: P;\n}\n\nexport type TesselDirection = \"row\" | \"column\";\n\nexport interface TesselPercentDivision {\n  firstPercent: number;\n}\nexport interface TesselFixedDivision {\n  firstSize?: number;\n  secondSize?: number;\n}\nexport type TesselDivision = TesselPercentDivision | TesselFixedDivision;\nexport type TesselDivisionValue = number | TesselDivision;\n\nexport interface TesselSplitItem {\n  first: TesselValue;\n  second: TesselValue;\n  direction: TesselDirection;\n  division: TesselDivisionValue;\n}\n\nexport type TesselItem = TesselWindowItem | TesselSplitItem;\nexport type TesselValue = string | TesselItem;\n\nexport type TesselDropPosition = \"left\" | \"right\" | \"top\" | \"bottom\";\n\nexport function normalizeTesselItem(value: TesselValue): TesselItem {\n  if (typeof value === \"string\") {\n    return {\n      windowId: value,\n    };\n  }\n\n  return value;\n}\n\nexport function isTesselWindow(item: TesselItem): item is TesselWindowItem {\n  return has(item, \"windowId\");\n}\n\nexport function isTesselSplit(item: TesselItem): item is TesselSplitItem {\n  return has(item, \"first\") && has(item, \"second\") && has(item, \"direction\");\n}\n\nexport function normalizeTesselDivision(\n  value: TesselDivisionValue\n): TesselDivision {\n  if (typeof value === \"number\") {\n    return {\n      firstPercent: value,\n    };\n  }\n\n  return value;\n}\n\nexport function isTesselPercentDivision(\n  value: TesselDivision\n): value is TesselPercentDivision {\n  return has(value, \"firstPercent\");\n}\n\nexport function isTesselFixedDivision(\n  value: TesselDivision\n): value is TesselFixedDivision {\n  return has(value, \"firstSize\") || has(value, \"secondSize\");\n}\n","import * as React from \"react\";\n\nexport function useRefValue<T>(value: T): React.RefObject<T> {\n  const ref = React.useRef(value);\n  React.useEffect(() => {\n    ref.current = value;\n  });\n\n  return ref;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"tessel\":\"tessel--2Q3Xd\",\"tessel-content\":\"tessel-content--3-kEA\",\"tessel-drop-capture\":\"tessel-drop-capture--3TbuI\",\"tessel-drop-capture--dragging\":\"tessel-drop-capture--dragging--Ihwyz\",\"tessel-drop-marker\":\"tessel-drop-marker--1cqr2\",\"drop-left\":\"drop-left--wqP1V\",\"drop-right\":\"drop-right--2MyGz\",\"drop-top\":\"drop-top--1S0co\",\"drop-bottom\":\"drop-bottom--2f330\",\"tessel-split\":\"tessel-split--2gDs5\",\"tessel-split--row\":\"tessel-split--row--2fC6o\",\"tessel-split--column\":\"tessel-split--column--1Hl4C\",\"tessel-window\":\"tessel-window--1qDgp\",\"tessel-window-titlebar\":\"tessel-window-titlebar--uHBdn\",\"tessel-window-title\":\"tessel-window-title--2v0hT\",\"tessel-window-controls\":\"tessel-window-controls--3i3ou\",\"tessel-window-controls-close\":\"tessel-window-controls-close--2O8Zs\",\"tessel-window-content\":\"tessel-window-content--sOnG-\"};","import { cls } from \"@/utils\";\nimport * as React from \"react\";\nimport throttle from \"lodash/throttle\";\n\nimport { useRefValue } from \"@/hooks/useRefValue\";\n\nimport { TesselDirection } from \"./types\";\n\nimport styles from \"./Tessel.module.css\";\n\nexport interface TesselSplitProps {\n  direction: TesselDirection;\n  onChangePercentage(percent: number, position: number): void;\n}\n\nconst ZeroRect: DOMRect = Object.freeze({\n  top: 0,\n  left: 0,\n  bottom: 0,\n  right: 0,\n  x: 0,\n  y: 0,\n  height: 0,\n  width: 0,\n  toJSON: () => ({}),\n});\n\nconst TesselSplit: React.FC<TesselSplitProps> = ({\n  direction,\n  onChangePercentage,\n}) => {\n  const ref = React.useRef<HTMLDivElement | null>(null);\n\n  const pointerCaptureRef = React.useRef<number | null>(null);\n\n  // Ref these up so we can continue using the same throttle across rerenders.\n  const directionRef = useRefValue(direction);\n  const onChangePercentageRef = useRefValue(onChangePercentage);\n\n  const onHandlePointerMove = React.useMemo(\n    () =>\n      throttle(\n        (e: React.PointerEvent<HTMLDivElement>) => {\n          if (pointerCaptureRef.current == null || ref.current == null) {\n            return;\n          }\n\n          const parentRect =\n            ref.current.parentElement?.getBoundingClientRect() ?? ZeroRect;\n\n          let percentage = 0;\n          let position = 0;\n          if (directionRef.current === \"row\") {\n            position = e.pageX - parentRect.left;\n            percentage = position / parentRect.width;\n            if (isNaN(percentage)) {\n              percentage = 0;\n              position = parentRect.left;\n            } else if (percentage > 1) {\n              percentage = 1;\n              position = parentRect.right;\n            }\n          } else {\n            position = e.pageY - parentRect.top;\n            percentage = position / parentRect.height;\n            if (isNaN(percentage)) {\n              percentage = 0;\n              position = parentRect.top;\n            } else if (percentage > 1) {\n              percentage = 1;\n              position = parentRect.bottom;\n            }\n          }\n\n          onChangePercentageRef.current!(percentage * 100, position);\n        },\n        1000 / 60,\n        { leading: true }\n      ),\n    [directionRef, onChangePercentageRef]\n  );\n\n  const onPointerMove = React.useCallback(\n    (e: React.PointerEvent<HTMLDivElement>) => {\n      e.persist();\n      onHandlePointerMove(e);\n    },\n    [onHandlePointerMove]\n  );\n\n  const onPointerDown = React.useCallback(\n    (e: React.PointerEvent<HTMLDivElement>) => {\n      if (e.defaultPrevented || !ref.current) {\n        return;\n      }\n\n      if (pointerCaptureRef.current) {\n        return;\n      }\n\n      e.preventDefault();\n\n      ref.current.setPointerCapture(e.pointerId);\n      pointerCaptureRef.current = e.pointerId;\n    },\n    []\n  );\n\n  const onPointerUp = React.useCallback(() => {\n    if (ref.current && pointerCaptureRef.current) {\n      ref.current.releasePointerCapture(pointerCaptureRef.current);\n      pointerCaptureRef.current = null;\n    }\n  }, []);\n\n  return (\n    <div\n      ref={ref}\n      className={cls(\n        \"tessel-split\",\n        styles[\"tessel-split\"],\n        styles[\n          direction === \"row\" ? \"tessel-split--row\" : \"tessel-split--column\"\n        ]\n      )}\n      onPointerDown={onPointerDown}\n      onPointerMove={onPointerMove}\n      onPointerUp={onPointerUp}\n    />\n  );\n};\n\nexport default TesselSplit;\n","import * as React from \"react\";\nimport { TesselDropPosition } from \"./types\";\n\nconst tesselPathContext = React.createContext<string[]>([]);\nexport function useTesselPath() {\n  return React.useContext(tesselPathContext);\n}\nexport interface TesselContextProviderProps {\n  pathKey: string;\n}\nexport const TesselPathProvider: React.FC<TesselContextProviderProps> = ({\n  pathKey,\n  children,\n}) => {\n  const path = useTesselPath();\n\n  const newPath = React.useMemo<string[]>(() => [...path, pathKey], [\n    path,\n    pathKey,\n  ]);\n\n  return (\n    <tesselPathContext.Provider value={newPath}>\n      {children}\n    </tesselPathContext.Provider>\n  );\n};\n\nexport interface TesselInteractionContext {\n  moveWindow(from: string[], to: string[], position: TesselDropPosition): void;\n  closeWindow(path: string[]): void;\n}\nfunction noop() {\n  /* no op */\n}\nconst tesselInteractionContext = React.createContext<TesselInteractionContext>({\n  moveWindow: noop,\n  closeWindow: noop,\n});\nexport function useTesselInteraction() {\n  return React.useContext(tesselInteractionContext);\n}\n\nexport type TesselInteractionProviderProps = TesselInteractionContext;\nexport const TesselInteractionProvider: React.FC<TesselInteractionProviderProps> = ({\n  moveWindow,\n  closeWindow,\n  children,\n}) => {\n  const context = React.useMemo<TesselInteractionContext>(\n    () => ({\n      moveWindow,\n      closeWindow,\n    }),\n    [moveWindow, closeWindow]\n  );\n\n  return (\n    <tesselInteractionContext.Provider value={context}>\n      {children}\n    </tesselInteractionContext.Provider>\n  );\n};\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport sizing from \"@/styles/sizing.module.css\";\nimport flex from \"@/styles/flex.module.css\";\n\nimport {\n  isTesselFixedDivision,\n  isTesselPercentDivision,\n  normalizeTesselDivision,\n  TesselDivision,\n  TesselItem,\n  TesselSplitItem,\n  TesselValue,\n  TesselWindowRenderer,\n} from \"./types\";\n\nimport TesselSplit from \"./TesselSplit\";\nimport TesselFrame from \"./TesselFrame\";\nimport { TesselPathProvider } from \"./TesselContext\";\n\nexport interface TesselSplitFrameProps {\n  item: TesselSplitItem;\n  renderWindow: TesselWindowRenderer;\n  onLayoutChange(relativeRoot: TesselItem): void;\n}\n\nconst TesselSplitFrame: React.FC<TesselSplitFrameProps> = ({\n  item,\n  renderWindow,\n  onLayoutChange,\n}) => {\n  const { direction, first, second, division: divisionValue } = item;\n  const sizeDirection = direction === \"row\" ? \"width\" : \"height\";\n\n  const onChangePercentage = React.useCallback(\n    (percentage: number, absolute: number) => {\n      const division = normalizeTesselDivision(item.division);\n      onLayoutChange({\n        ...item,\n        division: applyDivisionChange(division, percentage, absolute),\n      });\n    },\n    [item, onLayoutChange]\n  );\n\n  const onFirstLayoutChange = React.useCallback(\n    (value: TesselValue) => {\n      onLayoutChange({\n        ...item,\n        first: value,\n      });\n    },\n    [item, onLayoutChange]\n  );\n\n  const onSecondLayoutChange = React.useCallback(\n    (value: TesselValue) => {\n      onLayoutChange({\n        ...item,\n        second: value,\n      });\n    },\n    [item, onLayoutChange]\n  );\n\n  const division = normalizeTesselDivision(divisionValue);\n  let firstSize = \"50%\";\n  let secondSize = \"50%\";\n  let firstFix = false;\n  let secondFix = false;\n  if (isTesselPercentDivision(division)) {\n    const { firstPercent } = division;\n    firstSize = `${firstPercent}%`;\n    secondSize = `${100 - firstPercent}%`;\n  } else if (isTesselFixedDivision(division)) {\n    const { firstSize: firstSizeDiv, secondSize: secondSizeDiv } = division;\n    // Only support one of firstSize or secondSize\n    if (firstSizeDiv) {\n      firstSize = `${firstSizeDiv}px`;\n      firstFix = true;\n      secondSize = \"100%\";\n    } else {\n      firstSize = \"100%\";\n      secondSize = `${secondSizeDiv}px`;\n      secondFix = true;\n    }\n  }\n\n  return (\n    <div\n      className={cls(\n        sizing[\"fill-parent\"],\n        flex[direction === \"row\" ? \"flex-row\" : \"flex-column\"]\n      )}\n    >\n      <div\n        className={cls(\n          firstFix ? flex[\"flexitem-fix\"] : flex[\"flexitem-shrink\"]\n        )}\n        style={{ [sizeDirection]: firstSize }}\n      >\n        <TesselPathProvider pathKey=\"first\">\n          <TesselFrame\n            value={first}\n            renderWindow={renderWindow}\n            onLayoutChange={onFirstLayoutChange}\n          />\n        </TesselPathProvider>\n      </div>\n      <TesselSplit\n        direction={direction}\n        onChangePercentage={onChangePercentage}\n      />\n      <div\n        className={cls(\n          secondFix ? flex[\"flexitem-fix\"] : flex[\"flexitem-shrink\"]\n        )}\n        style={{ [sizeDirection]: secondSize }}\n      >\n        <TesselPathProvider pathKey=\"second\">\n          <TesselFrame\n            value={second}\n            renderWindow={renderWindow}\n            onLayoutChange={onSecondLayoutChange}\n          />\n        </TesselPathProvider>\n      </div>\n    </div>\n  );\n};\n\nfunction applyDivisionChange(\n  division: TesselDivision,\n  percent: number,\n  absolute: number\n): TesselDivision {\n  if (isTesselPercentDivision(division)) {\n    return {\n      firstPercent: percent,\n    };\n  } else if (isTesselFixedDivision(division)) {\n    if (typeof division.secondSize === \"number\") {\n      return {\n        secondSize: absolute,\n      };\n    }\n\n    return {\n      firstSize: absolute,\n    };\n  }\n\n  return division;\n}\n\nexport default TesselSplitFrame;\n","import * as React from \"react\";\nimport TesselSplitFrame from \"./TesselSplitFrame\";\n\nimport {\n  isTesselSplit,\n  isTesselWindow,\n  normalizeTesselItem,\n  TesselValue,\n  TesselWindowRenderer,\n} from \"./types\";\n\nexport interface TesselFrameProps {\n  value: TesselValue;\n  renderWindow: TesselWindowRenderer;\n  onLayoutChange(value: TesselValue): void;\n}\n\nconst TesselFrame: React.FC<TesselFrameProps> = ({\n  value,\n  renderWindow,\n  onLayoutChange,\n}) => {\n  const item = normalizeTesselItem(value);\n  if (isTesselWindow(item)) {\n    return renderWindow(item);\n  } else if (isTesselSplit(item)) {\n    return (\n      <TesselSplitFrame\n        item={item}\n        renderWindow={renderWindow}\n        onLayoutChange={onLayoutChange}\n      />\n    );\n  } else {\n    return null;\n  }\n};\n\nexport default TesselFrame;\n","export type MaybeArray<T> = T | T[];\nexport function asArray<T>(value: MaybeArray<T>): T[] {\n  return Array.isArray(value) ? value : [value];\n}\n\nexport function arrayEquals<T extends any[]>(a: T, b: T) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  return a.every((v, i) => b[i] === v);\n}\n\nconst EmptyArray: ReadonlyArray<unknown> = Object.freeze([]);\n// Would be simpler to just use EmptyArray, but we cannot type that to what the usage wants.\n// Shame the type `[]` is invalid.\nexport function immutableEmptyArray<T>(): T[] {\n  return EmptyArray as any;\n}\n\nexport function dropIndexFp<T>(array: T[], index: number) {\n  const newArray = array.slice(0, index);\n  for (let i = index + 1; i < array.length; i++) {\n    newArray.push(array[i]);\n  }\n  return newArray;\n}\n","import * as React from \"react\";\nimport ResizeObserver from \"resize-observer-polyfill\";\n\ninterface UseComponentBounds {\n  left: number;\n  top: number;\n  right: number;\n  bottom: number;\n  width: number;\n  height: number;\n}\nexport function useComponentBounds(ref: React.RefObject<HTMLElement | null>) {\n  const [size, setSize] = React.useState<UseComponentBounds>({\n    left: 0,\n    top: 0,\n    right: 0,\n    bottom: 0,\n    width: 0,\n    height: 0,\n  });\n\n  React.useLayoutEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n\n    const observer = new ResizeObserver(() => {\n      const el = ref.current;\n      if (!el) {\n        return;\n      }\n      const b = el.getBoundingClientRect();\n      setSize({\n        top: b.top,\n        left: b.left,\n        right: b.right,\n        bottom: b.bottom,\n        width: b.width,\n        height: b.height,\n      });\n    });\n\n    observer.observe(ref.current);\n\n    return () => {\n      observer.disconnect();\n    };\n  }, [ref]);\n\n  return size;\n}\n","import { DragObjectWithType } from \"react-dnd\";\n\nexport const TESSEL_WINDOW_DRAG_OBJECT = \"@tessel/window\" as const;\nexport const tesselWindowDragObject = (path: string[]) => ({\n  type: TESSEL_WINDOW_DRAG_OBJECT,\n  payload: { path },\n});\nexport type TesselWindowDragObject = ReturnType<typeof tesselWindowDragObject>;\nexport function isTesselWindowDragObject(\n  item: DragObjectWithType\n): item is TesselWindowDragObject {\n  return item.type === TESSEL_WINDOW_DRAG_OBJECT;\n}\n","import { arrayEquals } from \"@/arrays\";\nimport { useComponentBounds } from \"@/hooks/useComponentBounds\";\nimport { cls } from \"@/utils\";\nimport * as React from \"react\";\nimport { DropTargetMonitor, DragObjectWithType, useDrop } from \"react-dnd\";\n\nimport {\n  isTesselWindowDragObject,\n  TESSEL_WINDOW_DRAG_OBJECT,\n} from \"./drag-items/tessel-window\";\n\nimport styles from \"./Tessel.module.css\";\nimport { useTesselInteraction, useTesselPath } from \"./TesselContext\";\nimport { TesselDropPosition } from \"./types\";\n\nexport interface TesselDropCaptureProps {\n  className?: string;\n  children?: React.ReactNode;\n}\nconst TesselDropCapture = React.forwardRef<\n  HTMLDivElement,\n  TesselDropCaptureProps\n>(({ className, children }, forwardRef) => {\n  const tesselPath = useTesselPath();\n  const { moveWindow } = useTesselInteraction();\n\n  const ref = React.useRef<HTMLDivElement | null>(null);\n  const { top, left, right, bottom } = useComponentBounds(ref);\n\n  const [dropPos, setDropPos] = React.useState<TesselDropPosition | null>(null);\n\n  const onHover = React.useCallback(\n    (item: DragObjectWithType, monitor: DropTargetMonitor) => {\n      if (!monitor.isOver({ shallow: true })) {\n        setDropPos(null);\n        return;\n      }\n\n      const pos = monitor.getClientOffset();\n      if (item == null || pos == null || !isTesselWindowDragObject(item)) {\n        setDropPos(null);\n        return;\n      }\n\n      if (pos.x < left || pos.x > right) {\n        setDropPos(null);\n        return;\n      }\n\n      if (pos.y < top || pos.y > bottom) {\n        setDropPos(null);\n        return;\n      }\n\n      const relX = pos.x - left;\n      const xPercent = relX / (right - left);\n      if (xPercent <= 0.3) {\n        setDropPos(\"left\");\n        return;\n      }\n      if (xPercent >= 0.6) {\n        setDropPos(\"right\");\n        return;\n      }\n\n      const relY = pos.y - top;\n      const yPercent = relY / (bottom - top);\n      if (yPercent <= 0.3) {\n        setDropPos(\"top\");\n        return;\n      }\n      if (yPercent >= 0.6) {\n        setDropPos(\"bottom\");\n        return;\n      }\n\n      setDropPos(null);\n    },\n    [top, left, right, bottom]\n  );\n\n  const onDrop = React.useCallback(\n    (item: DragObjectWithType, monitor: DropTargetMonitor) => {\n      if (!monitor.isOver({ shallow: true })) {\n        return;\n      }\n\n      if (!isTesselWindowDragObject(item)) {\n        return;\n      }\n      const { path: draggingPath } = item.payload;\n\n      if (arrayEquals(draggingPath, tesselPath)) {\n        return;\n      }\n\n      if (dropPos == null) {\n        return;\n      }\n\n      moveWindow(draggingPath, tesselPath, dropPos);\n    },\n    [tesselPath, dropPos, moveWindow]\n  );\n\n  const [{ draggingSelf }, dropRef] = useDrop(\n    {\n      accept: TESSEL_WINDOW_DRAG_OBJECT,\n      collect: (monitor) => {\n        // This is here as hover is not called on hover exit.\n        // We need something to capture the exit event.\n        if (!monitor.isOver({ shallow: true })) {\n          setDropPos(null);\n        }\n\n        const item = monitor.getItem();\n        if (!item || !isTesselWindowDragObject(item)) {\n          return {};\n        }\n\n        return {\n          draggingSelf: arrayEquals(item.payload.path, tesselPath),\n        };\n      },\n      hover: onHover,\n      drop: onDrop,\n    },\n    [onHover, onDrop]\n  );\n\n  let dropMarkerClassname = styles[\"tessel-drop-marker\"] + \" \";\n  if (dropPos != null && !draggingSelf) {\n    switch (dropPos) {\n      case \"bottom\":\n        dropMarkerClassname += styles[\"drop-bottom\"];\n        break;\n      case \"top\":\n        dropMarkerClassname += styles[\"drop-top\"];\n        break;\n      case \"left\":\n        dropMarkerClassname += styles[\"drop-left\"];\n        break;\n      case \"right\":\n        dropMarkerClassname += styles[\"drop-right\"];\n        break;\n    }\n  }\n\n  return (\n    <div\n      ref={(divRef) => {\n        ref.current = divRef;\n        dropRef(divRef);\n        if (typeof forwardRef === \"function\") {\n          forwardRef(divRef);\n        } else if (forwardRef) {\n          forwardRef.current = divRef;\n        }\n      }}\n      className={cls(\n        styles[\"tessel-drop-capture\"],\n        draggingSelf && styles[\"tessel-drop-capture--dragging\"],\n        className\n      )}\n    >\n      {children}\n      <div className={dropMarkerClassname} />\n    </div>\n  );\n});\n\nexport default TesselDropCapture;\n","import { isTesselSplit, normalizeTesselItem, TesselValue } from \"./types\";\n\nexport function walkTesselValues(\n  value: TesselValue,\n  walk: (value: TesselValue, path: string[]) => boolean | undefined\n) {\n  function doWork(value: TesselValue, path: string[]): boolean {\n    if (walk(value, []) === false) {\n      return false;\n    }\n\n    const normalized = normalizeTesselItem(value);\n    if (isTesselSplit(normalized)) {\n      if (!doWork(normalized.first, [...path, \"first\"])) {\n        return false;\n      }\n      if (!doWork(normalized.second, [...path, \"second\"])) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  doWork(value, []);\n}\n\nexport function filterTesselValues(\n  value: TesselValue,\n  filter: (value: TesselValue) => boolean\n): TesselValue | null {\n  if (!filter(value)) {\n    return null;\n  }\n\n  const normalized = normalizeTesselItem(value);\n\n  if (isTesselSplit(normalized)) {\n    const first = filterTesselValues(normalized.first, filter);\n    const second = filterTesselValues(normalized.second, filter);\n\n    if (first && second) {\n      return value;\n    }\n\n    return first ?? second ?? null;\n  }\n\n  return value;\n}\n\nexport function findAndReplaceTesselValue(\n  value: TesselValue,\n  replace: (value: TesselValue) => TesselValue | null\n): TesselValue {\n  function doWork(value: TesselValue): TesselValue | null {\n    const newValue = replace(value);\n    if (newValue) {\n      return newValue;\n    }\n\n    const normalized = normalizeTesselItem(value);\n    if (isTesselSplit(normalized)) {\n      const first = doWork(normalized.first);\n      if (first) {\n        return {\n          ...normalized,\n          first,\n        };\n      }\n\n      const second = doWork(normalized.second);\n      if (second) {\n        return {\n          ...normalized,\n          second,\n        };\n      }\n    }\n\n    return null;\n  }\n  return doWork(value) ?? value;\n}\n\nexport function pruneEmptyTesselValues(value: TesselValue): TesselValue {\n  if (typeof value === \"string\") {\n    return value;\n  }\n\n  if (isTesselSplit(value)) {\n    if (value.first == null) {\n      return pruneEmptyTesselValues(value.second);\n    }\n    if (value.second == null) {\n      return pruneEmptyTesselValues(value.first);\n    }\n    return {\n      ...value,\n      first: pruneEmptyTesselValues(value.first),\n      second: pruneEmptyTesselValues(value.second),\n    };\n  }\n\n  return value;\n}\n","import * as React from \"react\";\nimport get from \"lodash/get\";\n\nimport { cls, fpSetByArray } from \"@/utils\";\n\nimport {\n  TesselDropPosition,\n  TesselItem,\n  TesselValue,\n  TesselWindowRenderer,\n} from \"./types\";\n\nimport TesselFrame from \"./TesselFrame\";\nimport TesselDropCapture from \"./TesselDropCapture\";\n\nimport styles from \"./Tessel.module.css\";\n\nimport { TesselInteractionProvider } from \"./TesselContext\";\nimport { pruneEmptyTesselValues } from \"./utils\";\n\nexport interface TesselProps {\n  className?: string;\n  rootItem: TesselValue | null;\n  renderWindow: TesselWindowRenderer;\n  onLayoutChange(rootItem: TesselValue | null): void;\n}\n\nconst Tessel: React.FC<TesselProps> = ({\n  className,\n  rootItem,\n  renderWindow,\n  onLayoutChange,\n}) => {\n  const moveWindow = React.useCallback(\n    (from: string[], to: string[], position: TesselDropPosition) => {\n      if (from.length === 0) {\n        // If we have a window at the root, there is no place to drag it to.\n        return;\n      }\n\n      let newRoot = rootItem;\n      const movingElement = get(newRoot, from);\n      // If rootItem is a string (implicit window), than there is no way we can find our\n      // from target inside of it (given that from is not the root).\n      // This would be covered by movingElement being undefined, but we add\n      // the extra check to inform typescript of this condition.\n      if (!newRoot || typeof newRoot === \"string\" || !movingElement) {\n        return;\n      }\n\n      // Target must exist, or be the root.\n      if (to.length > 0 && !get(newRoot, to)) {\n        return;\n      }\n\n      // First, null out the from path.\n      // We cannot clean up the stack at this point as that might remove path\n      // elements that we are moving to.  Cleanup will be done later.\n      newRoot = fpSetByArray(newRoot, from, null);\n\n      // Now, insert the window at the new location\n      newRoot = fpSetByArray(newRoot, to, (item: TesselValue) => {\n        let newItem: TesselItem;\n        if (position === \"left\" || position === \"right\") {\n          newItem = {\n            direction: \"row\",\n            division: 50,\n            first: position === \"left\" ? movingElement : item,\n            second: position === \"right\" ? movingElement : item,\n          };\n        } else if (position === \"top\" || position === \"bottom\") {\n          newItem = {\n            direction: \"column\",\n            division: 50,\n            first: position === \"top\" ? movingElement : item,\n            second: position === \"bottom\" ? movingElement : item,\n          };\n        } else {\n          // Unknown position\n          throw new Error(`Unknown tessel position: ${position}`);\n        }\n        return newItem;\n      });\n\n      // Remove the empty entry from the removal of the from element.\n      newRoot = pruneEmptyTesselValues(newRoot);\n\n      onLayoutChange(newRoot);\n    },\n    [rootItem, onLayoutChange]\n  );\n\n  const closeWindow = React.useCallback(\n    (path: string[]) => {\n      let newRoot = rootItem;\n      if (!newRoot) {\n        return;\n      }\n      if (typeof newRoot === \"string\") {\n        if (path.length === 0) {\n          onLayoutChange(null);\n        }\n        return;\n      }\n\n      // First, null out the from path.\n      // We cannot clean up the stack at this point as that might remove path\n      // elements that we are moving to.  Cleanup will be done later.\n      newRoot = fpSetByArray(newRoot, path, null);\n      // Remove the empty entry from the removal of the from element.\n      newRoot = pruneEmptyTesselValues(newRoot);\n\n      onLayoutChange(newRoot);\n    },\n    [onLayoutChange, rootItem]\n  );\n\n  return (\n    <div className={cls(\"tessel\", styles[\"tessel\"], className)}>\n      <TesselInteractionProvider\n        moveWindow={moveWindow}\n        closeWindow={closeWindow}\n      >\n        <TesselDropCapture>\n          <div className={styles[\"tessel-content\"]}>\n            {rootItem && (\n              <TesselFrame\n                value={rootItem}\n                renderWindow={renderWindow}\n                onLayoutChange={onLayoutChange}\n              />\n            )}\n          </div>\n        </TesselDropCapture>\n      </TesselInteractionProvider>\n    </div>\n  );\n};\n\nexport default Tessel;\n","export * from \"./Tessel\";\nexport * from \"./types\";\n\nimport Tessel from \"./Tessel\";\nexport default Tessel;\nexport { Tessel };\n","import {\n  isTesselWindow,\n  TesselValue,\n  TesselWindowItem,\n} from \"@/components/Tessel\";\n\nimport { CircuitEditorWindowProps } from \"./CircuitEditorWindow\";\n\nexport const CIRCUIT_FIELD_WINDOW_ID = \"circuit-field\" as const;\n\nexport const circuitEditorTesselWindow = (\n  circuitEditorId: string\n): TesselWindowItem<CircuitEditorWindowProps> => ({\n  windowId: CIRCUIT_FIELD_WINDOW_ID,\n  windowProps: {\n    editorId: circuitEditorId,\n  },\n});\n\nexport function isCircuitEditorTesselWindow(\n  x: TesselValue\n): x is Required<TesselWindowItem<CircuitEditorWindowProps>> {\n  if (typeof x === \"string\") {\n    // We must have props to be a proper circuit field.\n    return false;\n  }\n  if (!isTesselWindow(x)) {\n    return false;\n  }\n  return x.windowId === CIRCUIT_FIELD_WINDOW_ID;\n}\n","import { TesselValue } from \"@/components/Tessel\";\n\nimport { circuitEditorTesselWindow } from \"@/pages/ProjectEditorPage/windows/CircuitEditorWindow/tessel-window\";\n\nimport { DEFAULT_CIRCUIT_EDITOR_ID } from \"@/services/circuit-editors/constants\";\n\nexport interface UiLayoutServiceState {\n  /**\n   * The tessel layout.\n   */\n  layout: TesselValue | null;\n}\n\nconst _defaultState: UiLayoutServiceState = {\n  layout: {\n    direction: \"row\",\n    division: {\n      firstSize: 200,\n    },\n    first: {\n      direction: \"column\",\n      division: 30,\n      first: \"circuits-list\",\n      second: \"node-tray\",\n    },\n    second: circuitEditorTesselWindow(DEFAULT_CIRCUIT_EDITOR_ID),\n  },\n};\n\nexport const defaultUiLayoutServiceState = Object.freeze(_defaultState);\n","export interface UiSettingsState {\n  nodeNameMode: \"all\" | \"named-only\" | \"none\";\n}\n\nconst _defaultState: UiSettingsState = {\n  nodeNameMode: \"named-only\",\n};\n\nexport const defaultUiSettingsState = Object.freeze(_defaultState);\n","import {\n  CircuitEditorDragServiceState,\n  defaultCircuitEditorDragServiceState,\n} from \"./circuit-editor-drag/state\";\nimport {\n  CircuitEditorsServiceState,\n  defaultCircuitEditorServiceState,\n} from \"./circuit-editors/state\";\nimport {\n  CircuitsServiceState,\n  defaultCircuitsServiceState,\n} from \"./circuits/state\";\nimport {\n  ClipboardServiceState,\n  defaultClipboardServiceState,\n} from \"./clipboard/state\";\nimport { DialogServiceState, defaultDialogServiceState } from \"./dialog/state\";\nimport {\n  NodeGraphServiceState,\n  defaultNodeGraphServiceState,\n} from \"./node-graph/state\";\nimport {\n  NodeLayoutServiceState,\n  defaultNodeLayoutServiceState,\n} from \"./node-layout/state\";\nimport {\n  ProjectServiceState,\n  defaultProjectServiceState,\n} from \"./project/state\";\nimport {\n  SelectionServiceState,\n  defaultSelectionServiceState,\n} from \"./selection/state\";\nimport {\n  SimulatorServiceState,\n  defaultSimulatorServiceState,\n} from \"./simulator/state\";\nimport {\n  SimulatorControlServiceState,\n  defaultSimulatorControlServiceState,\n} from \"./simulator-control/state\";\nimport {\n  UiLayoutServiceState,\n  defaultUiLayoutServiceState,\n} from \"./ui-layout/state\";\nimport { UiSettingsState, defaultUiSettingsState } from \"./ui-settings/state\";\n\nexport interface AppServicesState {\n  circuitEditorDrag: CircuitEditorDragServiceState;\n  circuitEditors: CircuitEditorsServiceState;\n  circuits: CircuitsServiceState;\n  clipboard: ClipboardServiceState;\n  dialog: DialogServiceState;\n  nodeGraph: NodeGraphServiceState;\n  nodeLayout: NodeLayoutServiceState;\n  project: ProjectServiceState;\n  selection: SelectionServiceState;\n  simulator: SimulatorServiceState;\n  simulatorControl: SimulatorControlServiceState;\n  uiLayout: UiLayoutServiceState;\n  uiSettings: UiSettingsState;\n}\n\nconst _defaultServiceState: AppServicesState = {\n  circuitEditorDrag: defaultCircuitEditorDragServiceState,\n  circuitEditors: defaultCircuitEditorServiceState,\n  nodeGraph: defaultNodeGraphServiceState,\n  nodeLayout: defaultNodeLayoutServiceState,\n  circuits: defaultCircuitsServiceState,\n  clipboard: defaultClipboardServiceState,\n  dialog: defaultDialogServiceState,\n  project: defaultProjectServiceState,\n  selection: defaultSelectionServiceState,\n  simulator: defaultSimulatorServiceState,\n  simulatorControl: defaultSimulatorControlServiceState,\n  uiLayout: defaultUiLayoutServiceState,\n  uiSettings: defaultUiSettingsState,\n};\n\nexport const defaultServicesState = Object.freeze(_defaultServiceState);\n","import { AppServicesState } from \"@/services/state\";\n\nexport const UndoServicesStateKeys = [\n  \"circuits\",\n  \"nodeGraph\",\n  \"nodeLayout\",\n] as const;\nexport type UndoServicesStates = Pick<\n  AppServicesState,\n  \"circuits\" | \"nodeGraph\" | \"nodeLayout\"\n>;\n\nexport interface UndoStackState {\n  serviceStates: UndoServicesStates;\n  viewCircuitId: string | null;\n}\n\nexport interface UndoState {\n  undoStack: UndoStackState[];\n  redoStack: UndoStackState[];\n}\n\nconst _defaultState: UndoState = {\n  undoStack: [],\n  redoStack: [],\n};\n\nexport const defaultUndoState = Object.freeze(_defaultState);\n","import { AppServicesState, defaultServicesState } from \"@/services/state\";\nimport { defaultUndoState, UndoState } from \"@/undo/state\";\n\nexport interface AppState {\n  services: AppServicesState;\n  undo: UndoState;\n}\n\nconst _defaultAppState: AppState = {\n  services: defaultServicesState,\n  undo: defaultUndoState,\n};\n\nexport const defaultAppState = Object.freeze(_defaultAppState);\n","export const isProd = process.env.NODE_ENV === \"production\";\nexport const isDev = process.env.NODE_ENV === \"development\";\n\nconst rootUrlBuilder = new URL(window.location.origin);\nrootUrlBuilder.pathname = __webpack_public_path__;\nexport const rootUrl = rootUrlBuilder.toString();\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_INIT = \"@init\";\nexport const doInit = () => ({ type: ACTION_INIT });\nexport type InitAction = ReturnType<typeof doInit>;\nexport function isInitAction(action: AnyAction): action is InitAction {\n  return action.type === ACTION_INIT;\n}\n","import { AnyAction } from \"redux\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nexport const ACTION_CIRCUIT_ADD = \"@circuit/add\" as const;\nexport interface NewCircuitOpts {\n  circuitName?: string;\n  circuitId?: string;\n  edit?: boolean;\n}\nexport const addCircuit = ({\n  circuitName,\n  circuitId,\n  edit,\n}: NewCircuitOpts = {}) => ({\n  type: ACTION_CIRCUIT_ADD,\n  payload: { circuitId: circuitId ?? uuidV4(), circuitName, edit },\n});\nexport type AddCircuitAction = ReturnType<typeof addCircuit>;\nexport function isAddCircuitAction(\n  action: AnyAction\n): action is AddCircuitAction {\n  return action.type === ACTION_CIRCUIT_ADD;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_CIRCUIT_DELETE = \"@circuit/delete\" as const;\nexport const deleteCircuit = (circuitId: string) => ({\n  type: ACTION_CIRCUIT_DELETE,\n  payload: { circuitId },\n});\nexport type DeleteCircuitAction = ReturnType<typeof deleteCircuit>;\nexport function isDeleteCircuitAction(\n  action: AnyAction\n): action is DeleteCircuitAction {\n  return action.type === ACTION_CIRCUIT_DELETE;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_CIRCUIT_RENAME = \"@circuit/rename\" as const;\nexport const renameCircuit = (circuitId: string, circuitName: string) => ({\n  type: ACTION_CIRCUIT_RENAME,\n  payload: { circuitId, circuitName },\n});\nexport type RenameCircuitAction = ReturnType<typeof renameCircuit>;\nexport function isRenameCircuitAction(\n  action: AnyAction\n): action is RenameCircuitAction {\n  return action.type === ACTION_CIRCUIT_RENAME;\n}\n","import { v4 as uuidV4 } from \"uuid\";\nimport { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\n\nexport interface AddNodeOptions {\n  nodeId?: string;\n  nodeName?: string;\n}\nexport const ACTION_NODE_ADD = \"@node/add\" as const;\nexport const addNode = (\n  nodeType: string,\n  circuitId: string,\n  position: Point,\n  opts?: AddNodeOptions\n) => ({\n  type: ACTION_NODE_ADD,\n  payload: { nodeId: uuidV4(), nodeType, circuitId, position, ...(opts || {}) },\n});\nexport type AddNodeAction = ReturnType<typeof addNode>;\nexport function isAddNodeAction(action: AnyAction): action is AddNodeAction {\n  return action.type === ACTION_NODE_ADD;\n}\n","import { AnyAction } from \"redux\";\n\nimport { asArray, MaybeArray } from \"@/arrays\";\n\nexport const ACTION_NODE_DELETE = \"@node/delete\" as const;\nexport const deleteNode = (nodeId: MaybeArray<string>) => ({\n  type: ACTION_NODE_DELETE,\n  payload: { nodeIds: asArray(nodeId) },\n});\nexport type DeleteNodeAction = ReturnType<typeof deleteNode>;\nexport function isDeleteNodeAction(\n  action: AnyAction\n): action is DeleteNodeAction {\n  return action.type === ACTION_NODE_DELETE;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_NODE_RENAME = \"@node/rename\" as const;\nexport const renameNode = (nodeId: string, nodeName: string) => ({\n  type: ACTION_NODE_RENAME,\n  payload: { nodeId, nodeName },\n});\nexport type RenameNodeAction = ReturnType<typeof renameNode>;\nexport function isRenameNodeAction(\n  action: AnyAction\n): action is RenameNodeAction {\n  return action.type === ACTION_NODE_RENAME;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SELECTION_ALIGN_TO_GRID = \"@selection/align-to-grid\" as const;\nexport const selectionAlignToGrid = () => ({\n  type: ACTION_SELECTION_ALIGN_TO_GRID,\n});\nexport function isSelectionAlignToGridAction(action: AnyAction): boolean {\n  return action.type === ACTION_SELECTION_ALIGN_TO_GRID;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SELECTION_DELETE = \"@selection/delete\" as const;\nexport const deleteSelection = () => ({\n  type: ACTION_SELECTION_DELETE,\n});\nexport type DeleteSelectionAction = ReturnType<typeof deleteSelection>;\nexport function isDeleteSelectionAction(\n  action: AnyAction\n): action is DeleteSelectionAction {\n  return action.type === ACTION_SELECTION_DELETE;\n}\n","import { AnyAction } from \"redux\";\n\nexport interface MoveSelectionOpts {\n  snapMode?: \"none\" | \"node\" | \"by-type\";\n}\nexport const ACTION_SELECTION_MOVE = \"@selection/move\" as const;\nexport const moveSelection = (\n  offsetX: number,\n  offsetY: number,\n  opts: MoveSelectionOpts = {}\n) => ({\n  type: ACTION_SELECTION_MOVE,\n  payload: { offsetX, offsetY, snapMode: opts.snapMode ?? \"none\" },\n});\nexport type MoveSelectionAction = ReturnType<typeof moveSelection>;\nexport function isMoveSelectionAction(\n  action: AnyAction\n): action is MoveSelectionAction {\n  return action.type === ACTION_SELECTION_MOVE;\n}\n","import { AnyAction } from \"redux\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nimport { Point } from \"@/geometry\";\n\nimport { NodePin } from \"@/services/node-graph/types\";\n\nexport interface AttachWireOptions {\n  joints?: Point[];\n}\nexport const ACTION_WIRE_ATTACH = \"@wire/attach\" as const;\nexport const attachWire = (\n  p1: NodePin,\n  p2: NodePin,\n  opts?: AttachWireOptions\n) => ({\n  type: ACTION_WIRE_ATTACH,\n  payload: {\n    connectionId: uuidV4(),\n    p1,\n    p2,\n    joints: opts?.joints || [],\n  },\n});\nexport type AttachWireAction = ReturnType<typeof attachWire>;\nexport function isAttachWireAction(\n  action: AnyAction\n): action is AttachWireAction {\n  return action.type === ACTION_WIRE_ATTACH;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_WIRE_DETATCH = \"@wire/detatch\" as const;\nexport const detatchWire = (connectionId: string) => ({\n  type: ACTION_WIRE_DETATCH,\n  payload: {\n    connectionId,\n  },\n});\nexport type DetatchWireNodeAction = ReturnType<typeof detatchWire>;\nexport function isDetatchWireAction(\n  action: AnyAction\n): action is DetatchWireNodeAction {\n  return action.type === ACTION_WIRE_DETATCH;\n}\n","import { AnyAction } from \"redux\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nimport { Point } from \"@/geometry\";\n\nexport const ACTION_WIRE_JOINT_ADD = \"@wire/joint/add\" as const;\nexport const addWireJoint = (\n  connectionId: string,\n  addAfterJointId: string | null,\n  position: Point,\n  jointId?: string\n) => ({\n  type: ACTION_WIRE_JOINT_ADD,\n  payload: {\n    connectionId,\n    jointId: jointId || uuidV4(),\n    addAfterJointId,\n    position,\n  },\n});\nexport type AddWireJointAction = ReturnType<typeof addWireJoint>;\nexport function isAddWireJointAction(\n  action: AnyAction\n): action is AddWireJointAction {\n  return action.type === ACTION_WIRE_JOINT_ADD;\n}\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { asArray, MaybeArray } from \"@/arrays\";\n\nexport interface MoveWireJointOpts {\n  relative?: boolean;\n  snapMode?: \"none\" | \"node\" | \"joint\";\n}\nexport const ACTION_WIRE_JOINT_MOVE = \"@wire/joint/move\" as const;\nexport const moveWireJoint = (\n  jointId: MaybeArray<string>,\n  position: Point,\n  opts: MoveWireJointOpts = {}\n) => ({\n  type: ACTION_WIRE_JOINT_MOVE,\n  payload: {\n    jointIds: asArray(jointId),\n    position,\n    relative: opts.relative ?? false,\n    snapMode: opts.snapMode ?? \"none\",\n  },\n});\nexport type MoveWireJointAction = ReturnType<typeof moveWireJoint>;\nexport function isMoveWireJointAction(\n  action: AnyAction\n): action is MoveWireJointAction {\n  return action.type === ACTION_WIRE_JOINT_MOVE;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_WIRE_JOINT_DELETE = \"@wire/joint/delete\" as const;\nexport const deleteWireJoint = (jointId: string) => ({\n  type: ACTION_WIRE_JOINT_DELETE,\n  payload: { jointId },\n});\nexport type DeleteWireJointAction = ReturnType<typeof deleteWireJoint>;\nexport function isDeleteWireJointAction(\n  action: AnyAction\n): action is DeleteWireJointAction {\n  return action.type === ACTION_WIRE_JOINT_DELETE;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PASTE = \"@clipboard/paste\" as const;\nexport const paste = (targetCircuitId: string) => ({\n  type: ACTION_PASTE,\n  payload: { targetCircuitId },\n});\nexport type PasteAction = ReturnType<typeof paste>;\nexport function isPasteAction(action: AnyAction): action is PasteAction {\n  return action.type === ACTION_PASTE;\n}\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_END = \"@circuit-editor/drag/end\" as const;\nexport const circuitEditorDragEnd = (\n  point: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_END,\n  payload: { ...point, modifierKeys, editorId },\n});\nexport type CircuitEditorDragEndAction = ReturnType<\n  typeof circuitEditorDragEnd\n>;\nexport function isCircuitEditorDragEndAction(\n  action: AnyAction\n): action is CircuitEditorDragEndAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_END;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_UNDO = \"@undo/undo\" as const;\nexport const undo = () => ({\n  type: ACTION_UNDO,\n});\nexport function isUndoAction(action: AnyAction) {\n  return action.type === ACTION_UNDO;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_REDO = \"@undo/redo\" as const;\nexport const redo = () => ({\n  type: ACTION_REDO,\n});\nexport function isRedoAction(action: AnyAction) {\n  return action.type === ACTION_REDO;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_NEW = \"@project/new\" as const;\nexport const newProject = () => ({\n  type: ACTION_PROJECT_NEW,\n});\nexport type NewProjectAction = ReturnType<typeof newProject>;\nexport function isNewProjectAction(\n  action: AnyAction\n): action is NewProjectAction {\n  return action.type === ACTION_PROJECT_NEW;\n}\n","import { AnyAction } from \"redux\";\n\nimport { SaveData } from \"@/services/savedata/types\";\n\nexport const ACTION_PROJECT_RECEIVE = \"@project/receive\" as const;\nexport const receiveProject = (fileName: string, saveData: SaveData) => ({\n  type: ACTION_PROJECT_RECEIVE,\n  payload: { fileName, saveData },\n});\nexport type ReceiveProjectAction = ReturnType<typeof receiveProject>;\nexport function isReceiveProjectAction(\n  action: AnyAction\n): action is ReceiveProjectAction {\n  return action.type === ACTION_PROJECT_RECEIVE;\n}\n","import { AnyAction } from \"redux\";\n\nimport { ACTION_CIRCUIT_ADD } from \"@/actions/circuit-add\";\nimport { ACTION_CIRCUIT_DELETE } from \"@/actions/circuit-delete\";\nimport { ACTION_CIRCUIT_RENAME } from \"@/actions/circuit-rename\";\nimport { ACTION_NODE_ADD } from \"@/actions/node-add\";\nimport { ACTION_NODE_DELETE } from \"@/actions/node-delete\";\nimport { ACTION_NODE_RENAME } from \"@/actions/node-rename\";\nimport { ACTION_SELECTION_ALIGN_TO_GRID } from \"@/actions/selection-align-to-grid\";\nimport { ACTION_SELECTION_DELETE } from \"@/actions/selection-delete\";\nimport { ACTION_SELECTION_MOVE } from \"@/actions/selection-move\";\nimport { ACTION_WIRE_ATTACH } from \"@/actions/wire-attach\";\nimport { ACTION_WIRE_DETATCH } from \"@/actions/wire-detatch\";\nimport { ACTION_WIRE_JOINT_ADD } from \"@/actions/wire-joint-add\";\nimport { ACTION_WIRE_JOINT_MOVE } from \"@/actions/wire-joint-move\";\nimport { ACTION_WIRE_JOINT_DELETE } from \"@/actions/wire-joint-delete\";\n\nimport { ACTION_PASTE } from \"@/actions/clipboard-paste\";\nimport { ACTION_CIRCUIT_EDITOR_DRAG_END } from \"@/actions/circuit-editor-drag-end\";\n\nimport { ACTION_UNDO } from \"@/actions/undo\";\nimport { ACTION_REDO } from \"@/actions/redo\";\n\nimport { ACTION_PROJECT_NEW } from \"@/actions/project-new\";\nimport { ACTION_PROJECT_RECEIVE } from \"@/actions/project-receive\";\n\nexport const PROJECT_MUTATION_ACTIONS = [\n  ACTION_CIRCUIT_ADD,\n  ACTION_CIRCUIT_DELETE,\n  ACTION_CIRCUIT_RENAME,\n  ACTION_NODE_ADD,\n  ACTION_NODE_DELETE,\n  ACTION_NODE_RENAME,\n  ACTION_SELECTION_ALIGN_TO_GRID,\n  ACTION_SELECTION_DELETE,\n  ACTION_SELECTION_MOVE,\n  ACTION_WIRE_ATTACH,\n  ACTION_WIRE_DETATCH,\n  ACTION_WIRE_JOINT_ADD,\n  ACTION_WIRE_JOINT_DELETE,\n  ACTION_WIRE_JOINT_MOVE,\n\n  ACTION_UNDO,\n  ACTION_REDO,\n\n  // These actions typically fire off other actions in this list,\n  // and are redundant for services that take part in the core reducer.\n  // However, undo/redo is outside of the core reducer and does not see the\n  // reentrant actions in order to produce a single undo stack entry for\n  // the entire paste operation.\n  ACTION_PASTE,\n  ACTION_CIRCUIT_EDITOR_DRAG_END,\n];\n\nexport function isProjectMutationAction(action: AnyAction) {\n  return PROJECT_MUTATION_ACTIONS.indexOf(action.type) !== -1;\n}\n\nexport const PROJECT_RESET_ACTIONS = [\n  ACTION_PROJECT_NEW,\n  ACTION_PROJECT_RECEIVE,\n];\n\nexport function isProjectResetAction(action: AnyAction) {\n  return PROJECT_RESET_ACTIONS.indexOf(action.type) !== -1;\n}\n","import { AnyAction, Reducer } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport { fpSet } from \"@/utils\";\n\nexport type ServiceKey = keyof AppState[\"services\"];\nexport type ServiceState<\n  TServiceKey extends ServiceKey\n> = AppState[\"services\"][TServiceKey];\n\nexport interface ServiceReducer<TServiceState> {\n  (\n    state: Readonly<TServiceState>,\n    action: AnyAction,\n    appState: AppState\n  ): TServiceState;\n}\n\nexport function createServiceReducerCreator<TServiceKey extends ServiceKey>(\n  service: TServiceKey\n): (\n  reducer: ServiceReducer<AppState[\"services\"][TServiceKey]>\n) => Reducer<AppState, AnyAction> {\n  return (reducer: ServiceReducer<AppState[\"services\"][TServiceKey]>) => {\n    return (state: AppState = defaultAppState, action: AnyAction) => {\n      const newState = reducer(state.services[service], action, state);\n      if (state.services[service] != newState) {\n        return fpSet(state, \"services\", service, newState);\n      }\n      return state;\n    };\n  };\n}\n\nexport interface ServiceSelectorA0<TServiceKey extends ServiceKey, TReturn> {\n  (s: AppState): TReturn;\n  local(s: ServiceState<TServiceKey>): TReturn;\n}\n\nexport interface ServiceSelectorA1<\n  TServiceKey extends ServiceKey,\n  TA1,\n  TReturn\n> {\n  (s: AppState, a1: TA1): TReturn;\n  local(s: ServiceState<TServiceKey>, a1: TA1): TReturn;\n}\n\nexport interface ServiceSelectorA2<\n  TServiceKey extends ServiceKey,\n  TA1,\n  TA2,\n  TReturn\n> {\n  (s: AppState, a1: TA1, a2: TA2): TReturn;\n  local(s: ServiceState<TServiceKey>, a1: TA1, a2: TA2): TReturn;\n}\n\nexport interface ServiceSelectorCreator<TServiceKey extends ServiceKey> {\n  <TReturn>(\n    selector: (s: ServiceState<TServiceKey>) => TReturn\n  ): ServiceSelectorA0<TServiceKey, TReturn>;\n  <TA1, TReturn>(\n    selector: (s: ServiceState<TServiceKey>, a1: TA1) => TReturn\n  ): ServiceSelectorA1<TServiceKey, TA1, TReturn>;\n  <TA1, TA2, TReturn>(\n    selector: (s: ServiceState<TServiceKey>, a1: TA1, a2: TA2) => TReturn\n  ): ServiceSelectorA2<TServiceKey, TA1, TA2, TReturn>;\n}\n\nexport function createServiceSelectorCreator<TServiceKey extends ServiceKey>(\n  service: TServiceKey\n): ServiceSelectorCreator<TServiceKey> {\n  return <TArgs, TReturn>(\n    selector: (s: ServiceState<TServiceKey>, ...args: TArgs[]) => TReturn\n  ) => {\n    const appSelector: any = (s: AppState, ...args: TArgs[]) =>\n      selector(s.services[service], ...args);\n    appSelector.local = selector;\n    return appSelector;\n  };\n}\n","import first from \"lodash/first\";\n\nimport {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\nimport { CircuitEditorsServiceState } from \"./state\";\n\nexport const createCircuitEditorsReducer = createServiceReducerCreator(\n  \"circuitEditors\"\n);\nexport const createCircuitEditorsSelector = createServiceSelectorCreator(\n  \"circuitEditors\"\n);\n\nexport function findActiveEditorId(\n  state: CircuitEditorsServiceState\n): string | null {\n  if (state.activeEditorId) {\n    return state.activeEditorId;\n  }\n  return first(Object.keys(state.circucitEditorsById)) ?? null;\n}\n","import { AppState } from \"@/store\";\n\nimport { CircuitEditorsServiceState } from \"../state\";\nimport { createCircuitEditorsSelector } from \"../utils\";\n\nexport const circuitEditorStateFromIdSelector = createCircuitEditorsSelector(\n  (s: CircuitEditorsServiceState, editorId: string) =>\n    s.circucitEditorsById[editorId]\n);\n\nexport const circuitIdForEditorIdSelector = (\n  state: AppState,\n  editorId: string\n) => {\n  const editorState = circuitEditorStateFromIdSelector(state, editorId);\n  if (!editorState) {\n    return null;\n  }\n\n  return editorState.circuitId;\n};\n\nexport const activeCircuitEditorIdSelector = createCircuitEditorsSelector(\n  (s) => s.activeEditorId\n);\nexport const activeCircuitEditorStateSelector = createCircuitEditorsSelector(\n  (s) => (s.activeEditorId ? s.circucitEditorsById[s.activeEditorId] : null)\n);\n\nexport const editorIdsFromCircuitIdSelector = createCircuitEditorsSelector(\n  (s: CircuitEditorsServiceState, circuitId: string) => {\n    return Object.keys(s.circucitEditorsById).filter(\n      (id) => s.circucitEditorsById[id].circuitId === circuitId\n    );\n  }\n);\n","import pick from \"lodash/pick\";\n\nimport { AppState } from \"@/store\";\n\nimport { activeCircuitEditorStateSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nimport { UndoStackState, UndoServicesStateKeys } from \"./state\";\n\nexport function captureUndoState(state: AppState): UndoStackState {\n  let viewCircuitId: string | null = null;\n\n  const activeEditor = activeCircuitEditorStateSelector(state);\n  if (activeEditor) {\n    viewCircuitId = activeEditor.circuitId;\n  }\n\n  return {\n    serviceStates: pick(state.services, UndoServicesStateKeys),\n    viewCircuitId,\n  };\n}\n","import { AnyAction } from \"redux\";\nimport sortBy from \"lodash/sortBy\";\n\nimport { MaybeArray } from \"@/arrays\";\n\nimport { AppState, defaultAppState } from \"./state\";\nimport { AppReducer } from \"./types\";\n\nexport function concatReducers(\n  ...reducers: MaybeArray<AppReducer>[]\n): AppReducer[] {\n  // Previously, this was reduceReducers and generated a reducer\n  //  that invokes each child reducer.\n  // However, we need to be able to order reducers across services,\n  //  so we must now aggregate a list of reducers and do a final ordering\n  //  step after all are collected.\n  return ([] as AppReducer[]).concat(...reducers);\n}\n\nexport function finalizeReducerList(reducers: AppReducer[]): AppReducer {\n  // Order the list by weight ascending.\n  const finalizedList = sortBy(reducers, (x: AppReducer) => x.weight || 0);\n\n  return (state: AppState = defaultAppState, action: AnyAction) => {\n    return finalizedList.reduce(\n      (state, reducer) => reducer(state, action),\n      state\n    );\n  };\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_ABORT = \"@circuit-editor/drag/abort\" as const;\nexport const circuitEditorDragAbort = () => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_ABORT,\n});\nexport type CircuitEditorDragAbortAction = ReturnType<\n  typeof circuitEditorDragAbort\n>;\nexport function isCircuitEditorDragAbortAction(\n  action: AnyAction\n): action is CircuitEditorDragAbortAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_ABORT;\n}\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createCircuitEditorDragReducer = createServiceReducerCreator(\n  \"circuitEditorDrag\"\n);\nexport const createCircuitEditorDragSelector = createServiceSelectorCreator(\n  \"circuitEditorDrag\"\n);\n","import { isCircuitEditorDragAbortAction } from \"@/actions/circuit-editor-drag-abort\";\nimport { defaultCircuitEditorDragServiceState } from \"../state\";\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action) => {\n  if (!isCircuitEditorDragAbortAction(action)) {\n    return state;\n  }\n\n  return defaultCircuitEditorDragServiceState;\n});\n","import { AnyAction } from \"redux\";\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE = \"@circuit-editor/drag/continue\" as const;\nexport const circuitEditorDragContinue = (\n  p: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE,\n  payload: { dragPos: p, modifierKeys, editorId },\n});\nexport type CircuitEditorDragContinueAction = ReturnType<\n  typeof circuitEditorDragContinue\n>;\nexport function isCircuitEditorDragContinueAction(\n  action: AnyAction\n): action is CircuitEditorDragContinueAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE;\n}\n","import { isCircuitEditorDragContinueAction } from \"@/actions/circuit-editor-drag-continue\";\n\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action) => {\n  if (!isCircuitEditorDragContinueAction(action)) {\n    return state;\n  }\n\n  const { dragPos, modifierKeys, editorId } = action.payload;\n\n  return {\n    ...state,\n    dragEnd: dragPos,\n    dragEndEditorId: editorId,\n    dragModifierKeys: modifierKeys,\n  };\n});\n","import union from \"lodash/union\";\nimport difference from \"lodash/difference\";\n\nimport { ModifierKeys } from \"./modifier-keys\";\n\nexport type SelectionMode =\n  | \"set\"\n  | \"append\"\n  | \"remove\"\n  | \"toggle\"\n  | \"set-if-unselected\";\n\nexport function getSelectMode(\n  modifiers: ModifierKeys,\n  defaultMode: SelectionMode = \"set\"\n): SelectionMode {\n  if (modifiers.shiftKey && modifiers.ctrlMetaKey) {\n    return \"remove\";\n  }\n  if (modifiers.shiftKey) {\n    return \"append\";\n  }\n  if (modifiers.ctrlMetaKey) {\n    return \"toggle\";\n  }\n  return defaultMode;\n}\n\nexport function combineSelection(\n  selectedIds: string[],\n  chosenIds: string[],\n  mode: SelectionMode\n) {\n  switch (mode) {\n    case \"set\":\n      return chosenIds;\n    case \"set-if-unselected\": {\n      if (chosenIds.every((chosen) => selectedIds.indexOf(chosen) !== -1)) {\n        // All were selected.\n        return selectedIds;\n      }\n\n      // One wasn't selected, set it\n      return chosenIds;\n    }\n    case \"append\":\n      return union(selectedIds, chosenIds);\n    case \"remove\":\n      return difference(selectedIds, chosenIds);\n    case \"toggle\": {\n      return difference(selectedIds, chosenIds).concat(\n        difference(chosenIds, selectedIds)\n      );\n    }\n  }\n\n  return chosenIds;\n}\n","import { AnyAction } from \"redux\";\n\nimport { Rectangle } from \"@/geometry\";\nimport { SelectionMode } from \"@/selection-mode\";\n\nexport const ACTION_SELECT_REGION = \"@select/region\" as const;\nexport const selectRegion = (\n  region: Rectangle,\n  circuitId: string,\n  mode: SelectionMode = \"set\"\n) => ({\n  type: ACTION_SELECT_REGION,\n  payload: {\n    region,\n    circuitId,\n    mode,\n  },\n});\nexport type SelectRegionAction = ReturnType<typeof selectRegion>;\nexport function isSelectRegionAction(\n  action: AnyAction\n): action is SelectRegionAction {\n  return action.type === ACTION_SELECT_REGION;\n}\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createNodeGraphReducer = createServiceReducerCreator(\"nodeGraph\");\nexport const createNodeGraphSelector = createServiceSelectorCreator(\n  \"nodeGraph\"\n);\n","import { createSelector } from \"reselect\";\nimport mapValues from \"lodash/mapValues\";\n\nimport { createNodeGraphSelector } from \"../utils\";\nimport { NodeGraphServiceState } from \"../state\";\nimport { Node } from \"../types\";\n\nexport const nodesByNodeIdSelector = createNodeGraphSelector(\n  (s) => s.nodesById\n);\n\nexport const nodeIdsSelector = createNodeGraphSelector(\n  createSelector(\n    nodesByNodeIdSelector.local,\n    (nodesById: Record<string, Node>) => Object.keys(nodesById)\n  )\n);\n\nexport const nodeTypesByNodeIdSelector = createNodeGraphSelector(\n  createSelector(\n    nodesByNodeIdSelector.local,\n    (nodesById: Record<string, Node>) => mapValues(nodesById, (x) => x.nodeType)\n  )\n);\n\nexport const nodeFromNodeIdSelector = createNodeGraphSelector(\n  (s: NodeGraphServiceState, nodeId: string) => s.nodesById[nodeId] || null\n);\n\nexport const nodeIdsFromTypeSelector = createNodeGraphSelector(\n  (s: NodeGraphServiceState, desiredType: string) => {\n    const nodeIds: string[] = [];\n    for (const nodeId of Object.keys(s.nodesById)) {\n      const { nodeType } = s.nodesById[nodeId];\n      if (nodeType === desiredType) {\n        nodeIds.push(nodeId);\n      }\n    }\n    return nodeIds;\n  }\n);\n\nexport const nodeTypeFromNodeIdSelector = createNodeGraphSelector(\n  (s: NodeGraphServiceState, nodeId: string) => {\n    const node = nodeFromNodeIdSelector.local(s, nodeId);\n    if (!node) {\n      return null;\n    }\n    return node.nodeType;\n  }\n);\n\nexport const nodeNamesByNodeIdSelector = createNodeGraphSelector(\n  createSelector(\n    (state) => state.nodesById,\n    (nodesById) => {\n      return mapValues(nodesById, (node) => node.nodeName);\n    }\n  )\n);\n\nexport const nodeNameOrDefaultFromNodeIdSelector = createNodeGraphSelector(\n  (s: NodeGraphServiceState, nodeId: string) => {\n    const node = nodeFromNodeIdSelector.local(s, nodeId);\n    if (!node) {\n      return null;\n    }\n\n    return node.nodeName ?? nodeId.substr(0, 4);\n  }\n);\n\nexport const nodeNameFromNodeIdSelector = createNodeGraphSelector(\n  (s: NodeGraphServiceState, nodeId: string) => {\n    const node = nodeFromNodeIdSelector.local(s, nodeId);\n    if (!node) {\n      return null;\n    }\n\n    return node.nodeName;\n  }\n);\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createCircuitsReducer = createServiceReducerCreator(\"circuits\");\nexport const createCircuitsSelector = createServiceSelectorCreator(\"circuits\");\n","import { createCircuitsSelector } from \"../utils\";\n\nexport const nodeIdsByCircuitIdSelector = createCircuitsSelector(\n  (state) => state.nodeIdsByCircuitId\n);\n\nexport const nodeIdsFromCircuitIdSelector = createCircuitsSelector<\n  string,\n  string[]\n>((state, circuitId: string) => state.nodeIdsByCircuitId[circuitId]);\n\nexport const circuitIdFromNodeIdSelector = createCircuitsSelector<\n  string,\n  string | null\n>((state, nodeId) => {\n  for (const circuitId of Object.keys(state.nodeIdsByCircuitId)) {\n    const nodeIds = state.nodeIdsByCircuitId[circuitId];\n    if (nodeIds.indexOf(nodeId) !== -1) {\n      return circuitId;\n    }\n  }\n  return null;\n});\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createNodeLayoutReducer = createServiceReducerCreator(\n  \"nodeLayout\"\n);\nexport const createNodeLayoutSelector = createServiceSelectorCreator(\n  \"nodeLayout\"\n);\n","import { ZeroPoint } from \"@/geometry\";\n\nimport { createNodeLayoutSelector } from \"../utils\";\nimport { NodeLayoutServiceState } from \"../state\";\n\nexport const nodePositionsByNodeIdSelector = createNodeLayoutSelector(\n  (state) => state.nodePositionsById\n);\n\nexport const nodePositionFromNodeIdSelector = createNodeLayoutSelector(\n  (state: NodeLayoutServiceState, nodeId: string) =>\n    state.nodePositionsById[nodeId] ?? ZeroPoint\n);\n","export function circuitIdToNodeType(circuitId: string) {\n  return `ic-${circuitId}`;\n}\n\nexport function nodeTypeToCircuitId(nodeType: string | null): string | null {\n  if (!nodeType || !nodeType.startsWith(\"ic-\")) {\n    return null;\n  }\n  return nodeType.substr(3);\n}\n\nexport function getICBorderPath(inputPinCount: number, outputPinCount: number) {\n  const height = Math.max(inputPinCount, outputPinCount, 1) * 50 - 20;\n  return `M10,10 h80 v${height} h-80 z`;\n}\n","import { AppState } from \"@/store\";\n\nimport { circuitIdToNodeType } from \"@/nodes/definitions/integrated-circuits/utils\";\n\nimport { CircuitsServiceState } from \"../state\";\nimport { createCircuitsSelector } from \"../utils\";\n\nexport const circuitIdsSelector = createCircuitsSelector((state) =>\n  Object.keys(state.circuitNamesByCircuitId)\n);\n\nexport const circuitNamesByIdSelector = createCircuitsSelector(\n  (state) => state.circuitNamesByCircuitId\n);\n\nexport const circuitNameFromIdSelector = createCircuitsSelector(\n  (state: CircuitsServiceState, circuitId: string) =>\n    state.circuitNamesByCircuitId[circuitId]\n);\n\nconst circuitIdForNodeIdSelector = createCircuitsSelector(\n  (state: CircuitsServiceState, nodeId: string) => {\n    const { nodeIdsByCircuitId } = state;\n    const circuitIds = Object.keys(nodeIdsByCircuitId);\n    for (const circuitId of circuitIds) {\n      if (nodeIdsByCircuitId[circuitId].indexOf(nodeId) !== -1) {\n        return circuitId;\n      }\n    }\n    return null;\n  }\n);\n\nexport const circuitWouldRecurseSelector = (\n  state: AppState,\n  circuitId: string | null,\n  targetCircuitId: string\n): boolean => {\n  if (!circuitId) {\n    return false;\n  }\n  if (circuitId === targetCircuitId) {\n    return true;\n  }\n\n  const targetCircuitNodeType = circuitIdToNodeType(targetCircuitId);\n  const { nodesById } = state.services.nodeGraph;\n  const targetCircuitNodeIds = Object.keys(nodesById).filter(\n    (nodeId) => nodesById[nodeId].nodeType === targetCircuitNodeType\n  );\n\n  return targetCircuitNodeIds.some((nodeId) => {\n    const targetContainingCircuitId = circuitIdForNodeIdSelector(state, nodeId);\n    if (!targetContainingCircuitId) {\n      return false;\n    }\n    return circuitWouldRecurseSelector(\n      state,\n      circuitId,\n      targetContainingCircuitId\n    );\n  });\n};\n","import * as React from \"react\";\n\nimport { createSelector } from \"reselect\";\nimport sortBy from \"lodash/sortBy\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { PinDirection } from \"@/logic\";\nimport { boundsToRect, Point } from \"@/geometry\";\n\nimport { IntegratedCircuitVisualProps } from \"@/nodes/visuals/IntegratedCircuitNode\";\n\nimport { nodeIdsByCircuitIdSelector } from \"@/services/circuits/selectors/nodes\";\nimport { ROOT_CIRCUIT_ID } from \"@/services/circuits/constants\";\nimport { nodeTypesByNodeIdSelector } from \"@/services/node-graph/selectors/nodes\";\nimport { nodePositionsByNodeIdSelector } from \"@/services/node-layout/selectors/node-positions\";\nimport { circuitNamesByIdSelector } from \"@/services/circuits/selectors/circuits\";\n\nimport {\n  NodeDefinition,\n  NodeDefinitionSource,\n  NodePinDefinition,\n} from \"../../types\";\n\nimport { circuitIdToNodeType, getICBorderPath } from \"./utils\";\n\nconst IntegratedCircuitDefinitionSource: NodeDefinitionSource = createSelector(\n  nodeIdsByCircuitIdSelector,\n  nodeTypesByNodeIdSelector,\n  nodePositionsByNodeIdSelector,\n  circuitNamesByIdSelector,\n  (\n    nodeIdsByCircuitId,\n    nodeTypesByNodeId,\n    nodePositionsByNodeId,\n    circuitNamesById\n  ) => {\n    return Object.keys(nodeIdsByCircuitId)\n      .filter((x) => x !== ROOT_CIRCUIT_ID)\n      .map((circuitId) => {\n        const circuitNodeIds = nodeIdsByCircuitId[circuitId] ?? [];\n        const circuitName =\n          circuitNamesById[circuitId] ?? circuitId.substr(0, 5);\n\n        // Sort by y axis position to get consistent pin locations.\n        let pinNodeIds = circuitNodeIds.filter((circuitNodeId) =>\n          nodeTypesByNodeId[circuitNodeId].startsWith(\"pin-\")\n        );\n        pinNodeIds = sortBy(\n          pinNodeIds,\n          (nodeId) => nodePositionsByNodeId[nodeId].y,\n          (nodeId) => nodePositionsByNodeId[nodeId].x\n        );\n\n        const pins: Record<string, NodePinDefinition> = {};\n        const inputPinIds: string[] = [];\n        const outputPinIds: string[] = [];\n        for (const pinNodeId of pinNodeIds) {\n          const type = nodeTypesByNodeId[pinNodeId];\n          if (type === \"pin-input\") {\n            pins[pinNodeId] = {\n              direction: \"input\",\n              ...circuitPinPosition(inputPinIds.length, \"input\"),\n            };\n            inputPinIds.push(pinNodeId);\n          } else if (type === \"pin-output\") {\n            pins[pinNodeId] = {\n              direction: \"output\",\n              ...circuitPinPosition(outputPinIds.length, \"output\"),\n            };\n            outputPinIds.push(pinNodeId);\n          }\n        }\n\n        const componentProps: IntegratedCircuitVisualProps = {\n          circuitId,\n          inputPinIds,\n          outputPinIds,\n        };\n\n        const def: NodeDefinition = {\n          type: circuitIdToNodeType(circuitId),\n          category: \"integrated-circuit\",\n          displayName: circuitName,\n          elementProduction: {\n            type: \"circuit\",\n            circuitId,\n          },\n          visual: {\n            hitRect: boundsToRect(\n              getBounds(\n                getICBorderPath(inputPinIds.length, outputPinIds.length)\n              )\n            ),\n            trayComponent: () => (\n              <g stroke=\"black\" strokeWidth={1}>\n                <rect x={10} y={10} width={30} height={30} fill=\"none\" />\n\n                <line x1={10} y1={15} x2={5} y2={15} />\n                <line x1={40} y1={15} x2={45} y2={15} />\n\n                <line x1={10} y1={35} x2={5} y2={35} />\n                <line x1={40} y1={35} x2={45} y2={35} />\n              </g>\n            ),\n            component: \"integrated-circuit\",\n            componentProps,\n          },\n          pins,\n        };\n        return def;\n      });\n  }\n);\n\nexport default [IntegratedCircuitDefinitionSource];\n\nfunction circuitPinPosition(pinIndex: number, direction: PinDirection): Point {\n  return {\n    x: direction === \"input\" ? 0 : 100,\n    y: pinIndex * 50 + 25,\n  };\n}\n","import { NodeDefinitionSource } from \"../../types\";\n\nconst InteractionNodeDefinitionSources: NodeDefinitionSource[] = [\n  require(\"./momentary\").default,\n  require(\"./toggle\").default,\n];\n\nexport default InteractionNodeDefinitionSources;\n","import { NodeDefinitionSource } from \"../types\";\n\nimport IntegratedCircuitDefinitionSources from \"./integrated-circuits\";\nimport InteractionNodeDefinitionSources from \"./interaction\";\nimport LogicNodeDefinitionSources from \"./logic\";\nimport OutputNodeDefinitionSources from \"./output\";\nimport PinNodeDefinitionSources from \"./pins\";\n\nconst nodeDefinitionSources: NodeDefinitionSource[] = [\n  ...IntegratedCircuitDefinitionSources,\n  ...InteractionNodeDefinitionSources,\n  ...LogicNodeDefinitionSources,\n  ...OutputNodeDefinitionSources,\n  ...PinNodeDefinitionSources,\n];\n\nexport default nodeDefinitionSources;\n","import { NodeDefinitionSource } from \"../../types\";\n\nconst LogicNodeDefinitionSources: NodeDefinitionSource[] = [\n  require(\"./and\").default,\n  require(\"./buffer\").default,\n  require(\"./nand\").default,\n  require(\"./nor\").default,\n  require(\"./not\").default,\n  require(\"./or\").default,\n  require(\"./xor\").default,\n];\n\nexport default LogicNodeDefinitionSources;\n","import { NodeDefinitionSource } from \"../../types\";\n\nconst OutputNodeDefinitionSources: NodeDefinitionSource[] = [\n  require(\"./led\").default,\n  require(\"./seg7\").default,\n];\n\nexport default OutputNodeDefinitionSources;\n","import { NodeDefinitionSource } from \"../../types\";\n\nconst PinNodeDefinitionSources: NodeDefinitionSource[] = [\n  require(\"./high\").default,\n  require(\"./input\").default,\n  require(\"./output\").default,\n];\n\nexport default PinNodeDefinitionSources;\n","import flatMap from \"lodash/flatMap\";\nimport find from \"lodash/find\";\n\nimport { asArray, MaybeArray } from \"@/arrays\";\nimport { AppState } from \"@/store\";\n\nimport nodeDefinitionSources from \"@/nodes/definitions\";\n\nimport { NodeDefinition, NodeDefinitionSource } from \"../../../nodes/types\";\nimport { createSelector } from \"reselect\";\n\n/**\n * Gets an array of node definitions from the current state.\n * WARN: Returns an unstable reference, not react safe.\n */\nlet cachedNodeDefinitionsSelector: NodeDefinition[] = [];\nexport const nodeDefinitionsSelector = (state: AppState) => {\n  const nodeDefinitions = flatMap(nodeDefinitionSources, (source) =>\n    resolveSources(source, state)\n  );\n\n  if (\n    nodeDefinitions.every(\n      (def, index) => def === cachedNodeDefinitionsSelector[index]\n    )\n  ) {\n    return cachedNodeDefinitionsSelector;\n  }\n\n  cachedNodeDefinitionsSelector = nodeDefinitions;\n  return nodeDefinitions;\n};\n\nexport const nodeDefinitionsByTypeSelector = createSelector(\n  nodeDefinitionsSelector,\n  (defs) => {\n    const defsByType: Record<string, NodeDefinition> = {};\n    for (const def of defs) {\n      defsByType[def.type] = def;\n    }\n    return defsByType;\n  }\n);\n\nexport const nodeDefinitionFromTypeSelector = (\n  state: AppState,\n  nodeType: string\n) => {\n  const definitions = nodeDefinitionsSelector(state);\n  return find(definitions, (x) => x.type === nodeType) ?? null;\n};\n\nfunction resolveSources(\n  source: NodeDefinitionSource,\n  state: AppState\n): NodeDefinition[] {\n  let resolved: MaybeArray<NodeDefinition>;\n  if (typeof source === \"function\") {\n    resolved = source(state);\n  } else {\n    resolved = source;\n  }\n\n  return asArray(resolved);\n}\n","import * as yup from \"yup\";\n\nexport interface Node {\n  /**\n   * The type of this node.\n   */\n  nodeType: string;\n\n  /**\n   * The user provided name of this node.\n   */\n  nodeName: string | null;\n}\n\n/**\n * Identifies a pin on a specific node.\n */\nexport interface NodePin {\n  nodeId: string;\n  pinId: string;\n}\nexport const nodePinSchema = yup.object().shape({\n  nodeId: yup.string().required().min(1),\n  pinId: yup.string().required().min(1),\n});\nexport function nodePinEquals(a: NodePin, b: NodePin) {\n  return a.nodeId === b.nodeId && a.pinId === b.pinId;\n}\n\n/**\n * A connection from a node output to a node input.\n */\nexport interface Connection {\n  /**\n   * The output pin on a node, sending a value outwards.\n   */\n  outputPin: NodePin;\n\n  /**\n   * The input pin on a node to receive the value.\n   */\n  inputPin: NodePin;\n}\n","import { createSelector } from \"reselect\";\n\nimport { AppState } from \"@/store\";\n\nimport {\n  magnitude,\n  Point,\n  pointAdd,\n  pointSubtract,\n  ZeroPoint,\n} from \"@/geometry\";\n\nimport { nodeTypesByNodeIdSelector } from \"@/services/node-graph/selectors/nodes\";\nimport { nodeDefinitionsByTypeSelector } from \"@/services/node-types/selectors/node-types\";\nimport { nodeIdsFromCircuitIdSelector } from \"@/services/circuits/selectors/nodes\";\nimport { NodePin, nodePinEquals } from \"@/services/node-graph/types\";\n\nimport { nodePositionsByNodeIdSelector } from \"./node-positions\";\n\nexport const nodePinPositionsByPinIdByNodeIdSelector = createSelector(\n  nodeDefinitionsByTypeSelector,\n  nodePositionsByNodeIdSelector,\n  nodeTypesByNodeIdSelector,\n  (nodeDefsByType, nodePositionsByNodeId, nodeTypesByNodeId) => {\n    const nodePinPositionsByPinIdByNodeId: Record<\n      string,\n      Record<string, Point>\n    > = {};\n\n    const nodeIds = Object.keys(nodeTypesByNodeId);\n    for (const nodeId of nodeIds) {\n      const nodePinPositionsByPinId: Record<string, Point> = {};\n      nodePinPositionsByPinIdByNodeId[nodeId] = nodePinPositionsByPinId;\n\n      const nodePosition = nodePositionsByNodeId[nodeId] ?? ZeroPoint;\n\n      const elementType = nodeTypesByNodeId[nodeId];\n      if (!elementType) {\n        continue;\n      }\n      const def = nodeDefsByType[elementType];\n      if (!def) {\n        continue;\n      }\n\n      const pinIds = Object.keys(def.pins);\n      for (const pinId of pinIds) {\n        const relPinPosition = def.pins[pinId];\n        const pinPosition = pointAdd(nodePosition, relPinPosition);\n        nodePinPositionsByPinId[pinId] = pinPosition;\n      }\n    }\n\n    return nodePinPositionsByPinIdByNodeId;\n  }\n);\n\nexport const nodePinPositionFromNodePinSelector = (\n  state: AppState,\n  nodeId: string,\n  pinId: string\n) => {\n  const positonsByPinIdByNodeId = nodePinPositionsByPinIdByNodeIdSelector(\n    state\n  );\n  const nodePinPositions = positonsByPinIdByNodeId[nodeId];\n  if (!nodePinPositions) {\n    return ZeroPoint;\n  }\n  return nodePinPositions[pinId] ?? ZeroPoint;\n};\n\nlet cachedPinFromPoint: NodePin | null = null;\nexport const nodePinFromPointSelector = (\n  state: AppState,\n  point: Point,\n  circuitId: string\n) => {\n  const pinPositionsByPinByNode = nodePinPositionsByPinIdByNodeIdSelector(\n    state\n  );\n  const nodeIds = nodeIdsFromCircuitIdSelector(state, circuitId);\n  if (!nodeIds) {\n    return null;\n  }\n\n  for (const nodeId of nodeIds) {\n    const pinPositionsByPinId = pinPositionsByPinByNode[nodeId] ?? ZeroPoint;\n    const pinIds = Object.keys(pinPositionsByPinId);\n    for (const pinId of pinIds) {\n      const pinPosition = pinPositionsByPinId[pinId];\n      const offset = pointSubtract(point, pinPosition);\n      const length = magnitude(offset);\n      if (length > 6) {\n        continue;\n      }\n\n      const pin: NodePin = { nodeId, pinId };\n      if (!cachedPinFromPoint || !nodePinEquals(pin, cachedPinFromPoint)) {\n        cachedPinFromPoint = pin;\n      }\n      return cachedPinFromPoint;\n    }\n  }\n\n  return null;\n};\n","import { Point, snapPoint } from \"@/geometry\";\nimport { AppState } from \"@/store\";\n\nimport { createCircuitEditorDragSelector } from \"../utils\";\n\nexport const gridNodeSnapSelector = createCircuitEditorDragSelector(() => 50);\n\nexport const gridJointSnapSelector = createCircuitEditorDragSelector(() => 5);\n\nexport const applyGridNodeSnapSelector = (s: AppState, p: Point) => {\n  const snap = gridNodeSnapSelector(s);\n  return snapPoint(p, snap);\n};\n\nexport const applyGridJointSnapSelector = (s: AppState, p: Point) => {\n  const snap = gridJointSnapSelector(s);\n  return snapPoint(p, snap);\n};\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_START_JOINT = \"@circuit-editor/drag/start/joint\" as const;\nexport const circuitEditorDragStartJoint = (\n  jointId: string,\n  p: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_START_JOINT,\n  payload: {\n    ...p,\n    jointId,\n    modifierKeys,\n    editorId,\n  },\n});\nexport type CircuitEditorDragStartJointAction = ReturnType<\n  typeof circuitEditorDragStartJoint\n>;\nexport function isCircuitEditorDragStartJointAction(\n  action: AnyAction\n): action is CircuitEditorDragStartJointAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_START_JOINT;\n}\n","import { AnyAction } from \"redux\";\n\nimport { SelectionMode } from \"@/selection-mode\";\n\nexport const ACTION_SELECT_WIRE_JOINTS = \"@select/wire-joints\" as const;\nexport const selectWireJoints = (\n  jointId: string | string[],\n  mode: SelectionMode = \"set\"\n) => ({\n  type: ACTION_SELECT_WIRE_JOINTS,\n  payload: {\n    jointIds: Array.isArray(jointId) ? jointId : [jointId],\n    mode,\n  },\n});\nexport type SelectWireJointsAction = ReturnType<typeof selectWireJoints>;\nexport function isSelectWireJointsAction(\n  action: AnyAction\n): action is SelectWireJointsAction {\n  return action.type === ACTION_SELECT_WIRE_JOINTS;\n}\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createSelectionReducer = createServiceReducerCreator(\"selection\");\nexport const createSelectionSelector = createServiceSelectorCreator(\n  \"selection\"\n);\n","import { createSelector } from \"reselect\";\n\nimport pick from \"lodash/pick\";\n\nimport { nodesByNodeIdSelector } from \"@/services/node-graph/selectors/nodes\";\n\nimport { createSelectionSelector } from \"../utils\";\nimport { SelectionServiceState } from \"../state\";\n\nexport const selectedNodeIdsSelector = createSelectionSelector(\n  (state) => state.selectedNodeIds\n);\n\nexport const isNodeSelectedFromNodeIdSelector = createSelectionSelector(\n  (s: SelectionServiceState, nodeId: string) =>\n    s.selectedNodeIds.indexOf(nodeId) !== -1\n);\n\nexport const selectedNodesByIdSelector = createSelector(\n  nodesByNodeIdSelector,\n  selectedNodeIdsSelector,\n  (nodesById, selectedNodeIds) => pick(nodesById, selectedNodeIds)\n);\n\nexport const selectedConnectionIdsSelector = createSelectionSelector(\n  (state) => state.selectedConnectionIds\n);\n\nexport const isWireSelectedFromConnectionIdSelector = createSelectionSelector(\n  (s: SelectionServiceState, connectionId: string) =>\n    s.selectedConnectionIds.indexOf(connectionId) !== -1\n);\n\nexport const selectedJointIdsSelector = createSelectionSelector(\n  (state) => state.selectedJointIds\n);\n\nexport const isJointSelectedFromJointIdSelector = createSelectionSelector(\n  (s: SelectionServiceState, jointId: string) =>\n    s.selectedJointIds.indexOf(jointId) !== -1\n);\n","import { createSelector } from \"reselect\";\nimport { includes } from \"lodash\";\n\nimport { AppState } from \"@/store\";\n\nimport { Connection } from \"@/services/node-graph/types\";\n\nimport {\n  circuitIdFromNodeIdSelector,\n  nodeIdsFromCircuitIdSelector,\n} from \"./nodes\";\n\n/**\n * Get all connection ids for the given circuit id.\n *\n * A connection is in the circuit if both its input and output are for nodes in this circuit.\n *\n * WARN: Single-memoized, cache will bust if new circuit id passed.\n */\nexport const connectionIdsByCircuitIdSelector = createSelector(\n  (state: AppState, circuitId: string) =>\n    nodeIdsFromCircuitIdSelector(state, circuitId),\n  (state: AppState) => state.services.nodeGraph.connectionsById,\n  (nodeIds: string[], connectionsById: Record<string, Connection>) => {\n    return Object.keys(connectionsById).filter((connectionId) => {\n      const { inputPin, outputPin } = connectionsById[connectionId];\n\n      if (!includes(nodeIds, inputPin.nodeId)) {\n        return false;\n      }\n\n      if (!includes(nodeIds, outputPin.nodeId)) {\n        return false;\n      }\n\n      return true;\n    });\n  }\n);\n\nexport const circuitIdFromConnectionIdSelector = (\n  state: AppState,\n  connectionId: string\n) => {\n  const { connectionsById } = state.services.nodeGraph;\n  const conn = connectionsById[connectionId];\n  if (!conn) {\n    return null;\n  }\n\n  // Input or output doesn't matter,\n  // the ui prevents connections from crossing circuit boundaries.\n  const { nodeId } = conn.inputPin || conn.outputPin;\n  return circuitIdFromNodeIdSelector(state, nodeId);\n};\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_START_NEWJOINT = \"@circuit-editor/drag/start/new-joint\" as const;\nexport const circuitEditorDragStartNewJoint = (\n  connectionId: string,\n  addAfterJointId: string | null,\n  p: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_START_NEWJOINT,\n  payload: {\n    ...p,\n    connectionId,\n    addAfterJointId,\n    modifierKeys,\n    editorId,\n  },\n});\nexport type CircuitEditorDragStartNewJointAction = ReturnType<\n  typeof circuitEditorDragStartNewJoint\n>;\nexport function isCircuitEditorDragStartNewJointAction(\n  action: AnyAction\n): action is CircuitEditorDragStartNewJointAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_START_NEWJOINT;\n}\n","import { isCircuitEditorDragStartNewJointAction } from \"@/actions/circuit-editor-drag-start-newjoint\";\nimport { circuitIdFromConnectionIdSelector } from \"@/services/circuits/selectors/connections\";\n\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action, appState) => {\n  if (!isCircuitEditorDragStartNewJointAction(action)) {\n    return state;\n  }\n\n  const {\n    connectionId,\n    addAfterJointId,\n    modifierKeys,\n    x,\n    y,\n    editorId,\n  } = action.payload;\n\n  const circuitId = circuitIdFromConnectionIdSelector(appState, connectionId);\n  if (!circuitId) {\n    return state;\n  }\n\n  return {\n    ...state,\n    dragMode: \"new-joint\" as const,\n    dragStart: {\n      x,\n      y,\n    },\n    dragStartEditorId: editorId,\n    dragEnd: null,\n    dragEndEditorId: null,\n    dragNewJointConnectionId: connectionId,\n    dragNewJointAfterJointId: addAfterJointId,\n    dragModifierKeys: modifierKeys,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_START_NODE = \"@field/drag/start/node\" as const;\nexport const circuitEditorDragStartNode = (\n  nodeId: string,\n  p: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_START_NODE,\n  payload: {\n    ...p,\n    nodeId,\n    modifierKeys,\n    editorId,\n  },\n});\nexport type CircuitEditorDragStartNodeAction = ReturnType<\n  typeof circuitEditorDragStartNode\n>;\nexport function isCircuitEditorDragStartNodeAction(\n  action: AnyAction\n): action is CircuitEditorDragStartNodeAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_START_NODE;\n}\n","import { AnyAction } from \"redux\";\n\nimport { SelectionMode } from \"@/selection-mode\";\n\nexport const ACTION_SELECT_NODES = \"@select/nodes\" as const;\nexport const selectNodes = (\n  nodeId: string | string[],\n  mode: SelectionMode = \"set\"\n) => ({\n  type: ACTION_SELECT_NODES,\n  payload: {\n    nodeIds: Array.isArray(nodeId) ? nodeId : [nodeId],\n    mode,\n  },\n});\nexport type SelectNodesAction = ReturnType<typeof selectNodes>;\nexport function isSelectNodesAction(\n  action: AnyAction\n): action is SelectNodesAction {\n  return action.type === ACTION_SELECT_NODES;\n}\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_START_SELECT = \"@circuit-editor/drag/start/select\" as const;\nexport const circuitEditorDragStartSelect = (\n  p: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_START_SELECT,\n  payload: {\n    ...p,\n    modifierKeys,\n    editorId,\n  },\n});\nexport type CircuitEditorDragStartSelectAction = ReturnType<\n  typeof circuitEditorDragStartSelect\n>;\nexport function isCircuitEditorDragStartSelectAction(\n  action: AnyAction\n): action is CircuitEditorDragStartSelectAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_START_SELECT;\n}\n","import { isCircuitEditorDragStartSelectAction } from \"@/actions/circuit-editor-drag-start-select\";\n\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action) => {\n  if (!isCircuitEditorDragStartSelectAction(action)) {\n    return state;\n  }\n\n  const { x, y, modifierKeys, editorId } = action.payload;\n\n  return {\n    ...state,\n    dragMode: \"select\",\n    dragStart: {\n      x,\n      y,\n    },\n    dragStartEditorId: editorId,\n    dragModifierKeys: modifierKeys,\n    dragEnd: null,\n    dragEndEditorId: null,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { NodePin } from \"@/services/node-graph/types\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_START_WIRE = \"@circuit-editor/drag/start/wire\" as const;\nexport const circuitEditorDragStartWire = (\n  dragStart: Point,\n  pin: NodePin,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_START_WIRE,\n  payload: {\n    ...dragStart,\n    pin,\n    editorId,\n  },\n});\nexport type CircuitEditorDragStartWireAction = ReturnType<\n  typeof circuitEditorDragStartWire\n>;\nexport function isCircuitEditorDragStartWireAction(\n  action: AnyAction\n): action is CircuitEditorDragStartWireAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_START_WIRE;\n}\n","import { AppState } from \"@/store\";\n\nimport { isCircuitEditorDragStartWireAction } from \"@/actions/circuit-editor-drag-start-wire\";\nimport { nodeIdsByCircuitIdSelector } from \"@/services/circuits/selectors/nodes\";\n\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action, rootState) => {\n  if (!isCircuitEditorDragStartWireAction(action)) {\n    return state;\n  }\n\n  const { x, y, pin, editorId } = action.payload;\n\n  const circuitId = circuitIdForNode(pin.nodeId, rootState);\n  if (!circuitId) {\n    return state;\n  }\n\n  return {\n    ...state,\n    dragMode: \"wire\",\n    dragStart: { x, y },\n    dragStartEditorId: editorId,\n    dragWireSource: pin,\n    dragEnd: null,\n    dragEndEditorId: null,\n  };\n});\n\nfunction circuitIdForNode(nodeId: string, state: AppState) {\n  const nodeIdsByCircuit = nodeIdsByCircuitIdSelector(state);\n  for (const circuitId of Object.keys(nodeIdsByCircuit)) {\n    if (nodeIdsByCircuit[circuitId].indexOf(nodeId) !== -1) {\n      return circuitId;\n    }\n  }\n  return null;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE = \"@circuit-editor/mouse/leave\" as const;\nexport const circuitEditorMouseLeave = () => ({\n  type: ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE,\n});\nexport type CircuitEditorMouseLeaveAction = ReturnType<\n  typeof circuitEditorMouseLeave\n>;\nexport function isCircuitEditorMouseLeaveAction(\n  action: AnyAction\n): action is CircuitEditorMouseLeaveAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE;\n}\n","import { concatReducers } from \"@/store/utils\";\n\nimport dragAbortReducer from \"./drag-abort\";\nimport dragContinueReducer from \"./drag-continue\";\nimport dragEndReducer from \"./drag-end\";\nimport dragStartJointReducer from \"./drag-start-joint\";\nimport dragStartNewJointReducer from \"./drag-start-newjoint\";\nimport dragStartNodeReducer from \"./drag-start-node\";\nimport dragStartSelectReducer from \"./drag-start-select\";\nimport dragStartWireReducer from \"./drag-start-wire\";\nimport mouseLeaveReducer from \"./mouse-leave\";\n\nexport default concatReducers(\n  dragAbortReducer,\n  dragContinueReducer,\n  dragEndReducer,\n  dragStartJointReducer,\n  dragStartNewJointReducer,\n  dragStartNodeReducer,\n  dragStartSelectReducer,\n  dragStartWireReducer,\n  mouseLeaveReducer\n);\n","import { AnyAction } from \"redux\";\n\nimport { normalizeRectangle, pointSubtract } from \"@/geometry\";\nimport { fpSet } from \"@/utils\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isCircuitEditorDragEndAction } from \"@/actions/circuit-editor-drag-end\";\nimport { selectRegion } from \"@/actions/select-region\";\nimport { moveSelection } from \"@/actions/selection-move\";\nimport { addWireJoint } from \"@/actions/wire-joint-add\";\nimport { attachWire } from \"@/actions/wire-attach\";\n\nimport { nodePinFromPointSelector } from \"@/services/node-layout/selectors/node-pin-positions\";\nimport { circuitIdForEditorIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nimport {\n  applyGridJointSnapSelector,\n  applyGridNodeSnapSelector,\n} from \"../selectors/snap\";\n\nimport { defaultCircuitEditorDragServiceState } from \"../state\";\n\nexport default function dragEndReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n) {\n  if (!isCircuitEditorDragEndAction(action)) {\n    return state;\n  }\n\n  const dragState = state.services.circuitEditorDrag;\n\n  if (dragState.dragMode === null) {\n    return state;\n  }\n\n  const { x, y } = action.payload;\n\n  const { dragStart, dragStartEditorId, dragEndEditorId } = dragState;\n\n  if (dragStartEditorId != dragEndEditorId) {\n    // TODO: Should allow this if dragMode is move.  Just be sure to cut the cross-circuit wires.\n    state = fpSet(\n      state,\n      \"services\",\n      \"circuitEditorDrag\",\n      defaultCircuitEditorDragServiceState\n    );\n    return state;\n  }\n\n  switch (dragState.dragMode) {\n    case \"select\": {\n      const circuitId = circuitIdForEditorIdSelector(state, dragStartEditorId);\n      if (circuitId) {\n        const { dragModifierKeys } = dragState;\n        const selectionMode = getSelectMode(dragModifierKeys);\n        const rect = normalizeRectangle(dragStart, { x, y });\n        state = rootReducer(\n          state,\n          selectRegion(rect, circuitId, selectionMode)\n        );\n      }\n      break;\n    }\n    case \"move\": {\n      const { dragModifierKeys } = dragState;\n      let moveBy = pointSubtract({ x, y }, dragStart);\n      const hasNodes = state.services.selection.selectedNodeIds.length > 0;\n      if (!dragModifierKeys.ctrlMetaKey) {\n        // We apply the snap here because we want to snap the offset, not the resulting positions.\n        // Applying the snap in moveSelection can result in different objects moving different distances\n        // depending on their snap.\n        if (hasNodes) {\n          moveBy = applyGridNodeSnapSelector(state, moveBy);\n        } else {\n          moveBy = applyGridJointSnapSelector(state, moveBy);\n        }\n      }\n      state = rootReducer(state, moveSelection(moveBy.x, moveBy.y));\n      break;\n    }\n    case \"new-joint\": {\n      const { dragNewJointConnectionId, dragNewJointAfterJointId } = dragState;\n      const position = applyGridJointSnapSelector(state, { x, y });\n      state = rootReducer(\n        state,\n        addWireJoint(\n          dragNewJointConnectionId!,\n          dragNewJointAfterJointId,\n          position\n        )\n      );\n      break;\n    }\n    case \"wire\": {\n      const circuitId = circuitIdForEditorIdSelector(state, dragStartEditorId);\n      if (circuitId) {\n        const { dragWireSource } = dragState;\n        const endPin = nodePinFromPointSelector(state, { x, y }, circuitId);\n        if (dragWireSource && endPin) {\n          state = rootReducer(state, attachWire(dragWireSource, endPin));\n        }\n      }\n      break;\n    }\n  }\n\n  state = fpSet(\n    state,\n    \"services\",\n    \"circuitEditorDrag\",\n    defaultCircuitEditorDragServiceState\n  );\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nimport { fpSet } from \"@/utils\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isCircuitEditorDragStartJointAction } from \"@/actions/circuit-editor-drag-start-joint\";\nimport { selectWireJoints } from \"@/actions/select-wire-joints\";\n\nimport { isJointSelectedFromJointIdSelector } from \"@/services/selection/selectors/selection\";\nimport { circuitIdFromJointIdSelector } from \"@/services/circuits/selectors/joints\";\n\nexport default function dragStartJointReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n) {\n  if (!isCircuitEditorDragStartJointAction(action)) {\n    return state;\n  }\n\n  const { jointId, x, y, modifierKeys, editorId } = action.payload;\n\n  const circuitId = circuitIdFromJointIdSelector(state, jointId);\n  if (!circuitId) {\n    return state;\n  }\n\n  state = fpSet(state, \"services\", \"circuitEditorDrag\", (value) => ({\n    ...value,\n    dragMode: \"move\" as const,\n    dragStart: {\n      x,\n      y,\n    },\n    dragStartEditorId: editorId,\n    dragModifierKeys: modifierKeys,\n    dragEnd: null,\n    dragEndEditorId: null,\n  }));\n\n  if (!isJointSelectedFromJointIdSelector(state, jointId)) {\n    const selectionMode = getSelectMode(modifierKeys);\n    // Dragging a node that was not previously selected.  Perform a selection on the node.\n    state = rootReducer(state, selectWireJoints(jointId, selectionMode));\n  }\n\n  return state;\n}\n","import { AppState } from \"@/store\";\n\nimport { circuitIdFromConnectionIdSelector } from \"./connections\";\n\n/**\n * A hideously inefficient and not react safe selector designed to\n * find the circuit a joint id belongs to.\n *\n * This exists because we have a single drag logic state across\n * multiple circuit windows, and we need to know which circuit\n * the drag operation is being performed for.\n *\n * This should be removed when the circuit-editor-ui-drag state is\n * refactored to be local to the CircuitEditor component\n */\nexport const circuitIdFromJointIdSelector = (\n  state: AppState,\n  jointId: string\n) => {\n  const { wireJointIdsByConnectionId } = state.services.nodeLayout;\n  const connectionId = Object.keys(wireJointIdsByConnectionId).find(\n    (connId) => wireJointIdsByConnectionId[connId].indexOf(jointId) !== -1\n  );\n  if (!connectionId) {\n    return null;\n  }\n\n  return circuitIdFromConnectionIdSelector(state, connectionId);\n};\n","import { AnyAction } from \"redux\";\n\nimport { fpSet } from \"@/utils\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isCircuitEditorDragStartNodeAction } from \"@/actions/circuit-editor-drag-start-node\";\nimport { selectNodes } from \"@/actions/select-nodes\";\n\nimport { isNodeSelectedFromNodeIdSelector } from \"@/services/selection/selectors/selection\";\nimport { circuitIdFromNodeIdSelector } from \"@/services/circuits/selectors/nodes\";\n\nexport default function dragStartNodeReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n) {\n  if (!isCircuitEditorDragStartNodeAction(action)) {\n    return state;\n  }\n\n  const { nodeId, x, y, modifierKeys, editorId } = action.payload;\n\n  const circuitId = circuitIdFromNodeIdSelector(state, nodeId);\n  if (!circuitId) {\n    return state;\n  }\n\n  state = fpSet(state, \"services\", \"circuitEditorDrag\", (value) => ({\n    ...value,\n    dragMode: \"move\" as const,\n    dragStart: {\n      x,\n      y,\n    },\n    dragStartEditorId: editorId,\n    dragModifierKeys: modifierKeys,\n    dragEnd: null,\n    dragEndEditorId: null,\n  }));\n\n  if (!isNodeSelectedFromNodeIdSelector(state, nodeId)) {\n    const selectionMode = getSelectMode(modifierKeys);\n    // Dragging a node that was not previously selected.  Perform a selection on the node.\n    state = rootReducer(state, selectNodes(nodeId, selectionMode));\n  }\n\n  return state;\n}\n","import { isCircuitEditorMouseLeaveAction } from \"@/actions/circuit-editor-mouse-leave\";\n\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action) => {\n  if (!isCircuitEditorMouseLeaveAction(action)) {\n    return state;\n  }\n\n  if (state.dragMode == null) {\n    return state;\n  }\n\n  return {\n    ...state,\n    dragEnd: null,\n  };\n});\n","import pick from \"lodash/pick\";\n\nimport { isDeleteCircuitAction } from \"@/actions/circuit-delete\";\n\nimport { createCircuitEditorsReducer } from \"../utils\";\n\nexport default createCircuitEditorsReducer((state, action) => {\n  if (!isDeleteCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitId } = action.payload;\n\n  const keepIds = Object.keys(state.circucitEditorsById).filter(\n    (id) => state.circucitEditorsById[id].circuitId !== circuitId\n  );\n\n  let activeEditorId = state.activeEditorId;\n  if (!activeEditorId || keepIds.indexOf(activeEditorId) === -1) {\n    activeEditorId = null;\n  }\n\n  return {\n    ...state,\n    circucitEditorsById: pick(state.circucitEditorsById, keepIds),\n    activeEditorId,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_CIRCUIT_EDITOR_RECEIVE_FOCUS = \"@circuit-editor/receive-focus\" as const;\nexport const circuitEditorReceiveFocus = (editorId: string) => ({\n  type: ACTION_CIRCUIT_EDITOR_RECEIVE_FOCUS,\n  payload: { editorId },\n});\nexport type CircuitEditorFocusAction = ReturnType<\n  typeof circuitEditorReceiveFocus\n>;\nexport function isCircuitEditorReceiveFocusAction(\n  action: AnyAction\n): action is CircuitEditorFocusAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_RECEIVE_FOCUS;\n}\n","import { isCircuitEditorReceiveFocusAction } from \"@/actions/circuit-editor-receive-focus\";\n\nimport { createCircuitEditorsReducer } from \"../utils\";\n\nexport default createCircuitEditorsReducer((state, action) => {\n  if (!isCircuitEditorReceiveFocusAction(action)) {\n    return state;\n  }\n\n  const { editorId } = action.payload;\n\n  if (Object.keys(state.circucitEditorsById).indexOf(editorId) === -1) {\n    return state;\n  }\n\n  return {\n    ...state,\n    activeEditorId: editorId,\n  };\n});\n","import { AnyAction } from \"redux\";\nimport { v4 as uuidV4 } from \"uuid\";\n\ninterface ViewCircuitOpts {\n  newWindow?: boolean;\n}\nexport const ACTION_VIEW_CIRCUIT = \"@view/circuit\" as const;\nexport const viewCircuit = (\n  circuitId: string,\n  circuitNodeIdPath: string[] | null = null,\n  opts: ViewCircuitOpts = {}\n) => ({\n  type: ACTION_VIEW_CIRCUIT,\n  payload: {\n    circuitId,\n    circuitNodeIdPath,\n    newWindowId: opts.newWindow ? uuidV4() : null,\n  },\n});\nexport type ViewCircuitAction = ReturnType<typeof viewCircuit>;\nexport function isViewCircuitAction(\n  action: AnyAction\n): action is ViewCircuitAction {\n  return action.type === ACTION_VIEW_CIRCUIT;\n}\n","import { circuitIdsSelector } from \"@/services/circuits/selectors/circuits\";\n\nimport { isViewCircuitAction } from \"@/actions/view-circuit\";\n\nimport { createCircuitEditorsReducer, findActiveEditorId } from \"../utils\";\n\nexport default createCircuitEditorsReducer((state, action, appState) => {\n  if (!isViewCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitId, circuitNodeIdPath, newWindowId } = action.payload;\n\n  if (circuitIdsSelector(appState).indexOf(circuitId) === -1) {\n    return state;\n  }\n\n  let targetWindowId = newWindowId;\n  if (!targetWindowId) {\n    targetWindowId = findActiveEditorId(state);\n  }\n\n  if (!targetWindowId) {\n    return state;\n  }\n\n  return {\n    ...state,\n    circucitEditorsById: {\n      ...state.circucitEditorsById,\n      [targetWindowId]: {\n        circuitId,\n        circuitNodeIdPath: circuitNodeIdPath ?? [],\n      },\n    },\n    activeEditorId: targetWindowId,\n  };\n});\n","import { concatReducers } from \"@/store/utils\";\n\nimport circuitDeleteReducer from \"./circuit-delete\";\nimport editorFocusReducer from \"./editor-focus\";\nimport viewCircuitReducer from \"./view-circuit\";\n\nexport default concatReducers(\n  circuitDeleteReducer,\n  editorFocusReducer,\n  viewCircuitReducer\n);\n","import { isAddCircuitAction } from \"@/actions/circuit-add\";\nimport { createCircuitsReducer } from \"../utils\";\n\nexport default createCircuitsReducer((state, action) => {\n  if (!isAddCircuitAction(action)) {\n    return state;\n  }\n\n  const circuitId = action.payload.circuitId;\n  let circuitName = action.payload.circuitName;\n\n  if (!circuitName) {\n    circuitName = `Circuit ${\n      Object.keys(state.circuitNamesByCircuitId).length + 1\n    }`;\n  }\n\n  return {\n    ...state,\n    circuitNamesByCircuitId: {\n      ...state.circuitNamesByCircuitId,\n      [circuitId]: circuitName,\n    },\n    nodeIdsByCircuitId: {\n      ...state.nodeIdsByCircuitId,\n      [circuitId]: [],\n    },\n  };\n});\n","import { AnyAction } from \"redux\";\n\nimport { asArray, MaybeArray } from \"@/arrays\";\n\nimport { SaveData } from \"@/services/savedata/types\";\n\nexport const ACTION_CIRCUIT_IMPORT = \"@circuit/import\" as const;\nexport const importCircuits = (\n  circuitId: MaybeArray<string>,\n  saveData: SaveData\n) => ({\n  type: ACTION_CIRCUIT_IMPORT,\n  payload: { circuitIds: asArray(circuitId), saveData },\n});\nexport type ImportCircuitAction = ReturnType<typeof importCircuits>;\nexport function isImportCircuitAction(\n  action: AnyAction\n): action is ImportCircuitAction {\n  return action.type === ACTION_CIRCUIT_IMPORT;\n}\n","import * as yup from \"yup\";\n\nimport { Point, pointSchema } from \"@/geometry\";\n\nimport { NodePin, nodePinSchema } from \"../node-graph/types\";\n\nexport interface SaveCircuit {\n  circuitId: string;\n  circuitName: string;\n}\nexport const saveCircuitSchema = yup.object().shape({\n  circuitId: yup.string().required().min(1),\n  circuitName: yup.string().required().min(1),\n});\n\nexport interface SaveNode {\n  nodeId: string;\n  nodeType: string;\n  nodeName: string | null;\n  circuitId: string;\n  x: number;\n  y: number;\n}\nexport const saveNodeSchema = yup.object().shape({\n  nodeId: yup.string().required().min(1),\n  nodeType: yup.string().required().min(1),\n  nodeName: yup.string().nullable().min(1),\n  circuitId: yup.string().required().min(1),\n  x: yup.number().required(),\n  y: yup.number().required(),\n});\n\nexport interface SaveWire {\n  output: NodePin;\n  input: NodePin;\n  joints: Point[];\n}\nexport const saveWireSchema = yup.object().shape({\n  output: nodePinSchema.required(),\n  input: nodePinSchema.required(),\n  // Cannot make this required, as yup says required on an array is min length 1...\n  joints: yup.array().of(pointSchema),\n});\n\nexport interface SaveData {\n  circuits: SaveCircuit[];\n  nodes: SaveNode[];\n  wires: SaveWire[];\n}\nexport const saveDataSchema = yup.object().shape({\n  circuits: yup.array().of(saveCircuitSchema).min(0),\n  nodes: yup.array().of(saveNodeSchema).min(0),\n  wires: yup.array().of(saveWireSchema).min(0),\n});\n","import values from \"lodash/values\";\nimport uniq from \"lodash/uniq\";\nimport { createSelector } from \"reselect\";\n\nimport { NodeGraphServiceState } from \"../state\";\nimport { createNodeGraphSelector } from \"../utils\";\nimport { NodePin, nodePinEquals } from \"../types\";\n\nexport const connectionsByIdSelector = createNodeGraphSelector(\n  (s) => s.connectionsById\n);\n\nexport const connectionIdsSelector = createNodeGraphSelector(\n  createSelector(\n    (s) => s.connectionsById,\n    (connectionsById) => Object.keys(connectionsById)\n  )\n);\n\nexport const connectionFromConnectionIdSelector = createNodeGraphSelector(\n  (s: NodeGraphServiceState, connectionId: string) =>\n    s.connectionsById[connectionId]\n);\n\nexport const connectionsSelector = createNodeGraphSelector(\n  createSelector(\n    (state: NodeGraphServiceState) => state.connectionsById,\n    (connectionsById) => values(connectionsById)\n  )\n);\n\nexport const connectionIdFromInputPinSelector = createNodeGraphSelector(\n  (state: NodeGraphServiceState, pin: NodePin) => {\n    const { connectionsById } = state;\n    const connectionIds = Object.keys(connectionsById);\n    for (const connectionId of connectionIds) {\n      const connection = connectionsById[connectionId];\n      if (nodePinEquals(connection.inputPin, pin)) {\n        return connectionId;\n      }\n    }\n\n    return null;\n  }\n);\n\n/**\n * Gets an array of connection ids supplying input to the specified node.\n * WARN: Not react safe.  For reducer use only.\n */\nexport const nodeInputConnectionIdsFromNodeIdSelector = createNodeGraphSelector(\n  (state: NodeGraphServiceState, nodeId: string) =>\n    Object.keys(state.connectionsById).filter(\n      (connectionId) =>\n        state.connectionsById[connectionId].inputPin.nodeId === nodeId\n    )\n);\n\n/**\n * Gets an array of connection ids leaving the given node.\n * WARN: Not react safe.  For reducer use only.\n */\nexport const nodeOutputConnectionIdsFromNodeIdSelector = createNodeGraphSelector(\n  (state: NodeGraphServiceState, nodeId: string) =>\n    Object.keys(state.connectionsById).filter(\n      (connectionId) =>\n        state.connectionsById[connectionId].outputPin.nodeId === nodeId\n    )\n);\n\n/**\n * Gets an array of connection ids attached to the given node.\n * WARN: Not react safe.  For reducer use only.\n */\nexport const nodeConnectionIdsFromNodeIdSelector = createNodeGraphSelector(\n  (state: NodeGraphServiceState, nodeId: string) => {\n    const inputs = nodeInputConnectionIdsFromNodeIdSelector.local(\n      state,\n      nodeId\n    );\n    const outputs = nodeOutputConnectionIdsFromNodeIdSelector.local(\n      state,\n      nodeId\n    );\n    return uniq([...inputs, ...outputs]);\n  }\n);\n","import { AppState } from \"@/store\";\n\nimport { nodeDefinitionFromTypeSelector } from \"@/services/node-types/selectors/node-types\";\n\nimport { nodeTypeFromNodeIdSelector } from \"./nodes\";\n\nexport const nodeDefFromNodeIdSelector = (state: AppState, nodeId: string) => {\n  const nodeType = nodeTypeFromNodeIdSelector(state, nodeId);\n  if (!nodeType) {\n    return null;\n  }\n\n  const def = nodeDefinitionFromTypeSelector(state, nodeType);\n\n  return def;\n};\n","import flatMap from \"lodash/flatMap\";\nimport uniq from \"lodash/uniq\";\n\nimport { AppState } from \"@/store\";\nimport { Point, pointAdd, ZeroPoint } from \"@/geometry\";\n\nimport { NodeDefinition } from \"@/nodes/types\";\nimport { nodeDefFromNodeIdSelector } from \"@/services/node-graph/selectors/node-def\";\nimport { nodeConnectionIdsFromNodeIdSelector } from \"@/services/node-graph/selectors/connections\";\n\nimport { createNodeLayoutSelector } from \"../utils\";\nimport { NodeLayoutServiceState } from \"../state\";\n\nimport { nodePositionFromNodeIdSelector } from \"./node-positions\";\nimport { nodeIdsFromCircuitIdSelector } from \"@/services/circuits/selectors/nodes\";\n\ninterface PositionCache {\n  inputNodeDef: NodeDefinition;\n  inputNodePosition: Point;\n  outputPosition: Point;\n}\n\n// TODO: These build up forever, need to wipe it on occasion.\n// Probably should use LRU cache.\n// Not fixing it right now as we previously used re-reselect, which\n//  also builds up forever.\nconst startPositionCacheByConnectionId: Record<string, PositionCache> = {};\nconst endPositionCacheByConnectionId: Record<string, PositionCache> = {};\n\nexport const wireStartPositionFromConnectionIdSelector = (\n  state: AppState,\n  connectionId: string\n) => {\n  const {\n    outputPin: { nodeId, pinId },\n  } = state.services.nodeGraph.connectionsById[connectionId];\n\n  const nodeDef = nodeDefFromNodeIdSelector(state, nodeId);\n  if (!nodeDef) {\n    return ZeroPoint;\n  }\n\n  const nodePosition = nodePositionFromNodeIdSelector(state, nodeId);\n\n  // Caching is to get a consistent reference to avoid component rerenders.\n  //  We are not concerned about performance here.\n  const cacheData = startPositionCacheByConnectionId[connectionId];\n  if (\n    cacheData &&\n    cacheData.inputNodeDef === nodeDef &&\n    cacheData.inputNodePosition.x === nodePosition.x &&\n    cacheData.inputNodePosition.y === nodePosition.y\n  ) {\n    return cacheData.outputPosition;\n  }\n\n  let offset = ZeroPoint;\n  if (nodeDef && nodeDef.pins[pinId]) {\n    offset = nodeDef.pins[pinId];\n  }\n  const position = pointAdd(nodePosition, offset);\n  startPositionCacheByConnectionId[connectionId] = {\n    inputNodeDef: nodeDef,\n    inputNodePosition: nodePosition,\n    outputPosition: position,\n  };\n\n  return position;\n};\n\nexport const wireEndPositionFromConnectionIdSelector = (\n  state: AppState,\n  connectionId: string\n) => {\n  const {\n    inputPin: { nodeId, pinId },\n  } = state.services.nodeGraph.connectionsById[connectionId];\n  const nodeDef = nodeDefFromNodeIdSelector(state, nodeId);\n  if (!nodeDef) {\n    return ZeroPoint;\n  }\n\n  const nodePosition = nodePositionFromNodeIdSelector(state, nodeId);\n\n  // Caching is to get a consistent reference to avoid component rerenders.\n  //  We are not concerned about performance here.\n  const cacheData = endPositionCacheByConnectionId[connectionId];\n  if (\n    cacheData &&\n    cacheData.inputNodeDef === nodeDef &&\n    cacheData.inputNodePosition.x === nodePosition.x &&\n    cacheData.inputNodePosition.y === nodePosition.y\n  ) {\n    return cacheData.outputPosition;\n  }\n\n  let offset = ZeroPoint;\n  if (nodeDef && nodeDef.pins[pinId]) {\n    offset = nodeDef.pins[pinId];\n  }\n  const position = pointAdd(nodePosition, offset);\n  endPositionCacheByConnectionId[connectionId] = {\n    inputNodeDef: nodeDef,\n    inputNodePosition: nodePosition,\n    outputPosition: position,\n  };\n\n  return position;\n};\n\n// WARN: Returns new object with each invocation.  Not safe for react use.\n//  Currently used to get all joint ids in reducers.\nexport const jointIdsSelector = createNodeLayoutSelector(\n  (state: NodeLayoutServiceState) =>\n    Object.keys(state.wireJointPositionsByJointId)\n);\n\n/**\n * Gets all joint ids in the editing circuit.\n * WARN: Not react safe, for reducer use only.\n */\nexport const jointIdsFromCircuitIdSelector = (\n  state: AppState,\n  circuitId: string\n) => {\n  const nodeIds = nodeIdsFromCircuitIdSelector(state, circuitId);\n  const connectionIds = flatMap(nodeIds, (nodeId) =>\n    nodeConnectionIdsFromNodeIdSelector(state, nodeId)\n  );\n  const jointIds = flatMap(connectionIds, (connectionId) =>\n    wireJointIdsFromConnectionIdSelector(state, connectionId)\n  );\n  return uniq(jointIds);\n};\n\nexport const wireJointIdsByConnectionIdSelector = createNodeLayoutSelector(\n  (state) => state.wireJointIdsByConnectionId\n);\n\nexport const wireJointIdsFromConnectionIdSelector = createNodeLayoutSelector(\n  (state: NodeLayoutServiceState, connectionId: string) =>\n    state.wireJointIdsByConnectionId[connectionId]\n);\n\nexport const wireJointPositionFromJointIdSelector = createNodeLayoutSelector(\n  (state: NodeLayoutServiceState, jointId: string) =>\n    state.wireJointPositionsByJointId[jointId]\n);\n\n// WARN: Returns new object with each invocation.  Not safe for react use.\n//  Currently used to get all joint ids in reducers.\nexport const wireJointPositionsByJointIdSelector = createNodeLayoutSelector(\n  (state: NodeLayoutServiceState) => {\n    return state.wireJointPositionsByJointId;\n  }\n);\n","export class SaveFormatError extends Error {\n  code: string;\n\n  constructor(message: string) {\n    super(message);\n    this.message = message;\n    this.code = \"SAVE_FORMAT_ERROR\";\n  }\n}\n","import {\n  SaveCircuit,\n  SaveData,\n  saveDataSchema,\n  SaveNode,\n  SaveWire,\n} from \"./types\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { addNode } from \"@/actions/node-add\";\nimport { attachWire } from \"@/actions/wire-attach\";\n\nimport {\n  nodeIdsSelector,\n  nodeFromNodeIdSelector,\n} from \"../node-graph/selectors/nodes\";\nimport {\n  connectionIdsSelector,\n  connectionFromConnectionIdSelector,\n} from \"../node-graph/selectors/connections\";\nimport { nodePositionFromNodeIdSelector } from \"../node-layout/selectors/node-positions\";\nimport {\n  circuitIdsSelector,\n  circuitNameFromIdSelector,\n} from \"../circuits/selectors/circuits\";\nimport { ROOT_CIRCUIT_ID } from \"../circuits/constants\";\n\nimport { circuitIdFromNodeIdSelector } from \"../circuits/selectors/nodes\";\nimport {\n  wireJointPositionsByJointIdSelector,\n  wireJointIdsFromConnectionIdSelector,\n} from \"../node-layout/selectors/wires\";\n\nimport { SaveFormatError } from \"./errors\";\nimport { addCircuit } from \"@/actions/circuit-add\";\n\nexport function createSave(state: AppState): SaveData {\n  const jointPositions = wireJointPositionsByJointIdSelector(state);\n  return {\n    circuits: circuitIdsSelector(state).map((circuitId) => {\n      const circuitName = circuitNameFromIdSelector(state, circuitId);\n      const saveCircuit: SaveCircuit = {\n        circuitId,\n        circuitName,\n      };\n      return saveCircuit;\n    }),\n    nodes: nodeIdsSelector(state).map((nodeId) => {\n      const node = nodeFromNodeIdSelector(state, nodeId);\n      const position = nodePositionFromNodeIdSelector(state, nodeId);\n      const circuitId = circuitIdFromNodeIdSelector(state, nodeId);\n      const saveNode: SaveNode = {\n        nodeId: nodeId,\n        nodeType: node.nodeType,\n        nodeName: node.nodeName,\n        circuitId: circuitId ?? ROOT_CIRCUIT_ID,\n        x: position.x,\n        y: position.y,\n      };\n      return saveNode;\n    }),\n    wires: connectionIdsSelector(state).map((connectionId) => {\n      const wire = connectionFromConnectionIdSelector(state, connectionId);\n      const jointIds = wireJointIdsFromConnectionIdSelector(\n        state,\n        connectionId\n      );\n      const saveWire: SaveWire = {\n        input: wire.inputPin,\n        output: wire.outputPin,\n        joints: jointIds.map((jointId) => jointPositions[jointId]),\n      };\n      return saveWire;\n    }),\n  };\n}\n\nexport function loadSave(state: AppState, save: SaveData): AppState {\n  try {\n    saveDataSchema.validateSync(save);\n  } catch (e) {\n    throw new SaveFormatError(e.message);\n  }\n\n  // TODO: There may be some services that want to persist data across projects.\n  state = defaultAppState;\n\n  try {\n    state = (save.circuits ?? []).reduce(\n      (state, { circuitId, circuitName }) =>\n        rootReducer(state, addCircuit({ circuitId, circuitName })),\n      state\n    );\n\n    state = (save.nodes ?? []).reduce(\n      (state, node) =>\n        rootReducer(\n          state,\n          addNode(\n            node.nodeType,\n            node.circuitId,\n            { x: node.x, y: node.y },\n            {\n              nodeId: node.nodeId,\n              nodeName: node.nodeName ?? undefined,\n            }\n          )\n        ),\n      state\n    );\n\n    state = (save.wires ?? []).reduce(\n      (state, wire) =>\n        rootReducer(\n          state,\n          attachWire(wire.output, wire.input, { joints: wire.joints })\n        ),\n      state\n    );\n  } catch (e) {\n    console.error(\"Failed to rehydrate SaveData:\", e);\n    throw new SaveFormatError(\"Failed to load project.\");\n  }\n\n  return state;\n}\n\nexport function importCircuitsFromSave(\n  state: AppState,\n  circuitIds: string[],\n  save: SaveData\n): AppState {\n  try {\n    saveDataSchema.validateSync(save);\n  } catch (e) {\n    throw new SaveFormatError(e.message);\n  }\n\n  const existingCircuits = Object.keys(\n    state.services.circuits.circuitNamesByCircuitId\n  );\n  const importCircuits = save.circuits.filter(\n    (c) =>\n      circuitIds.indexOf(c.circuitId) !== -1 &&\n      existingCircuits.indexOf(c.circuitId) === -1\n  );\n  if (importCircuits.length === 0) {\n    return state;\n  }\n\n  try {\n    state = importCircuits.reduce(\n      (state, { circuitId, circuitName }) =>\n        rootReducer(state, addCircuit({ circuitId, circuitName })),\n      state\n    );\n\n    const importNodes = (save.nodes ?? []).filter((x) =>\n      importCircuits.some(({ circuitId }) => circuitId === x.circuitId)\n    );\n    state = importNodes.reduce(\n      (state, node) =>\n        rootReducer(\n          state,\n          addNode(\n            node.nodeType,\n            node.circuitId,\n            { x: node.x, y: node.y },\n            {\n              nodeId: node.nodeId,\n              nodeName: node.nodeName ?? undefined,\n            }\n          )\n        ),\n      state\n    );\n\n    function isImportableWire(wire: SaveWire) {\n      return importNodes.some(\n        ({ nodeId }) =>\n          wire.input.nodeId === nodeId || wire.output.nodeId === nodeId\n      );\n    }\n\n    const importWires = (save.wires ?? []).filter(isImportableWire);\n    state = importWires.reduce(\n      (state, wire) =>\n        rootReducer(\n          state,\n          attachWire(wire.output, wire.input, { joints: wire.joints })\n        ),\n      state\n    );\n  } catch (e) {\n    console.error(\"Failed to import circuit from SaveData:\", e);\n    throw new SaveFormatError(\"Failed to import circuit.\");\n  }\n\n  return state;\n}\n\nexport function storeAutosave(save: SaveData): void {\n  localStorage.setItem(\"autosave\", JSON.stringify(save));\n}\n\nexport function loadAutosave(): SaveData | null {\n  const str = localStorage.getItem(\"autosave\");\n  if (!str) {\n    return null;\n  }\n\n  try {\n    return JSON.parse(str);\n  } catch {\n    return null;\n  }\n}\n\nexport function deleteAutosave() {\n  localStorage.removeItem(\"autosave\");\n}\n","import { isRenameCircuitAction } from \"@/actions/circuit-rename\";\nimport { createCircuitsReducer } from \"../utils\";\n\nexport default createCircuitsReducer((state, action) => {\n  if (!isRenameCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitId, circuitName } = action.payload;\n\n  const trimmedName = circuitName.trim();\n\n  if (trimmedName === \"\") {\n    return state;\n  }\n\n  return {\n    ...state,\n    circuitNamesByCircuitId: {\n      ...state.circuitNamesByCircuitId,\n      [circuitId]: trimmedName,\n    },\n  };\n});\n","import { isAddNodeAction } from \"@/actions/node-add\";\n\nimport { createCircuitsReducer } from \"../utils\";\n\nexport default createCircuitsReducer((state, action) => {\n  if (!isAddNodeAction(action)) {\n    return state;\n  }\n\n  const { nodeId, circuitId } = action.payload;\n\n  const targetCircuitId = circuitId;\n\n  return {\n    ...state,\n    nodeIdsByCircuitId: {\n      ...state.nodeIdsByCircuitId,\n      [targetCircuitId]: [...state.nodeIdsByCircuitId[targetCircuitId], nodeId],\n    },\n  };\n});\n","import { isDeleteNodeAction } from \"@/actions/node-delete\";\nimport mapValues from \"lodash/mapValues\";\n\nimport { createCircuitsReducer } from \"../utils\";\n\nexport default createCircuitsReducer((state, action) => {\n  if (!isDeleteNodeAction(action)) {\n    return state;\n  }\n\n  const { nodeIds } = action.payload;\n\n  return {\n    ...state,\n    nodeIdsByCircuitId: mapValues(state.nodeIdsByCircuitId, (circuitNodeIds) =>\n      circuitNodeIds.filter(\n        (circuitNodeId) => nodeIds.indexOf(circuitNodeId) === -1\n      )\n    ),\n  };\n});\n","import { concatReducers } from \"@/store/utils\";\n\nimport circuitAddReducer from \"./circuit-add\";\nimport circuitDeleteReducer from \"./circuit-delete\";\nimport circuitImportReducer from \"./circuit-import\";\nimport circuitRenameReducer from \"./circuit-rename\";\nimport nodeAddReducer from \"./node-add\";\nimport nodeDeleteReducer from \"./node-delete\";\nimport projectNewReducer from \"./project-new\";\n\nexport default concatReducers(\n  circuitAddReducer,\n  circuitDeleteReducer,\n  circuitImportReducer,\n  circuitRenameReducer,\n  nodeAddReducer,\n  nodeDeleteReducer,\n  projectNewReducer\n);\n","import { AnyAction } from \"redux\";\n\nimport pick from \"lodash/pick\";\n\nimport { fpSet } from \"@/utils\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { circuitIdToNodeType } from \"@/nodes/definitions/integrated-circuits/utils\";\n\nimport { isDeleteCircuitAction } from \"@/actions/circuit-delete\";\nimport { deleteNode } from \"@/actions/node-delete\";\n\nimport { nodeIdsFromTypeSelector } from \"@/services/node-graph/selectors/nodes\";\n\nexport default (state: AppState = defaultAppState, action: AnyAction) => {\n  if (!isDeleteCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitId } = action.payload;\n\n  const nodeIdsInCircuit =\n    state.services.circuits.nodeIdsByCircuitId[circuitId];\n  if (!nodeIdsInCircuit) {\n    return state;\n  }\n\n  // The node ids of instances of this circuit.\n  const circuitTypeNodeIds = nodeIdsFromTypeSelector(\n    state,\n    circuitIdToNodeType(circuitId)\n  );\n\n  const nodeIdsToDelete = [...circuitTypeNodeIds, ...nodeIdsInCircuit];\n\n  // We used to handle this in a seperate reducer in node-graph, but we need to\n  // know the node types before deletion to know which instances of the circuit to delete,\n  // and node-graph needs to know what nodes are in each circuit.  This means\n  // both need the data from the other, and they cannot be ordered separately.\n  // This might be a sign that we need to move nodeIdsByCircuitId into node-graph,\n  // but this way seems cleaner as it keeps the separation of concerns while\n  // leveraging actions to reuse the node deletion code.\n  state = nodeIdsToDelete.reduce(\n    (state, nodeId) => rootReducer(state, deleteNode(nodeId)),\n    state\n  );\n\n  const remainingCircuitIds = Object.keys(\n    state.services.circuits.nodeIdsByCircuitId\n  ).filter((x) => x !== circuitId);\n\n  return fpSet(state, \"services\", \"circuits\", (serviceState) => ({\n    ...serviceState,\n    nodeIdsByCircuitId: pick(\n      serviceState.nodeIdsByCircuitId,\n      remainingCircuitIds\n    ),\n    circuitNamesByCircuitId: pick(\n      serviceState.circuitNamesByCircuitId,\n      remainingCircuitIds\n    ),\n  }));\n};\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\n\nimport { isImportCircuitAction } from \"@/actions/circuit-import\";\nimport { importCircuitsFromSave } from \"@/services/savedata/api\";\n\nexport default function circuitImportReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isImportCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitIds, saveData } = action.payload;\n\n  return importCircuitsFromSave(state, circuitIds, saveData);\n}\n","import { isNewProjectAction } from \"@/actions/project-new\";\n\nimport { ROOT_CIRCUIT_ID } from \"../constants\";\nimport { createCircuitsReducer } from \"../utils\";\n\nexport default createCircuitsReducer((state, action) => {\n  if (!isNewProjectAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    circuitNamesByCircuitId: {\n      [ROOT_CIRCUIT_ID]: \"Root\",\n    },\n    nodeIdsByCircuitId: {\n      [ROOT_CIRCUIT_ID]: [],\n    },\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_COPY_NODES = \"@clipboard/copy\" as const;\nexport const copyNodes = (nodeId: string | string[]) => ({\n  type: ACTION_COPY_NODES,\n  payload: {\n    nodeIds: Array.isArray(nodeId) ? nodeId : [nodeId],\n  },\n});\nexport type CopyNodesAction = ReturnType<typeof copyNodes>;\nexport function isCopyNodesAction(\n  action: AnyAction\n): action is CopyNodesAction {\n  return action.type === ACTION_COPY_NODES;\n}\n","import { circuitIdFromNodeIdSelector } from \"@/services/circuits/selectors/nodes\";\nimport { circuitIdToNodeType } from \"@/nodes/definitions/integrated-circuits/utils\";\nimport { AppState } from \"@/store\";\n\nimport { NodePin } from \"../types\";\n\nimport { connectionsSelector } from \"./connections\";\nimport { nodeDefFromNodeIdSelector } from \"./node-def\";\nimport { nodeIdsFromTypeSelector, nodeTypeFromNodeIdSelector } from \"./nodes\";\n\nexport const pinDirectionFromNodePinSelector = (\n  state: AppState,\n  nodeId: string,\n  pinId: string\n) => {\n  const def = nodeDefFromNodeIdSelector(state, nodeId);\n  if (!def) {\n    return null;\n  }\n\n  const pinDef = def.pins[pinId];\n  if (!pinDef) {\n    return null;\n  }\n  return pinDef.direction;\n};\n\n/**\n * Gets a map of node input pins to their output sources given a node id.\n *\n * WARN: Not react safe.  For reducer use only\n */\nexport const nodeOutputSourcesByPinIdFromNodeIdSelector = (\n  state: AppState,\n  nodeId: string\n) => {\n  const connections = connectionsSelector(state);\n  const nodeDef = nodeDefFromNodeIdSelector(state, nodeId);\n\n  if (!nodeDef) {\n    return {};\n  }\n\n  let outputPins: string[] = [];\n  outputPins = Object.keys(nodeDef.pins).filter(\n    (x) => nodeDef.pins[x].direction === \"output\"\n  );\n\n  const outputConnections = connections.filter(\n    (x) => x.outputPin.nodeId === nodeId\n  );\n\n  const result: Record<string, NodePin[]> = {};\n  for (const pin of outputPins) {\n    result[pin] = [];\n  }\n\n  for (const connection of outputConnections) {\n    const { outputPin, inputPin } = connection;\n    result[outputPin.pinId].push(inputPin);\n  }\n\n  return result;\n};\n\nexport const nodePinsFromPinNodeSelector = (\n  state: AppState,\n  nodeId: string\n): NodePin[] => {\n  const nodeType = nodeTypeFromNodeIdSelector(state, nodeId);\n  if (nodeType !== \"pin-input\" && nodeType !== \"pin-output\") {\n    return [];\n  }\n\n  const circuitId = circuitIdFromNodeIdSelector(state, nodeId);\n  if (!circuitId) {\n    return [];\n  }\n\n  const icNodeType = circuitIdToNodeType(circuitId);\n  const icNodeIds = nodeIdsFromTypeSelector(state, icNodeType);\n\n  return icNodeIds.map((icNodeId) => ({ nodeId: icNodeId, pinId: nodeId }));\n};\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createClipboardReducer = createServiceReducerCreator(\"clipboard\");\nexport const createClipboardSelector = createServiceSelectorCreator(\n  \"clipboard\"\n);\n","import { concatReducers } from \"@/store/utils\";\n\nimport clipboardCopyReducer from \"./clipboard-copy\";\nimport clipboardPasteReducer from \"./clipboard-paste\";\n\nconst clipboardReducer = concatReducers(\n  clipboardCopyReducer,\n  clipboardPasteReducer\n);\n\nexport default clipboardReducer;\n","import { v4 as uuidV4 } from \"uuid\";\nimport map from \"lodash/map\";\nimport mapValues from \"lodash/mapValues\";\nimport findIndex from \"lodash/findIndex\";\nimport zipObject from \"lodash/zipObject\";\n\nimport { pointSubtract } from \"@/geometry\";\n\nimport { isCopyNodesAction } from \"@/actions/clipboard-copy\";\n\nimport { nodeFromNodeIdSelector } from \"@/services/node-graph/selectors/nodes\";\nimport { nodeOutputSourcesByPinIdFromNodeIdSelector } from \"@/services/node-graph/selectors/pins\";\nimport { nodePositionsByNodeIdSelector } from \"@/services/node-layout/selectors/node-positions\";\n\nimport { ClipboardNode } from \"../types\";\nimport { createClipboardReducer } from \"../utils\";\n\nexport default createClipboardReducer((state, action, appState) => {\n  if (!isCopyNodesAction(action)) {\n    return state;\n  }\n\n  const { nodeIds } = action.payload;\n  if (nodeIds.length === 0) {\n    return state;\n  }\n\n  const nodePositionsById = nodePositionsByNodeIdSelector(appState);\n\n  const copyIds = zipObject(\n    nodeIds,\n    map(nodeIds, () => uuidV4())\n  );\n\n  function nodeIsSelected(id: string): boolean {\n    return findIndex(nodeIds, (x) => x === id) !== -1;\n  }\n\n  const rootPosition = nodePositionsById[nodeIds[0]];\n\n  const copyNodes: ClipboardNode[] = nodeIds.map((nodeId) => {\n    const node = nodeFromNodeIdSelector(appState, nodeId);\n    const outputs = nodeOutputSourcesByPinIdFromNodeIdSelector(\n      appState,\n      nodeId\n    );\n    const copyNode: ClipboardNode = {\n      id: copyIds[nodeId],\n      nodeType: node.nodeType,\n      offset: pointSubtract(nodePositionsById[nodeId], rootPosition),\n      outputs: mapValues(outputs, (conns) =>\n        conns\n          .filter((x) => nodeIsSelected(x.nodeId))\n          .map((c) => ({ nodeId: copyIds[c.nodeId], pinId: c.pinId }))\n      ),\n    };\n    return copyNode;\n  });\n\n  return {\n    ...state,\n    clipboardNodes: copyNodes,\n    clipboardPasteOrigin: rootPosition,\n  };\n});\n","import { AnyAction } from \"redux\";\nimport zipObject from \"lodash/zipObject\";\nimport map from \"lodash/map\";\nimport values from \"lodash/values\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nimport { pointAdd } from \"@/geometry\";\nimport { AppState, defaultAppState } from \"@/store\";\nimport { fpSet } from \"@/utils\";\n\nimport rootReducer from \"@/store/reducer\";\n\nimport { addNode } from \"@/actions/node-add\";\nimport { attachWire } from \"@/actions/wire-attach\";\nimport { isPasteAction } from \"@/actions/clipboard-paste\";\nimport { selectNodes } from \"@/actions/select-nodes\";\n\nimport { gridNodeSnapSelector } from \"@/services/circuit-editor-drag/selectors/snap\";\n\nexport default function clipboardPasteReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isPasteAction(action)) {\n    return state;\n  }\n\n  const { targetCircuitId } = action.payload;\n\n  const { clipboardNodes, clipboardPasteOrigin } = state.services.clipboard;\n  const gridSnap = gridNodeSnapSelector(state);\n  const pastePosition = pointAdd(clipboardPasteOrigin, {\n    x: gridSnap,\n    y: gridSnap,\n  });\n\n  const pasteIds = zipObject(\n    clipboardNodes.map((x) => x.id),\n    map(clipboardNodes, () => uuidV4())\n  );\n\n  // Two passes: Create and Wire.\n\n  // Create the nodes.\n  for (const node of clipboardNodes) {\n    const { id, nodeType, offset } = node;\n    const p = pointAdd(pastePosition, offset);\n    state = rootReducer(\n      state,\n      addNode(nodeType, targetCircuitId, p, { nodeId: pasteIds[id] })\n    );\n  }\n\n  // Wire the nodes\n  for (const node of clipboardNodes) {\n    const { id, outputs } = node;\n    const sourceId = pasteIds[id];\n    for (const outputPin of Object.keys(outputs)) {\n      for (const output of outputs[outputPin]) {\n        const { nodeId: targetCopyId, pinId: targetPin } = output;\n        const targetId = pasteIds[targetCopyId];\n        state = rootReducer(\n          state,\n          attachWire(\n            { nodeId: sourceId, pinId: outputPin },\n            { nodeId: targetId, pinId: targetPin }\n          )\n        );\n      }\n    }\n  }\n\n  state = fpSet(\n    state,\n    \"services\",\n    \"clipboard\",\n    \"clipboardPasteOrigin\",\n    pastePosition\n  );\n  state = rootReducer(state, selectNodes(values(pasteIds)));\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_DIALOG_RESPONSE_ACCEPT = \"@dialog/response/accept\" as const;\nexport const acceptDialog = (result: any) => ({\n  type: ACTION_DIALOG_RESPONSE_ACCEPT,\n  payload: { result },\n});\nexport type AcceptDialogAction = ReturnType<typeof acceptDialog>;\nexport function isAcceptDialogAction(\n  action: AnyAction\n): action is AcceptDialogAction {\n  return action.type === ACTION_DIALOG_RESPONSE_ACCEPT;\n}\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createDialogReducer = createServiceReducerCreator(\"dialog\");\nexport const createDialogSelector = createServiceSelectorCreator(\"dialog\");\n","import { isAcceptDialogAction } from \"@/actions/dialog-response-accept\";\n\nimport { defaultDialogServiceState } from \"../state\";\nimport { createDialogReducer } from \"../utils\";\n\nexport default createDialogReducer((state, action) => {\n  if (!isAcceptDialogAction(action)) {\n    return state;\n  }\n\n  return defaultDialogServiceState;\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_DIALOG_RESPONSE_CANCEL = \"@dialog/response/cancel\" as const;\nexport const cancelDialog = () => ({\n  type: ACTION_DIALOG_RESPONSE_CANCEL,\n});\nexport type CancelDialogAction = ReturnType<typeof cancelDialog>;\nexport function isCancelDialogAction(\n  action: AnyAction\n): action is CancelDialogAction {\n  return action.type === ACTION_DIALOG_RESPONSE_CANCEL;\n}\n","import { isCancelDialogAction } from \"@/actions/dialog-response-cancel\";\n\nimport { defaultDialogServiceState } from \"../state\";\nimport { createDialogReducer } from \"../utils\";\n\nexport default createDialogReducer((state, action) => {\n  if (!isCancelDialogAction(action)) {\n    return state;\n  }\n\n  return defaultDialogServiceState;\n});\n","import { AnyAction } from \"redux\";\n\nimport { DialogType } from \"@/dialogs/types\";\n\nexport const ACTION_DIALOG_SHOW = \"@dialog/show\" as const;\nexport const showDialog = (dialogType: DialogType, data: any) => ({\n  type: ACTION_DIALOG_SHOW,\n  payload: { dialogType, data },\n});\nexport type ShowDialogAction = ReturnType<typeof showDialog>;\nexport function isShowDialogAction(\n  action: AnyAction\n): action is ShowDialogAction {\n  return action.type === ACTION_DIALOG_SHOW;\n}\n","import { concatReducers } from \"@/store/utils\";\n\nimport dialogResponseAcceptReducer from \"./dialog-response-accept\";\nimport dialogResponseCancelReducer from \"./dialog-response-cancel\";\nimport dialogShowReducer from \"./dialog-show\";\n\nexport default concatReducers(\n  dialogResponseAcceptReducer,\n  dialogResponseCancelReducer,\n  dialogShowReducer\n);\n","import { isShowDialogAction } from \"@/actions/dialog-show\";\nimport { createDialogReducer } from \"../utils\";\n\nexport default createDialogReducer((state, action) => {\n  if (!isShowDialogAction(action)) {\n    return state;\n  }\n\n  const { dialogType, data } = action.payload;\n\n  return {\n    ...state,\n    dialogType,\n    data,\n  };\n});\n","import { AppReducer } from \"./types\";\n\nexport const PRIORITY_PRE = -10;\nexport const PRIORITY_POST = 10;\nexport const PRIORITY_SAVE = 50;\n\nexport function reducerPriority(\n  priority: number,\n  reducer: AppReducer\n): AppReducer {\n  reducer.weight = priority;\n  return reducer;\n}\n\nexport function priorityBefore(reducer: AppReducer) {\n  return (reducer.weight ?? 0) - 1;\n}\n","import { AnyAction } from \"redux\";\n\nimport { reducerPriority, PRIORITY_PRE } from \"@/store/priorities\";\n\nimport { isAddNodeAction } from \"@/actions/node-add\";\n\nimport { createNodeGraphReducer } from \"../utils\";\n\nexport default reducerPriority(\n  PRIORITY_PRE,\n  createNodeGraphReducer((state, action: AnyAction) => {\n    if (!isAddNodeAction(action)) {\n      return state;\n    }\n\n    const { nodeId: id, nodeType, nodeName } = action.payload;\n    return {\n      ...state,\n      nodesById: {\n        ...state.nodesById,\n        [id]: {\n          nodeType,\n          nodeName: nodeName ?? null,\n        },\n      },\n    };\n  })\n);\n","import { isDeleteNodeAction } from \"@/actions/node-delete\";\n\nimport { priorityBefore, reducerPriority } from \"@/store/priorities\";\n\nimport circuitsNodeDeleteReducer from \"@/services/circuits/reducer/node-delete\";\n\nimport { createNodeGraphReducer } from \"../utils\";\n\nimport nodeDelete from \"./operations/node-delete\";\n\n// We need to know what circuit the node was a part of\nexport default reducerPriority(\n  priorityBefore(circuitsNodeDeleteReducer),\n  createNodeGraphReducer((state, action, rootState) => {\n    if (!isDeleteNodeAction(action)) {\n      return state;\n    }\n\n    const { nodeIds } = action.payload;\n\n    return nodeDelete(state, nodeIds, rootState);\n  })\n);\n","import pick from \"lodash/pick\";\nimport difference from \"lodash/difference\";\nimport pickBy from \"lodash/pickBy\";\nimport flatMap from \"lodash/flatMap\";\n\nimport { AppState } from \"@/store\";\n\nimport { NodeGraphServiceState } from \"../../state\";\nimport { Connection, nodePinEquals } from \"../../types\";\nimport { nodePinsFromPinNodeSelector } from \"../../selectors/pins\";\n\nexport default function nodeDelete(\n  state: NodeGraphServiceState,\n  nodeIds: string[],\n  rootState: AppState\n): NodeGraphServiceState {\n  const remainingNodeIds = difference(Object.keys(state.nodesById), nodeIds);\n\n  const removedIcPins = flatMap(nodeIds, (nodeId) =>\n    nodePinsFromPinNodeSelector(rootState, nodeId)\n  );\n\n  function isRemainingConnection({ inputPin, outputPin }: Connection) {\n    if (\n      nodeIds.indexOf(inputPin.nodeId) !== -1 ||\n      nodeIds.indexOf(outputPin.nodeId) !== -1\n    ) {\n      // Connection went to a removed node\n      return false;\n    }\n\n    // Connection was to a removed node pin\n    if (\n      removedIcPins.some(\n        (pin) => nodePinEquals(pin, inputPin) || nodePinEquals(pin, outputPin)\n      )\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  return {\n    ...state,\n    nodesById: pick(state.nodesById, remainingNodeIds),\n    connectionsById: pickBy(state.connectionsById, isRemainingConnection),\n  };\n}\n","import { AnyAction } from \"redux\";\n\nimport { isRenameNodeAction } from \"@/actions/node-rename\";\n\nimport { createNodeGraphReducer } from \"../utils\";\n\nexport default createNodeGraphReducer((state, action: AnyAction) => {\n  if (!isRenameNodeAction(action)) {\n    return state;\n  }\n\n  const { nodeId } = action.payload;\n  if (!state.nodesById[nodeId]) {\n    return state;\n  }\n\n  let nodeName: string | null = action.payload.nodeName;\n  if (!nodeName && nodeName.trim() === \"\") {\n    nodeName = null;\n  }\n\n  return {\n    ...state,\n    nodesById: {\n      ...state.nodesById,\n      [nodeId]: {\n        ...state.nodesById[nodeId],\n        nodeName: nodeName,\n      },\n    },\n  };\n});\n","import { concatReducers } from \"@/store/utils\";\n\nimport nodeAddReducer from \"./node-add\";\nimport nodeDeleteReducer from \"./node-delete\";\nimport nodeRenameReducer from \"./node-rename\";\nimport projectNewReducer from \"./project-new\";\nimport wireAttachReducer from \"./wire-attach\";\nimport wireDetatchReducer from \"./wire-detatch\";\n\nconst graphReducer = concatReducers(\n  nodeAddReducer,\n  projectNewReducer,\n  nodeDeleteReducer,\n  nodeRenameReducer,\n  wireAttachReducer,\n  wireDetatchReducer\n);\n\nexport default graphReducer;\n","import { isNewProjectAction } from \"@/actions/project-new\";\n\nimport { createNodeGraphReducer } from \"../utils\";\nimport { defaultNodeGraphServiceState } from \"../state\";\n\nexport default createNodeGraphReducer((state, action) => {\n  if (!isNewProjectAction(action)) {\n    return state;\n  }\n\n  return defaultNodeGraphServiceState;\n});\n","import find from \"lodash/find\";\n\nimport { AppState } from \"@/store\";\n\nimport { isAttachWireAction } from \"@/actions/wire-attach\";\n\nimport { nodeDefinitionFromTypeSelector } from \"@/services/node-types/selectors/node-types\";\n\nimport { createNodeGraphReducer } from \"../utils\";\nimport { Connection, NodePin, nodePinEquals } from \"../types\";\nimport { NodeGraphServiceState } from \"../state\";\n\nexport default createNodeGraphReducer((state, action, rootState) => {\n  if (!isAttachWireAction(action)) {\n    return state;\n  }\n\n  const { connectionId, p1, p2 } = action.payload;\n  const conn = pinsToConnection(state, p1, p2, rootState);\n  if (!conn) {\n    return state;\n  }\n\n  const { inputPin } = conn;\n\n  // Only one source per input.\n  if (find(state.connectionsById, (c) => nodePinEquals(c.inputPin, inputPin))) {\n    return state;\n  }\n\n  return {\n    ...state,\n    connectionsById: {\n      ...state.connectionsById,\n      [connectionId]: {\n        id: connectionId,\n        ...conn,\n      },\n    },\n  };\n});\n\n/**\n * Check two pins to see if they can form a valid connection.\n * Returns null if no connection can be made (both inputs or both outputs)\n *\n * Does not check to see if the pins are already connected, or other connections prevent this connection from forming.\n */\nexport function pinsToConnection(\n  state: NodeGraphServiceState,\n  p1: NodePin,\n  p2: NodePin,\n  rootState: AppState\n): Connection | null {\n  const p1Node = state.nodesById[p1.nodeId];\n  const p2Node = state.nodesById[p2.nodeId];\n\n  if (!p1Node || !p2Node) {\n    return null;\n  }\n\n  const p1Def = nodeDefinitionFromTypeSelector(rootState, p1Node.nodeType);\n  const p2Def = nodeDefinitionFromTypeSelector(rootState, p2Node.nodeType);\n\n  if (!p1Def || !p2Def) {\n    return null;\n  }\n\n  const p1Pin = p1Def.pins[p1.pinId];\n  const p2Pin = p2Def.pins[p2.pinId];\n\n  if (!p1Pin || !p2Pin) {\n    return null;\n  }\n\n  // Pins are in same direction and cannot be connected.\n  if (p1Pin.direction === p2Pin.direction) {\n    return null;\n  }\n\n  const outputPin = p1Pin.direction === \"output\" ? p1 : p2;\n  const inputPin = p1Pin.direction === \"input\" ? p1 : p2;\n\n  return {\n    outputPin,\n    inputPin,\n  };\n}\n","import pick from \"lodash/pick\";\n\nimport { isDetatchWireAction } from \"@/actions/wire-detatch\";\n\nimport { createNodeGraphReducer } from \"../utils\";\n\nexport default createNodeGraphReducer((state, action) => {\n  if (!isDetatchWireAction(action)) {\n    return state;\n  }\n\n  const { connectionId } = action.payload;\n\n  const remainingIds = Object.keys(state.connectionsById).filter(\n    (x) => x !== connectionId\n  );\n\n  return {\n    ...state,\n    connectionsById: pick(state.connectionsById, remainingIds),\n  };\n});\n","import { fpSet } from \"@/utils\";\n\nimport { ZeroPoint } from \"@/geometry\";\nimport { isAddNodeAction } from \"@/actions/node-add\";\n\nimport { createNodeLayoutReducer } from \"../utils\";\n\nexport default createNodeLayoutReducer((state, action) => {\n  if (!isAddNodeAction(action)) {\n    return state;\n  }\n  const { nodeId, position = ZeroPoint } = action.payload;\n\n  return fpSet(state, \"nodePositionsById\", nodeId, position);\n});\n","import { priorityBefore, reducerPriority } from \"@/store/priorities\";\n\nimport { isDeleteNodeAction } from \"@/actions/node-delete\";\n\nimport nodeGraphNodeDeleteReducer from \"@/services/node-graph/reducer/node-delete\";\n\nimport { createNodeLayoutReducer } from \"../utils\";\n\nimport nodeDeleteOperation from \"./operations/node-delete\";\n\n// We need to run this reducer before graph runs, as we want to check what wires are connected to the node being deleted.\nexport default reducerPriority(\n  priorityBefore(nodeGraphNodeDeleteReducer),\n  createNodeLayoutReducer((state, action, rootState) => {\n    if (!isDeleteNodeAction(action)) {\n      return state;\n    }\n\n    const { nodeIds } = action.payload;\n\n    return nodeDeleteOperation(state, nodeIds, rootState);\n  })\n);\n","import difference from \"lodash/difference\";\nimport pick from \"lodash/pick\";\nimport flatMap from \"lodash/flatMap\";\n\nimport { AppState } from \"@/store\";\n\nimport {\n  connectionsByIdSelector,\n  nodeInputConnectionIdsFromNodeIdSelector,\n  nodeOutputConnectionIdsFromNodeIdSelector,\n} from \"@/services/node-graph/selectors/connections\";\n\nimport { NodeLayoutServiceState } from \"../../state\";\nimport { nodePinsFromPinNodeSelector } from \"@/services/node-graph/selectors/pins\";\nimport { nodePinEquals } from \"@/services/node-graph/types\";\n\nexport default function nodeDelete(\n  state: NodeLayoutServiceState,\n  nodeIds: string[],\n  rootState: AppState\n): NodeLayoutServiceState {\n  // Connection ids connected to nodes being removed.\n  const removingNodeConnectionIds = nodeIds.reduce((connectionIds, nodeId) => {\n    // Get all inputs and outputs to the node.\n    const inputs = nodeInputConnectionIdsFromNodeIdSelector(rootState, nodeId);\n    const outputs = nodeOutputConnectionIdsFromNodeIdSelector(\n      rootState,\n      nodeId\n    );\n\n    connectionIds.push(...inputs, ...outputs);\n\n    return connectionIds;\n  }, [] as string[]);\n\n  // Connections going to IC node pins whose pin nodes were removed.\n  const removedIcPins = flatMap(nodeIds, (nodeId) =>\n    // If not a pin, this will return an empty array.\n    nodePinsFromPinNodeSelector(rootState, nodeId)\n  );\n  const connectionsById = connectionsByIdSelector(rootState);\n  const removingPinConnectionIds = Object.keys(connectionsById).filter(\n    (connectionId) => {\n      const { inputPin, outputPin } = connectionsById[connectionId];\n      // We will need to remove this connection if it went to a pin generated by\n      // an input or output pin node being removed.\n      return removedIcPins.some(\n        (removedPin) =>\n          nodePinEquals(removedPin, inputPin) ||\n          nodePinEquals(removedPin, outputPin)\n      );\n    }\n  );\n\n  const removingConnectionIds = [\n    ...removingNodeConnectionIds,\n    ...removingPinConnectionIds,\n  ];\n\n  // Remove any joint that is part of a removed connection.\n  const removingJointIds = removingConnectionIds.reduce(\n    (jointIds, connectionId) => {\n      jointIds.push(...state.wireJointIdsByConnectionId[connectionId]);\n      return jointIds;\n    },\n    [] as string[]\n  );\n\n  const remainingConnectionIds = difference(\n    Object.keys(state.wireJointIdsByConnectionId),\n    removingNodeConnectionIds\n  );\n\n  const remainingJointIds = difference(\n    Object.keys(state.wireJointPositionsByJointId),\n    removingJointIds\n  );\n\n  const remainingNodeIds = difference(\n    Object.keys(state.nodePositionsById),\n    nodeIds\n  );\n\n  return {\n    ...state,\n    nodePositionsById: pick(state.nodePositionsById, remainingNodeIds),\n    wireJointIdsByConnectionId: pick(\n      state.wireJointIdsByConnectionId,\n      remainingConnectionIds\n    ),\n    wireJointPositionsByJointId: pick(\n      state.wireJointPositionsByJointId,\n      remainingJointIds\n    ),\n  };\n}\n","import { AnyAction } from \"redux\";\n\nimport { asArray, MaybeArray } from \"@/arrays\";\nimport { Point } from \"@/geometry\";\n\nexport interface MoveNodeOpts {\n  relative?: boolean;\n  snapMode?: \"none\" | \"node\";\n}\nexport const ACTION_NODE_MOVE = \"@node/move\" as const;\nexport const moveNode = (\n  nodeId: MaybeArray<string>,\n  position: Point,\n  opts: MoveNodeOpts = {}\n) => ({\n  type: ACTION_NODE_MOVE,\n  payload: {\n    nodeIds: asArray(nodeId),\n    position,\n    relative: opts.relative ?? false,\n    snapMode: opts.snapMode ?? \"none\",\n  },\n});\nexport type MoveNodeAction = ReturnType<typeof moveNode>;\nexport function isMoveNodeAction(action: AnyAction): action is MoveNodeAction {\n  return action.type === ACTION_NODE_MOVE;\n}\n","import mapValues from \"lodash/mapValues\";\nimport pick from \"lodash/pick\";\n\nimport { isMoveNodeAction } from \"@/actions/node-move\";\n\nimport { applyGridNodeSnapSelector } from \"@/services/circuit-editor-drag/selectors/snap\";\n\nimport { createNodeLayoutReducer } from \"../utils\";\n\nexport default createNodeLayoutReducer((state, action, appState) => {\n  if (!isMoveNodeAction(action)) {\n    return state;\n  }\n\n  const { nodeIds, position, relative, snapMode } = action.payload;\n\n  const movedNodePositions = mapValues(\n    pick(state.nodePositionsById, nodeIds),\n    (p) => {\n      let movedP = {\n        x: relative ? p.x + position.x : position.x,\n        y: relative ? p.y + position.y : position.y,\n      };\n      if (snapMode === \"node\") {\n        movedP = applyGridNodeSnapSelector(appState, movedP);\n      }\n      return movedP;\n    }\n  );\n\n  return {\n    ...state,\n    nodePositionsById: {\n      ...state.nodePositionsById,\n      ...movedNodePositions,\n    },\n  };\n});\n","import { concatReducers } from \"@/store/utils\";\n\nimport nodeAddReducer from \"./node-add\";\nimport nodeDeleteReducer from \"./node-delete\";\nimport nodeMoveReducer from \"./node-move\";\nimport projectNewReducer from \"./project-new\";\nimport wireAttachReducer from \"./wire-attach\";\nimport wireDetatchReducer from \"./wire-detatch\";\nimport wireJointAddReducer from \"./wire-joint-add\";\nimport wireJointDeleteReducer from \"./wire-joint-delete\";\nimport wireJointMoveReducer from \"./wire-joint-move\";\n\nconst fieldReducer = concatReducers(\n  nodeAddReducer,\n  projectNewReducer,\n  nodeDeleteReducer,\n  nodeMoveReducer,\n  wireAttachReducer,\n  wireDetatchReducer,\n  wireJointAddReducer,\n  wireJointDeleteReducer,\n  wireJointMoveReducer\n);\n\nexport default fieldReducer;\n","import { isNewProjectAction } from \"@/actions/project-new\";\n\nimport { createNodeLayoutReducer } from \"../utils\";\nimport { defaultNodeLayoutServiceState } from \"../state\";\n\nexport default createNodeLayoutReducer((state, action) => {\n  if (!isNewProjectAction(action)) {\n    return state;\n  }\n\n  return defaultNodeLayoutServiceState;\n});\n","import { v4 as uuidV4 } from \"uuid\";\nimport zipObject from \"lodash/zipObject\";\n\nimport { isAttachWireAction } from \"@/actions/wire-attach\";\nimport { fpSet } from \"@/utils\";\n\nimport { createNodeLayoutReducer } from \"../utils\";\n\nexport default createNodeLayoutReducer((state, action) => {\n  if (!isAttachWireAction(action)) {\n    return state;\n  }\n\n  const { connectionId, joints } = action.payload;\n\n  // Might want to use addWireJoint action, but field is the only thing that cares about joints.\n  if (joints.length > 0) {\n    const jointIds = joints.map(() => uuidV4());\n    state = fpSet(state, \"wireJointIdsByConnectionId\", connectionId, jointIds);\n    state = fpSet(state, \"wireJointPositionsByJointId\", (value) => ({\n      ...value,\n      ...zipObject(jointIds, joints),\n    }));\n  } else {\n    state = fpSet(state, \"wireJointIdsByConnectionId\", connectionId, []);\n  }\n\n  return state;\n});\n","import pick from \"lodash/pick\";\nimport difference from \"lodash/difference\";\n\nimport { isDetatchWireAction } from \"@/actions/wire-detatch\";\n\nimport { createNodeLayoutReducer } from \"../utils\";\n\nexport default createNodeLayoutReducer((state, action) => {\n  if (!isDetatchWireAction(action)) {\n    return state;\n  }\n\n  const { connectionId } = action.payload;\n\n  const remainingConnectionIds = Object.keys(\n    state.wireJointIdsByConnectionId\n  ).filter((x) => x != connectionId);\n\n  const remainingJointIds = difference(\n    Object.keys(state.wireJointPositionsByJointId),\n    state.wireJointIdsByConnectionId[connectionId]\n  );\n\n  return {\n    ...state,\n    wireJointIdsByConnectionId: pick(\n      state.wireJointIdsByConnectionId,\n      remainingConnectionIds\n    ),\n    wireJointPositionsByJointId: pick(\n      state.wireJointPositionsByJointId,\n      remainingJointIds\n    ),\n  };\n});\n","import { isAddWireJointAction } from \"@/actions/wire-joint-add\";\n\nimport { createNodeLayoutReducer } from \"../utils\";\n\nexport default createNodeLayoutReducer((state, action) => {\n  if (!isAddWireJointAction(action)) {\n    return state;\n  }\n\n  const { connectionId, addAfterJointId, position, jointId } = action.payload;\n  let wireJoints = state.wireJointIdsByConnectionId[connectionId];\n  const insertionIndex = addAfterJointId\n    ? wireJoints.indexOf(addAfterJointId) + 1\n    : 0;\n\n  wireJoints = [\n    ...wireJoints.slice(0, insertionIndex),\n    jointId,\n    ...wireJoints.slice(insertionIndex),\n  ];\n\n  return {\n    ...state,\n    wireJointIdsByConnectionId: {\n      ...state.wireJointIdsByConnectionId,\n      [connectionId]: wireJoints,\n    },\n    wireJointPositionsByJointId: {\n      ...state.wireJointPositionsByJointId,\n      [jointId]: position,\n    },\n  };\n});\n","import pick from \"lodash/pick\";\nimport mapValues from \"lodash/mapValues\";\n\nimport { isDeleteWireJointAction } from \"@/actions/wire-joint-delete\";\n\nimport { createNodeLayoutReducer } from \"../utils\";\n\nexport default createNodeLayoutReducer((state, action) => {\n  if (!isDeleteWireJointAction(action)) {\n    return state;\n  }\n\n  const { jointId } = action.payload;\n\n  const remainingJointIds = Object.keys(\n    state.wireJointPositionsByJointId\n  ).filter((x) => x !== jointId);\n\n  return {\n    ...state,\n    wireJointIdsByConnectionId: mapValues(\n      state.wireJointIdsByConnectionId,\n      (connectionIds) => connectionIds.filter((x) => x !== jointId)\n    ),\n    wireJointPositionsByJointId: pick(\n      state.wireJointPositionsByJointId,\n      remainingJointIds\n    ),\n  };\n});\n","import mapValues from \"lodash/mapValues\";\nimport pick from \"lodash/pick\";\n\nimport { isMoveWireJointAction } from \"@/actions/wire-joint-move\";\n\nimport { createNodeLayoutReducer } from \"../utils\";\nimport {\n  applyGridJointSnapSelector,\n  applyGridNodeSnapSelector,\n} from \"@/services/circuit-editor-drag/selectors/snap\";\n\nexport default createNodeLayoutReducer((state, action, appState) => {\n  if (!isMoveWireJointAction(action)) {\n    return state;\n  }\n\n  const { jointIds, position, relative, snapMode } = action.payload;\n\n  const movedJoints = mapValues(\n    pick(state.wireJointPositionsByJointId, jointIds),\n    (p) => {\n      let movedP = {\n        x: relative ? p.x + position.x : position.x,\n        y: relative ? p.y + position.y : position.y,\n      };\n\n      if (snapMode === \"node\") {\n        movedP = applyGridNodeSnapSelector(appState, movedP);\n      } else if (snapMode === \"joint\") {\n        movedP = applyGridJointSnapSelector(appState, movedP);\n      }\n\n      return movedP;\n    }\n  );\n\n  return {\n    ...state,\n    wireJointPositionsByJointId: {\n      ...state.wireJointPositionsByJointId,\n      ...movedJoints,\n    },\n  };\n});\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport { reducerPriority, PRIORITY_SAVE } from \"@/store/priorities\";\nimport { isProjectMutationAction } from \"@/project-mutation-actions\";\n\nimport { createSave, storeAutosave } from \"@/services/savedata/api\";\n\nexport default reducerPriority(\n  PRIORITY_SAVE,\n  (state: AppState = defaultAppState, action: AnyAction): AppState => {\n    if (!isProjectMutationAction(action)) {\n      return state;\n    }\n\n    const save = createSave(state);\n    storeAutosave(save);\n\n    return state;\n  }\n);\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createProjectReducer = createServiceReducerCreator(\"project\");\nexport const createProjectSelector = createServiceSelectorCreator(\"project\");\n","import { isProjectMutationAction } from \"@/project-mutation-actions\";\nimport { createProjectReducer } from \"../utils\";\n\nexport default createProjectReducer((state, action) => {\n  if (!isProjectMutationAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    projectModified: true,\n  };\n});\n","import { isNewProjectAction } from \"@/actions/project-new\";\n\nimport { deleteAutosave } from \"@/services/savedata/api\";\nimport { createProjectReducer } from \"../utils\";\n\nexport default createProjectReducer((state, action) => {\n  if (!isNewProjectAction(action)) {\n    return state;\n  }\n\n  // FIXME: Side effect, move to saga.\n  deleteAutosave();\n\n  return {\n    ...state,\n    projectName: \"New Project\",\n    projectModified: false,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_RENAME = \"@project/rename\" as const;\nexport const renameProject = (projectName: string) => ({\n  type: ACTION_PROJECT_RENAME,\n  payload: { projectName },\n});\nexport type RenameProjectAction = ReturnType<typeof renameProject>;\nexport function isRenameProjectAction(\n  action: AnyAction\n): action is RenameProjectAction {\n  return action.type === ACTION_PROJECT_RENAME;\n}\n","import { isRenameProjectAction } from \"@/actions/project-rename\";\n\nimport { createProjectReducer } from \"../utils\";\n\nexport default createProjectReducer((state, action) => {\n  if (!isRenameProjectAction(action)) {\n    return state;\n  }\n\n  let { projectName } = action.payload;\n  projectName = projectName.trim();\n\n  if (projectName === \"\") {\n    return state;\n  }\n\n  return {\n    ...state,\n    projectName,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_SAVE = \"@project/save\" as const;\nexport const saveProject = () => ({\n  type: ACTION_PROJECT_SAVE,\n});\nexport type SaveProjectAction = ReturnType<typeof saveProject>;\nexport function isSaveProjectAction(\n  action: AnyAction\n): action is SaveProjectAction {\n  return action.type === ACTION_PROJECT_SAVE;\n}\n\nexport const ACTION_PROJECT_SAVE_SUCCESS = \"@project/save:success\" as const;\nexport const saveProjectSuccess = () => ({\n  type: ACTION_PROJECT_SAVE_SUCCESS,\n});\nexport type SaveProjectSuccessAction = ReturnType<typeof saveProjectSuccess>;\nexport function isSaveProjectSuccessAction(\n  action: AnyAction\n): action is SaveProjectSuccessAction {\n  return action.type === ACTION_PROJECT_SAVE_SUCCESS;\n}\n","import { concatReducers } from \"@/store/utils\";\n\nimport autosaveReducer from \"./autosave\";\nimport initReducer from \"./init\";\nimport projectModifiedReducer from \"./project-modified\";\nimport projectNewReducer from \"./project-new\";\nimport projectReceiveReducer from \"./project-receive\";\nimport projectRenameReducer from \"./project-rename\";\nimport projectSaveSuccessReducer from \"./project-save-success\";\n\nexport default concatReducers(\n  autosaveReducer,\n  initReducer,\n  projectModifiedReducer,\n  projectNewReducer,\n  projectReceiveReducer,\n  projectRenameReducer,\n  projectSaveSuccessReducer\n);\n","import { AnyAction } from \"redux\";\nimport { AppState, defaultAppState } from \"@/store\";\n\nimport { isInitAction } from \"@/actions/init\";\n\nimport { loadAutosave, loadSave } from \"@/services/savedata/api\";\nimport { fpSet } from \"@/utils\";\n\nexport default function initReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isInitAction(action)) {\n    return state;\n  }\n\n  const save = loadAutosave();\n  if (!save) {\n    return state;\n  }\n\n  try {\n    state = loadSave(state, save);\n    state = fpSet(state, \"services\", \"project\", (state) => ({\n      ...state,\n      projectName: \"Previous Project\",\n      projectModified: true,\n    }));\n  } catch {\n    // TODO: Reprot error\n  }\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport { fpSet } from \"@/utils\";\n\nimport { isReceiveProjectAction } from \"@/actions/project-receive\";\n\nimport { loadSave } from \"@/services/savedata/api\";\n\nexport default function projectReceiveReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isReceiveProjectAction(action)) {\n    return state;\n  }\n\n  const { fileName, saveData } = action.payload;\n\n  try {\n    state = loadSave(state, saveData);\n    state = fpSet(state, \"services\", \"project\", (state) => ({\n      ...state,\n      projectName: fileName,\n      projectModified: false,\n    }));\n  } catch (e) {\n    // TODO: display error\n    console.error(\"Failed to load save\", e);\n  }\n\n  return state;\n}\n","import { isSaveProjectSuccessAction } from \"@/actions/project-save\";\nimport { createProjectReducer } from \"../utils\";\n\nexport default createProjectReducer((state, action) => {\n  if (!isSaveProjectSuccessAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    projectModified: false,\n  };\n});\n","import difference from \"lodash/difference\";\n\nimport { isDeleteNodeAction } from \"@/actions/node-delete\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isDeleteNodeAction(action)) {\n    return state;\n  }\n\n  const { nodeIds } = action.payload;\n\n  return {\n    ...state,\n    selectedNodeIds: difference(state.selectedNodeIds, nodeIds),\n    selectedConnectionIds: [], // Might be removing a node attached to a selected wire\n  };\n});\n","import { isNewProjectAction } from \"@/actions/project-new\";\n\nimport { createSelectionReducer } from \"../utils\";\nimport { defaultSelectionServiceState } from \"../state\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isNewProjectAction(action)) {\n    return state;\n  }\n\n  return defaultSelectionServiceState;\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SELECT_CLEAR = \"@select/all\" as const;\nexport const selectAll = (circuitId: string) => ({\n  type: ACTION_SELECT_CLEAR,\n  payload: { circuitId },\n});\nexport type SelectAllAction = ReturnType<typeof selectAll>;\nexport function isSelectAllAction(\n  action: AnyAction\n): action is SelectAllAction {\n  return action.type === ACTION_SELECT_CLEAR;\n}\n","import flatten from \"lodash/flatten\";\n\nimport { isSelectAllAction } from \"@/actions/select-all\";\n\nimport {\n  connectionIdsSelector,\n  connectionsByIdSelector,\n} from \"@/services/node-graph/selectors/connections\";\nimport { wireJointIdsByConnectionIdSelector } from \"@/services/node-layout/selectors/wires\";\nimport { nodeIdsFromCircuitIdSelector } from \"@/services/circuits/selectors/nodes\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action, appState) => {\n  if (!isSelectAllAction(action)) {\n    return state;\n  }\n\n  const { circuitId } = action.payload;\n  const nodeIds = nodeIdsFromCircuitIdSelector(appState, circuitId);\n\n  let connectionIds = connectionIdsSelector(appState);\n  const connectionsById = connectionsByIdSelector(appState);\n  connectionIds = connectionIds.filter((connectionId) => {\n    const { inputPin, outputPin } = connectionsById[connectionId];\n    if (\n      nodeIds.indexOf(inputPin.nodeId) === -1 ||\n      nodeIds.indexOf(outputPin.nodeId) === -1\n    ) {\n      return false;\n    }\n    return true;\n  });\n\n  const wireJointIdsFromConnectionId = wireJointIdsByConnectionIdSelector(\n    appState\n  );\n  const jointIds = flatten(\n    connectionIds.map((connId) => wireJointIdsFromConnectionId[connId])\n  );\n\n  return {\n    ...state,\n    selectedNodeIds: nodeIds,\n    selectedConnectionIds: connectionIds,\n    selectedJointIds: jointIds,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SELECT_CLEAR = \"@select/clear\" as const;\nexport const clearSelection = () => ({\n  type: ACTION_SELECT_CLEAR,\n});\nexport type ClearSelectionAction = ReturnType<typeof clearSelection>;\nexport function isClearSelectionAction(\n  action: AnyAction\n): action is ClearSelectionAction {\n  return action.type === ACTION_SELECT_CLEAR;\n}\n","import { isClearSelectionAction } from \"@/actions/select-clear\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isClearSelectionAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    selectedNodeIds: [],\n    selectedConnectionIds: [],\n    selectedJointIds: [],\n  };\n});\n","import { combineSelection } from \"@/selection-mode\";\n\nimport { isSelectWireJointsAction } from \"@/actions/select-wire-joints\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isSelectWireJointsAction(action)) {\n    return state;\n  }\n\n  const { jointIds, mode } = action.payload;\n\n  return {\n    ...state,\n    selectedNodeIds: mode === \"set\" ? [] : state.selectedNodeIds,\n    selectedConnectionIds: mode === \"set\" ? [] : state.selectedConnectionIds,\n    selectedJointIds: combineSelection(state.selectedJointIds, jointIds, mode),\n  };\n});\n","import { combineSelection } from \"@/selection-mode\";\n\nimport { isSelectNodesAction } from \"@/actions/select-nodes\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isSelectNodesAction(action)) {\n    return state;\n  }\n\n  const { nodeIds, mode } = action.payload;\n\n  return {\n    ...state,\n    selectedNodeIds: combineSelection(state.selectedNodeIds, nodeIds, mode),\n    selectedConnectionIds: mode === \"set\" ? [] : state.selectedConnectionIds,\n    selectedJointIds: mode === \"set\" ? [] : state.selectedJointIds,\n  };\n});\n","import { createSelector } from \"reselect\";\n\nimport mapValues from \"lodash/mapValues\";\n\nimport { offsetRectangle, ZeroRect } from \"@/geometry\";\n\nimport { nodeTypesByNodeIdSelector } from \"@/services/node-graph/selectors/nodes\";\nimport { nodeDefinitionsByTypeSelector } from \"@/services/node-types/selectors/node-types\";\n\nimport { nodePositionsByNodeIdSelector } from \"./node-positions\";\n\nexport const nodeRectsByIdSelector = createSelector(\n  nodePositionsByNodeIdSelector,\n  nodeDefinitionsByTypeSelector,\n  nodeTypesByNodeIdSelector,\n  (positionsById, nodeDefsByType, nodeTypesById) =>\n    mapValues(positionsById, (position, id) => {\n      const type = nodeTypesById[id];\n      if (!type) {\n        return ZeroRect;\n      }\n      const def = nodeDefsByType[type];\n      if (!def) {\n        return ZeroRect;\n      }\n\n      return offsetRectangle(def.visual.hitRect, position);\n    })\n);\n","import forOwn from \"lodash/forOwn\";\nimport pick from \"lodash/pick\";\n\nimport { intersects, pointIntersects } from \"@/geometry\";\nimport { combineSelection } from \"@/selection-mode\";\n\nimport { isSelectRegionAction } from \"@/actions/select-region\";\n\nimport { nodeIdsFromCircuitIdSelector } from \"@/services/circuits/selectors/nodes\";\nimport { nodeRectsByIdSelector } from \"@/services/node-layout/selectors/node-bounds\";\nimport {\n  wireJointPositionsByJointIdSelector,\n  jointIdsFromCircuitIdSelector,\n} from \"@/services/node-layout/selectors/wires\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action, appState) => {\n  if (!isSelectRegionAction(action)) {\n    return state;\n  }\n\n  const { region, circuitId, mode } = action.payload;\n\n  const nodeIds = nodeIdsFromCircuitIdSelector(appState, circuitId);\n  const rects = pick(nodeRectsByIdSelector(appState), nodeIds);\n\n  const chosenNodeIds: string[] = [];\n  forOwn(rects, (rect, id) => {\n    if (intersects(rect, region)) {\n      chosenNodeIds.push(id);\n    }\n  });\n\n  const jointPositions = wireJointPositionsByJointIdSelector(appState);\n  const jointIds = jointIdsFromCircuitIdSelector(appState, circuitId);\n  const chosenJointIds = jointIds.filter((jointId) => {\n    const position = jointPositions[jointId];\n    return pointIntersects(position, region);\n  });\n\n  return {\n    ...state,\n    selectedNodeIds: combineSelection(\n      state.selectedNodeIds,\n      chosenNodeIds,\n      mode\n    ),\n    selectedConnectionIds: mode === \"set\" ? [] : state.selectedConnectionIds,\n    selectedJointIds: combineSelection(\n      state.selectedJointIds,\n      chosenJointIds,\n      mode\n    ),\n  };\n});\n","import { AnyAction } from \"redux\";\n\nimport { SelectionMode } from \"@/selection-mode\";\n\nexport const ACTION_SELECT_WIRES = \"@select/wires\" as const;\nexport const selectWires = (\n  connectionId: string | string[],\n  mode: SelectionMode = \"set\"\n) => ({\n  type: ACTION_SELECT_WIRES,\n  payload: {\n    connectionIds: Array.isArray(connectionId) ? connectionId : [connectionId],\n    mode,\n  },\n});\nexport type SelectWiresAction = ReturnType<typeof selectWires>;\nexport function isSelectWiresAction(\n  action: AnyAction\n): action is SelectWiresAction {\n  return action.type === ACTION_SELECT_WIRES;\n}\n","import { combineSelection } from \"@/selection-mode\";\n\nimport { isSelectWiresAction } from \"@/actions/select-wires\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isSelectWiresAction(action)) {\n    return state;\n  }\n\n  const { connectionIds, mode } = action.payload;\n\n  return {\n    ...state,\n    selectedNodeIds: mode === \"set\" ? [] : state.selectedNodeIds,\n    selectedConnectionIds: combineSelection(\n      state.selectedConnectionIds,\n      connectionIds,\n      mode\n    ),\n    selectedJointIds: mode === \"set\" ? [] : state.selectedJointIds,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SELECTION_COPY = \"@selection/copy\" as const;\nexport const copySelection = () => ({\n  type: ACTION_SELECTION_COPY,\n});\nexport type CopySelectionAction = ReturnType<typeof copySelection>;\nexport function isCopySelectionAction(\n  action: AnyAction\n): action is CopySelectionAction {\n  return action.type === ACTION_SELECTION_COPY;\n}\n","import { concatReducers } from \"@/store/utils\";\n\nimport nodeDeleteReducer from \"./node-delete\";\nimport projectNewReducer from \"./project-new\";\nimport selectAllReducer from \"./select-all\";\nimport selectClearReducer from \"./select-clear\";\nimport selectJointsReducer from \"./select-joints\";\nimport selectNodesReducer from \"./select-nodes\";\nimport selectRegionReducer from \"./select-region\";\nimport selectWiresReducer from \"./select-wires\";\nimport selectionAlignToGrid from \"./selection-align-to-grid\";\nimport selectionCopyReducer from \"./selection-copy\";\nimport selectionDeleteReducer from \"./selection-delete\";\nimport selectionMoveReducer from \"./selection-move\";\nimport wireDetatchReducer from \"./wire-detatch\";\n\nconst selectionReducer = concatReducers(\n  projectNewReducer,\n  nodeDeleteReducer,\n  selectAllReducer,\n  selectClearReducer,\n  selectJointsReducer,\n  selectNodesReducer,\n  selectRegionReducer,\n  selectWiresReducer,\n  selectionAlignToGrid,\n  selectionCopyReducer,\n  selectionDeleteReducer,\n  selectionMoveReducer,\n  wireDetatchReducer\n);\n\nexport default selectionReducer;\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\nimport { pointEquals } from \"@/geometry\";\n\nimport { isSelectionAlignToGridAction } from \"@/actions/selection-align-to-grid\";\nimport { moveNode } from \"@/actions/node-move\";\nimport { moveWireJoint } from \"@/actions/wire-joint-move\";\n\nimport { nodePositionsByNodeIdSelector } from \"@/services/node-layout/selectors/node-positions\";\nimport {\n  applyGridJointSnapSelector,\n  applyGridNodeSnapSelector,\n} from \"@/services/circuit-editor-drag/selectors/snap\";\nimport { wireJointPositionsByJointIdSelector } from \"@/services/node-layout/selectors/wires\";\n\nexport default function selectionAlignToGridReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isSelectionAlignToGridAction(action)) {\n    return state;\n  }\n\n  const { selectedNodeIds, selectedJointIds } = state.services.selection;\n\n  // Align nodes.\n  const nodePositions = nodePositionsByNodeIdSelector(state);\n  for (const nodeId of selectedNodeIds) {\n    const nodePos = nodePositions[nodeId];\n    if (!nodePos) {\n      continue;\n    }\n\n    const snappedPos = applyGridNodeSnapSelector(state, nodePos);\n    if (!pointEquals(nodePos, snappedPos)) {\n      state = rootReducer(state, moveNode(nodeId, snappedPos));\n    }\n  }\n\n  // Align joints.\n  const jointPositions = wireJointPositionsByJointIdSelector(state);\n  for (const jointId of selectedJointIds) {\n    const jointPos = jointPositions[jointId];\n    if (!jointPos) {\n      continue;\n    }\n\n    const snappedPos = applyGridJointSnapSelector(state, jointPos);\n    if (!pointEquals(jointPos, snappedPos)) {\n      state = rootReducer(state, moveWireJoint(jointId, snappedPos));\n    }\n  }\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isCopySelectionAction } from \"@/actions/selection-copy\";\nimport { copyNodes } from \"@/actions/clipboard-copy\";\n\nimport { selectedNodeIdsSelector } from \"@/services/selection/selectors/selection\";\n\nexport default function selectionCopyReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isCopySelectionAction(action)) {\n    return state;\n  }\n\n  const selectedNodes = selectedNodeIdsSelector(state);\n  if (selectedNodes.length === 0) {\n    return state;\n  }\n\n  return rootReducer(state, copyNodes(selectedNodes));\n}\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isDeleteSelectionAction } from \"@/actions/selection-delete\";\nimport { deleteNode } from \"@/actions/node-delete\";\nimport { detatchWire } from \"@/actions/wire-detatch\";\nimport { deleteWireJoint } from \"@/actions/wire-joint-delete\";\n\nexport default function selectionDeleteReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isDeleteSelectionAction(action)) {\n    return state;\n  }\n\n  const {\n    selectedNodeIds,\n    selectedConnectionIds,\n    selectedJointIds,\n  } = state.services.selection;\n\n  if (selectedNodeIds.length > 0) {\n    state = rootReducer(state, deleteNode(selectedNodeIds));\n  }\n  state = selectedConnectionIds.reduce(\n    (state, connectionId) => rootReducer(state, detatchWire(connectionId)),\n    state\n  );\n  state = selectedJointIds.reduce(\n    (state, jointId) => rootReducer(state, deleteWireJoint(jointId)),\n    state\n  );\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isMoveSelectionAction } from \"@/actions/selection-move\";\nimport { moveNode, MoveNodeOpts } from \"@/actions/node-move\";\nimport { moveWireJoint, MoveWireJointOpts } from \"@/actions/wire-joint-move\";\n\nimport {\n  selectedNodeIdsSelector,\n  selectedJointIdsSelector,\n} from \"@/services/selection/selectors/selection\";\n\nexport default function selectionMoveReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n) {\n  if (!isMoveSelectionAction(action)) {\n    return state;\n  }\n\n  const { offsetX, offsetY, snapMode } = action.payload;\n\n  const nodeIds = selectedNodeIdsSelector(state);\n  const jointIds = selectedJointIdsSelector(state);\n\n  const offset: Point = {\n    x: offsetX,\n    y: offsetY,\n  };\n\n  let nodeSnapMode: MoveNodeOpts[\"snapMode\"] = \"none\";\n  if (snapMode === \"node\" || snapMode === \"by-type\") {\n    nodeSnapMode = \"node\";\n  }\n\n  let jointSnapMode: MoveWireJointOpts[\"snapMode\"] = \"none\";\n  if (snapMode === \"by-type\") {\n    jointSnapMode = \"joint\";\n  } else {\n    jointSnapMode = snapMode;\n  }\n\n  state = rootReducer(\n    state,\n    moveNode(nodeIds, offset, { relative: true, snapMode: nodeSnapMode })\n  );\n  state = rootReducer(\n    state,\n    moveWireJoint(jointIds, offset, { relative: true, snapMode: jointSnapMode })\n  );\n\n  return state;\n}\n","import { isDetatchWireAction } from \"@/actions/wire-detatch\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isDetatchWireAction(action)) {\n    return state;\n  }\n\n  const { connectionId } = action.payload;\n\n  return {\n    ...state,\n    selectedConnectionIds: state.selectedConnectionIds.filter(\n      (x) => x !== connectionId\n    ),\n  };\n});\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createSimulatorReducer = createServiceReducerCreator(\"simulator\");\nexport const createSimulatorSelector = createServiceSelectorCreator(\n  \"simulator\"\n);\n","import { isProjectMutationAction } from \"@/project-mutation-actions\";\n\nimport { defaultSimulatorServiceState } from \"../state\";\nimport { createSimulatorReducer } from \"../utils\";\n\nexport default createSimulatorReducer((state, action) => {\n  if (!isProjectMutationAction(action)) {\n    return state;\n  }\n\n  return defaultSimulatorServiceState;\n});\n","import { ElementDefinition } from \"../types\";\n\nfunction asElementDef(module: any): ElementDefinition {\n  return module.default as ElementDefinition;\n}\n\nexport const ElementDefinitionsByType = {\n  \"input-momentary\": asElementDef(require(\"./input-momentary\")),\n  \"input-toggle\": asElementDef(require(\"./input-toggle\")),\n\n  \"logic-and\": asElementDef(require(\"./logic-and\")),\n  \"logic-buffer\": asElementDef(require(\"./logic-buffer\")),\n  \"logic-nand\": asElementDef(require(\"./logic-nand\")),\n  \"logic-nor\": asElementDef(require(\"./logic-nor\")),\n  \"logic-not\": asElementDef(require(\"./logic-not\")),\n  \"logic-or\": asElementDef(require(\"./logic-or\")),\n  \"logic-xor\": asElementDef(require(\"./logic-xor\")),\n\n  \"output-led\": asElementDef(require(\"./output-led\")),\n  \"output-seg7\": asElementDef(require(\"./output-seg7\")),\n\n  \"pin-high\": asElementDef(require(\"./pin-high\")),\n};\nexport type ElementType = keyof typeof ElementDefinitionsByType;\n","import flatMap from \"lodash/flatMap\";\nimport get from \"lodash/get\";\n\nimport {\n  SimulatorNodeIdMappingTreeItem,\n  SimulatorNodeIdToCircuitNodeIdMap,\n} from \"./types\";\n\nexport function walkSimulatorNodeIdToCircuitNodeIdMap(\n  map: SimulatorNodeIdToCircuitNodeIdMap,\n  visit: (circuitNodeIdPath: string[], simulatorNodeId: string) => void,\n  circuitNodeIdPath: string[] = []\n) {\n  const circuitNodeIds = Object.keys(map);\n  for (const circuitNodeId of circuitNodeIds) {\n    const { simulatorNodeId, subCircuitIds } = map[circuitNodeId];\n    const currentPath = [...circuitNodeIdPath, circuitNodeId];\n    if (simulatorNodeId) {\n      visit(currentPath, simulatorNodeId);\n    }\n    walkSimulatorNodeIdToCircuitNodeIdMap(subCircuitIds, visit, currentPath);\n  }\n}\n\nexport function getSimulatorNodeIdFromCircuitNodeIdPath(\n  map: SimulatorNodeIdToCircuitNodeIdMap,\n  circuitNodeIdPath: string[]\n): string | null {\n  // Look up the path through the ic nodes to reach this node.\n  const simulatorNodeIdPath = flatMap(circuitNodeIdPath, (icNodeId) => [\n    icNodeId,\n    \"subCircuitIds\",\n  ]);\n\n  // Remove the last subCircuitIds\n  simulatorNodeIdPath.pop();\n\n  const simulatorNodeIdItem: SimulatorNodeIdMappingTreeItem = get(\n    map,\n    simulatorNodeIdPath\n  );\n\n  if (!simulatorNodeIdItem) {\n    return null;\n  }\n\n  const { simulatorNodeId } = simulatorNodeIdItem;\n  return simulatorNodeId ?? null;\n}\n","import get from \"lodash/get\";\nimport merge from \"lodash/merge\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nimport {\n  CircuitNodeElementProduction,\n  ElementNodeElementProduction,\n  normalizeElementProduction,\n} from \"../../nodes/types/element-production\";\n\nimport {\n  SimulatorGraph,\n  SimulatorGraphDependencies,\n  SimulatorNode,\n  SimulatorNodeIdMappingTreeItem,\n  SimulatorNodePin,\n} from \"./types\";\n\ntype CircuitProductionResult = SimulatorGraph & {\n  inputElementPinsByCircuitPinId: Record<string, SimulatorNodePin[]>;\n  outputElementPinsByCircuitPinId: Record<string, SimulatorNodePin>;\n};\n\nconst EMPTY_PRODUCTION = Object.freeze<CircuitProductionResult>({\n  simulatorNodesById: {},\n  simulatorNodeIdsByCircuitNodeId: {},\n  inputElementPinsByCircuitPinId: {},\n  outputElementPinsByCircuitPinId: {},\n});\n\nexport function produceCircuitGraph(\n  circuitId: string,\n  dependencies: SimulatorGraphDependencies,\n  path: string[] = []\n): CircuitProductionResult {\n  if (path.indexOf(circuitId) !== -1) {\n    throw new Error(\n      `Circuit graph encountered loop on ${path.join(\n        \" => \"\n      )} while trying to add circuit ${circuitId}`\n    );\n  }\n\n  path = [...path, circuitId];\n\n  const simulatorNodesById: Record<string, SimulatorNode> = {};\n  const simulatorNodeIdsByCircuitNodeId: Record<\n    string,\n    SimulatorNodeIdMappingTreeItem\n  > = {};\n  const inputElementPinsByCircuitPinId: Record<string, SimulatorNodePin[]> = {};\n  const outputElementPinsByCircuitPinId: Record<string, SimulatorNodePin> = {};\n\n  const inputCircuitNodeIds: string[] = [];\n  const outputCircuitNodeIds: string[] = [];\n\n  // 1. Create new elements\n  // 2. Wire elements amongs themselves.\n  // 3. Pass input and output mapping to parent.\n\n  const circuitNodeInputPinsByPinIdByNodeId: Record<\n    string,\n    Record<string, SimulatorNodePin[]>\n  > = {};\n  const circuitNodeOutputPinsByPinIdByNodeId: Record<\n    string,\n    Record<string, SimulatorNodePin>\n  > = {};\n\n  const circuitNodeIds = dependencies.nodeIdsByCircuitId[circuitId] ?? [];\n  for (const circuitNodeId of circuitNodeIds) {\n    const nodeType = dependencies.nodeTypesByNodeId[circuitNodeId];\n    if (!nodeType) {\n      continue;\n    }\n\n    // If this node is a pin, remember it to calculate circuit inputs and outputs.\n    if (nodeType === \"pin-input\") {\n      inputCircuitNodeIds.push(circuitNodeId);\n      inputElementPinsByCircuitPinId[circuitNodeId] = [];\n      continue;\n    } else if (nodeType === \"pin-output\") {\n      outputCircuitNodeIds.push(circuitNodeId);\n      continue;\n    }\n\n    const productionResult = produceNode(circuitNodeId, dependencies, path);\n\n    // Merge the produced simulator nodes.\n    merge(simulatorNodesById, productionResult.simulatorNodesById);\n\n    // Merge the mapping from circuit node to simulator node.\n    merge(\n      simulatorNodeIdsByCircuitNodeId,\n      productionResult.simulatorNodeIdsByCircuitNodeId\n    );\n\n    // Remember what these circuit node pins translate to.\n    circuitNodeInputPinsByPinIdByNodeId[circuitNodeId] =\n      productionResult.inputElementPinsByCircuitPinId;\n    circuitNodeOutputPinsByPinIdByNodeId[circuitNodeId] =\n      productionResult.outputElementPinsByCircuitPinId;\n  }\n\n  const circuitConnectionsById = dependencies.connectionsById;\n  for (const connectionId of Object.keys(circuitConnectionsById)) {\n    const { inputPin, outputPin } = circuitConnectionsById[connectionId];\n    // We are only interested in connections within this circuit.\n    // There should not be any cross-circuit connections.\n    // It might be ok to skip this step, and rely on not finding the node mapping.\n\n    if (\n      circuitNodeIds.indexOf(inputPin.nodeId) === -1 ||\n      circuitNodeIds.indexOf(outputPin.nodeId) === -1\n    ) {\n      continue;\n    }\n\n    // We need to find the one output, and connect it to all inputs that match.\n    // There might be more than one input if the input was on an IC / circuit production.\n    const outputSimPin = get(circuitNodeOutputPinsByPinIdByNodeId, [\n      outputPin.nodeId,\n      outputPin.pinId,\n    ]);\n    const inputSimPins = get(circuitNodeInputPinsByPinIdByNodeId, [\n      inputPin.nodeId,\n      inputPin.pinId,\n    ]);\n\n    // If the output is one of our input nodes, then the inputs\n    //  need to be saved for our circuit inputs\n    if (inputCircuitNodeIds.indexOf(outputPin.nodeId) !== -1 && inputSimPins) {\n      // pin id is the pin-input nodeId\n      inputElementPinsByCircuitPinId[outputPin.nodeId].push(...inputSimPins);\n      continue;\n    } else if (\n      outputCircuitNodeIds.indexOf(inputPin.nodeId) !== -1 &&\n      outputSimPin\n    ) {\n      outputElementPinsByCircuitPinId[inputPin.nodeId] = outputSimPin;\n      continue;\n    }\n\n    if (!outputSimPin || !inputSimPins) {\n      continue;\n    }\n\n    const outputSimNode = simulatorNodesById[outputSimPin.simulatorNodeId];\n    let outputsByOutputPin = outputSimNode.outputsByPin[outputSimPin.pinId];\n    if (outputsByOutputPin == null) {\n      outputSimNode.outputsByPin[outputSimPin.pinId] = outputsByOutputPin = [];\n    }\n\n    // Wire up the output to all of the inputs\n    for (const inputSimPin of inputSimPins) {\n      outputsByOutputPin.push({\n        simulatorNodeId: inputSimPin.simulatorNodeId,\n        pinId: inputSimPin.pinId,\n      });\n\n      const inputNode = simulatorNodesById[inputSimPin.simulatorNodeId];\n      inputNode.inputsByPin[inputSimPin.pinId] = {\n        simulatorNodeId: outputSimPin.simulatorNodeId,\n        pinId: outputSimPin.pinId,\n      };\n    }\n  }\n\n  return {\n    simulatorNodesById,\n    simulatorNodeIdsByCircuitNodeId,\n    inputElementPinsByCircuitPinId,\n    outputElementPinsByCircuitPinId,\n  };\n}\n\nfunction produceNode(\n  circuitNodeId: string,\n  dependencies: SimulatorGraphDependencies,\n  path: string[]\n): CircuitProductionResult {\n  const nodeType = dependencies.nodeTypesByNodeId[circuitNodeId];\n  if (!nodeType) {\n    return EMPTY_PRODUCTION;\n  }\n\n  const nodeDef = dependencies.nodeDefsByType[nodeType];\n  if (!nodeDef || !nodeDef.elementProduction) {\n    return EMPTY_PRODUCTION;\n  }\n\n  const production = normalizeElementProduction(nodeDef.elementProduction);\n  switch (production.type) {\n    case \"element\":\n      return produceElementNode(circuitNodeId, production, dependencies);\n    case \"circuit\":\n      return produceCircuitNode(circuitNodeId, production, dependencies, path);\n    default:\n      throw new Error(\n        \"Unsupported production type \" + (production as any).type\n      );\n  }\n}\n\nfunction produceElementNode(\n  circuitNodeId: string,\n  production: ElementNodeElementProduction,\n  { nodeTypesByNodeId, nodeDefsByType }: SimulatorGraphDependencies\n): CircuitProductionResult {\n  const nodeType = nodeTypesByNodeId[circuitNodeId];\n  const nodeDef = nodeDefsByType[nodeType];\n  if (!nodeDef) {\n    return EMPTY_PRODUCTION;\n  }\n\n  const simulatorNodesById: Record<string, SimulatorNode> = {};\n  const simulatorNodeIdsByCircuitNodeId: Record<\n    string,\n    SimulatorNodeIdMappingTreeItem\n  > = {};\n\n  const simulatorNodeId = uuidV4();\n  simulatorNodesById[simulatorNodeId] = {\n    elementType: production.elementType,\n    // We do not have any internal pins.\n    // These will be wired by produceCircuit as\n    // it completes is cross-circuit connections.\n    inputsByPin: {},\n    outputsByPin: {},\n  };\n\n  simulatorNodeIdsByCircuitNodeId[circuitNodeId] = {\n    simulatorNodeId,\n    subCircuitIds: {},\n  };\n\n  const inputElementPinsByCircuitPinId: Record<string, SimulatorNodePin[]> = {};\n  const outputElementPinsByCircuitPinId: Record<string, SimulatorNodePin> = {};\n\n  // We have a one to one pin mapping between node and element\n  for (const pinId of Object.keys(nodeDef.pins)) {\n    const { direction } = nodeDef.pins[pinId];\n    if (direction === \"input\") {\n      inputElementPinsByCircuitPinId[pinId] = [\n        {\n          pinId,\n          simulatorNodeId,\n        },\n      ];\n    } else if (direction === \"output\") {\n      outputElementPinsByCircuitPinId[pinId] = {\n        pinId,\n        simulatorNodeId,\n      };\n    }\n  }\n\n  return {\n    simulatorNodesById,\n    simulatorNodeIdsByCircuitNodeId,\n    inputElementPinsByCircuitPinId,\n    outputElementPinsByCircuitPinId,\n  };\n}\n\nfunction produceCircuitNode(\n  circuitNodeId: string,\n  production: CircuitNodeElementProduction,\n  dependencies: SimulatorGraphDependencies,\n  path: string[]\n): CircuitProductionResult {\n  const circuitProuction = produceCircuitGraph(\n    production.circuitId,\n    dependencies,\n    path\n  );\n\n  return {\n    ...circuitProuction,\n    simulatorNodeIdsByCircuitNodeId: {\n      [circuitNodeId]: {\n        simulatorNodeId: null,\n        subCircuitIds: circuitProuction.simulatorNodeIdsByCircuitNodeId,\n      },\n    },\n  };\n}\n","import { ElementType } from \"@/elements\";\n\nexport interface NodeElementProductionBase {\n  type: string;\n}\n\nexport interface ElementNodeElementProduction {\n  type: \"element\";\n  elementType: ElementType;\n}\n\nexport interface CircuitNodeElementProduction {\n  type: \"circuit\";\n  circuitId: string;\n}\n\nexport type NodeElementProductionObject =\n  | ElementNodeElementProduction\n  | CircuitNodeElementProduction;\n\nexport type NodeElementProduction = ElementType | NodeElementProductionObject;\n\nexport function normalizeElementProduction(\n  elementProduction: NodeElementProduction\n): NodeElementProductionObject {\n  if (typeof elementProduction === \"string\") {\n    return {\n      type: \"element\",\n      elementType: elementProduction,\n    };\n  }\n\n  return elementProduction;\n}\n","import { ElementType } from \"@/elements\";\nimport { Connection } from \"../node-graph/types\";\nimport { NodeDefinition } from \"../../nodes/types\";\n\nexport interface SimulatorNodePin {\n  simulatorNodeId: string;\n  pinId: string;\n}\n\nexport interface SimulatorNode {\n  /**\n   * The element type of this node.\n   */\n  elementType: ElementType;\n\n  /**\n   * Input source pins by input pin id.\n   *\n   * This is redundant with the opposing node's outputsByPin,\n   * to increase lookup speed.\n   */\n  inputsByPin: Record<string, SimulatorNodePin>;\n\n  /**\n   * Output source pins by output pin id.\n   *\n   * This is redundant with the opposing node's inputsByPin,\n   * to increase lookup speed.\n   */\n  outputsByPin: Record<string, SimulatorNodePin[]>;\n}\n\nexport interface SimulatorNodeIdMappingTreeItem {\n  simulatorNodeId: string | null;\n  subCircuitIds: SimulatorNodeIdToCircuitNodeIdMap;\n}\n\nexport type SimulatorNodeIdToCircuitNodeIdMap = Record<\n  string,\n  SimulatorNodeIdMappingTreeItem\n>;\n\nexport interface SimulatorGraphDependencies {\n  nodeIdsByCircuitId: Record<string, string[]>;\n  nodeTypesByNodeId: Record<string, string>;\n  connectionsById: Record<string, Connection>;\n  nodeDefsByType: Record<string, NodeDefinition>;\n}\n\nexport interface SimulatorGraph {\n  /**\n   * A map of all simulator nodes by simulator node id.\n   */\n  simulatorNodesById: Record<string, SimulatorNode>;\n\n  /**\n   * A map of simulator node ids by the circuit node id that generated them.\n   */\n  simulatorNodeIdsByCircuitNodeId: SimulatorNodeIdToCircuitNodeIdMap;\n}\n\nexport const EmptySimulatorGraph: SimulatorGraph = Object.freeze({\n  simulatorNodesById: {},\n  simulatorNodeIdsByCircuitNodeId: {},\n});\n","import { createSelector } from \"reselect\";\n\nimport { nodeIdsByCircuitIdSelector } from \"@/services/circuits/selectors/nodes\";\nimport { nodeTypesByNodeIdSelector } from \"@/services/node-graph/selectors/nodes\";\nimport { connectionsByIdSelector } from \"@/services/node-graph/selectors/connections\";\nimport { nodeDefinitionsByTypeSelector } from \"@/services/node-types/selectors/node-types\";\nimport { ROOT_CIRCUIT_ID } from \"@/services/circuits/constants\";\n\nimport { produceCircuitGraph } from \"../graph-production\";\nimport { EmptySimulatorGraph } from \"../types\";\n\nexport const rootNodeGraphSelector = createSelector(\n  nodeIdsByCircuitIdSelector,\n  nodeTypesByNodeIdSelector,\n  connectionsByIdSelector,\n  nodeDefinitionsByTypeSelector,\n  (nodeIdsByCircuitId, nodeTypesByNodeId, connectionsById, nodeDefsByType) => {\n    // FIXME: Display this error to the user.\n    try {\n      return produceCircuitGraph(ROOT_CIRCUIT_ID, {\n        nodeIdsByCircuitId,\n        nodeTypesByNodeId,\n        connectionsById,\n        nodeDefsByType,\n      });\n    } catch (e) {\n      console.error(e);\n      return EmptySimulatorGraph;\n    }\n  }\n);\n","import { AppState } from \"@/store\";\nimport { ElementDefinitionsByType } from \"@/elements\";\n\nimport { getSimulatorNodeIdFromCircuitNodeIdPath } from \"../utils\";\n\nimport { rootNodeGraphSelector } from \"./graph\";\n\nexport const simulatorNodeIdsByCircuitNodeIdSelector = (state: AppState) =>\n  rootNodeGraphSelector(state).simulatorNodeIdsByCircuitNodeId;\n\n/**\n * Gets the simulator node id for a given circuit node id.\n */\nexport const simulatorNodeIdFromCircuitNodeIdSelector = (\n  state: AppState,\n  circuitNodeIdPath: string[]\n) => {\n  const { simulatorNodeIdsByCircuitNodeId } = rootNodeGraphSelector(state);\n  return getSimulatorNodeIdFromCircuitNodeIdPath(\n    simulatorNodeIdsByCircuitNodeId,\n    circuitNodeIdPath\n  );\n};\n\n/**\n * Get all simulator node ids.\n *\n * WARN: Not react safe.\n */\nexport const simulatorNodeIdsSelector = (state: AppState) => {\n  const { simulatorNodesById } = rootNodeGraphSelector(state);\n  return Object.keys(simulatorNodesById);\n};\n\nexport const elementTypeFromSimulatorNodeId = (\n  state: AppState,\n  simulatorNodeId: string\n) => {\n  const { simulatorNodesById } = rootNodeGraphSelector(state);\n  const simulatorNode = simulatorNodesById[simulatorNodeId];\n  if (!simulatorNode) {\n    return null;\n  }\n\n  return simulatorNode.elementType;\n};\n\nexport const elementDefFromSimulatorNodeId = (\n  state: AppState,\n  nodeId: string\n) => {\n  const type = elementTypeFromSimulatorNodeId(state, nodeId);\n  if (!type) {\n    return null;\n  }\n\n  return ElementDefinitionsByType[type] ?? null;\n};\n","import values from \"lodash/values\";\nimport flatMap from \"lodash/flatMap\";\n\nimport { AppState } from \"@/store\";\n\nimport { rootNodeGraphSelector } from \"./graph\";\nimport { SimulatorNodePin } from \"../types\";\n\nconst EmptyPinArray = Object.freeze([] as string[]);\nconst EmptyPinInputs = Object.freeze({} as Record<string, SimulatorNodePin>);\n\n/**\n * Gets an array of simulator node ids connected to the outputs of the given node id.\n * WARN: Not react safe.  For reducer use only.\n */\nexport const outputSimulatorNodeIdsFromSimulatorNodeIdSelector = (\n  state: AppState,\n  simulatorNodeId: string\n) => {\n  const { simulatorNodesById } = rootNodeGraphSelector(state);\n\n  const simulatorNode = simulatorNodesById[simulatorNodeId];\n  if (!simulatorNode) {\n    return EmptyPinArray;\n  }\n\n  return flatMap(values(simulatorNode.outputsByPin), (pins) =>\n    pins.map((x) => x.simulatorNodeId)\n  );\n};\n\n/**\n * Gets a map of node input pins to their output sources given a node id.\n */\nexport const inputPinsByPinIdFromSimulatorNodeIdSelector = (\n  state: AppState,\n  simulatorNodeId: string\n) => {\n  const { simulatorNodesById } = rootNodeGraphSelector(state);\n  const simulatorNode = simulatorNodesById[simulatorNodeId];\n  if (!simulatorNode) {\n    return EmptyPinInputs;\n  }\n\n  return simulatorNode.inputsByPin;\n};\n","import binarySearch from \"binary-search\";\nimport { v4 as uuidV4 } from \"uuid\";\nimport pick from \"lodash/pick\";\nimport difference from \"lodash/difference\";\n\nimport { fpSet } from \"@/utils\";\nimport { asArray, dropIndexFp } from \"@/arrays\";\nimport { AppState } from \"@/store\";\nimport { EvolutionResult, OutputTransition } from \"@/logic\";\n\nimport {\n  inputPinsByPinIdFromSimulatorNodeIdSelector,\n  outputSimulatorNodeIdsFromSimulatorNodeIdSelector,\n} from \"@/services/simulator-graph/selectors/connections\";\nimport {\n  simulatorNodeIdsSelector,\n  elementDefFromSimulatorNodeId,\n} from \"@/services/simulator-graph/selectors/nodes\";\n\nimport { SimulatorServiceState, defaultSimulatorServiceState } from \"../state\";\nimport { SimTransitionWindow, SimNodePinTransition } from \"../types\";\n\nexport function simInit(\n  state: Readonly<SimulatorServiceState>,\n  appState: Readonly<AppState>\n): SimulatorServiceState {\n  const nodeIds = simulatorNodeIdsSelector(appState);\n\n  state = defaultSimulatorServiceState;\n\n  state = nodeIds.reduce(\n    (state, nodeId) => initNode(state, nodeId, appState),\n    state\n  );\n\n  state = nodeIds.reduce(\n    (state, nodeId) => collectNodeTransitions(state, nodeId, appState),\n    state\n  );\n\n  return Object.assign({}, state, { initialized: true });\n}\n\nfunction initNode(\n  state: Readonly<SimulatorServiceState>,\n  nodeId: string,\n  appState: Readonly<AppState>\n): SimulatorServiceState {\n  const def = elementDefFromSimulatorNodeId(appState, nodeId);\n  if (!def) {\n    return state;\n  }\n\n  const outputValues: Record<string, boolean> = {};\n  def.outputPins.forEach((output) => {\n    outputValues[output] = false;\n  });\n\n  return fpSet(state, \"nodeOutputValuesByNodeId\", nodeId, outputValues);\n}\n\nexport function simTick(\n  state: Readonly<SimulatorServiceState>,\n  tickCount: number,\n  appState: Readonly<AppState>\n): SimulatorServiceState {\n  const endTick = state.tick + tickCount;\n\n  // We cannot grab the windows ahead of time, as some windows might generate more windows\n  //  for future ticks.\n\n  // Pre-clone windows as we wil be repeatedly modifying it.\n  state = Object.assign({}, state, {\n    transitionWindows: state.transitionWindows.slice(),\n  });\n\n  let saftyCount = tickCount + 1;\n  while (\n    state.transitionWindows.length > 0 &&\n    state.transitionWindows[0].tick <= endTick\n  ) {\n    if (--saftyCount === 0) {\n      // If we have seen more windows than ticks, something is creating windows for past ticks.\n      throw new Error(\n        `Maximum ticks per sim evolution exceeded.  This is an indication that windows are being generated for past ticks.`\n      );\n    }\n\n    // We can safely mutate here, as even if the array is regenerated\n    //  from a tick it will still be a fresh copy that has not yet been\n    //  consumed by redux.\n    const window = state.transitionWindows.shift()!;\n    state = tickWindow(state, window, appState);\n  }\n\n  // If we did not encounter a window on our last tick, jump ahead to that tick.\n  if (state.tick != endTick) {\n    state = Object.assign({}, state, {\n      tick: endTick,\n    });\n  }\n\n  return state;\n}\n\nfunction tickWindow(\n  readonlyState: Readonly<SimulatorServiceState>,\n  window: SimTransitionWindow,\n  appState: Readonly<AppState>\n): SimulatorServiceState {\n  if (window.transitionIds.length === 0) {\n    return readonlyState;\n  }\n\n  // Update the current tick, as it is referenced\n  //  during transition collection.\n  let state = Object.assign({}, readonlyState, {\n    tick: window.tick,\n    // pre-clone outputs for mutation below\n    nodeOutputValuesByNodeId: Object.assign(\n      {},\n      readonlyState.nodeOutputValuesByNodeId\n    ),\n  }) as SimulatorServiceState;\n\n  // Could benefit from being changed to a Set, although nodes usually arent hooked up to too many\n  //  outputs at a time.\n  const updatedNodes = new Set<string>();\n  window.transitionIds.forEach((tid) => {\n    const { nodeId, valuesByOutputPin } = state.transitionsById[tid];\n\n    if (\n      !isOutputsUpdated(\n        state.nodeOutputValuesByNodeId[nodeId],\n        valuesByOutputPin\n      )\n    ) {\n      // Values are unchanged from current, node will not update.\n      return;\n    }\n\n    // nodeOutputValuesByNodeId is pre-cloned\n    state.nodeOutputValuesByNodeId[nodeId] = Object.assign(\n      {},\n      state.nodeOutputValuesByNodeId[nodeId],\n      valuesByOutputPin\n    );\n\n    // Add each node we output to, to the output list.\n    const outputNodeIds = outputSimulatorNodeIdsFromSimulatorNodeIdSelector(\n      appState,\n      nodeId\n    );\n    outputNodeIds.forEach((nodeId) => updatedNodes.add(nodeId));\n  });\n\n  // Remove all window transitions as they have been consumed.\n  // State is cloned above\n  state.transitionsById = pick(\n    state.transitionsById,\n    difference(Object.keys(state.transitionsById), window.transitionIds)\n  );\n\n  for (const nodeId of updatedNodes) {\n    state = collectNodeTransitions(state, nodeId, appState);\n  }\n\n  return state;\n}\n\nfunction isOutputsUpdated(\n  outputs: Record<string, boolean>,\n  updates: Record<string, boolean>\n) {\n  return Object.keys(updates).some((key) => outputs[key] !== updates[key]);\n}\n\nexport function collectNodeTransitions(\n  state: Readonly<SimulatorServiceState>,\n  nodeId: string,\n  appState: Readonly<AppState>\n): SimulatorServiceState {\n  const def = elementDefFromSimulatorNodeId(appState, nodeId);\n  if (!def || !def.evolve) {\n    return state;\n  }\n\n  // Build the current input state from the connected pins.\n  const inputs = collectNodeInputs(state, nodeId, appState);\n  const result = def.evolve(\n    state.nodeStatesByNodeId[nodeId],\n    inputs,\n    state.tick\n  );\n\n  return applyEvolutionResult(state, nodeId, result);\n}\n\nexport function applyEvolutionResult(\n  state: Readonly<SimulatorServiceState>,\n  nodeId: string,\n  evolutionResult: EvolutionResult\n) {\n  const { state: nodeState, transitions } = evolutionResult;\n\n  if (nodeState) {\n    state = fpSet(state, \"nodeStatesByNodeId\", nodeId, nodeState);\n  }\n\n  if (transitions) {\n    const transitionsArray = asArray(transitions);\n    state = transitionsArray.reduce(\n      (state, transition, i) =>\n        applyOutputTransition(\n          state,\n          nodeId,\n          transition,\n          i === 0 ? \"replace\" : \"append\"\n        ),\n      state\n    );\n  }\n\n  return state;\n}\n\nfunction collectNodeInputs(\n  state: Readonly<SimulatorServiceState>,\n  nodeId: string,\n  appState: Readonly<AppState>\n): Record<string, boolean> {\n  // Build the current input state from the connected pins.\n  const inputs: Record<string, boolean> = {};\n  const inputSourcesByPin = inputPinsByPinIdFromSimulatorNodeIdSelector(\n    appState,\n    nodeId\n  );\n\n  Object.keys(inputSourcesByPin).forEach((inputPin) => {\n    const inputConn = inputSourcesByPin[inputPin];\n    if (!inputConn) {\n      inputs[inputPin] = false;\n      return;\n    }\n\n    const { simulatorNodeId: sourceNodeId, pinId: sourcePinId } = inputConn;\n    inputs[inputPin] =\n      state.nodeOutputValuesByNodeId[sourceNodeId]?.[sourcePinId] || false;\n  });\n\n  return inputs;\n}\n\nfunction applyOutputTransition(\n  state: Readonly<SimulatorServiceState>,\n  nodeId: string,\n  transition: OutputTransition,\n  defaultMerger: \"replace\" | \"append\" = \"replace\"\n): SimulatorServiceState {\n  const {\n    tickOffset,\n    valuesByPin,\n    transitionMerger = defaultMerger,\n  } = transition;\n\n  // Sanity check that we are not producing transitions for the past or current tick.\n  const transitionTick = state.tick + (tickOffset > 0 ? tickOffset : 1);\n\n  // We originally removed old transitions when scheduling new transitions.\n  //  Experimenting without this.\n  if (transitionMerger === \"replace\") {\n    state = removeTransitionsByNodeId(state, nodeId);\n  }\n\n  return addTransition(state, nodeId, transitionTick, valuesByPin);\n}\n\nfunction addTransition(\n  state: Readonly<SimulatorServiceState>,\n  nodeId: string,\n  tick: number,\n  valuesByOutputPin: Record<string, boolean>\n): SimulatorServiceState {\n  const transitionId = uuidV4();\n\n  const newTransition: SimNodePinTransition = {\n    nodeId,\n    tick,\n    valuesByOutputPin,\n  };\n\n  // Prepare the new transition window.\n  const transitionWindows = state.transitionWindows.slice();\n\n  let index = binarySearch(transitionWindows, tick, (a, b) => a.tick - b);\n  if (index < 0) {\n    // Need to create a new window\n    index = -index - 1;\n    const newWindow: SimTransitionWindow = {\n      tick,\n      transitionIds: [],\n    };\n    transitionWindows.splice(index, 0, newWindow);\n  }\n\n  const transitionIds = transitionWindows[index].transitionIds.slice();\n  transitionIds.push(transitionId);\n\n  transitionWindows[index] = Object.assign({}, transitionWindows[index], {\n    transitionIds,\n  });\n\n  const transitionsById = Object.assign({}, state.transitionsById, {\n    [transitionId]: newTransition,\n  });\n\n  return Object.assign({}, state, {\n    // Add the new transition window to the id mapping.\n    transitionsById,\n    transitionWindows,\n  });\n}\n\nfunction removeTransitionsByNodeId(\n  state: Readonly<SimulatorServiceState>,\n  nodeId: string\n): SimulatorServiceState {\n  function isNodeTransition(transition: SimNodePinTransition) {\n    return transition.nodeId === nodeId;\n  }\n\n  const transitionIds = Object.keys(state.transitionsById).filter((id) =>\n    isNodeTransition(state.transitionsById[id])\n  );\n\n  return transitionIds.reduce(\n    (state, transitionId) => removeTransitionById(state, transitionId),\n    state\n  );\n}\n\nexport function removeTransitionById(\n  state: Readonly<SimulatorServiceState>,\n  transitionId: string\n): SimulatorServiceState {\n  const transition = state.transitionsById[transitionId];\n  if (!transition) {\n    return state;\n  }\n\n  const transitionsById = pick(\n    state.transitionsById,\n    Object.keys(state.transitionsById).filter((x) => x !== transitionId)\n  );\n  let transitionWindows = state.transitionWindows;\n\n  const transitionWindowIndex = binarySearch(\n    transitionWindows,\n    transition.tick,\n    (a, b) => a.tick - b\n  );\n  if (transitionWindowIndex >= 0) {\n    const transitionWindow = transitionWindows[transitionWindowIndex];\n    const { transitionIds } = transitionWindow;\n\n    const tickWindowTransitionIndex = transitionWindow.transitionIds.indexOf(\n      transitionId\n    );\n    if (tickWindowTransitionIndex !== -1) {\n      if (transitionWindow.transitionIds.length === 1) {\n        // Only one element left, remove the window.\n        transitionWindows = dropIndexFp(\n          transitionWindows,\n          transitionWindowIndex\n        );\n      } else {\n        // Remove the transition from the tick window.\n        transitionWindows = transitionWindows.slice();\n        transitionWindows[transitionWindowIndex] = Object.assign(\n          {},\n          transitionWindows[transitionWindowIndex],\n          {\n            transitionIds: dropIndexFp(\n              transitionIds,\n              tickWindowTransitionIndex\n            ),\n          }\n        );\n      }\n    }\n  }\n\n  return Object.assign({}, state, {\n    transitionsById,\n    transitionWindows,\n  });\n}\n","import { ElementDefinitionsByType } from \"@/elements\";\n\nimport { isInteractNodeAction } from \"@/actions/node-interact\";\nimport {\n  simulatorNodeIdFromCircuitNodeIdSelector,\n  elementTypeFromSimulatorNodeId,\n} from \"@/services/simulator-graph/selectors/nodes\";\n\nimport { createSimulatorReducer } from \"../utils\";\n\nimport { applyEvolutionResult } from \"./utils\";\n\nexport default createSimulatorReducer((state, action, appState) => {\n  if (!isInteractNodeAction(action)) {\n    return state;\n  }\n\n  const { circuitNodeIdPath, data } = action.payload;\n  const simulatorNodeId = simulatorNodeIdFromCircuitNodeIdSelector(\n    appState,\n    circuitNodeIdPath\n  );\n\n  if (!simulatorNodeId) {\n    return state;\n  }\n\n  const elementType = elementTypeFromSimulatorNodeId(appState, simulatorNodeId);\n  if (!elementType) {\n    return state;\n  }\n\n  const def = ElementDefinitionsByType[elementType];\n  if (!def || !def.interact) {\n    return state;\n  }\n\n  const nodeState = state.nodeStatesByNodeId[simulatorNodeId];\n  const evolutionResult = def.interact(nodeState, data);\n\n  return applyEvolutionResult(state, simulatorNodeId, evolutionResult);\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SIM_START = \"@sim/start\" as const;\nexport const startSim = () => ({\n  type: ACTION_SIM_START,\n});\nexport type StartSimAction = ReturnType<typeof startSim>;\nexport function isStartSimAction(action: AnyAction): action is StartSimAction {\n  return action.type === ACTION_SIM_START;\n}\n","import { isStartSimAction } from \"@/actions/sim-start\";\n\nimport { createSimulatorReducer } from \"../utils\";\n\nimport { simInit } from \"./utils\";\n\nexport default createSimulatorReducer((state, action, appState) => {\n  if (!isStartSimAction(action)) {\n    return state;\n  }\n\n  return simInit(state, appState);\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SIM_STEP = \"@sim/step\" as const;\nexport const stepSim = () => ({\n  type: ACTION_SIM_STEP,\n});\nexport type StepSimAction = ReturnType<typeof stepSim>;\nexport function isStepSimAction(action: AnyAction): action is StepSimAction {\n  return action.type === ACTION_SIM_STEP;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SIM_TICK = \"@sim/tick\" as const;\nexport const tickSim = (tickCount: number) => ({\n  type: ACTION_SIM_TICK,\n  payload: { tickCount },\n});\nexport type TickSimAction = ReturnType<typeof tickSim>;\nexport function isTickSimAction(action: AnyAction): action is TickSimAction {\n  return action.type === ACTION_SIM_TICK;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SIM_STOP = \"@sim/stop\" as const;\nexport const stopSim = () => ({\n  type: ACTION_SIM_STOP,\n});\nexport type StartSimAction = ReturnType<typeof stopSim>;\nexport function isStopSimAction(action: AnyAction): action is StartSimAction {\n  return action.type === ACTION_SIM_STOP;\n}\n","import { isStopSimAction } from \"@/actions/sim-stop\";\n\nimport { defaultSimulatorServiceState } from \"../state\";\n\nimport { createSimulatorReducer } from \"../utils\";\n\nexport default createSimulatorReducer((state, action) => {\n  if (!isStopSimAction(action)) {\n    return state;\n  }\n\n  return defaultSimulatorServiceState;\n});\n","import { concatReducers } from \"@/store/utils\";\n\nimport elementGraphInvalidatedReducer from \"./element-graph-invalidated\";\nimport nodeInteractReducer from \"./node-interact\";\nimport simStartReducer from \"./sim-start\";\nimport simStepReducer from \"./sim-step\";\nimport simStopReducer from \"./sim-stop\";\nimport simTickReducer from \"./sim-tick\";\n\nconst simulatorReducer = concatReducers(\n  elementGraphInvalidatedReducer,\n  nodeInteractReducer,\n  simStartReducer,\n  simStepReducer,\n  simStopReducer,\n  simTickReducer\n);\n\nexport default simulatorReducer;\n","import { AnyAction } from \"redux\";\n\nimport { fpSet } from \"@/utils\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isStepSimAction } from \"@/actions/sim-step\";\nimport { tickSim } from \"@/actions/sim-tick\";\n\nimport { simInit } from \"./utils\";\n\nexport default function (\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isStepSimAction(action)) {\n    return state;\n  }\n\n  const { initialized } = state.services.simulator;\n  if (!initialized) {\n    state = fpSet(state, \"services\", \"simulator\", (simState) =>\n      simInit(simState, state)\n    );\n  }\n\n  // These may have changed as a result of the init process.\n  const { tick, transitionWindows } = state.services.simulator;\n  if (transitionWindows.length === 0) {\n    return state;\n  }\n\n  const windowTick = transitionWindows[0].tick;\n\n  return rootReducer(state, tickSim(windowTick - tick));\n}\n","import { isTickSimAction } from \"@/actions/sim-tick\";\n\nimport { createSimulatorReducer } from \"../utils\";\n\nimport { simTick } from \"./utils\";\n\nexport default createSimulatorReducer((state, action, appState) => {\n  if (!isTickSimAction(action)) {\n    return state;\n  }\n\n  const { tickCount } = action.payload;\n\n  const start = performance.now();\n\n  state = simTick(state, tickCount, appState);\n\n  const end = performance.now();\n\n  const updateTime = end - start;\n  state = {\n    ...state,\n    lastTickProcessingTimeMs: updateTime,\n  };\n\n  return state;\n});\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createSimulatorControlReducer = createServiceReducerCreator(\n  \"simulatorControl\"\n);\nexport const createSimulatorControlSelector = createServiceSelectorCreator(\n  \"simulatorControl\"\n);\n","import { isProjectMutationAction } from \"@/project-mutation-actions\";\n\nimport { createSimulatorControlReducer } from \"../utils\";\n\nexport default createSimulatorControlReducer((state, action) => {\n  if (!isProjectMutationAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    mode: \"edit\",\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SIM_PAUSE = \"@sim/pause\" as const;\nexport const pauseSim = (mode: boolean | \"toggle\") => ({\n  type: ACTION_SIM_PAUSE,\n  payload: { mode },\n});\nexport type PauseSimAction = ReturnType<typeof pauseSim>;\nexport function isPauseSimAction(action: AnyAction): action is PauseSimAction {\n  return action.type === ACTION_SIM_PAUSE;\n}\n","import { createSimulatorControlSelector } from \"../utils\";\n\nexport const isSimActiveSelector = createSimulatorControlSelector(\n  (state) => state.mode !== \"edit\"\n);\n\nexport const isSimRunningSelector = createSimulatorControlSelector(\n  (state) => state.mode === \"run\"\n);\n\nexport const isSimPausedSelector = createSimulatorControlSelector(\n  (state) => state.mode === \"pause\"\n);\n\nexport const ticksPerSecondSelector = createSimulatorControlSelector(\n  (state) => state.ticksPerSecond\n);\n","import { concatReducers } from \"@/store/utils\";\n\nimport elementGraphInvalidatedReducer from \"./element-graph-invalidated\";\nimport simPauseReducer from \"./sim-pause\";\nimport simStartReducer from \"./sim-start\";\nimport simStepReducer from \"./sim-step\";\nimport simStopReducer from \"./sim-stop\";\n\nconst simulatorReducer = concatReducers(\n  elementGraphInvalidatedReducer,\n  simPauseReducer,\n  simStartReducer,\n  simStepReducer,\n  simStopReducer\n);\n\nexport default simulatorReducer;\n","import { isPauseSimAction } from \"@/actions/sim-pause\";\n\nimport { createSimulatorControlReducer } from \"../utils\";\nimport { isSimActiveSelector } from \"../selectors/run\";\n\nexport default createSimulatorControlReducer((state, action) => {\n  if (!isPauseSimAction(action)) {\n    return state;\n  }\n\n  const { mode } = action.payload;\n\n  if (!isSimActiveSelector.local(state)) {\n    return state;\n  }\n\n  let runMode = state.mode;\n\n  switch (mode) {\n    case true:\n      runMode = \"pause\";\n      break;\n    case false:\n      runMode = \"run\";\n      break;\n    case \"toggle\":\n      runMode = runMode == \"run\" ? \"pause\" : \"run\";\n  }\n\n  return {\n    ...state,\n    mode: runMode,\n  };\n});\n","import { isStartSimAction } from \"@/actions/sim-start\";\n\nimport { createSimulatorControlReducer } from \"../utils\";\n\nexport default createSimulatorControlReducer((state, action) => {\n  if (!isStartSimAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    mode: \"run\",\n  };\n});\n","import { isStepSimAction } from \"@/actions/sim-step\";\n\nimport { createSimulatorControlReducer } from \"../utils\";\n\nexport default createSimulatorControlReducer((state, action) => {\n  if (!isStepSimAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    mode: \"pause\",\n  };\n});\n","import { isStopSimAction } from \"@/actions/sim-stop\";\n\nimport { createSimulatorControlReducer } from \"../utils\";\n\nimport { defaultSimulatorControlServiceState } from \"../state\";\n\nexport default createSimulatorControlReducer((state, action) => {\n  if (!isStopSimAction(action)) {\n    return state;\n  }\n\n  // Reset the simulator but keep the ticks per second choice.\n  return {\n    ...defaultSimulatorControlServiceState,\n    ticksPerSecond: state.ticksPerSecond,\n  };\n});\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createUiLayoutReducer = createServiceReducerCreator(\"uiLayout\");\nexport const createUiLayoutSelector = createServiceSelectorCreator(\"uiLayout\");\n","import { isDeleteCircuitAction } from \"@/actions/circuit-delete\";\n\nimport { filterTesselValues } from \"@/components/Tessel/utils\";\n\nimport { isCircuitEditorTesselWindow } from \"@/pages/ProjectEditorPage/windows/CircuitEditorWindow/tessel-window\";\nimport { editorIdsFromCircuitIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nimport { createUiLayoutReducer } from \"../utils\";\n\nexport default createUiLayoutReducer((state, action, appState) => {\n  if (!isDeleteCircuitAction(action)) {\n    return state;\n  }\n\n  if (!state.layout) {\n    return state;\n  }\n\n  const { circuitId } = action.payload;\n\n  const removedWindowIds = editorIdsFromCircuitIdSelector(appState, circuitId);\n\n  const layout = filterTesselValues(state.layout, (value) => {\n    if (!isCircuitEditorTesselWindow(value)) {\n      return true;\n    }\n\n    if (removedWindowIds.indexOf(value.windowProps.editorId) !== -1) {\n      return false;\n    }\n\n    return true;\n  });\n\n  return {\n    ...state,\n    layout,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nimport { TesselValue } from \"@/components/Tessel\";\n\nexport const ACTION_LAYOUT_REARRANGE = \"@layout/rearrange\" as const;\nexport const rearrangeLayout = (layout: TesselValue) => ({\n  type: ACTION_LAYOUT_REARRANGE,\n  payload: { layout },\n});\nexport type RearrangeLayoutActionType = ReturnType<typeof rearrangeLayout>;\nexport function isRearrangeLayoutAction(\n  action: AnyAction\n): action is RearrangeLayoutActionType {\n  return action.type === ACTION_LAYOUT_REARRANGE;\n}\n","import { isRearrangeLayoutAction } from \"@/actions/layout-rearrange\";\nimport { createUiLayoutReducer } from \"../utils\";\n\nexport default createUiLayoutReducer((state, action) => {\n  if (!isRearrangeLayoutAction(action)) {\n    return state;\n  }\n\n  const { layout } = action.payload;\n\n  return {\n    ...state,\n    layout,\n  };\n});\n","import { isViewCircuitAction } from \"@/actions/view-circuit\";\n\nimport { normalizeTesselItem, TesselValue } from \"@/components/Tessel\";\nimport { findAndReplaceTesselValue } from \"@/components/Tessel/utils\";\n\nimport {\n  circuitEditorTesselWindow,\n  isCircuitEditorTesselWindow,\n} from \"@/pages/ProjectEditorPage/windows/CircuitEditorWindow/tessel-window\";\nimport { activeCircuitEditorIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nimport { createUiLayoutReducer } from \"../utils\";\n\nexport default createUiLayoutReducer((state, action, appState) => {\n  if (!isViewCircuitAction(action)) {\n    return state;\n  }\n\n  const { newWindowId } = action.payload;\n\n  if (!newWindowId) {\n    return state;\n  }\n\n  const window = circuitEditorTesselWindow(newWindowId);\n  const activeEditorId = activeCircuitEditorIdSelector(appState);\n\n  let layout: TesselValue | null = state.layout;\n\n  if (layout == null) {\n    layout = window;\n  } else {\n    let inserted = false;\n\n    // Try inserting the window alongside the active editor.\n    layout = findAndReplaceTesselValue(layout, (value) => {\n      const normalized = normalizeTesselItem(value);\n      if (\n        isCircuitEditorTesselWindow(normalized) &&\n        normalized.windowProps.editorId === activeEditorId\n      ) {\n        inserted = true;\n        return {\n          direction: \"row\",\n          division: 50,\n          first: value,\n          second: window,\n        };\n      }\n\n      return null;\n    });\n\n    if (!inserted) {\n      layout = {\n        direction: \"row\",\n        division: 50,\n        first: layout,\n        second: window,\n      };\n    }\n  }\n\n  return {\n    ...state,\n    layout,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const VIEW_RESET = \"@view/reset\" as const;\nexport const resetView = () => ({\n  type: VIEW_RESET,\n});\nexport type ResetViewAction = ReturnType<typeof resetView>;\nexport function isResetViewAction(\n  action: AnyAction\n): action is ResetViewAction {\n  return action.type === VIEW_RESET;\n}\n","import { concatReducers } from \"@/store/utils\";\n\nimport circuitDeleteReducer from \"./circuit-delete\";\nimport layoutRearrangeReducer from \"./layout-rearrange\";\nimport viewCircuitReducer from \"./view-circuit\";\nimport viewResetReducer from \"./view-reset\";\n\nexport default concatReducers(\n  circuitDeleteReducer,\n  layoutRearrangeReducer,\n  viewCircuitReducer,\n  viewResetReducer\n);\n","import { isResetViewAction } from \"@/actions/view-reset\";\nimport { defaultUiLayoutServiceState } from \"../state\";\nimport { createUiLayoutReducer } from \"../utils\";\n\nexport default createUiLayoutReducer((state, action) => {\n  if (!isResetViewAction(action)) {\n    return state;\n  }\n\n  return defaultUiLayoutServiceState;\n});\n","import { AnyAction } from \"redux\";\n\nexport const VIEW_NODE_NAMES = \"@view/node-names\" as const;\nexport const viewNodeNames = (mode: \"all\" | \"named-only\" | \"none\") => ({\n  type: VIEW_NODE_NAMES,\n  payload: { mode },\n});\nexport type ViewNodeNamesAction = ReturnType<typeof viewNodeNames>;\nexport function isViewNodeNamesAction(\n  action: AnyAction\n): action is ViewNodeNamesAction {\n  return action.type === VIEW_NODE_NAMES;\n}\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createUiSettingsReducer = createServiceReducerCreator(\n  \"uiSettings\"\n);\nexport const createUiSettingsSelector = createServiceSelectorCreator(\n  \"uiSettings\"\n);\n","import { concatReducers } from \"@/store/utils\";\n\nimport viewNodeNamesReducer from \"./view-node-names\";\n\nexport default concatReducers(viewNodeNamesReducer);\n","import { isViewNodeNamesAction } from \"@/actions/view-node-names\";\nimport { createUiSettingsReducer } from \"../utils\";\n\nexport default createUiSettingsReducer((state, action) => {\n  if (!isViewNodeNamesAction(action)) {\n    return state;\n  }\n\n  const { mode } = action.payload;\n  return {\n    ...state,\n    nodeNameMode: mode,\n  };\n});\n","import servicesReducer from \"@/services/reducer\";\n\nimport { finalizeReducerList } from \"./utils\";\n\nconst reducer = finalizeReducerList(servicesReducer);\n\nexport default reducer;\n","import { concatReducers } from \"@/store/utils\";\n\nimport circuitEditorUiDragReducer from \"./circuit-editor-drag/reducer\";\nimport circuitEditorsReducer from \"./circuit-editors/reducer\";\nimport circuitsReducer from \"./circuits/reducer\";\nimport clipboardReducer from \"./clipboard/reducer\";\nimport dialogReducer from \"./dialog/reducer\";\nimport nodeGraphReducer from \"./node-graph/reducer\";\nimport nodeLayoutReducer from \"./node-layout/reducer\";\nimport projectReducer from \"./project/reducer\";\nimport selectionReducer from \"./selection/reducer\";\nimport simulatorReducer from \"./simulator/reducer\";\nimport simulatorControlReducer from \"./simulator-control/reducers\";\nimport uiLayoutReducer from \"./ui-layout/reducer\";\nimport uiSettingsReducer from \"./ui-settings/reducer\";\n\nconst reducer = concatReducers(\n  circuitEditorUiDragReducer,\n  circuitEditorsReducer,\n  circuitsReducer,\n  clipboardReducer,\n  dialogReducer,\n  nodeGraphReducer,\n  nodeLayoutReducer,\n  projectReducer,\n  selectionReducer,\n  simulatorReducer,\n  simulatorControlReducer,\n  uiLayoutReducer,\n  uiSettingsReducer\n);\n\nexport default reducer;\n","import { AnyAction } from \"redux\";\n\nimport { AppState } from \"@/store\";\n\nimport { ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE } from \"@/actions/circuit-editor-drag-continue\";\nimport { ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE } from \"@/actions/circuit-editor-mouse-leave\";\nimport { ACTION_SIM_TICK } from \"@/actions/sim-tick\";\n\nexport const actionsBlacklist: string[] = [\n  ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE,\n  ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE,\n  ACTION_SIM_TICK,\n];\n\nexport function actionSanitizer(action: AnyAction): AnyAction {\n  return action;\n}\n\nexport function stateSanitizer(state: AppState): any {\n  return state;\n}\n","import { SagaIterator } from \"redux-saga\";\nimport { put, take } from \"redux-saga/effects\";\n\nimport { DialogData, DialogResult, DialogType } from \"@/dialogs/types\";\n\nimport { showDialog } from \"@/actions/dialog-show\";\n\nimport {\n  AcceptDialogAction,\n  ACTION_DIALOG_RESPONSE_ACCEPT,\n} from \"@/actions/dialog-response-accept\";\nimport {\n  CancelDialogAction,\n  ACTION_DIALOG_RESPONSE_CANCEL,\n} from \"@/actions/dialog-response-cancel\";\n\nexport function* displayDialogSaga<T extends DialogType>(\n  dialogType: T,\n  data: DialogData<T>\n): SagaIterator<DialogResult<T> | null> {\n  yield put(showDialog(dialogType, data));\n  const response: AcceptDialogAction | CancelDialogAction = yield take([\n    ACTION_DIALOG_RESPONSE_ACCEPT,\n    ACTION_DIALOG_RESPONSE_CANCEL,\n  ]);\n\n  if (response.type === ACTION_DIALOG_RESPONSE_ACCEPT) {\n    return response.payload.result;\n  }\n\n  return null;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_EXPORT_LINK = \"@project/export-link\" as const;\nexport const exportProjectLink = () => ({\n  type: ACTION_PROJECT_EXPORT_LINK,\n});\nexport type ExportProjectLinkAction = ReturnType<typeof exportProjectLink>;\nexport function isExportProjectLinkAction(\n  action: AnyAction\n): action is ExportProjectLinkAction {\n  return action.type === ACTION_PROJECT_EXPORT_LINK;\n}\n","import { call, select, takeEvery } from \"redux-saga/effects\";\nimport { Buffer } from \"buffer\";\nimport { deflate } from \"pako\";\n\nimport { rootUrl } from \"@/env\";\nimport history from \"@/history\";\n\nimport { AppState } from \"@/store\";\n\nimport { displayDialogSaga } from \"@/services/dialog/api\";\n\nimport { ACTION_PROJECT_EXPORT_LINK } from \"@/actions/project-export-link\";\n\nimport { createSave } from \"@/services/savedata/api\";\n\nexport default function* projectExportLinkSaga() {\n  yield takeEvery(ACTION_PROJECT_EXPORT_LINK, onExportLink);\n}\n\nfunction* onExportLink() {\n  const state: AppState = yield select();\n\n  try {\n    const save = createSave(state);\n    const saveText = JSON.stringify(save);\n    const encoded = deflate(saveText);\n\n    const encodedText = Buffer.from(encoded).toString(\"base64\");\n\n    const urlData = encodeURIComponent(encodedText);\n\n    const projectLink =\n      rootUrl +\n      history.createHref({\n        pathname: \"/import\",\n        search: `data=${urlData}`,\n      });\n\n    yield call(displayDialogSaga, \"export-project-link\", { projectLink });\n  } catch (e) {\n    // TODO: Warn user of failure\n    console.error(\"Failed to export project as link\", e);\n  }\n}\n","export const ACTION_PROJECT_IMPORT_CIRCUITS = \"@project/import-circuits\" as const;\nexport const importCircuitFromProject = () => ({\n  type: ACTION_PROJECT_IMPORT_CIRCUITS,\n});\n","import fileDialog from \"file-dialog\";\nimport { SagaIterator } from \"redux-saga\";\nimport { call, put, takeEvery } from \"redux-saga/effects\";\n\nimport { nodeTypeToCircuitId } from \"@/nodes/definitions/integrated-circuits/utils\";\n\nimport { ACTION_PROJECT_IMPORT_CIRCUITS } from \"@/actions/project-import-circuits\";\nimport { importCircuits } from \"@/actions/circuit-import\";\n\nimport { SaveData } from \"@/services/savedata/types\";\nimport { displayDialogSaga } from \"@/services/dialog/api\";\nimport { ROOT_CIRCUIT_ID } from \"@/services/circuits/constants\";\n\nexport default function* projectImportCircuitsSaga() {\n  yield takeEvery(ACTION_PROJECT_IMPORT_CIRCUITS, handleProjectImportCircuits);\n}\n\nfunction* handleProjectImportCircuits(): SagaIterator {\n  const [file]: File[] = yield call(fileDialog, {\n    accept: \"application/json\",\n  });\n  const contents = yield call(file.text.bind(file));\n  const saveData: SaveData = JSON.parse(contents);\n\n  const result: string[] | undefined = yield call(\n    displayDialogSaga,\n    \"import-project-circuits\",\n    {\n      circuits: saveData.circuits.filter(\n        (x) => x.circuitId !== ROOT_CIRCUIT_ID\n      ),\n    }\n  );\n\n  if (!Array.isArray(result)) {\n    return;\n  }\n\n  const scanCircuitIds = result;\n  const targetCircuitIds: string[] = [];\n  // Scan through the list of circuits and import dependencies.\n  let circuitId: string | undefined;\n  while ((circuitId = scanCircuitIds.pop())) {\n    targetCircuitIds.push(circuitId);\n    for (const node of saveData.nodes) {\n      const { circuitId: nodeCircuitId, nodeType } = node;\n      if (circuitId !== nodeCircuitId) {\n        continue;\n      }\n      const nodeIcCircuitId = nodeTypeToCircuitId(nodeType);\n      if (nodeIcCircuitId == null) {\n        continue;\n      }\n      scanCircuitIds.push(nodeIcCircuitId);\n    }\n  }\n\n  yield put(importCircuits(targetCircuitIds, saveData));\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_IMPORT_LINK = \"@project/import-link\" as const;\nexport const importProjectLink = (data: string) => ({\n  type: ACTION_PROJECT_IMPORT_LINK,\n  payload: { data },\n});\nexport type ImportProjectLinkAction = ReturnType<typeof importProjectLink>;\nexport function isImportProjectLinkAction(\n  action: AnyAction\n): action is ImportProjectLinkAction {\n  return action.type === ACTION_PROJECT_IMPORT_LINK;\n}\n","import { put, takeEvery } from \"redux-saga/effects\";\nimport { Buffer } from \"buffer\";\n\nimport { inflate } from \"pako\";\n\nimport {\n  ACTION_PROJECT_IMPORT_LINK,\n  ImportProjectLinkAction,\n} from \"@/actions/project-import-link\";\n\nimport { receiveProject } from \"@/actions/project-receive\";\nimport history from \"@/history\";\n\nexport default function* projectImportLinkSaga() {\n  yield takeEvery(ACTION_PROJECT_IMPORT_LINK, onImportLink);\n}\n\nfunction* onImportLink(action: ImportProjectLinkAction) {\n  const { data } = action.payload;\n  try {\n    const dewrapped = decodeURIComponent(data);\n    const deflated = Buffer.from(dewrapped, \"base64\");\n    const saveText = inflate(deflated, { to: \"string\" });\n    const save = JSON.parse(saveText);\n\n    yield put(receiveProject(\"Linked Project\", save));\n\n    history.replace(\"/\");\n  } catch (e) {\n    console.error(\"Failed to import save from link\", e);\n  }\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_LOAD = \"@project/load\" as const;\nexport const loadProject = () => ({\n  type: ACTION_PROJECT_LOAD,\n});\nexport type LoadProjectAction = ReturnType<typeof loadProject>;\nexport function isLoadProjectAction(\n  action: AnyAction\n): action is LoadProjectAction {\n  return action.type === ACTION_PROJECT_LOAD;\n}\n","import { SagaIterator } from \"redux-saga\";\nimport { call, put, takeEvery } from \"redux-saga/effects\";\nimport fileDialog from \"file-dialog\";\n\nimport { ACTION_PROJECT_LOAD } from \"@/actions/project-load\";\nimport { receiveProject } from \"@/actions/project-receive\";\n\nimport { SaveData } from \"@/services/savedata/types\";\n\nexport default function* projectLoadSaga() {\n  yield takeEvery(ACTION_PROJECT_LOAD, loadProject);\n}\n\nfunction* loadProject(): SagaIterator {\n  try {\n    const [file]: File[] = yield call(fileDialog, {\n      accept: \"application/json\",\n    });\n    const contents = yield call(file.text.bind(file));\n    const saveData: SaveData = JSON.parse(contents);\n    let fileName = file.name;\n    if (fileName) {\n      fileName = fileName.substr(0, fileName.lastIndexOf(\".json\"));\n    } else {\n      fileName = \"Unnamed Project\";\n    }\n    yield put(receiveProject(fileName, saveData));\n  } catch (e) {\n    // TODO: Handle error\n    console.warn(\"Failed to load project:\", e);\n  }\n}\n","import { createProjectSelector } from \"../utils\";\n\nexport const projectNameSelector = createProjectSelector(\n  (state) => state.projectName\n);\n\nexport const projectModifiedSelector = createProjectSelector(\n  (state) => state.projectModified\n);\n","import { SagaIterator } from \"redux-saga\";\nimport { call, put, select, takeEvery } from \"redux-saga/effects\";\nimport { saveAs } from \"file-saver\";\n\nimport { AppState } from \"@/store\";\n\nimport {\n  ACTION_PROJECT_SAVE,\n  saveProjectSuccess,\n} from \"@/actions/project-save\";\nimport { renameProject } from \"@/actions/project-rename\";\n\nimport { createSave } from \"@/services/savedata/api\";\n\nimport { projectNameSelector } from \"../selectors/project\";\n\nexport default function* projectSaveSaga() {\n  yield takeEvery(ACTION_PROJECT_SAVE, saveProject);\n}\n\nfunction* saveProject() {\n  const state: AppState = yield select();\n\n  try {\n    if (window.showSaveFilePicker) {\n      yield call(saveNativeFileApi, state);\n    } else {\n      yield call(saveLegacy, state);\n    }\n    yield put(saveProjectSuccess());\n  } catch (e) {\n    // TODO: Report error\n    console.warn(\"Failed to save project\", e);\n  }\n}\n\nfunction* saveNativeFileApi(state: AppState): SagaIterator {\n  const projectName = yield select(projectNameSelector);\n\n  const fileHandle: FileHandle | null = yield call(window.showSaveFilePicker!, {\n    // This isn't official yet, even with the not-official showSaveFilePicker\n    // https://github.com/WICG/file-system-access/blob/main/SuggestedNameAndDir.md#specifying-suggested-file-name-to-save-as\n    // It's so new, chrome does not yet support it, but it will:\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=1145102\n    suggestedName: projectName,\n    types: [\n      {\n        description: \"Discrelog Project Files\",\n        accept: {\n          \"application/json\": [\".json\"],\n        },\n      },\n    ],\n  });\n\n  if (!fileHandle) {\n    return;\n  }\n\n  // Some confusion over how to get the name of the file...\n  // fileHandle.name appears in the debugger for chrome, but does not\n  // seem to be documented.\n  // getFile().name is documented by mozilla, but gives me undefined.\n  let name = fileHandle.name;\n  if (!name) {\n    name = fileHandle.getFile().name;\n  }\n  if (name) {\n    name = name.substr(0, name.lastIndexOf(\".json\"));\n    yield put(renameProject(name));\n  }\n\n  const save = createSave(state);\n\n  const writable: FileSystemWritableStream = yield call(\n    fileHandle.createWritable.bind(fileHandle)\n  );\n  yield call(writable.write.bind(writable), JSON.stringify(save, null, 2));\n  yield call(writable.close.bind(writable));\n}\n\nfunction* saveLegacy(state: AppState): SagaIterator {\n  const projectName = yield select(projectNameSelector);\n\n  const save = createSave(state);\n  const blob = new Blob([JSON.stringify(save, null, 2)], {\n    type: \"application/json;charset=utf-8\",\n  });\n\n  saveAs(blob, `${projectName}.json`);\n}\n","import { fork } from \"redux-saga/effects\";\n\nimport projectExportLink from \"./project-export-link\";\nimport projectImportCircuits from \"./project-import-circuits\";\nimport projectImportLink from \"./project-import-link\";\nimport projectLoadSaga from \"./project-load\";\nimport projectSaveSaga from \"./project-save\";\n\nexport default function* saveDataSaga() {\n  yield fork(projectExportLink);\n  yield fork(projectImportCircuits);\n  yield fork(projectImportLink);\n  yield fork(projectLoadSaga);\n  yield fork(projectSaveSaga);\n}\n","import { SagaIterator } from \"redux-saga\";\nimport { takeLeading, select, put, delay } from \"redux-saga/effects\";\n\nimport { ACTION_SIM_START } from \"@/actions/sim-start\";\nimport { ACTION_SIM_PAUSE, pauseSim } from \"@/actions/sim-pause\";\nimport { ACTION_SIM_STEP } from \"@/actions/sim-step\";\n\nimport { tickSim } from \"@/actions/sim-tick\";\n\nimport { isSimRunningSelector, ticksPerSecondSelector } from \"../selectors/run\";\n\nexport default function* runModeSaga() {\n  yield takeLeading(\n    [ACTION_SIM_START, ACTION_SIM_PAUSE, ACTION_SIM_STEP],\n    handleRunSim\n  );\n}\n\nfunction* handleRunSim(): SagaIterator {\n  while (true) {\n    const isRunning = yield select(isSimRunningSelector);\n    if (!isRunning) {\n      break;\n    }\n\n    try {\n      yield put(tickSim(1));\n    } catch (e) {\n      console.error(e);\n      yield put(pauseSim(true));\n      return;\n    }\n\n    const tps = yield select(ticksPerSecondSelector);\n    const timeToWait = Math.max(Math.ceil(1000 / tps), 1);\n    yield delay(timeToWait);\n  }\n}\n","import { fork } from \"redux-saga/effects\";\n\nimport runModeSaga from \"./mode-run\";\n\nexport default function* simulatorSaga() {\n  yield fork(runModeSaga);\n}\n","import servicesSaga from \"@/services/saga\";\n\nexport default servicesSaga;\n","import {\n  createStore,\n  compose,\n  applyMiddleware,\n  AnyAction,\n  Middleware,\n} from \"redux\";\nimport freeze from \"redux-freeze\";\nimport createSagaMiddleware from \"redux-saga\";\n\nimport { isTruthy } from \"@/utils\";\nimport { isProd } from \"@/env\";\n\nimport { doInit } from \"@/actions/init\";\n\nimport undoReducer from \"@/undo/reducer\";\n\nimport {\n  actionSanitizer,\n  stateSanitizer,\n  actionsBlacklist,\n} from \"./devtool-sanitizer\";\n\nimport { AppState, defaultAppState } from \"./state\";\nimport saga from \"./saga\";\nimport rootReducer from \"./reducer\";\n\nfunction finalReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  state = undoReducer(state, action);\n  state = rootReducer(state, action);\n  return state;\n}\n\nconst composeEnhancers =\n  (window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ &&\n    window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({\n      actionSanitizer,\n      stateSanitizer,\n      actionsBlacklist,\n    })) ||\n  compose;\n\nconst sagaMiddleware = createSagaMiddleware();\n\nconst middleware: Middleware<any, any, any>[] = [\n  !isProd && freeze,\n  sagaMiddleware,\n].filter(isTruthy);\n\nexport const store = createStore(\n  finalReducer,\n  composeEnhancers(applyMiddleware(...middleware))\n);\n\nsagaMiddleware.run(saga);\nstore.dispatch(doInit());\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\n\nimport captureUndoStateReducer from \"./capture-undo-state\";\nimport redoReducer from \"./redo\";\nimport undoReducer from \"./undo\";\n\n// The undo reducer is special and returns a single reducer that is always ran outside of the primary reducer stack.\n// This is less for reducer priority and more to capture the effects of reentrant reducers like clipboard-paste.\n// FIXME: Moving this outside the services system means autosave cannot save undo/redo.  Either move autosave out\n//  as well or move undo into services.\nexport default function undoServiceReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  state = captureUndoStateReducer(state, action);\n  state = redoReducer(state, action);\n  state = undoReducer(state, action);\n  return state;\n}\n","import { AnyAction } from \"redux\";\nimport last from \"lodash/last\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isUndoAction } from \"@/actions/undo\";\nimport { viewCircuit } from \"@/actions/view-circuit\";\n\nimport { captureUndoState } from \"../utils\";\n\nexport default function undoReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isUndoAction(action)) {\n    return state;\n  }\n\n  const { undoStack, redoStack } = state.undo;\n\n  const stackItem = last(undoStack);\n  if (!stackItem) {\n    return state;\n  }\n\n  const { serviceStates, viewCircuitId } = stackItem;\n\n  state = {\n    ...state,\n    services: {\n      ...state.services,\n      ...serviceStates,\n    },\n    undo: {\n      ...state.undo,\n      undoStack: undoStack.slice(0, undoStack.length - 1),\n      redoStack: [...redoStack, captureUndoState(state)],\n    },\n  };\n\n  if (viewCircuitId) {\n    state = rootReducer(state, viewCircuit(viewCircuitId));\n  }\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\nimport last from \"lodash/last\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isRedoAction } from \"@/actions/redo\";\nimport { viewCircuit } from \"@/actions/view-circuit\";\n\nimport { captureUndoState } from \"../utils\";\n\nexport default function redoReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isRedoAction(action)) {\n    return state;\n  }\n\n  const { undoStack, redoStack } = state.undo;\n\n  const stackItem = last(redoStack);\n  if (!stackItem) {\n    return state;\n  }\n\n  const { serviceStates, viewCircuitId } = stackItem;\n\n  state = {\n    ...state,\n    services: {\n      ...state.services,\n      ...serviceStates,\n    },\n    undo: {\n      ...state.undo,\n      undoStack: [...undoStack, captureUndoState(state)],\n      redoStack: redoStack.slice(0, redoStack.length - 1),\n    },\n  };\n\n  if (viewCircuitId) {\n    state = rootReducer(state, viewCircuit(viewCircuitId));\n  }\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nimport { isProjectMutationAction } from \"@/project-mutation-actions\";\nimport { AppState, defaultAppState } from \"@/store\";\nimport { fpSet } from \"@/utils\";\n\nimport { isUndoAction } from \"@/actions/undo\";\nimport { isRedoAction } from \"@/actions/redo\";\n\nimport { captureUndoState } from \"../utils\";\n\n// If this was part of the normal reducer stack, we would want to give it a very low priority\n// so it occurs after all other reducers.\n// However, in order to capture reentrant reducers, our master undo reducer wraps\n// the root reducer especially and always occurs last.\nexport default function captureUndoStateReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (\n    !isProjectMutationAction(action) ||\n    isUndoAction(action) ||\n    isRedoAction(action)\n  ) {\n    return state;\n  }\n\n  return fpSet(state, \"undo\", (undoState) => ({\n    ...undoState,\n    // Limiting undo to 25 entries, since we store the entire project every slice.\n    // TODO: Consider using a difference engine to store the minimal difference between the states.\n    //  This should let us store far more undo operations as the project gets larger.\n    // Could use https://www.npmjs.com/package/deep-diff\n    // Problem with this is it takes up time capturing the undo, which slows down all operations.\n    undoStack: [...undoState.undoStack.slice(0, 25), captureUndoState(state)],\n    redoStack: [],\n  }));\n}\n","import { useSelector as useSelectorRedux } from \"react-redux\";\n\nimport { AppState } from \"@/store\";\n\nexport default function useSelector<T>(selector: (s: AppState) => T) {\n  return useSelectorRedux<AppState, T>(selector);\n}\n","import * as React from \"react\";\n\nexport function useNativeEvent<\n  T extends GlobalEventHandlers,\n  K extends keyof GlobalEventHandlersEventMap\n>(\n  ref: React.RefObject<T | null>,\n  type: K,\n  listener: (\n    this: GlobalEventHandlers,\n    ev: GlobalEventHandlersEventMap[K]\n  ) => any,\n  options?: boolean | AddEventListenerOptions\n) {\n  React.useEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n\n    // De-reference the target so we remove from the right element.\n    const listenTarget = ref.current;\n\n    listenTarget.addEventListener(type, listener, options);\n    return () => {\n      listenTarget.removeEventListener(type, listener, options);\n    };\n  }, [type, listener, ref, options]);\n}\n","import { fork } from \"redux-saga/effects\";\n\nimport projectSaga from \"./project/saga\";\nimport simulatorControlSaga from \"./simulator-control/saga\";\n\nexport default function* appSaga() {\n  yield fork(projectSaga);\n  yield fork(simulatorControlSaga);\n}\n","import { createUiLayoutSelector } from \"../utils\";\n\nexport const layoutSelector = createUiLayoutSelector((s) => s.layout);\n","import TitleBar from \"./TitleBar\";\nexport default TitleBar;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./TitleBar.module.css\";\n\nexport interface TitleBarProps {\n  className?: string;\n  title?: string;\n}\nconst TitleBar: React.FC<TitleBarProps> = ({ className, title, children }) => {\n  return (\n    <div className={cls(styles.titlebar, className)}>\n      <span className={styles[\"titlebar-heading\"]}>Discrelog</span>\n      <div className={styles[\"titlebar-divider\"]} />\n      {title && <div className={styles[\"titlebar-title\"]}>{title}</div>}\n      {children}\n    </div>\n  );\n};\n\nexport default TitleBar;\n","// extracted by mini-css-extract-plugin\nexport default {\"titlebar\":\"titlebar--3-TCE\",\"titlebar-heading\":\"titlebar-heading--3RAl1\",\"titlebar-divider\":\"titlebar-divider--Wl_27\",\"titlebar-title\":\"titlebar-title--HXGig\"};","import * as React from \"react\";\n\nexport interface PopoverChildContext {\n  registerPopoverChild(element: HTMLElement): void;\n  unregisterPopoverChild(element: HTMLElement): void;\n}\n\nfunction noop() {\n  // no op.\n}\nconst noopPopoverChildContext: PopoverChildContext = {\n  registerPopoverChild: noop,\n  unregisterPopoverChild: noop,\n};\n\nexport const PopoverChildContext = React.createContext<PopoverChildContext | null>(\n  null\n);\n\nexport const usePopoverChildContext = () =>\n  React.useContext(PopoverChildContext);\n\nexport const PopoverChildContextProvider: React.FC<PopoverChildContext> = ({\n  registerPopoverChild: contextRegister,\n  unregisterPopoverChild: contextUnregister,\n  children,\n}) => {\n  const parent = usePopoverChildContext();\n  const parentRegister = parent?.registerPopoverChild;\n  const parentUnregister = parent?.unregisterPopoverChild;\n\n  const registerPopoverChild = React.useCallback(\n    (element: HTMLElement) => {\n      if (parentRegister) {\n        parentRegister(element);\n      }\n      contextRegister(element);\n    },\n    [contextRegister, parentRegister]\n  );\n\n  const unregisterPopoverChild = React.useCallback(\n    (element: HTMLElement) => {\n      contextUnregister(element);\n      if (parentUnregister) {\n        parentUnregister;\n      }\n    },\n    [contextUnregister, parentUnregister]\n  );\n\n  const providedContext = React.useMemo(\n    () => ({\n      registerPopoverChild,\n      unregisterPopoverChild,\n    }),\n    [registerPopoverChild, unregisterPopoverChild]\n  );\n\n  return (\n    <PopoverChildContext.Provider value={providedContext}>\n      {children}\n    </PopoverChildContext.Provider>\n  );\n};\n\nexport function usePopoverChild(element: HTMLElement | null) {\n  const popoverContext =\n    React.useContext(PopoverChildContext) ?? noopPopoverChildContext;\n\n  // We do not want to trigger the effect when\n  //  the context changes, as the context will change\n  //  as a result of calling register and unregister.\n  // As a result, we will not function right if somehow our\n  //  element transfers to a different popup chain without re-rendering.\n  const ctxRef = React.useRef(popoverContext);\n  React.useEffect(() => {\n    ctxRef.current = popoverContext;\n  });\n\n  React.useEffect(() => {\n    if (element) {\n      ctxRef.current.registerPopoverChild(element);\n      return () => ctxRef.current.unregisterPopoverChild(element);\n    }\n  }, [element]);\n}\n","export * from \"./Popover\";\nimport Popover from \"./Popover\";\nexport default Popover;\n","import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport { Options, VirtualElement } from \"@popperjs/core\";\nimport { usePopper } from \"react-popper\";\n\nimport { useOutsideMouseEvent } from \"@/hooks/useOutsideMouseEvent\";\nimport { useArrayState } from \"@/hooks/useArrayState\";\n\nimport {\n  PopoverChildContextProvider,\n  usePopoverChild,\n} from \"./PopoverChildContext\";\n\nexport interface PopoverProps {\n  anchorEl: Element | VirtualElement | null;\n  placement?: Options[\"placement\"];\n  isOpen: boolean;\n  onRequestClose(): void;\n}\n\nconst Popover: React.FC<PopoverProps> = ({\n  isOpen,\n  anchorEl,\n  placement = \"auto\",\n  onRequestClose,\n  children,\n}) => {\n  const [popoverRef, setPopoverRef] = React.useState<HTMLDivElement | null>(\n    null\n  );\n  const { attributes, styles } = usePopper(\n    isOpen ? anchorEl : null,\n    popoverRef,\n    {\n      placement,\n    }\n  );\n\n  // Register us as a child of a parent popover, if any is present.\n  usePopoverChild(popoverRef);\n\n  const [\n    popoverChildren,\n    registerPopoverChild,\n    unregisterPopoverChild,\n  ] = useArrayState<HTMLElement>();\n\n  // Close when a click happens on the outside.\n  // We still want to handle this even if we are a child, as the user\n  // may have clicked on a parent popover which should close us.\n  const insideRefs = React.useMemo(() => [popoverRef, ...popoverChildren], [\n    popoverChildren,\n    popoverRef,\n  ]);\n  useOutsideMouseEvent(insideRefs, onRequestClose);\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return createPortal(\n    <PopoverChildContextProvider\n      registerPopoverChild={registerPopoverChild}\n      unregisterPopoverChild={unregisterPopoverChild}\n    >\n      <div ref={setPopoverRef} style={styles.popper} {...attributes.popper}>\n        {children}\n      </div>\n    </PopoverChildContextProvider>,\n    document.body\n  );\n};\n\nexport default Popover;\n","import * as React from \"react\";\nimport difference from \"lodash/difference\";\n\nexport type UseArrayState<T> = [\n  items: T[],\n  addItem: (value: T) => void,\n  removeItem: (value: T) => void,\n  setItems: (items: T[]) => void\n];\n\nexport function useArrayState<T>(defaultValue: T[] = []): UseArrayState<T> {\n  const [items, setItems] = React.useState(defaultValue);\n  const addItem = React.useCallback(\n    (item: T) => {\n      setItems([...items, item]);\n    },\n    [items]\n  );\n  const removeItem = React.useCallback(\n    (item: T) => {\n      setItems(difference(items, [item]));\n    },\n    [items]\n  );\n\n  return [items, addItem, removeItem, setItems];\n}\n","import * as React from \"react\";\n\nimport { asArray, MaybeArray } from \"@/arrays\";\nimport { isTruthy } from \"@/utils\";\n\nexport function useOutsideMouseEvent(\n  element: MaybeArray<HTMLElement | null>,\n  onOutsideEvent: () => void,\n  when = true\n) {\n  const onEvent = React.useCallback(\n    (e: MouseEvent | TouchEvent) => {\n      const elements = asArray(element).filter(isTruthy);\n      if (!elements.length) {\n        return;\n      }\n\n      if (elements.every((element) => !element.contains(e.target as any))) {\n        onOutsideEvent();\n      }\n    },\n    [element, onOutsideEvent]\n  );\n\n  React.useEffect(() => {\n    if (!when) {\n      return;\n    }\n\n    document.addEventListener(\"mousedown\", onEvent);\n    document.addEventListener(\"touchstart\", onEvent);\n\n    return () => {\n      document.removeEventListener(\"mousedown\", onEvent);\n      document.removeEventListener(\"touchstart\", onEvent);\n    };\n  }, [onEvent, when]);\n}\n","import * as React from \"react\";\n\nfunction noop() {\n  /* Do nothing */\n}\n\nconst MenuCloseContext = React.createContext<() => void>(noop);\n\nexport function useMenuCloseContext() {\n  return React.useContext(MenuCloseContext);\n}\n\nexport const MenuCloseContextProvider = MenuCloseContext.Provider;\n","import * as React from \"react\";\nimport { Options } from \"@popperjs/core\";\n\nimport Popover from \"./Popover\";\nimport { MenuCloseContextProvider } from \"./Menus/MenuCloseContext\";\n\nexport interface AutoPopoverProps {\n  content: JSX.Element;\n  placement?: Options[\"placement\"];\n}\n\nconst AutoPopover: React.FC<AutoPopoverProps> = ({\n  content,\n  placement,\n  children,\n}) => {\n  const anchorEl = React.useRef<HTMLDivElement | null>(null);\n\n  const [open, setOpen] = React.useState(false);\n  const onClick = React.useCallback(() => {\n    setOpen(true);\n  }, []);\n  const onClose = React.useCallback(() => {\n    setOpen(false);\n  }, []);\n\n  return (\n    <MenuCloseContextProvider value={onClose}>\n      <div ref={anchorEl} onClick={onClick}>\n        {children}\n      </div>\n      <Popover\n        anchorEl={anchorEl.current}\n        isOpen={open}\n        placement={placement}\n        onRequestClose={onClose}\n      >\n        {open && content}\n      </Popover>\n    </MenuCloseContextProvider>\n  );\n};\n\nexport default AutoPopover;\n","// extracted by mini-css-extract-plugin\nexport default {\"button\":\"button--Ui3Hp\",\"button--size-small\":\"button--size-small--289kb\",\"button--size-default\":\"button--size-default--dnLXK\",\"button--variant-primary\":\"button--variant-primary--2qpAa\",\"button--variant-default\":\"button--variant-default---2bie\",\"button--variant-menu\":\"button--variant-menu--3lEZ1\"};","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nexport interface ButtonProps extends React.HTMLAttributes<HTMLButtonElement> {\n  variant?: \"primary\" | \"default\" | \"menu\";\n  size?: \"default\" | \"small\";\n}\n\nimport styles from \"./Button.module.css\";\n\nconst Button: React.FC<ButtonProps> = ({\n  variant = \"default\",\n  size = \"default\",\n  ...props\n}) => {\n  return (\n    <button\n      className={cls(\n        styles[\"button\"],\n        (styles as any)[`button--variant-${variant}`],\n        (styles as any)[`button--size-${size}`]\n      )}\n      type=\"button\"\n      {...props}\n    >\n      {props.children}\n    </button>\n  );\n};\n\nexport default Button;\n","import Button from \"./Button\";\nexport default Button;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { AnyAction } from \"redux\";\n\nexport function useAction(actionCreator: () => AnyAction): () => AnyAction;\nexport function useAction<Args>(\n  actionCreator: (...args: Args[]) => AnyAction\n): () => AnyAction;\nexport function useAction<A0, Args>(\n  actionCreator: (a0: A0, ...args: Args[]) => AnyAction,\n  a0: A0\n): () => AnyAction;\nexport function useAction(\n  actionCreator: (...args: any[]) => AnyAction,\n  ...preBind: any[]\n): () => AnyAction {\n  const dispatch = useDispatch();\n  return React.useCallback(\n    () => {\n      const action = actionCreator(...preBind);\n      if (action) {\n        dispatch(action);\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [dispatch, actionCreator, ...preBind]\n  ) as any;\n}\n\nexport function useClickAction(\n  actionCreator: (...args: any[]) => AnyAction,\n  ...preBind: any[]\n): (e: React.MouseEvent) => AnyAction {\n  const dispatch = useDispatch();\n  return React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n      const action = actionCreator(...preBind);\n      if (action) {\n        dispatch(action);\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [dispatch, actionCreator, ...preBind]\n  ) as any;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"menu\":\"menu--3E86w\",\"menu-item\":\"menu-item--2dcyN\",\"menu-item--disabled\":\"menu-item--disabled--RJJTK\",\"menu-item-content\":\"menu-item-content--3s1DG\",\"menu-item-text\":\"menu-item-text--1F41V\",\"menu-item-secondary\":\"menu-item-secondary--2PJLF\",\"menu-item-icon\":\"menu-item-icon--JTlha\",\"menu-divider\":\"menu-divider--1QPGp\"};","import * as React from \"react\";\n\nimport styles from \"./Menus.module.css\";\n\nconst Menu: React.FC = ({ children }) => {\n  return <ul className={styles[\"menu\"]}>{children}</ul>;\n};\n\nexport default Menu;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Menus.module.css\";\nimport { useMenuCloseContext } from \"./MenuCloseContext\";\n\nexport interface MenuItemProps {\n  disabled?: boolean;\n  secondary?: string;\n  onClick?(e: React.MouseEvent<HTMLElement>): void;\n}\nconst MenuItem: React.FC<MenuItemProps> = ({\n  disabled,\n  onClick,\n  secondary,\n  children,\n}) => {\n  const requestMenuClose = useMenuCloseContext();\n  const onItemClick = React.useCallback(\n    (e: React.MouseEvent<HTMLAnchorElement>) => {\n      if (onClick) {\n        onClick(e);\n      }\n      requestMenuClose();\n    },\n    [requestMenuClose, onClick]\n  );\n  return (\n    <li\n      className={cls(\n        styles[\"menu-item\"],\n        disabled && styles[\"menu-item--disabled\"]\n      )}\n    >\n      <a className={styles[\"menu-item-content\"]} onClick={onItemClick}>\n        <span className={styles[\"menu-item-text\"]}>{children}</span>\n        {secondary && (\n          <span className={styles[\"menu-item-secondary\"]}>{secondary}</span>\n        )}\n      </a>\n    </li>\n  );\n};\n\nexport default MenuItem;\n","import * as React from \"react\";\n\nimport styles from \"./Menus.module.css\";\n\nconst DividerMenuItem: React.FC = () => {\n  return <div className={styles[\"menu-divider\"]} />;\n};\n\nexport default DividerMenuItem;\n","import * as React from \"react\";\n\nimport { useAction } from \"@/hooks/useAction\";\nimport { newProject } from \"@/actions/project-new\";\nimport { saveProject } from \"@/actions/project-save\";\nimport { loadProject } from \"@/actions/project-load\";\nimport { exportProjectLink } from \"@/actions/project-export-link\";\nimport { importCircuitFromProject } from \"@/actions/project-import-circuits\";\n\nimport Menu from \"@/components/Menus/Menu\";\nimport MenuItem from \"@/components/Menus/MenuItem\";\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\n\nconst FileMenu: React.FC = () => {\n  const onNewProject = useAction(newProject);\n  const onSaveProject = useAction(saveProject);\n  const onLoadProject = useAction(loadProject);\n  const onImportProjectCircuits = useAction(importCircuitFromProject);\n  const onExportLink = useAction(exportProjectLink);\n\n  return (\n    <Menu>\n      <MenuItem onClick={onNewProject}>New</MenuItem>\n      <DividerMenuItem />\n      <MenuItem onClick={onLoadProject}>Load</MenuItem>\n      <MenuItem onClick={onSaveProject}>Save</MenuItem>\n      <DividerMenuItem />\n      <MenuItem onClick={onImportProjectCircuits}>Import Circuits</MenuItem>\n      <DividerMenuItem />\n      <MenuItem onClick={onExportLink}>Export Link</MenuItem>\n    </Menu>\n  );\n};\n\nexport default FileMenu;\n","import { os } from \"platform\";\n\nconst OS_MAC = /(Mac|iOS|OS\\ X)/;\n\nexport const keyboardIsMac = OS_MAC.test((os || \"undefined\").toString());\n\nexport const keyboardCommandModifier = keyboardIsMac ? \"command\" : \"ctrl\";\n","import { AppState } from \"@/store\";\n\nexport const canUndoSelector = (state: AppState) =>\n  state.undo.undoStack.length > 0;\nexport const canRedoSelector = (state: AppState) =>\n  state.undo.redoStack.length > 0;\n","import * as React from \"react\";\n\nimport { keyboardCommandModifier } from \"@/runtime-env\";\n\nimport { useAction } from \"@/hooks/useAction\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { canRedoSelector, canUndoSelector } from \"@/undo/selectors\";\n\nimport { undo } from \"@/actions/undo\";\nimport { redo } from \"@/actions/redo\";\n\nimport Menu from \"@/components/Menus/Menu\";\nimport MenuItem from \"@/components/Menus/MenuItem\";\n\nconst EditMenu: React.FC = () => {\n  const canUndo = useSelector(canUndoSelector);\n  const onUndo = useAction(undo);\n  const canRedo = useSelector(canRedoSelector);\n  const onRedo = useAction(redo);\n\n  return (\n    <Menu>\n      <MenuItem\n        disabled={!canUndo}\n        secondary={`${keyboardCommandModifier}+z`}\n        onClick={onUndo}\n      >\n        Undo\n      </MenuItem>\n      <MenuItem\n        disabled={!canRedo}\n        secondary={`${keyboardCommandModifier}+shift+z`}\n        onClick={onRedo}\n      >\n        Redo\n      </MenuItem>\n    </Menu>\n  );\n};\n\nexport default EditMenu;\n","import { AppState } from \"@/store\";\n\nimport {\n  nodeNameFromNodeIdSelector,\n  nodeNameOrDefaultFromNodeIdSelector,\n} from \"@/services/node-graph/selectors/nodes\";\nimport { createUiSettingsSelector } from \"../utils\";\n\nexport const nodeNameModeSelector = createUiSettingsSelector(\n  (s) => s.nodeNameMode\n);\n\nexport const nodeFieldDisplayNameFromNodeId = (\n  state: AppState,\n  nodeId: string\n) => {\n  const mode = state.services.uiSettings.nodeNameMode;\n  switch (mode) {\n    case \"all\":\n    default:\n      return nodeNameOrDefaultFromNodeIdSelector(state, nodeId);\n    case \"named-only\":\n      return nodeNameFromNodeIdSelector(state, nodeId);\n    case \"none\":\n      return null;\n  }\n};\n","export * from \"./Checkbox\";\nimport Checkbox from \"./Checkbox\";\nexport default Checkbox;\n","import * as React from \"react\";\n\nimport styles from \"./Checkbox.module.css\";\n\nexport interface CheckboxProps {\n  className?: string;\n  value: boolean;\n  onChange(e: React.ChangeEvent<HTMLInputElement>): void;\n}\n\nconst Checkbox: React.FC<CheckboxProps> = ({\n  className,\n  value,\n  onChange,\n  children,\n}) => {\n  return (\n    <label className={className}>\n      <span className={styles[\"checkbox-span\"]}>\n        <input type=\"checkbox\" checked={value} onChange={onChange} />\n      </span>\n      {children}\n    </label>\n  );\n};\n\nexport default Checkbox;\n","// extracted by mini-css-extract-plugin\nexport default {\"checkbox-span\":\"checkbox-span--1EWGs\"};","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport Checkbox from \"@/components/Checkbox\";\n\nimport styles from \"./Menus.module.css\";\n\nexport interface CheckboxMenuItemProps {\n  disabled?: boolean;\n  secondary?: string;\n  value: boolean;\n  onChange(e: React.ChangeEvent<HTMLInputElement>): void;\n}\nconst CheckboxMenuItem: React.FC<CheckboxMenuItemProps> = ({\n  disabled,\n  secondary,\n  value,\n  onChange,\n  children,\n}) => {\n  return (\n    <li\n      className={cls(\n        styles[\"menu-item\"],\n        disabled && styles[\"menu-item--disabled\"]\n      )}\n    >\n      <Checkbox\n        className={styles[\"menu-item-content\"]}\n        value={value}\n        onChange={onChange}\n      >\n        <span className={styles[\"menu-item-text\"]}>{children}</span>\n        {secondary && (\n          <span className={styles[\"menu-item-secondary\"]}>{secondary}</span>\n        )}\n      </Checkbox>\n    </li>\n  );\n};\n\nexport default CheckboxMenuItem;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport AutoPopover from \"@/components/AutoPopover\";\n\nimport styles from \"./Menus.module.css\";\n\nexport interface SubMenuItemProps {\n  disabled?: boolean;\n  secondary?: string;\n  content: JSX.Element;\n}\nconst SubMenuItem: React.FC<SubMenuItemProps> = ({\n  disabled,\n  secondary,\n  content,\n  children,\n}) => {\n  return (\n    <li\n      className={cls(\n        styles[\"menu-item\"],\n        disabled && styles[\"menu-item--disabled\"]\n      )}\n    >\n      <AutoPopover placement=\"right-start\" content={content}>\n        <a className={styles[\"menu-item-content\"]}>\n          <span className={styles[\"menu-item-text\"]}>{children}</span>\n          {secondary && (\n            <span className={styles[\"menu-item-secondary\"]}>{secondary}</span>\n          )}\n          <svg className={styles[\"menu-item-icon\"]} width={12} height={12}>\n            <path d=\"M0,0 l6,6 l-6,6 z\" fill=\"black\" strokeWidth={0} />\n          </svg>\n        </a>\n      </AutoPopover>\n    </li>\n  );\n};\n\nexport default SubMenuItem;\n","import * as React from \"react\";\n\nimport { useAction } from \"@/hooks/useAction\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { viewNodeNames } from \"@/actions/view-node-names\";\nimport { resetView } from \"@/actions/view-reset\";\n\nimport { nodeNameModeSelector } from \"@/services/ui-settings/selectors/node-name\";\n\nimport Menu from \"@/components/Menus/Menu\";\nimport CheckboxMenuItemItem from \"@/components/Menus/CheckboxMenuItem\";\nimport SubMenuItem from \"@/components/Menus/SubMenuItem\";\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\nimport MenuItem from \"@/components/Menus/MenuItem\";\n\nconst ViewMenu: React.FC = () => {\n  const onResetView = useAction(resetView);\n  return (\n    <Menu>\n      <SubMenuItem content={<ElementNamesMenu />}>Element Names</SubMenuItem>\n      <DividerMenuItem />\n      <MenuItem onClick={onResetView}>Reset View</MenuItem>\n    </Menu>\n  );\n};\n\nconst ElementNamesMenu: React.FC = () => {\n  const mode = useSelector(nodeNameModeSelector);\n  const onAlwaysVisible = useAction(viewNodeNames, \"all\");\n  const onNamedOnly = useAction(viewNodeNames, \"named-only\");\n  const onHidden = useAction(viewNodeNames, \"none\");\n\n  return (\n    <Menu>\n      <CheckboxMenuItemItem value={mode === \"all\"} onChange={onAlwaysVisible}>\n        Always visible\n      </CheckboxMenuItemItem>\n      <CheckboxMenuItemItem\n        value={mode === \"named-only\"}\n        onChange={onNamedOnly}\n      >\n        Named Items Only\n      </CheckboxMenuItemItem>\n      <CheckboxMenuItemItem value={mode === \"none\"} onChange={onHidden}>\n        Hidden\n      </CheckboxMenuItemItem>\n    </Menu>\n  );\n};\n\nexport default ViewMenu;\n","import { createSimulatorSelector } from \"../utils\";\n\nexport const averageMsecsPerTickSelector = createSimulatorSelector(\n  (state) => state.lastTickProcessingTimeMs\n);\n","// extracted by mini-css-extract-plugin\nexport default {\"icon\":\"icon--3Vly6\"};","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Icons.module.css\";\n\nconst PlayIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => {\n  return (\n    <svg\n      width={16}\n      height={16}\n      {...props}\n      className={cls(styles.icon, props.className)}\n    >\n      <path d=\"M3,0 L13,8 L3,16 z\" />\n    </svg>\n  );\n};\n\nexport default PlayIcon;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Icons.module.css\";\n\nconst StopIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => {\n  return (\n    <svg\n      width={16}\n      height={16}\n      {...props}\n      className={cls(styles.icon, props.className)}\n    >\n      <path d=\"M1,1 L15,1 L15,15 L1,15 z\" />\n    </svg>\n  );\n};\n\nexport default StopIcon;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Icons.module.css\";\n\nconst PauseIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => {\n  return (\n    <svg\n      width={16}\n      height={16}\n      {...props}\n      className={cls(styles.icon, props.className)}\n    >\n      <path d=\"M2.5,1 L6.5,1 L6.5,15 L2.5,15 z M9.5,1 L13.5,1 L13.5,15 L9.5,15 z\" />\n    </svg>\n  );\n};\n\nexport default PauseIcon;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Icons.module.css\";\n\nconst StepIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => {\n  return (\n    <svg\n      width={16}\n      height={16}\n      {...props}\n      className={cls(styles.icon, props.className)}\n    >\n      <path d=\"M3,0 L13,8 L3,16 z M11,1 l2,0 l0,14 l-2,0 z\" />\n    </svg>\n  );\n};\n\nexport default StepIcon;\n","// extracted by mini-css-extract-plugin\nexport default {\"button\":\"button--2N_ol\",\"button-play\":\"button-play--1vWfq\",\"button-stop\":\"button-stop--1dD4-\",\"button-pause\":\"button-pause--1UoHJ\",\"selected\":\"selected--Ev2q8\",\"button-step\":\"button-step--3Fat5\",\"button--disabled\":\"button--disabled--3caLv\",\"simrate\":\"simrate--NKBi_\"};","import SimControls from \"./SimControls\";\nexport default SimControls;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useClickAction } from \"@/hooks/useAction\";\n\nimport { startSim } from \"@/actions/sim-start\";\nimport { stopSim } from \"@/actions/sim-stop\";\nimport { pauseSim } from \"@/actions/sim-pause\";\nimport { stepSim } from \"@/actions/sim-step\";\n\nimport {\n  isSimActiveSelector,\n  isSimPausedSelector,\n} from \"@/services/simulator-control/selectors/run\";\nimport { averageMsecsPerTickSelector } from \"@/services/simulator/selectors/performance\";\n\nimport PlayIcon from \"@/components/Icons/Play\";\nimport StopIcon from \"@/components/Icons/Stop\";\nimport PauseIcon from \"@/components/Icons/Pause\";\nimport StepIcon from \"@/components/Icons/Step\";\n\nimport styles from \"./SimControls.module.css\";\n\nconst PlayPauseButton: React.FC = () => {\n  const isActive = useSelector(isSimActiveSelector);\n  const isPaused = useSelector(isSimPausedSelector);\n\n  const avgMsecsPerTick = useSelector(averageMsecsPerTickSelector);\n\n  const onPlayClick = useClickAction(startSim);\n  const onStopClick = useClickAction(stopSim);\n  const onPauseClick = useClickAction(pauseSim, \"toggle\");\n  const onStepClick = useClickAction(stepSim);\n\n  const onMuteMouseDown = React.useCallback((e: React.MouseEvent) => {\n    // Prevent rapid clicks from selecting nearby text.\n    e.preventDefault();\n  }, []);\n\n  return (\n    <span>\n      {isActive && (\n        <span className={styles[\"simrate\"]}>\n          {avgMsecsPerTick.toFixed(2)} ms\n        </span>\n      )}\n      {isActive ? (\n        <StopIcon\n          id=\"simctrl-stop\"\n          className={cls(styles[\"button\"], styles[\"button-stop\"])}\n          onClick={onStopClick}\n          onMouseDown={onMuteMouseDown}\n        />\n      ) : (\n        <PlayIcon\n          id=\"simctrl-run\"\n          className={cls(styles[\"button\"], styles[\"button-play\"])}\n          onClick={onPlayClick}\n          onMouseDown={onMuteMouseDown}\n        />\n      )}\n      <StepIcon\n        id=\"simctrl-step\"\n        className={cls(styles[\"button\"], styles[\"button-step\"])}\n        onClick={onStepClick}\n        onMouseDown={onMuteMouseDown}\n      />\n      <PauseIcon\n        id=\"simctrl-pause\"\n        className={cls(\n          styles[\"button\"],\n          styles[\"button-pause\"],\n          !isActive && styles[\"button--disabled\"],\n          isPaused && styles[\"selected\"]\n        )}\n        onClick={onPauseClick}\n        onMouseDown={onMuteMouseDown}\n      />\n    </span>\n  );\n};\n\nexport default PlayPauseButton;\n","import ProjectEditorTitleBar from \"./ProjectEditorTitleBar\";\nexport default ProjectEditorTitleBar;\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport {\n  projectModifiedSelector,\n  projectNameSelector,\n} from \"@/services/project/selectors/project\";\n\nimport TitleBar from \"@/components/TitleBar\";\nimport AutoPopover from \"@/components/AutoPopover\";\nimport Button from \"@/components/Button\";\n\nimport FileMenu from \"../FileMenu\";\nimport EditMenu from \"../EditMenu\";\nimport ViewMenu from \"../ViewMenu\";\nimport SimControls from \"../SimControls\";\n\nimport styles from \"./ProjectEditorTitleBar.module.css\";\n\nexport interface ProjectEditorTitleBarProps {\n  className?: string;\n}\nconst ProjectEditorTitleBar: React.FC<ProjectEditorTitleBarProps> = ({\n  className,\n}) => {\n  const projectName = useSelector(projectNameSelector);\n  const projectModified = useSelector(projectModifiedSelector);\n\n  const title = `${projectName}${projectModified ? \"*\" : \"\"}`;\n\n  return (\n    <TitleBar className={className} title={title}>\n      <AutoPopover content={<FileMenu />} placement=\"bottom-start\">\n        <Button variant=\"menu\">File</Button>\n      </AutoPopover>\n      <AutoPopover content={<EditMenu />} placement=\"bottom-start\">\n        <Button variant=\"menu\">Edit</Button>\n      </AutoPopover>\n      <AutoPopover content={<ViewMenu />} placement=\"bottom-start\">\n        <Button variant=\"menu\">View</Button>\n      </AutoPopover>\n      <div className={styles[\"project-titlebar-controls\"]}>\n        <SimControls />\n      </div>\n    </TitleBar>\n  );\n};\n\nexport default ProjectEditorTitleBar;\n","// extracted by mini-css-extract-plugin\nexport default {\"project-titlebar-controls\":\"project-titlebar-controls--1c1Qn\"};","// extracted by mini-css-extract-plugin\nexport default {\"circuit-node-breadcrumb\":\"circuit-node-breadcrumb--3Rx3N\"};","import * as React from \"react\";\nimport last from \"lodash/last\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { viewCircuit } from \"@/actions/view-circuit\";\n\nimport {\n  nodeNameOrDefaultFromNodeIdSelector,\n  nodeTypeFromNodeIdSelector,\n} from \"@/services/node-graph/selectors/nodes\";\nimport { nodeTypeToCircuitId } from \"@/nodes/definitions/integrated-circuits/utils\";\nimport { circuitNameFromIdSelector } from \"@/services/circuits/selectors/circuits\";\nimport { ROOT_CIRCUIT_ID } from \"@/services/circuits/constants\";\n\nimport Button from \"../Button\";\n\nimport styles from \"./CircuitNodeBreadcrumb.module.css\";\n\nexport interface CircuitNodeBreadcrumbProps {\n  circuitId: string;\n  circuitNodeIdPath: string[];\n}\nconst CircuitNodeBreadcrumb: React.FC<CircuitNodeBreadcrumbProps> = ({\n  circuitId,\n  circuitNodeIdPath,\n}) => {\n  const elements: JSX.Element[] = circuitNodeIdPath.map(\n    (circuitNodeId, index) => {\n      const elementPath = circuitNodeIdPath.slice(0, index + 1);\n      return (\n        <React.Fragment key={circuitNodeId}>\n          <span>&gt;</span>\n          <CircuitNodeBreadcrumbItem circuitNodeIdPath={elementPath} />\n        </React.Fragment>\n      );\n    }\n  );\n\n  return (\n    <div\n      className={cls(\n        \"circuit-node-breadcrumb\",\n        styles[\"circuit-node-breadcrumb\"]\n      )}\n    >\n      <CircuitNodeBreadcrumbRootItem\n        circuitId={circuitId}\n        circuitNodeIdPath={circuitNodeIdPath}\n      />\n      {elements}\n    </div>\n  );\n};\n\nexport default CircuitNodeBreadcrumb;\n\ninterface CircuitNodeBreadcrumbRootItemProps {\n  circuitId: string;\n  circuitNodeIdPath: string[];\n}\nconst CircuitNodeBreadcrumbRootItem: React.FC<CircuitNodeBreadcrumbRootItemProps> = ({\n  circuitId,\n  circuitNodeIdPath,\n}) => {\n  const dispatch = useDispatch();\n  const rootCircuitName = useSelector((state) =>\n    circuitNameFromIdSelector(state, ROOT_CIRCUIT_ID)\n  );\n  const circuitName = useSelector((state) =>\n    circuitNameFromIdSelector(state, circuitId)\n  );\n\n  const onClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      dispatch(viewCircuit(ROOT_CIRCUIT_ID, []));\n    },\n    [dispatch]\n  );\n\n  return (\n    <Button size=\"small\" onClick={onClick}>\n      {circuitNodeIdPath.length === 0 ? circuitName : rootCircuitName}\n    </Button>\n  );\n};\n\ninterface CircuitNodeBreadcrumbItemProps {\n  circuitNodeIdPath: string[];\n}\n\nconst CircuitNodeBreadcrumbItem: React.FC<CircuitNodeBreadcrumbItemProps> = ({\n  circuitNodeIdPath,\n}) => {\n  const dispatch = useDispatch();\n  const circuitNodeId = last(circuitNodeIdPath)!;\n\n  const nodeType = useSelector((state) =>\n    nodeTypeFromNodeIdSelector(state, circuitNodeId)\n  );\n  const nodeName = useSelector((state) =>\n    nodeNameOrDefaultFromNodeIdSelector(state, circuitNodeId)\n  );\n\n  const circuitId = nodeType ? nodeTypeToCircuitId(nodeType) : null;\n  const circuitName = useSelector((state) =>\n    circuitId ? circuitNameFromIdSelector(state, circuitId) : null\n  );\n\n  const onClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      if (!circuitId) {\n        return;\n      }\n      dispatch(viewCircuit(circuitId, circuitNodeIdPath));\n    },\n    [circuitId, circuitNodeIdPath, dispatch]\n  );\n\n  return (\n    <Button size=\"small\" onClick={onClick}>\n      {nodeName} [{circuitName}]\n    </Button>\n  );\n};\n","import CircuitNodeBreadcrumb from \"./CircuitNodeBreadcrumb\";\nexport default CircuitNodeBreadcrumb;\n","import { createSelector } from \"reselect\";\nimport values from \"lodash/values\";\n\nimport { Rectangle, union } from \"@/geometry\";\n\nimport { nodeRectsByIdSelector } from \"./node-bounds\";\nimport { wireJointPositionsByJointIdSelector } from \"./wires\";\n\nconst MinFieldRect: Readonly<Rectangle> = Object.freeze({\n  p1: {\n    x: -100,\n    y: -100,\n  },\n  p2: {\n    x: 100,\n    y: 100,\n  },\n});\n\nexport const fieldRectSelector = createSelector(\n  nodeRectsByIdSelector,\n  wireJointPositionsByJointIdSelector,\n  (nodeRectsById, wireJointsById) => {\n    const nodeRects = values(nodeRectsById);\n    const jointRects = values(wireJointsById).map((p) => ({ p1: p, p2: p }));\n\n    return [...nodeRects, ...jointRects].reduce(union, MinFieldRect);\n  }\n);\n","import * as React from \"react\";\nimport { VirtualElement } from \"@popperjs/core\";\n\nimport { Point } from \"@/geometry\";\n\nimport { MenuCloseContextProvider } from \"./Menus/MenuCloseContext\";\n\nimport Popover from \"./Popover\";\n\nexport interface ContextMenuProps {\n  x: number;\n  y: number;\n  open: boolean;\n  onRequestClose(): void;\n}\n\nconst ContextMenu: React.FC<ContextMenuProps> = ({\n  x,\n  y,\n  open,\n  onRequestClose,\n  children,\n}) => {\n  const anchorEl = React.useMemo<VirtualElement>(\n    () => ({\n      getBoundingClientRect: () => ({\n        left: x,\n        top: y,\n        right: x,\n        bottom: y,\n        width: 0,\n        height: 0,\n        x,\n        y,\n      }),\n    }),\n    [x, y]\n  );\n\n  return (\n    <MenuCloseContextProvider value={onRequestClose}>\n      <Popover\n        isOpen={open}\n        onRequestClose={onRequestClose}\n        anchorEl={anchorEl}\n        placement=\"bottom-start\"\n      >\n        {children}\n      </Popover>\n    </MenuCloseContextProvider>\n  );\n};\n\nexport default ContextMenu;\n\nexport interface UseContextMenu {\n  renderContextMenu(content: React.ReactNode): React.ReactNode;\n  openContextMenu(e: React.MouseEvent): void;\n}\nexport function useContextMenu(): UseContextMenu {\n  const [ctxPos, setCtxPos] = React.useState<Point | null>(null);\n\n  const openContextMenu = React.useCallback((e: React.MouseEvent) => {\n    setCtxPos({ x: e.pageX, y: e.pageY });\n  }, []);\n\n  const onCloseContextMenu = React.useCallback(() => {\n    setCtxPos(null);\n  }, []);\n\n  const renderContextMenu = React.useCallback(\n    (content: JSX.Element) => {\n      if (!ctxPos) {\n        return null;\n      }\n\n      return (\n        <ContextMenu\n          open\n          onRequestClose={onCloseContextMenu}\n          x={ctxPos.x}\n          y={ctxPos.y}\n        >\n          {content}\n        </ContextMenu>\n      );\n    },\n    [ctxPos, onCloseContextMenu]\n  );\n\n  return {\n    openContextMenu,\n    renderContextMenu,\n  };\n}\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport MenuItem from \"@/components/Menus/MenuItem\";\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\n\nimport { selectionAlignToGrid } from \"@/actions/selection-align-to-grid\";\nimport { deleteSelection } from \"@/actions/selection-delete\";\n\nconst ContextMenuItems: React.FC = () => {\n  const dispatch = useDispatch();\n\n  const onAlignToGrid = React.useCallback(() => {\n    dispatch(selectionAlignToGrid());\n  }, [dispatch]);\n  const onDelete = React.useCallback(() => {\n    dispatch(deleteSelection());\n  }, [dispatch]);\n  return (\n    <>\n      <MenuItem onClick={onAlignToGrid}>Align Selection To Grid</MenuItem>\n      <DividerMenuItem />\n      <MenuItem onClick={onDelete}>Delete Selected</MenuItem>\n    </>\n  );\n};\n\nexport default ContextMenuItems;\n","import * as React from \"react\";\n\nimport Menu from \"@/components/Menus/Menu\";\n\nimport ContextMenuItems from \"./ContextMenuItems\";\n\nconst FieldContextMenu: React.FC = () => {\n  return (\n    <Menu>\n      <ContextMenuItems />\n    </Menu>\n  );\n};\n\nexport default FieldContextMenu;\n","import { DragObjectWithType } from \"react-dnd\";\n\nexport const NEW_NODE_DRAG_OBJECT = \"@node/new\" as const;\nexport const newNodeDragObject = (nodeType: string) => ({\n  type: NEW_NODE_DRAG_OBJECT,\n  payload: { nodeType },\n});\nexport type NewNodeDragObject = ReturnType<typeof newNodeDragObject>;\nexport function isNewNodeDragObject(\n  item: DragObjectWithType\n): item is NewNodeDragObject {\n  return item.type === NEW_NODE_DRAG_OBJECT;\n}\n","import * as React from \"react\";\n\nexport interface ViewportContext {\n  zoomFactor: number;\n  zoom(factor: number): void;\n}\n\nconst viewportContext = React.createContext<ViewportContext>({\n  zoomFactor: 1,\n  zoom: () => {\n    /* no op */\n  },\n});\n\nexport function useViewportContext(): ViewportContext {\n  return React.useContext(viewportContext);\n}\n\nconst SCALE_FACTOR = 1.03;\n\nexport const ViewportContextProvider: React.FC = ({ children }) => {\n  const [zoomFactor, setZoomFactor] = React.useState(1);\n  const zoom = React.useCallback((delta: number) => {\n    setZoomFactor((zoomFactor) =>\n      delta > 0\n        ? zoomFactor * delta * SCALE_FACTOR\n        : zoomFactor / (-delta * SCALE_FACTOR)\n    );\n  }, []);\n\n  const context = React.useMemo<ViewportContext>(\n    () => ({\n      zoomFactor,\n      zoom,\n    }),\n    [zoom, zoomFactor]\n  );\n  return (\n    <viewportContext.Provider value={context}>\n      {children}\n    </viewportContext.Provider>\n  );\n};\n","import * as React from \"react\";\n\nexport interface FieldSvgElementContext {\n  svgRef: React.RefObject<SVGSVGElement | null>;\n  scalerRef: React.RefObject<SVGGraphicsElement | null>;\n}\nconst nullRef = { current: null };\nexport const fieldSvgElementContext = React.createContext<\n  FieldSvgElementContext\n>({ svgRef: nullRef, scalerRef: nullRef });\n\nconst ContextProvider = fieldSvgElementContext.Provider;\n\nexport const FieldSvgElementProvider: React.FC<{\n  svgRef: React.RefObject<SVGSVGElement | null>;\n  scalerRef: React.RefObject<SVGGraphicsElement | null>;\n}> = ({ svgRef, scalerRef, children }) => {\n  const context = React.useMemo(\n    () => ({\n      svgRef,\n      scalerRef,\n    }),\n    [svgRef, scalerRef]\n  );\n  return <ContextProvider value={context}>{children}</ContextProvider>;\n};\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { circuitEditorStateFromIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nexport interface CircuitEditorContext {\n  editorId: string;\n  circuitId: string;\n  circuitNodeIdPath: string[];\n}\n\nconst circuitEditorContext = React.createContext<CircuitEditorContext>({\n  editorId: \"~none\",\n  circuitId: \"~none\",\n  circuitNodeIdPath: [],\n});\n\nexport function useCircuitEditor(): CircuitEditorContext {\n  return React.useContext(circuitEditorContext);\n}\n\nexport interface CircuitEditorProviderProps {\n  editorId: string;\n}\nexport const CircuitEditorProvider: React.FC<CircuitEditorProviderProps> = ({\n  editorId,\n  children,\n}) => {\n  const editorState = useSelector((state) =>\n    circuitEditorStateFromIdSelector(state, editorId)\n  );\n  const { circuitId, circuitNodeIdPath } = editorState ?? {\n    circuitId: \"~none\",\n    circuitNodeIdPath: [],\n  };\n\n  const context = React.useMemo<CircuitEditorContext>(\n    () => ({\n      editorId,\n      circuitId,\n      circuitNodeIdPath,\n    }),\n    [circuitId, circuitNodeIdPath, editorId]\n  );\n\n  if (!editorState) {\n    return null;\n  }\n\n  return (\n    <circuitEditorContext.Provider value={context}>\n      {children}\n    </circuitEditorContext.Provider>\n  );\n};\n","import { Point } from \"@/geometry\";\n\nexport function getFieldCoord(\n  field: SVGSVGElement,\n  scaler: SVGGraphicsElement,\n  p: Point\n) {\n  const ctm = scaler.getScreenCTM();\n  if (!ctm) {\n    return p;\n  }\n\n  const pt = field.createSVGPoint();\n  pt.x = p.x;\n  pt.y = p.y;\n  const translated = pt.matrixTransform(ctm.inverse());\n  return { x: translated.x, y: translated.y };\n}\n","import * as React from \"react\";\n\nimport { Point, ZeroPoint } from \"@/geometry\";\n\nimport { fieldSvgElementContext } from \"../contexts/fieldSvgElement\";\nimport { getFieldCoord } from \"../../../utils\";\n\nexport function useMouseCoords(): (p: Point) => Point {\n  const { svgRef, scalerRef } = React.useContext(fieldSvgElementContext);\n  return React.useCallback(\n    (p: Point) => {\n      if (!svgRef.current || !scalerRef.current) {\n        return p;\n      }\n      return getFieldCoord(svgRef.current, scalerRef.current, p);\n    },\n    [svgRef, scalerRef]\n  );\n}\n\nexport function useEventMouseCoords(): (\n  e: MouseEvent | React.MouseEvent\n) => Point {\n  const { svgRef, scalerRef } = React.useContext(fieldSvgElementContext);\n  return React.useCallback(\n    (e: MouseEvent | React.MouseEvent) => {\n      if (!svgRef.current || !scalerRef.current) {\n        return ZeroPoint;\n      }\n      const p: Point = {\n        x: e.pageX,\n        y: e.pageY,\n      };\n      return getFieldCoord(svgRef.current, scalerRef.current, p);\n    },\n    [svgRef, scalerRef]\n  );\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"text-unselectable\":\"text-unselectable--2tvXe\"};","import { AppState } from \"@/store\";\n\nimport { getSimulatorNodeIdFromCircuitNodeIdPath } from \"@/services/simulator-graph/utils\";\nimport { rootNodeGraphSelector } from \"@/services/simulator-graph/selectors/graph\";\n\nexport const nodeStateFromCircuitNodeIdSelector = (\n  state: AppState,\n  circuitNodeIdPath: string[]\n) => {\n  const { simulatorNodeIdsByCircuitNodeId } = rootNodeGraphSelector(state);\n  const nodeStatesBySimulatorNodeId =\n    state.services.simulator.nodeStatesByNodeId;\n\n  const simulatorNodeId = getSimulatorNodeIdFromCircuitNodeIdPath(\n    simulatorNodeIdsByCircuitNodeId,\n    circuitNodeIdPath\n  );\n  if (!simulatorNodeId) {\n    return undefined;\n  }\n\n  return nodeStatesBySimulatorNodeId[simulatorNodeId];\n};\n\nexport const nodeOutputsFromCircuitNodeIdSelector = (\n  state: AppState,\n  circuitNodeIdPath: string[]\n) => {\n  const { simulatorNodeIdsByCircuitNodeId } = rootNodeGraphSelector(state);\n  const nodeOutputsBySimulatorNodeId =\n    state.services.simulator.nodeOutputValuesByNodeId;\n\n  const simulatorNodeId = getSimulatorNodeIdFromCircuitNodeIdPath(\n    simulatorNodeIdsByCircuitNodeId,\n    circuitNodeIdPath\n  );\n  if (!simulatorNodeId) {\n    return undefined;\n  }\n\n  return nodeOutputsBySimulatorNodeId[simulatorNodeId];\n};\n","// extracted by mini-css-extract-plugin\nexport default {\"node-interaction-toggle\":\"node-interaction-toggle--1eXWD\",\"node-interaction-momentary\":\"node-interaction-momentary--16GBy\"};","import * as React from \"react\";\n\nimport { NodeComponentType, NodeVisualDefinition } from \"@/nodes/types\";\n\nimport { IntegratedCircuitVisual } from \"./IntegratedCircuitNode\";\nimport { MomentaryInteractionNode } from \"./MomentaryInteractionNode\";\nimport { ToggleInteractionNode } from \"./ToggleInteractionNode\";\n\nconst NamedNodeComponents: Record<string, NodeComponentType> = {\n  \"integrated-circuit\": IntegratedCircuitVisual,\n  \"interaction-momentary\": MomentaryInteractionNode,\n  \"interaction-toggle\": ToggleInteractionNode,\n};\n\nconst ErrorComponent: React.FC<{ componentName: string }> = ({\n  componentName,\n}) => {\n  return (\n    <g>\n      <rect width={50} height={50} fill=\"red\" />\n      <text x={25} y={25} alignmentBaseline=\"middle\">\n        {componentName}\n      </text>\n    </g>\n  );\n};\n\nexport function getNodeVisualElement(\n  circuitNodeId: string | undefined,\n  circuitNodePath: string[] | undefined,\n  elementState: any,\n  visual: NodeVisualDefinition\n): JSX.Element {\n  const { component, componentProps } = visual;\n\n  const nodeProps = {\n    circuitNodeId,\n    circuitNodePath,\n    elementState,\n    ...componentProps,\n  };\n\n  let Component: NodeComponentType;\n  if (typeof component === \"string\") {\n    Component = NamedNodeComponents[component];\n    if (!Component) {\n      // Making a new component here each pass will invalidate the dom on every render,\n      //  but this only is for exceptional error cases anyway.\n      Component = () => <ErrorComponent componentName={component} />;\n    }\n  } else {\n    Component = component;\n  }\n\n  return <Component {...nodeProps} />;\n}\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\n\nimport { viewCircuit } from \"@/actions/view-circuit\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport { circuitNameFromIdSelector } from \"@/services/circuits/selectors/circuits\";\nimport { nodeNamesByNodeIdSelector } from \"@/services/node-graph/selectors/nodes\";\nimport { NodeComponentProps } from \"@/nodes/types\";\n\nimport { getICBorderPath } from \"@/nodes/definitions/integrated-circuits/utils\";\n\nexport interface IntegratedCircuitVisualProps {\n  circuitId: string;\n  inputPinIds: string[];\n  outputPinIds: string[];\n}\n\nexport const IntegratedCircuitVisual: React.FC<\n  IntegratedCircuitVisualProps & NodeComponentProps\n> = ({\n  circuitNodeId,\n  circuitNodePath,\n  circuitId,\n  inputPinIds,\n  outputPinIds,\n}) => {\n  const dispatch = useDispatch();\n  // TODO: Now that we are relying on components being in a tessel path, we\n  // definitely should move node components into children of CircuitEditor\n  // and connect to them from node-types using ids.\n  // More practically: this should ignore tessel path and instead rely on ui-layout\n  // to open us up in the last interacted with view.\n  const circuitName = useSelector((state) =>\n    circuitNameFromIdSelector(state, circuitId)\n  );\n\n  const nodeNamesById = useSelector(nodeNamesByNodeIdSelector);\n\n  const borderPath = getICBorderPath(inputPinIds.length, outputPinIds.length);\n\n  const onViewCircuit = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (!circuitNodeId) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n\n      dispatch(\n        viewCircuit(circuitId, [...(circuitNodePath || []), circuitNodeId])\n      );\n    },\n    [circuitNodeId, dispatch, circuitId, circuitNodePath]\n  );\n\n  const inputPins = inputPinIds.map((pinId, i) => {\n    const y = i * 50 + 25;\n    return (\n      <g key={pinId}>\n        <line\n          className=\"node-select-highlight--stroke\"\n          stroke=\"black\"\n          strokeWidth={2}\n          x1={4}\n          y1={y}\n          x2={10}\n          y2={y}\n        />\n        <text\n          className={interaction[\"text-unselectable\"]}\n          x={15}\n          y={y}\n          alignmentBaseline=\"middle\"\n          fontSize=\".7em\"\n        >\n          {nodeNamesById[pinId]}\n        </text>\n      </g>\n    );\n  });\n\n  const outputPins = outputPinIds.map((pinId, i) => {\n    const y = i * 50 + 25;\n    return (\n      <g key={pinId}>\n        <line\n          key={i}\n          className=\"node-select-highlight--stroke\"\n          stroke=\"black\"\n          strokeWidth={2}\n          x1={90}\n          y1={y}\n          x2={100}\n          y2={y}\n        />\n        <text\n          className={interaction[\"text-unselectable\"]}\n          x={85}\n          y={y}\n          textAnchor=\"end\"\n          alignmentBaseline=\"middle\"\n          fontSize=\".7em\"\n        >\n          {nodeNamesById[pinId]}\n        </text>\n      </g>\n    );\n  });\n\n  return (\n    <g>\n      <text\n        className={cls(\n          interaction[\"text-unselectable\"],\n          \"node-select-highlight--fill\"\n        )}\n        textAnchor=\"middle\"\n        x={50}\n        y={0}\n      >\n        {circuitName}\n      </text>\n      <path\n        className=\"node-select-highlight--stroke node-select-highlight--fill\"\n        stroke=\"black\"\n        fill=\"transparent\"\n        d={borderPath}\n        onDoubleClick={onViewCircuit}\n      />\n      {inputPins}\n      {outputPins}\n    </g>\n  );\n};\n","import React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { interactNode } from \"@/actions/node-interact\";\n\nimport { NodeComponentProps } from \"@/nodes/types\";\nimport { nodeOutputsFromCircuitNodeIdSelector } from \"@/services/simulator/selectors/nodes\";\n\nimport styles from \"./node-visuals.module.css\";\nimport { isSimActiveSelector } from \"@/services/simulator-control/selectors/run\";\n\nexport const MomentaryInteractionNode: React.FC<NodeComponentProps> = ({\n  circuitNodeId,\n  circuitNodePath,\n}) => {\n  const dispatch = useDispatch();\n  const isSimActive = useSelector(isSimActiveSelector);\n\n  const circuitIdPath = React.useMemo(\n    () => [...(circuitNodePath || []), circuitNodeId ?? \"~~none\"],\n    [circuitNodePath, circuitNodeId]\n  );\n\n  const outputs = useSelector((state) =>\n    nodeOutputsFromCircuitNodeIdSelector(state, circuitIdPath)\n  );\n\n  const onPress = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (!isSimActive) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n\n      dispatch(interactNode(circuitIdPath, true));\n    },\n    [circuitIdPath, dispatch, isSimActive]\n  );\n\n  const onRelease = React.useCallback(() => {\n    if (!isSimActive) {\n      return;\n    }\n\n    dispatch(interactNode(circuitIdPath, false));\n  }, [circuitIdPath, dispatch, isSimActive]);\n\n  let onColor = \"darkgreen\";\n  let onTextColor = \"lightgrey\";\n  if (outputs) {\n    if (outputs.OUT) {\n      onColor = \"lightgreen\";\n      onTextColor = \"black\";\n    }\n  }\n\n  return (\n    <g\n      onMouseDown={onPress}\n      onMouseUp={onRelease}\n      onMouseLeave={onRelease}\n      className={styles[\"node-interaction-toggle\"]}\n    >\n      <rect\n        className=\"node-select-highlight--stroke node-select-highlight--fill\"\n        x={5}\n        y={5}\n        width={40}\n        height={40}\n        stroke=\"black\"\n        fill=\"#AFAFAF\"\n        strokeWidth={1}\n      />\n\n      <line x1={45} y1={25} x2={50} y2={25} stroke=\"black\" strokeWidth={2} />\n\n      <circle cx={25} cy={25} r={17} fill={onColor} />\n\n      <text\n        className={interaction[\"text-unselectable\"]}\n        x={25}\n        y={25}\n        fontSize=\".8em\"\n        fill={onTextColor}\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        Push\n      </text>\n    </g>\n  );\n};\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport { interactNode } from \"@/actions/node-interact\";\n\nimport { NodeComponentProps } from \"@/nodes/types\";\n\nimport { ToggleElementState } from \"@/elements/definitions/input-toggle\";\n\nimport styles from \"./node-visuals.module.css\";\n\nexport const ToggleInteractionNode: React.FC<NodeComponentProps<\n  ToggleElementState\n>> = ({ circuitNodeId, circuitNodePath, elementState }) => {\n  const dispatch = useDispatch();\n\n  const onClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (!circuitNodeId) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      e.preventDefault();\n\n      dispatch(interactNode([...(circuitNodePath || []), circuitNodeId]));\n    },\n    [circuitNodeId, dispatch, circuitNodePath]\n  );\n\n  let onColor = \"darkgreen\";\n  let onTextColor = \"lightgrey\";\n  let offColor = \"darkred\";\n  if (elementState) {\n    const { toggleState } = elementState;\n    if (toggleState) {\n      onColor = \"lightgreen\";\n      onTextColor = \"black\";\n    } else {\n      offColor = \"red\";\n    }\n  }\n\n  return (\n    <g onClick={onClick} className={styles[\"node-interaction-toggle\"]}>\n      <rect\n        className=\"node-select-highlight--stroke node-select-highlight--fill\"\n        x={5}\n        y={5}\n        width={40}\n        height={40}\n        stroke=\"black\"\n        fill=\"#AFAFAF\"\n        strokeWidth={1}\n      />\n      <line x1={45} y1={25} x2={50} y2={25} stroke=\"black\" strokeWidth={2} />\n      <rect\n        x={10}\n        y={10}\n        width={30}\n        height={15}\n        strokeWidth={0}\n        fill={onColor}\n      />\n      <text\n        className={interaction[\"text-unselectable\"]}\n        x={25}\n        y={19}\n        fontSize=\".8em\"\n        fill={onTextColor}\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        On\n      </text>\n      <rect\n        x={10}\n        y={25}\n        width={30}\n        height={15}\n        strokeWidth={0}\n        fill={offColor}\n      />\n      <text\n        className={interaction[\"text-unselectable\"]}\n        x={25}\n        y={34}\n        fontSize=\".8em\"\n        fill=\"lightgrey\"\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        Off\n      </text>\n    </g>\n  );\n};\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { nodeDefinitionFromTypeSelector } from \"@/services/node-types/selectors/node-types\";\nimport { getNodeVisualElement } from \"@/nodes/visuals\";\n\nexport interface NodeVisualProps {\n  className?: string;\n  circuitNodeId?: string;\n  x?: number;\n  y?: number;\n  nodeType: string;\n}\n\nconst EmptyState = Object.freeze({});\n\nconst NodeVisual: React.FC<NodeVisualProps> = React.memo(function NodeVisual({\n  className,\n  circuitNodeId,\n  x = 0,\n  y = 0,\n  nodeType,\n}) {\n  const def = useSelector((state) =>\n    nodeDefinitionFromTypeSelector(state, nodeType)\n  );\n\n  let body: React.ReactNode;\n  if (!def) {\n    body = <rect x={x} y={y} width={50} height={50} fill=\"red\" />;\n  } else {\n    body = getNodeVisualElement(circuitNodeId, [], EmptyState, def.visual);\n  }\n\n  const transform = x != 0 || y != 0 ? `translate(${x}, ${y})` : undefined;\n  return (\n    <g className={cls(className, \"node-visual\")} transform={transform}>\n      {body}\n    </g>\n  );\n});\n\nexport default NodeVisual;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useDrop } from \"react-dnd\";\n\nimport { Point, snapPoint } from \"@/geometry\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { addNode } from \"@/actions/node-add\";\n\nimport { nodeTypeToCircuitId } from \"@/nodes/definitions/integrated-circuits/utils\";\n\nimport { gridNodeSnapSelector } from \"@/services/circuit-editor-drag/selectors/snap\";\nimport { circuitWouldRecurseSelector } from \"@/services/circuits/selectors/circuits\";\n\nimport {\n  isNewNodeDragObject,\n  NEW_NODE_DRAG_OBJECT,\n} from \"../../../drag-items/new-node\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport { useMouseCoords } from \"../hooks/useMouseCoords\";\n\nimport NodeVisual from \"./NodeVisual\";\n\nconst DragNewNodeLayer: React.FC = React.memo(function DragNewNodeLayer() {\n  const dispatch = useDispatch();\n  const { circuitId } = useCircuitEditor();\n  const snap = useSelector(gridNodeSnapSelector);\n  const getMouseCoords = useMouseCoords();\n\n  const [dragType, setDragType] = React.useState<string | null>(null);\n  const [dragPos, setDragPos] = React.useState<Point | null>(null);\n\n  const dropTargetWouldRecurse = useSelector((state) =>\n    circuitWouldRecurseSelector(state, nodeTypeToCircuitId(dragType), circuitId)\n  );\n\n  const [, dropRef] = useDrop(\n    {\n      accept: NEW_NODE_DRAG_OBJECT,\n      collect: (monitor) => {\n        // We need to clear this out on mouse out\n        if (!monitor.isOver()) {\n          setDragPos(null);\n          setDragType(null);\n        }\n      },\n      hover: (item, monitor) => {\n        if (!isNewNodeDragObject(item)) {\n          setDragPos(null);\n          setDragType(null);\n          return;\n        }\n\n        const pos = monitor.getClientOffset();\n        if (!pos) {\n          return;\n        }\n        const coords = getMouseCoords({ x: pos.x, y: pos.y });\n        setDragType(item.payload.nodeType);\n        setDragPos(coords);\n      },\n      drop: (item, monitor) => {\n        if (!isNewNodeDragObject(item)) {\n          return;\n        }\n\n        if (dropTargetWouldRecurse) {\n          return;\n        }\n\n        const pos = monitor.getClientOffset();\n        if (!pos) {\n          return;\n        }\n        const coords = getMouseCoords({ x: pos.x, y: pos.y });\n        dispatch(\n          addNode(item.payload.nodeType, circuitId, snapPoint(coords, snap))\n        );\n      },\n    },\n    [circuitId, getMouseCoords, snap, dropTargetWouldRecurse]\n  );\n\n  const snapDragPos = dragPos && snapPoint(dragPos, snap);\n\n  return (\n    <g id=\"drag-new-node-layer\">\n      {!dropTargetWouldRecurse && snapDragPos && dragType && (\n        <g opacity={0.5}>\n          <NodeVisual x={snapDragPos.x} y={snapDragPos.y} nodeType={dragType} />\n        </g>\n      )}\n      {dropTargetWouldRecurse && (\n        <g>\n          <rect width=\"100%\" height=\"100%\" opacity={0.7} fill=\"black\" />\n          {/* FIXME: Should center this text in the screen viewport. */}\n          <text x=\"100\" y=\"25%\" fill=\"white\">\n            The current circuit is already inside the dragged IC.\n          </text>\n        </g>\n      )}\n      <rect ref={dropRef} width=\"100%\" height=\"100%\" fill=\"transparent\" />\n    </g>\n  );\n});\n\nexport default DragNewNodeLayer;\n","import { createSelector } from \"reselect\";\n\nimport { AppState } from \"@/store\";\n\nimport {\n  normalizeRectangle,\n  Point,\n  pointEquals,\n  pointSubtract,\n} from \"@/geometry\";\n\nimport { selectedNodeIdsSelector } from \"@/services/selection/selectors/selection\";\nimport { nodePinFromPointSelector } from \"@/services/node-layout/selectors/node-pin-positions\";\nimport { circuitIdForEditorIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nimport { createCircuitEditorDragSelector } from \"../utils\";\nimport { CircuitEditorDragServiceState } from \"../state\";\n\nimport { gridJointSnapSelector, gridNodeSnapSelector } from \"./snap\";\n\nexport const dragModeSelector = createCircuitEditorDragSelector(\n  (s) => s.dragMode\n);\n\nexport const isEditorDraggingSelector = createCircuitEditorDragSelector(\n  (s: CircuitEditorDragServiceState, editorId: string) => {\n    if (s.dragMode == null) {\n      return false;\n    }\n\n    // TODO: Allow dragging in dragEndEditorId if dragMode is move.\n    if (s.dragStartEditorId !== s.dragEndEditorId) {\n      return false;\n    }\n\n    return s.dragStartEditorId === editorId;\n  }\n);\n\nexport const isDraggingSelector = createCircuitEditorDragSelector(\n  (s) => s.dragMode != null\n);\n\nexport const dragStartSelector = createCircuitEditorDragSelector((s) => {\n  if (!s.dragMode) {\n    return null;\n  }\n\n  return s.dragStart;\n});\n\nexport const dragEndSelector = createCircuitEditorDragSelector((s) => {\n  if (!s.dragMode) {\n    return null;\n  }\n\n  return s.dragEnd;\n});\n\nexport const selectionRectSelector = createCircuitEditorDragSelector(\n  createSelector(\n    dragModeSelector.local,\n    dragStartSelector.local,\n    dragEndSelector.local,\n    (dragMode, dragStart, dragEnd) =>\n      dragMode === \"select\" && dragStart && dragEnd\n        ? normalizeRectangle(dragStart, dragEnd)\n        : null\n  )\n);\n\nlet cachedDragMoveOffset: Point | null = null;\nexport const dragMoveOffsetSelector = (state: AppState) => {\n  const dragState = state.services.circuitEditorDrag;\n  if (dragState.dragMode !== \"move\") {\n    return null;\n  }\n\n  const selectedNodeIds = selectedNodeIdsSelector(state);\n\n  let gridSnap: number;\n  if (selectedNodeIds.length > 0) {\n    gridSnap = gridNodeSnapSelector(state);\n  } else {\n    gridSnap = gridJointSnapSelector(state);\n  }\n\n  const { dragStart, dragEnd, dragModifierKeys } = dragState;\n  if (!dragEnd) {\n    return null;\n  }\n\n  const offset = pointSubtract(dragEnd, dragStart);\n  if (!dragModifierKeys.ctrlMetaKey) {\n    offset.x = Math.round(offset.x / gridSnap) * gridSnap;\n    offset.y = Math.round(offset.y / gridSnap) * gridSnap;\n  }\n\n  if (!cachedDragMoveOffset || !pointEquals(offset, cachedDragMoveOffset)) {\n    cachedDragMoveOffset = offset;\n  }\n\n  return cachedDragMoveOffset;\n};\n\nexport const dragNewJointPositionSelector = createCircuitEditorDragSelector(\n  (state) => {\n    const gridSnap = gridJointSnapSelector.local(state);\n    if (state.dragMode !== \"new-joint\") {\n      return null;\n    }\n\n    const { dragEnd, dragModifierKeys } = state;\n    if (!dragEnd || !dragModifierKeys) {\n      return null;\n    }\n\n    const position = { ...dragEnd };\n    if (!dragModifierKeys.ctrlMetaKey) {\n      position.x = Math.round(position.x / gridSnap) * gridSnap;\n      position.y = Math.round(position.y / gridSnap) * gridSnap;\n    }\n\n    return position;\n  }\n);\n\nexport const dragDropTargetPinSelector = (state: AppState) => {\n  const dragState = state.services.circuitEditorDrag;\n  if (dragState.dragMode !== \"wire\") {\n    return null;\n  }\n\n  const { dragEnd, dragStartEditorId } = dragState;\n  if (!dragEnd) {\n    return null;\n  }\n\n  const circuitId = circuitIdForEditorIdSelector(state, dragStartEditorId);\n  if (!circuitId) {\n    return null;\n  }\n\n  return nodePinFromPointSelector(state, dragEnd, circuitId);\n};\n","import * as React from \"react\";\n\nimport pick from \"lodash/pick\";\nimport mapValues from \"lodash/mapValues\";\nimport values from \"lodash/values\";\n\nimport { createSelector } from \"reselect\";\n\nimport { nodeTypesByNodeIdSelector } from \"@/services/node-graph/selectors/nodes\";\nimport { nodePositionsByNodeIdSelector } from \"@/services/node-layout/selectors/node-positions\";\nimport { selectedNodeIdsSelector } from \"@/services/selection/selectors/selection\";\nimport {\n  dragMoveOffsetSelector,\n  isEditorDraggingSelector,\n} from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport NodeVisual from \"./NodeVisual\";\n\nconst selectedNodePositionsByIdSelector = createSelector(\n  selectedNodeIdsSelector,\n  nodePositionsByNodeIdSelector,\n  (selectedNodeIds, nodePositionsById) =>\n    pick(nodePositionsById, selectedNodeIds)\n);\n\nconst selectedNodeTypesByIdSelector = createSelector(\n  selectedNodeIdsSelector,\n  nodeTypesByNodeIdSelector,\n  (selectedNodeIds, nodeTypesById) => pick(nodeTypesById, selectedNodeIds)\n);\n\nconst DragNodePreviewLayer: React.FC = React.memo(\n  function DragNodePreviewLayer() {\n    const { editorId } = useCircuitEditor();\n\n    const isDragging = useSelector((state) =>\n      isEditorDraggingSelector(state, editorId)\n    );\n\n    const selectedNodePositionsById = useSelector(\n      selectedNodePositionsByIdSelector\n    );\n    const selectedNodeTypesById = useSelector(selectedNodeTypesByIdSelector);\n    const dragMoveOffset = useSelector(dragMoveOffsetSelector);\n\n    if (!isDragging || !dragMoveOffset) {\n      return null;\n    }\n\n    let elements: React.ReactNode | null = null;\n    if (dragMoveOffset) {\n      elements = values(\n        mapValues(selectedNodePositionsById, (p, nodeId) => (\n          <NodeVisual\n            key={nodeId}\n            nodeType={selectedNodeTypesById[nodeId]}\n            x={p.x + dragMoveOffset.x}\n            y={p.y + dragMoveOffset.y}\n          />\n        ))\n      );\n    }\n    return (\n      <g id=\"drag-node-preview-layer\" opacity={0.3}>\n        {elements}\n      </g>\n    );\n  }\n);\n\nexport default DragNodePreviewLayer;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./WireJointVisual.module.css\";\n\ninterface WireJointVisualProps extends React.SVGProps<SVGCircleElement> {\n  x: number;\n  y: number;\n  interactable?: boolean;\n  selected?: boolean;\n}\n\nconst WireJointVisual: React.FC<WireJointVisualProps> = ({\n  x,\n  y,\n  interactable = true,\n  selected = false,\n  ...props\n}) => {\n  const [mouseOver, setMouseOver] = React.useState(false);\n\n  const onMouseOver = React.useCallback(() => {\n    if (!interactable) {\n      return;\n    }\n    setMouseOver(true);\n  }, [interactable]);\n\n  const onMouseOut = React.useCallback(() => {\n    setMouseOver(false);\n  }, []);\n\n  return (\n    <circle\n      className={cls(styles[\"wire-joint\"], selected && styles[\"selected\"])}\n      cx={x}\n      cy={y}\n      r={(interactable && mouseOver) || selected ? 4 : 2}\n      onMouseOver={onMouseOver}\n      onMouseOut={onMouseOut}\n      {...props}\n    />\n  );\n};\n\nexport default WireJointVisual;\n","import WireJointVisual from \"./WireJointVisual\";\nexport default WireJointVisual;\n","// extracted by mini-css-extract-plugin\nexport default {\"wire-joint\":\"wire-joint--3o_SE\",\"selected\":\"selected--33Nsw\"};","import * as React from \"react\";\nimport { createSelector } from \"reselect\";\nimport pick from \"lodash/pick\";\nimport values from \"lodash/values\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport {\n  dragMoveOffsetSelector,\n  dragNewJointPositionSelector,\n  isEditorDraggingSelector,\n} from \"@/services/circuit-editor-drag/selectors/drag\";\nimport { selectedJointIdsSelector } from \"@/services/selection/selectors/selection\";\nimport { wireJointPositionsByJointIdSelector } from \"@/services/node-layout/selectors/wires\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport WireJointVisual from \"./WireJointVisual\";\n\nconst selectedJointPositionsByIdSelector = createSelector(\n  selectedJointIdsSelector,\n  wireJointPositionsByJointIdSelector,\n  (selectedJointIds, jointPositionsById) =>\n    pick(jointPositionsById, selectedJointIds)\n);\n\nconst DragJointPreviewLayer: React.FC = React.memo(\n  function DragJointPreviewLayer() {\n    const { editorId } = useCircuitEditor();\n\n    const isDragging = useSelector((state) =>\n      isEditorDraggingSelector(state, editorId)\n    );\n\n    const dragMoveOffset = useSelector(dragMoveOffsetSelector);\n    const selectedNodePositionsById = useSelector(\n      selectedJointPositionsByIdSelector\n    );\n\n    const newJointPosition = useSelector(dragNewJointPositionSelector);\n\n    if (!isDragging || (!dragMoveOffset && !newJointPosition)) {\n      return null;\n    }\n\n    let elements: React.ReactNode | null = null;\n    if (dragMoveOffset) {\n      elements = values(selectedNodePositionsById).map((p, index) => (\n        <WireJointVisual\n          key={index}\n          interactable={false}\n          x={p.x + dragMoveOffset.x}\n          y={p.y + dragMoveOffset.y}\n          opacity={0.5}\n        />\n      ));\n    }\n\n    let newJointElement: React.ReactNode | null = null;\n    if (newJointPosition) {\n      newJointElement = (\n        <WireJointVisual\n          interactable={false}\n          x={newJointPosition.x}\n          y={newJointPosition.y}\n          opacity={0.5}\n        />\n      );\n    }\n\n    // TODO: Draw transparent lines connecting the joint.\n\n    return (\n      <g id=\"drag-joint-preview-layer\" opacity={0.3}>\n        {elements}\n        {newJointElement}\n      </g>\n    );\n  }\n);\n\nexport default DragJointPreviewLayer;\n","import { Point } from \"@/geometry\";\nimport * as React from \"react\";\n\nexport interface UseMouseDragDetector {\n  startTracking(e: React.MouseEvent): void;\n}\n\nexport interface UseMouseDragDetectorOpts {\n  dragThreshold?: number;\n  onClick?(e: MouseEvent): void;\n  onDragStart?(e: MouseEvent, originalCoords: Point): void;\n}\nexport function useMouseDragDetector({\n  dragThreshold = 5,\n  onClick,\n  onDragStart,\n}: UseMouseDragDetectorOpts): UseMouseDragDetector {\n  // We need both state and ref for this.\n  //  State lets us trigger a rerender / useEffect.\n  //  Ref lets us check for cancellation when handling document events.\n  //  We seem to get a few rogue onMouseMove events after we try to stop tracking.\n  const [isTracking, setTracking] = React.useState(false);\n  const mouseDownRef = React.useRef<Point | null>(null);\n\n  const onMouseDown = React.useCallback((e: React.MouseEvent) => {\n    if (!e.preventDefault) {\n      return;\n    }\n\n    setTracking(true);\n    mouseDownRef.current = { x: e.pageX, y: e.pageY };\n  }, []);\n\n  const onMouseMove = React.useCallback(\n    (e: MouseEvent) => {\n      if (!mouseDownRef.current) {\n        return;\n      }\n\n      const d = mouseDownRef.current;\n      if (\n        Math.abs(d.x - e.pageX) >= dragThreshold ||\n        Math.abs(d.y - e.pageY) >= dragThreshold\n      ) {\n        if (onDragStart) {\n          onDragStart(e, mouseDownRef.current);\n        }\n        setTracking(false);\n        mouseDownRef.current = null;\n      }\n    },\n    [dragThreshold, onDragStart]\n  );\n\n  const onMouseUp = React.useCallback(\n    (e: MouseEvent) => {\n      if (!mouseDownRef.current) {\n        return;\n      }\n\n      if (onClick) {\n        onClick(e);\n      }\n\n      setTracking(false);\n      mouseDownRef.current = null;\n    },\n    [onClick]\n  );\n\n  React.useEffect(() => {\n    if (!isTracking) {\n      return;\n    }\n\n    document.addEventListener(\"mousemove\", onMouseMove);\n    document.addEventListener(\"mouseup\", onMouseUp);\n\n    return () => {\n      document.removeEventListener(\"mousemove\", onMouseMove);\n      document.removeEventListener(\"mouseup\", onMouseUp);\n    };\n  }, [isTracking, onMouseMove, onMouseUp]);\n\n  return {\n    startTracking: onMouseDown,\n  };\n}\n","import { keyboardIsMac } from \"./runtime-env\";\n\nexport const MODIFIER_KEYS_NONE = Object.freeze<ModifierKeys>({});\n\nexport interface ModifierKeys {\n  ctrlMetaKey?: boolean;\n  shiftKey?: boolean;\n  altKey?: boolean;\n}\n\nexport interface MouseEventModifierKeys {\n  ctrlKey: boolean;\n  altKey: boolean;\n  shiftKey: boolean;\n  metaKey: boolean;\n}\nexport function getModifiers(e: MouseEventModifierKeys): ModifierKeys {\n  const { ctrlKey, altKey, shiftKey, metaKey } = e;\n  return {\n    // Mac reserves ctrl for system use, apps use meta.\n    ctrlMetaKey: keyboardIsMac ? metaKey : ctrlKey,\n    altKey,\n    shiftKey,\n  };\n}\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { Point } from \"@/geometry\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useMouseDragDetector } from \"@/hooks/useMouseDragDetector\";\n\nimport { getModifiers } from \"@/modifier-keys\";\n\nimport {\n  isEditorDraggingSelector,\n  selectionRectSelector,\n} from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport { clearSelection } from \"@/actions/select-clear\";\nimport { circuitEditorDragStartSelect } from \"@/actions/circuit-editor-drag-start-select\";\n\nimport { useViewportContext } from \"../../../contexts/viewport-context\";\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport { useMouseCoords } from \"../hooks/useMouseCoords\";\n\nconst DragSelectLayer: React.FC = React.memo(function DragSelectLayer() {\n  const dispatch = useDispatch();\n  const { editorId } = useCircuitEditor();\n  const { zoomFactor } = useViewportContext();\n\n  const isDragging = useSelector((state) =>\n    isEditorDraggingSelector(state, editorId)\n  );\n\n  const selectionRect = useSelector(selectionRectSelector);\n\n  function counterScale(value: number) {\n    return value * (1 / zoomFactor);\n  }\n\n  const getCoords = useMouseCoords();\n\n  const onClick = React.useCallback(\n    (e: MouseEvent) => {\n      if (e.button !== 0) {\n        return;\n      }\n      const modifiers = getModifiers(e);\n      if (!modifiers.ctrlMetaKey && !modifiers.shiftKey) {\n        dispatch(clearSelection());\n      }\n    },\n    [dispatch]\n  );\n\n  const onDragStart = React.useCallback(\n    (e: MouseEvent, originalPoint: Point) => {\n      const p = getCoords(originalPoint);\n      const modifierKeys = getModifiers(e);\n      dispatch(circuitEditorDragStartSelect(p, modifierKeys, editorId));\n    },\n    [dispatch, editorId, getCoords]\n  );\n\n  const { startTracking: onMouseDown } = useMouseDragDetector({\n    onClick,\n    onDragStart,\n  });\n\n  return (\n    <g>\n      <rect\n        /*\n         Our width and height get scaled by the parent scaler.\n         We have to be inside the parent scaler to make our mouse coordinate values match up.\n         Scale us back out so we continue to cover the whole screen.\n         */\n        width={`${counterScale(1) * 100}%`}\n        height={`${counterScale(1) * 100}%`}\n        fill=\"transparent\"\n        onMouseDown={onMouseDown}\n      />\n      {isDragging && selectionRect && (\n        <g\n          transform={`translate(${selectionRect.p1.x}, ${selectionRect.p1.y})`}\n        >\n          <rect\n            width={selectionRect.p2.x - selectionRect.p1.x}\n            height={selectionRect.p2.y - selectionRect.p1.y}\n            strokeWidth={counterScale(2)}\n            strokeDasharray={`${counterScale(5)} ${counterScale(3)}`}\n            stroke=\"skyblue\"\n            fill=\"transparent\"\n          />\n        </g>\n      )}\n    </g>\n  );\n});\n\nexport default DragSelectLayer;\n","import * as React from \"react\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nimport { useViewportContext } from \"../../../contexts/viewport-context\";\n\nconst GridBackground: React.FC = React.memo(function GridBackground() {\n  const [gridId] = React.useState(`grid-${uuidV4()}`);\n  const { zoomFactor } = useViewportContext();\n\n  const gridSize = 50 * zoomFactor;\n\n  return (\n    <svg width=\"100%\" height=\"100%\" xmlns=\"http://www.w3.org/2000/svg\">\n      <defs>\n        <pattern\n          id={gridId}\n          width={gridSize}\n          height={gridSize}\n          patternUnits=\"userSpaceOnUse\"\n        >\n          <path\n            d={`M ${gridSize} 0 L 0 0 0 ${gridSize}`}\n            fill=\"none\"\n            stroke=\"gray\"\n            strokeWidth={0.5}\n          />\n        </pattern>\n      </defs>\n\n      <rect width=\"100%\" height=\"100%\" fill={`url(#${gridId})`} />\n    </svg>\n  );\n});\n\nexport default GridBackground;\n","import * as React from \"react\";\n\nexport interface AtomicTextInputProps {\n  className?: string;\n  autoFocus?: boolean;\n  defaultValue?: string;\n  value?: string;\n  onChange?(e: React.ChangeEvent<HTMLInputElement>): void;\n  onBeginEdit?(): void;\n  onCommit?(value: string): void;\n  onCancel?(): void;\n  onKeyUp?(e: React.KeyboardEvent<HTMLInputElement>): void;\n  onBlur?(e: React.FocusEvent<HTMLInputElement>): void;\n}\n\nconst AtomicTextInput = React.forwardRef<\n  HTMLInputElement,\n  AtomicTextInputProps\n>(\n  (\n    {\n      className,\n      autoFocus,\n      defaultValue,\n      value,\n      onChange,\n      onBeginEdit,\n      onCommit,\n      onCancel,\n      onBlur,\n      onKeyUp,\n    },\n    ref\n  ) => {\n    const [editValue, setEditValue] = React.useState<string | null>(null);\n\n    const onInputChange = React.useCallback(\n      (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (editValue == null && onBeginEdit) {\n          onBeginEdit();\n        }\n\n        setEditValue(e.target.value);\n\n        if (onChange) {\n          onChange(e);\n        }\n      },\n      [editValue, onBeginEdit, onChange]\n    );\n\n    const onInputKeyUp = React.useCallback(\n      (e: React.KeyboardEvent<HTMLInputElement>) => {\n        if (onKeyUp) {\n          onKeyUp(e);\n        }\n        if (e.defaultPrevented) {\n          return;\n        }\n\n        if (editValue == null) {\n          return;\n        }\n\n        if (e.key === \"Escape\") {\n          e.preventDefault();\n          if (onCancel) {\n            onCancel();\n          }\n        } else if (e.key === \"Enter\") {\n          e.preventDefault();\n          if (onCommit) {\n            onCommit(editValue);\n          }\n        }\n      },\n      [onKeyUp, editValue, onCancel, onCommit]\n    );\n\n    const onInputBlur = React.useCallback(\n      (e: React.FocusEvent<HTMLInputElement>) => {\n        if (onBlur) {\n          onBlur(e);\n        }\n\n        if (editValue != null && onCommit) {\n          onCommit(editValue);\n        }\n      },\n      [onBlur, editValue, onCommit]\n    );\n\n    return (\n      <input\n        ref={ref}\n        className={className}\n        autoFocus={autoFocus}\n        defaultValue={defaultValue}\n        value={value}\n        type=\"text\"\n        onChange={onInputChange}\n        onKeyUp={onInputKeyUp}\n        onBlur={onInputBlur}\n      />\n    );\n  }\n);\n\nexport default AtomicTextInput;\n","import { cls } from \"@/utils\";\nimport * as React from \"react\";\nimport AtomicTextInput from \"./AtomicTextInput\";\n\nexport interface EditableTextProps {\n  className?: string;\n  textClassname?: string;\n  inputClassname?: string;\n  label?: JSX.Element;\n  defaultValue: string;\n  isEditing: boolean;\n  onRequestEdit?(): void;\n  onCommit(value: string): void;\n  onCancel(): void;\n}\n\nconst EditableText: React.FC<EditableTextProps> = ({\n  className,\n  textClassname,\n  inputClassname,\n  label,\n  defaultValue,\n  isEditing,\n  onRequestEdit,\n  onCommit,\n  onCancel,\n}) => {\n  const inputRef = React.useRef<HTMLInputElement | null>(null);\n\n  const onSpanDoubleClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (!onRequestEdit) {\n        return;\n      }\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n      onRequestEdit();\n    },\n    [onRequestEdit]\n  );\n\n  // AtomicTextInput enters editing mode when the user changes something.\n  // It will not call cancel on blur.\n  // We want to exit when blurred\n  const onKeyUp = React.useCallback(\n    (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === \"Escape\" && isEditing) {\n        onCancel();\n      }\n    },\n    [isEditing, onCancel]\n  );\n\n  const onBlur = React.useCallback(() => {\n    if (isEditing) {\n      onCancel();\n    }\n  }, [isEditing, onCancel]);\n\n  React.useEffect(() => {\n    if (isEditing && inputRef.current) {\n      inputRef.current.select();\n    }\n  }, [isEditing]);\n\n  if (!isEditing) {\n    return (\n      <span\n        className={cls(className, textClassname)}\n        onDoubleClick={onSpanDoubleClick}\n      >\n        {label ?? defaultValue}\n      </span>\n    );\n  }\n\n  return (\n    <AtomicTextInput\n      ref={inputRef}\n      className={cls(className, inputClassname)}\n      autoFocus\n      defaultValue={defaultValue}\n      onBlur={onBlur}\n      onKeyUp={onKeyUp}\n      onCommit={onCommit}\n      onCancel={onCancel}\n    />\n  );\n};\n\nexport default EditableText;\n","import * as React from \"react\";\n\nimport EditableText, { EditableTextProps } from \"../EditableText\";\n\nimport { useMenuCloseContext } from \"./MenuCloseContext\";\n\nimport styles from \"./Menus.module.css\";\n\nexport type EditableTextMenuItemProps = EditableTextProps;\nconst EditableTextMenuItem: React.FC<EditableTextMenuItemProps> = (props) => {\n  const { onRequestEdit, onCommit } = props;\n\n  const requestMenuClose = useMenuCloseContext();\n\n  const onClick = React.useCallback(() => {\n    if (onRequestEdit) {\n      onRequestEdit();\n    }\n  }, [onRequestEdit]);\n\n  const onEditableCommit = React.useCallback(\n    (value: string) => {\n      onCommit(value);\n      requestMenuClose();\n    },\n    [onCommit, requestMenuClose]\n  );\n\n  return (\n    <li className={styles[\"menu-item\"]} onClick={onClick}>\n      <EditableText {...props} onCommit={onEditableCommit} />\n    </li>\n  );\n};\n\nexport default EditableTextMenuItem;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { nodeTypeToCircuitId } from \"@/nodes/definitions/integrated-circuits/utils\";\n\nimport { renameNode } from \"@/actions/node-rename\";\nimport { viewCircuit } from \"@/actions/view-circuit\";\n\nimport {\n  nodeNameOrDefaultFromNodeIdSelector,\n  nodeTypeFromNodeIdSelector,\n} from \"@/services/node-graph/selectors/nodes\";\n\nimport Menu from \"@/components/Menus/Menu\";\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\nimport EditableTextMenuItem from \"@/components/Menus/EditableTextMenuItem\";\nimport MenuItem from \"@/components/Menus/MenuItem\";\n\nimport ContextMenuItems from \"../../ContextMenuItems\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nexport interface NodeContextMenuProps {\n  nodeId: string;\n}\n\nconst NodeContextMenu: React.FC<NodeContextMenuProps> = ({ nodeId }) => {\n  const dispatch = useDispatch();\n\n  const { circuitNodeIdPath } = useCircuitEditor();\n\n  const nodeName = useSelector((state) =>\n    nodeNameOrDefaultFromNodeIdSelector(state, nodeId)\n  );\n  const nodeType = useSelector((state) =>\n    nodeTypeFromNodeIdSelector(state, nodeId)\n  );\n  const nodeCircuitId = nodeType ? nodeTypeToCircuitId(nodeType) : null;\n\n  const [isRenaming, setIsRenaming] = React.useState(false);\n  const onRename = React.useCallback(() => {\n    setIsRenaming(true);\n  }, []);\n  const onRenameCancel = React.useCallback(() => {\n    setIsRenaming(false);\n  }, []);\n  const onRenameCommit = React.useCallback(\n    (value: string) => {\n      setIsRenaming(false);\n      dispatch(renameNode(nodeId, value));\n    },\n    [dispatch, nodeId]\n  );\n\n  const onOpenCircuitInNewWindow = React.useCallback(() => {\n    if (!nodeCircuitId) {\n      return;\n    }\n    dispatch(\n      viewCircuit(nodeCircuitId, [...circuitNodeIdPath, nodeId], {\n        newWindow: true,\n      })\n    );\n  }, [circuitNodeIdPath, dispatch, nodeCircuitId, nodeId]);\n\n  return (\n    <Menu>\n      <EditableTextMenuItem\n        defaultValue={nodeName ?? \"<unknown>\"}\n        label={<span style={{ fontWeight: \"bold\" }}>{nodeName}</span>}\n        isEditing={isRenaming}\n        onRequestEdit={onRename}\n        onCommit={onRenameCommit}\n        onCancel={onRenameCancel}\n      />\n      <DividerMenuItem />\n      {nodeCircuitId && (\n        <>\n          <MenuItem onClick={onOpenCircuitInNewWindow}>\n            Open in New Window\n          </MenuItem>\n          <DividerMenuItem />\n        </>\n      )}\n      <ContextMenuItems />\n    </Menu>\n  );\n};\n\nexport default NodeContextMenu;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\nimport { Point, Rectangle, ZeroPoint } from \"@/geometry\";\nimport { getModifiers } from \"@/modifier-keys\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport { getNodeVisualElement } from \"@/nodes/visuals\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useMouseDragDetector } from \"@/hooks/useMouseDragDetector\";\n\nimport { nodeStateFromCircuitNodeIdSelector } from \"@/services/simulator/selectors/nodes\";\nimport { isNodeSelectedFromNodeIdSelector } from \"@/services/selection/selectors/selection\";\nimport { nodePositionFromNodeIdSelector } from \"@/services/node-layout/selectors/node-positions\";\nimport { isSimActiveSelector } from \"@/services/simulator-control/selectors/run\";\nimport { nodeDefFromNodeIdSelector } from \"@/services/node-graph/selectors/node-def\";\nimport { nodeFieldDisplayNameFromNodeId } from \"@/services/ui-settings/selectors/node-name\";\n\nimport { circuitEditorDragStartNode } from \"@/actions/circuit-editor-drag-start-node\";\nimport { selectNodes } from \"@/actions/select-nodes\";\n\nimport { useContextMenu } from \"@/components/ContextMenu\";\n\nimport { useCircuitEditor } from \"../../../../contexts/circuit-editor-context\";\nimport { useViewportContext } from \"../../../../contexts/viewport-context\";\n\nimport { useMouseCoords } from \"../../hooks/useMouseCoords\";\n\nimport NodeContextMenu from \"../NodeContextMenu\";\n\nimport \"./Node.module.css\";\n\nexport interface NodeProps {\n  nodeId: string;\n}\n\nconst Node: React.FC<NodeProps> = React.memo(function Node({ nodeId }) {\n  const dispatch = useDispatch();\n  const { editorId, circuitNodeIdPath } = useCircuitEditor();\n  const isSimActive = useSelector(isSimActiveSelector);\n\n  const { openContextMenu, renderContextMenu } = useContextMenu();\n\n  const def = useSelector((state) => nodeDefFromNodeIdSelector(state, nodeId));\n  const { x, y } = useSelector((s) =>\n    nodePositionFromNodeIdSelector(s, nodeId)\n  );\n  const nodeState = useSelector((s) =>\n    nodeStateFromCircuitNodeIdSelector(s, [...circuitNodeIdPath, nodeId])\n  );\n  const isSelected = useSelector((s) =>\n    isNodeSelectedFromNodeIdSelector(s, nodeId)\n  );\n\n  const getCoords = useMouseCoords();\n\n  const onClick = React.useCallback(\n    (e: MouseEvent) => {\n      if (isSimActive) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      if (e.button !== 0) {\n        return;\n      }\n\n      e.preventDefault();\n\n      const modifiers = getModifiers(e);\n      const selectionMode = getSelectMode(modifiers);\n      dispatch(selectNodes(nodeId, selectionMode));\n    },\n    [dispatch, isSimActive, nodeId]\n  );\n\n  const onContextMenu = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n\n      const modifiers = getModifiers(e);\n      const selectionMode = getSelectMode(modifiers, \"set-if-unselected\");\n      dispatch(selectNodes(nodeId, selectionMode));\n      openContextMenu(e);\n    },\n    [dispatch, nodeId, openContextMenu]\n  );\n\n  const onDragStart = React.useCallback(\n    (e: MouseEvent, originalPoint: Point) => {\n      const p = getCoords(originalPoint);\n      const modifiers = getModifiers(e);\n      dispatch(circuitEditorDragStartNode(nodeId, p, modifiers, editorId));\n    },\n    [getCoords, dispatch, nodeId, editorId]\n  );\n\n  const { startTracking } = useMouseDragDetector({\n    onClick,\n    onDragStart,\n  });\n\n  const onMouseDown = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n      // Handle this regardless, to stop mosue clicks\n      // selecting nearby text.\n      e.preventDefault();\n\n      if (isSimActive) {\n        return;\n      }\n\n      if (e.button !== 0) {\n        return;\n      }\n\n      startTracking(e);\n    },\n    [isSimActive, startTracking]\n  );\n\n  let body: React.ReactNode;\n  let rect: Rectangle;\n  if (!def) {\n    body = (\n      <rect\n        x={x}\n        y={y}\n        width={50}\n        height={50}\n        fill={isSelected ? \"goldenrod\" : \"red\"}\n      />\n    );\n    rect = { p1: ZeroPoint, p2: { x: 50, y: 50 } };\n  } else {\n    const { hitRect } = def.visual;\n    body = getNodeVisualElement(\n      nodeId,\n      circuitNodeIdPath,\n      nodeState,\n      def.visual\n    );\n    rect = hitRect;\n  }\n\n  const transform = x != 0 || y != 0 ? `translate(${x}, ${y})` : undefined;\n  return (\n    <g transform={transform}>\n      <g\n        className={cls(\"circuit-field-node\", isSelected && \"node-selected\")}\n        onMouseDown={onMouseDown}\n        onContextMenu={onContextMenu}\n      >\n        {body}\n      </g>\n      <NodeName nodeId={nodeId} hitRect={rect} />\n      {renderContextMenu(<NodeContextMenu nodeId={nodeId} />)}\n    </g>\n  );\n});\n\ninterface NodeNameProps extends NodeProps {\n  hitRect: Rectangle;\n}\nconst NodeName: React.FC<NodeNameProps> = React.memo(function NodeName({\n  nodeId,\n  hitRect,\n}) {\n  const { zoomFactor } = useViewportContext();\n  const nodeName = useSelector((s) =>\n    nodeFieldDisplayNameFromNodeId(s, nodeId)\n  );\n\n  // FIXME: This is really rough, especially the y offset.\n  // There is a noticable jump in position between >1 and >1 scale.\n  const textScale = Math.max(0.7, zoomFactor);\n  let textYOffset = 15;\n  if (textScale > 1) {\n    textYOffset -= textScale * 2;\n  } else {\n    textYOffset += (1 / textScale) * 7;\n  }\n\n  if (!nodeName) {\n    return null;\n  }\n\n  return (\n    <text\n      fontSize={`${1.2 / textScale}em`}\n      className={interaction[\"text-unselectable\"]}\n      textAnchor=\"middle\"\n      x={hitRect.p1.x + (hitRect.p2.x - hitRect.p1.x) / 2}\n      y={hitRect.p2.y + textYOffset}\n    >\n      {nodeName}\n    </text>\n  );\n});\n\nexport default Node;\n","import Node from \"./Node\";\nexport * from \"./Node\";\nexport default Node;\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { nodeIdsFromCircuitIdSelector } from \"@/services/circuits/selectors/nodes\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport Node from \"./Node\";\n\nconst NodesLayer: React.FC = React.memo(function NodesLayer() {\n  const { circuitId } = useCircuitEditor();\n  const nodeIds = useSelector((state) =>\n    nodeIdsFromCircuitIdSelector(state, circuitId)\n  );\n\n  const nodeElements = nodeIds.map((nodeId) => {\n    return <Node key={nodeId} nodeId={nodeId} />;\n  });\n\n  return <g>{nodeElements}</g>;\n});\nexport default NodesLayer;\n","import { AppState } from \"@/store\";\n\nimport {\n  connectionFromConnectionIdSelector,\n  connectionIdFromInputPinSelector,\n} from \"@/services/node-graph/selectors/connections\";\nimport { nodeTypeFromNodeIdSelector } from \"@/services/node-graph/selectors/nodes\";\n\nimport { nodeOutputsFromCircuitNodeIdSelector } from \"./nodes\";\nimport { NodePin } from \"@/services/node-graph/types\";\n\n// Doesn't need caching for react since it returns primitives, but\n// the additional complexity of tracing IC pins might make it a bit heavy.\nexport const wireValueFromConnectionIdSelector = (\n  state: AppState,\n  icNodePath: string[],\n  connectionId: string\n): boolean => {\n  const connection = connectionFromConnectionIdSelector(state, connectionId);\n  if (!connection) {\n    return false;\n  }\n\n  const {\n    outputPin: { nodeId, pinId },\n  } = connection;\n\n  const nodeType = nodeTypeFromNodeIdSelector(state, nodeId);\n  if (nodeType === \"pin-input\") {\n    // TODO: The ultimate connection id from the input pin is a good candidate\n    // for caching in its own selector, as the ultimate source connection\n    // id of a pin is something that only changes with the simulator graph.\n\n    // The node id of the ic is the ic-node we are contained in.\n    const nextIcNodePath = icNodePath.slice(0, icNodePath.length - 1);\n    const nextPin: NodePin = {\n      nodeId: icNodePath[icNodePath.length - 1], // target node is our parent.\n      pinId: nodeId, // target pin is the same as the node id for the input node.\n    };\n\n    const nextConnectionId = connectionIdFromInputPinSelector(state, nextPin);\n    if (!nextConnectionId) {\n      return false;\n    }\n\n    return wireValueFromConnectionIdSelector(\n      state,\n      nextIcNodePath,\n      nextConnectionId\n    );\n  } else if (nodeType?.startsWith(\"ic-\")) {\n    // Target the ic our output comes from\n    const nextIcNodePath = [...icNodePath, nodeId];\n    const nextPin: NodePin = {\n      nodeId: pinId, // output node id is the same as the target pin id\n      pinId: \"IN\",\n    };\n\n    const nextConnectionId = connectionIdFromInputPinSelector(state, nextPin);\n    if (!nextConnectionId) {\n      return false;\n    }\n\n    return wireValueFromConnectionIdSelector(\n      state,\n      nextIcNodePath,\n      nextConnectionId\n    );\n  } else {\n    const outputs = nodeOutputsFromCircuitNodeIdSelector(state, [\n      ...icNodePath,\n      nodeId,\n    ]);\n    if (!outputs) {\n      return false;\n    }\n    return outputs[pinId] || false;\n  }\n};\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport {\n  Point,\n  normalize,\n  pointSubtract,\n  dotProduct,\n  pointAdd,\n  scale,\n} from \"@/geometry\";\nimport { getModifiers } from \"@/modifier-keys\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useMouseDragDetector } from \"@/hooks/useMouseDragDetector\";\n\nimport { circuitEditorDragStartNewJoint } from \"@/actions/circuit-editor-drag-start-newjoint\";\nimport { selectWires } from \"@/actions/select-wires\";\n\nimport {\n  wireJointPositionFromJointIdSelector,\n  wireStartPositionFromConnectionIdSelector,\n  wireEndPositionFromConnectionIdSelector,\n} from \"@/services/node-layout/selectors/wires\";\nimport { isSimActiveSelector } from \"@/services/simulator-control/selectors/run\";\nimport { isDraggingSelector } from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport { useMouseCoords } from \"../hooks/useMouseCoords\";\n\nexport interface WireSegmentProps {\n  connectionId: string;\n  startJointId: string | null;\n  endJointId: string | null;\n}\nconst WireSegment: React.FC<WireSegmentProps> = React.memo(\n  function WireSegment({ connectionId, startJointId, endJointId }) {\n    const { editorId } = useCircuitEditor();\n    const dispatch = useDispatch();\n    const getMouseCoords = useMouseCoords();\n    const isSimActive = useSelector(isSimActiveSelector);\n    const isDragging = useSelector(isDraggingSelector);\n\n    const start = useSelector((state) => {\n      if (startJointId == null) {\n        return wireStartPositionFromConnectionIdSelector(state, connectionId);\n      }\n      return wireJointPositionFromJointIdSelector(state, startJointId);\n    });\n\n    const end = useSelector((state) => {\n      if (endJointId == null) {\n        return wireEndPositionFromConnectionIdSelector(state, connectionId);\n      }\n      return wireJointPositionFromJointIdSelector(state, endJointId);\n    });\n\n    const [mousePos, setMousePos] = React.useState<Point | null>(null);\n\n    const onMouseMove = React.useCallback(\n      (e: React.MouseEvent) => {\n        const p = getMouseCoords({ x: e.pageX, y: e.pageY });\n        setMousePos(p);\n      },\n      [getMouseCoords]\n    );\n\n    const onMouseLeave = React.useCallback(() => {\n      setMousePos(null);\n    }, []);\n\n    const onDragStart = React.useCallback(\n      (e: MouseEvent, origionalPoint: Point) => {\n        const p = getMouseCoords(origionalPoint);\n        const modifiers = getModifiers(e);\n        dispatch(\n          circuitEditorDragStartNewJoint(\n            connectionId,\n            startJointId,\n            p,\n            modifiers,\n            editorId\n          )\n        );\n      },\n      [getMouseCoords, dispatch, connectionId, startJointId, editorId]\n    );\n\n    const onClick = React.useCallback(\n      (e: MouseEvent) => {\n        const modifiers = getModifiers(e);\n        const mode = getSelectMode(modifiers);\n        dispatch(selectWires(connectionId, mode));\n      },\n      [connectionId, dispatch]\n    );\n\n    const { startTracking } = useMouseDragDetector({ onClick, onDragStart });\n\n    const onJointInsertMouseDown = React.useCallback(\n      (e: React.MouseEvent) => {\n        e.preventDefault();\n        if (isSimActive) {\n          return;\n        }\n\n        startTracking(e);\n      },\n      [isSimActive, startTracking]\n    );\n\n    let insertJointPos: Point | undefined;\n    if (!isDragging && !isSimActive && mousePos) {\n      const lineDir = normalize(pointSubtract(end, start));\n      const v = pointSubtract(mousePos, start);\n      const d = dotProduct(v, lineDir);\n      insertJointPos = pointAdd(start, scale(lineDir, d));\n    }\n\n    return (\n      <g onMouseMove={onMouseMove} onMouseLeave={onMouseLeave}>\n        <line x1={start.x} y1={start.y} x2={end.x} y2={end.y} strokeWidth={2} />\n        {endJointId == null && <circle cx={end.x} cy={end.y} r={1.5} />}\n        {insertJointPos && (\n          <circle\n            cx={insertJointPos.x}\n            cy={insertJointPos.y}\n            r={3}\n            stroke=\"none\"\n            fill=\"red\"\n            onMouseDown={onJointInsertMouseDown}\n          />\n        )}\n      </g>\n    );\n  }\n);\n\nexport default WireSegment;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { Point } from \"@/geometry\";\nimport { getModifiers } from \"@/modifier-keys\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useMouseDragDetector } from \"@/hooks/useMouseDragDetector\";\n\nimport { wireJointPositionFromJointIdSelector } from \"@/services/node-layout/selectors/wires\";\nimport { isJointSelectedFromJointIdSelector } from \"@/services/selection/selectors/selection\";\nimport { isSimActiveSelector } from \"@/services/simulator-control/selectors/run\";\n\nimport { selectWireJoints } from \"@/actions/select-wire-joints\";\nimport { circuitEditorDragStartJoint } from \"@/actions/circuit-editor-drag-start-joint\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport { useMouseCoords } from \"../hooks/useMouseCoords\";\n\nimport WireJointVisual from \"./WireJointVisual\";\n\ninterface WireJointProps {\n  jointId: string;\n}\n\nconst WireJoint: React.FC<WireJointProps> = React.memo(function WireJoint({\n  jointId,\n}) {\n  const { editorId } = useCircuitEditor();\n  const getMouseCoords = useMouseCoords();\n  const dispatch = useDispatch();\n  const isSimActive = useSelector(isSimActiveSelector);\n\n  const isSelected = useSelector((state) =>\n    isJointSelectedFromJointIdSelector(state, jointId)\n  );\n\n  const position = useSelector((state) =>\n    wireJointPositionFromJointIdSelector(state, jointId)\n  );\n  const onDragStart = React.useCallback(\n    (e: MouseEvent, originalPoint: Point) => {\n      const p = getMouseCoords(originalPoint);\n      const modifiers = getModifiers(e);\n      dispatch(circuitEditorDragStartJoint(jointId, p, modifiers, editorId));\n    },\n    [dispatch, editorId, getMouseCoords, jointId]\n  );\n\n  const onClick = React.useCallback(\n    (e: MouseEvent) => {\n      const modifiers = getModifiers(e);\n      const mode = getSelectMode(modifiers);\n      dispatch(selectWireJoints(jointId, mode));\n    },\n    [dispatch, jointId]\n  );\n\n  const { startTracking } = useMouseDragDetector({\n    onClick,\n    onDragStart,\n  });\n\n  const onJointMouseDown = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (isSimActive) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n\n      startTracking(e);\n    },\n    [isSimActive, startTracking]\n  );\n\n  return (\n    <WireJointVisual\n      interactable={!isSimActive}\n      selected={isSelected}\n      x={position.x}\n      y={position.y}\n      onMouseDown={onJointMouseDown}\n    />\n  );\n});\n\nexport default WireJoint;\n","import Wire from \"./Wire\";\nexport default Wire;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { wireJointIdsFromConnectionIdSelector } from \"@/services/node-layout/selectors/wires\";\nimport { isWireSelectedFromConnectionIdSelector } from \"@/services/selection/selectors/selection\";\nimport { wireValueFromConnectionIdSelector } from \"@/services/simulator/selectors/wires\";\n\nimport { useCircuitEditor } from \"../../../../contexts/circuit-editor-context\";\n\nimport WireSegment from \"../WireSegment\";\nimport WireJoint from \"../WireJoint\";\n\nimport styles from \"./Wire.module.css\";\n\nexport interface WireProps {\n  connectionId: string;\n}\n\nconst Wire: React.FC<WireProps> = React.memo(function Wire({ connectionId }) {\n  const { circuitNodeIdPath } = useCircuitEditor();\n\n  const jointIds = useSelector((state) =>\n    wireJointIdsFromConnectionIdSelector(state, connectionId)\n  );\n  const isPowered = useSelector((state) =>\n    wireValueFromConnectionIdSelector(state, circuitNodeIdPath, connectionId)\n  );\n  const isSelected = useSelector((state) =>\n    isWireSelectedFromConnectionIdSelector(state, connectionId)\n  );\n\n  // We need one extra array entry for starting on the last jointId and ending at null (end of wire)\n  const segmentElements = [...jointIds, null].map((endJointId, index) => {\n    const startJointId = index > 0 ? jointIds[index - 1] : null;\n    return (\n      <WireSegment\n        key={index}\n        connectionId={connectionId}\n        startJointId={startJointId}\n        endJointId={endJointId}\n      />\n    );\n  });\n\n  const jointElements = jointIds.map((jointId) => (\n    <WireJoint key={jointId} jointId={jointId} />\n  ));\n\n  return (\n    <g\n      className={cls(\n        styles[\"wire\"],\n        isPowered && styles[\"powered\"],\n        isSelected && styles[\"selected\"]\n      )}\n    >\n      {segmentElements}\n      {jointElements}\n    </g>\n  );\n});\n\nexport default Wire;\n","// extracted by mini-css-extract-plugin\nexport default {\"wire\":\"wire--2lJT9\",\"powered\":\"powered--3tsJ_\",\"selected\":\"selected--Dkrv_\"};","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { connectionIdsByCircuitIdSelector } from \"@/services/circuits/selectors/connections\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport Wire from \"./Wire\";\n\nconst WiresLayer: React.FC = React.memo(function WiresLayer() {\n  const { circuitId } = useCircuitEditor();\n  const connectionIds = useSelector((state) =>\n    connectionIdsByCircuitIdSelector(state, circuitId)\n  );\n  const connectorElements = connectionIds.map((connectionId) => (\n    <Wire key={connectionId} connectionId={connectionId} />\n  ));\n\n  return <g>{connectorElements}</g>;\n});\nexport default WiresLayer;\n","// extracted by mini-css-extract-plugin\nexport default {\"node-pin-output\":\"node-pin-output--WumfM\",\"highlight\":\"highlight--30Hqg\",\"is-drag-target\":\"is-drag-target--1kAL8\",\"node-pin-input\":\"node-pin-input--3iuKH\"};","import NodePin from \"./NodePin\";\nexport default NodePin;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\nimport { describeArc } from \"@/svg\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useMouseDragDetector } from \"@/hooks/useMouseDragDetector\";\n\nimport { nodePinPositionFromNodePinSelector } from \"@/services/node-layout/selectors/node-pin-positions\";\nimport { pinDirectionFromNodePinSelector } from \"@/services/node-graph/selectors/pins\";\nimport { dragDropTargetPinSelector } from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport { circuitEditorDragStartWire } from \"@/actions/circuit-editor-drag-start-wire\";\n\nimport { useCircuitEditor } from \"../../../../contexts/circuit-editor-context\";\n\nimport { useMouseCoords } from \"../../hooks/useMouseCoords\";\n\nimport styles from \"./NodePin.module.css\";\n\nexport interface NodePinProps {\n  nodeId: string;\n  pinId: string;\n}\n\nconst NodePin: React.FC<NodePinProps> = React.memo(function NodePin({\n  nodeId,\n  pinId,\n}) {\n  const { editorId } = useCircuitEditor();\n  const getMouseCoords = useMouseCoords();\n  const [highlight, setHighlight] = React.useState(false);\n  const dispatch = useDispatch();\n\n  const position = useSelector((s) =>\n    nodePinPositionFromNodePinSelector(s, nodeId, pinId)\n  );\n  const direction = useSelector((s) =>\n    pinDirectionFromNodePinSelector(s, nodeId, pinId)\n  );\n\n  const dragTargetPin = useSelector(dragDropTargetPinSelector);\n\n  const onDragStart = React.useCallback(\n    (e, originalPoint) => {\n      const p = getMouseCoords(originalPoint);\n      dispatch(circuitEditorDragStartWire(p, { nodeId, pinId }, editorId));\n    },\n    [dispatch, editorId, getMouseCoords, nodeId, pinId]\n  );\n\n  const { startTracking } = useMouseDragDetector({\n    onDragStart,\n  });\n\n  const onMouseDown = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.button !== 0) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n\n      e.stopPropagation();\n\n      startTracking(e);\n    },\n    [startTracking]\n  );\n\n  const onMouseEnter = React.useCallback(() => {\n    setHighlight(true);\n  }, []);\n  const onMouseLeave = React.useCallback(() => {\n    setHighlight(false);\n  }, []);\n\n  if (!position) {\n    return null;\n  }\n\n  const isDragTarget =\n    dragTargetPin != null &&\n    dragTargetPin.nodeId === nodeId &&\n    dragTargetPin.pinId === pinId;\n\n  const { x, y } = position;\n\n  let pinVisual: JSX.Element;\n\n  if (direction === \"input\") {\n    pinVisual = (\n      <path\n        d={describeArc(x, y, 4, -45, 225)}\n        strokeWidth={2}\n        className={cls(\n          styles[\"node-pin-input\"],\n          isDragTarget && styles[\"is-drag-target\"],\n          highlight && styles.highlight\n        )}\n      />\n    );\n  } else {\n    pinVisual = (\n      <circle\n        className={cls(\n          styles[\"node-pin-output\"],\n          isDragTarget && styles[\"is-drag-target\"],\n          highlight && styles.highlight\n        )}\n        cx={x}\n        cy={y}\n        r={3}\n      />\n    );\n  }\n\n  return (\n    <g onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave}>\n      {pinVisual}\n      <circle\n        stroke=\"none\"\n        fill=\"transparent\"\n        cx={x}\n        cy={y}\n        r={5}\n        onMouseDown={onMouseDown}\n      />\n    </g>\n  );\n});\n\nexport default NodePin;\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { nodeDefFromNodeIdSelector } from \"@/services/node-graph/selectors/node-def\";\n\nimport NodePin from \"./NodePin\";\n\nexport interface NodePinsProps {\n  nodeId: string;\n}\n\nconst NodePins: React.FC<NodePinsProps> = React.memo(function NodePins({\n  nodeId,\n}) {\n  const def = useSelector((state) => nodeDefFromNodeIdSelector(state, nodeId));\n\n  const pins = def?.pins ?? {};\n\n  const elements = Object.keys(pins).map((pinId) => (\n    <NodePin key={pinId} nodeId={nodeId} pinId={pinId} />\n  ));\n\n  return <>{elements}</>;\n});\n\nexport default NodePins;\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { nodeIdsFromCircuitIdSelector } from \"@/services/circuits/selectors/nodes\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport NodePins from \"./NodePins\";\n\nconst NodePinsLayer: React.FC = React.memo(function NodePinsLayer() {\n  const { circuitId } = useCircuitEditor();\n  const nodeIds = useSelector((state) =>\n    nodeIdsFromCircuitIdSelector(state, circuitId)\n  );\n\n  const elements = nodeIds.map((nodeId) => (\n    <NodePins key={nodeId} nodeId={nodeId} />\n  ));\n\n  return <g>{elements}</g>;\n});\n\nexport default NodePinsLayer;\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport {\n  dragEndSelector,\n  dragModeSelector,\n  dragStartSelector,\n  isEditorDraggingSelector,\n} from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nconst DragAttachWirePreviewLayer: React.FC = React.memo(\n  function DragAttachWirePreviewLayer() {\n    const { editorId } = useCircuitEditor();\n\n    const isEditorDragging = useSelector((state) =>\n      isEditorDraggingSelector(state, editorId)\n    );\n\n    const dragMode = useSelector(dragModeSelector);\n    const dragStart = useSelector(dragStartSelector);\n    const dragEnd = useSelector(dragEndSelector);\n\n    if (!isEditorDragging || dragMode != \"wire\" || !dragStart || !dragEnd) {\n      return null;\n    }\n\n    return (\n      <line\n        x1={dragStart.x}\n        y1={dragStart.y}\n        x2={dragEnd.x}\n        y2={dragEnd.y}\n        stroke=\"black\"\n        strokeWidth={1}\n      />\n    );\n  }\n);\n\nexport default DragAttachWirePreviewLayer;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { getModifiers } from \"@/modifier-keys\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { isDraggingSelector } from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport { circuitEditorDragContinue } from \"@/actions/circuit-editor-drag-continue\";\nimport { circuitEditorDragEnd } from \"@/actions/circuit-editor-drag-end\";\nimport { circuitEditorDragAbort } from \"@/actions/circuit-editor-drag-abort\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport { useEventMouseCoords } from \"../hooks/useMouseCoords\";\n\nconst EditorDragReceiver: React.FC = () => {\n  const dispatch = useDispatch();\n  const { editorId } = useCircuitEditor();\n\n  const isDragging = useSelector(isDraggingSelector);\n\n  const getCoords = useEventMouseCoords();\n\n  const onMouseMove = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.buttons === 0) {\n        // It would be nice if we could take a mouse capture and get notified\n        // of the mouse up elsewhere, but we need to allow other circuit editors\n        // to receive the mouse events so the drag can transfer.\n        // As a second best, detect mouse up when it comes back into us and cancel.\n        dispatch(circuitEditorDragAbort());\n        return;\n      }\n\n      const coords = getCoords(e);\n      const modifierKeys = getModifiers(e);\n      dispatch(circuitEditorDragContinue(coords, modifierKeys, editorId));\n    },\n    [dispatch, editorId, getCoords]\n  );\n\n  const onMouseUp = React.useCallback(\n    (e: React.MouseEvent) => {\n      const coords = getCoords(e);\n      const modifierKeys = getModifiers(e);\n      dispatch(circuitEditorDragEnd(coords, modifierKeys, editorId));\n    },\n    [dispatch, editorId, getCoords]\n  );\n\n  if (!isDragging) {\n    return null;\n  }\n\n  return (\n    <rect\n      width=\"100%\"\n      height=\"100%\"\n      fill=\"transparent\"\n      onMouseMove={onMouseMove}\n      onMouseUp={onMouseUp}\n    />\n  );\n};\n\nexport default EditorDragReceiver;\n","import CircuitFieldSurface from \"./CircuitFieldSurface\";\nexport default CircuitFieldSurface;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useDrop } from \"react-dnd\";\n\nimport { circuitEditorMouseLeave } from \"@/actions/circuit-editor-mouse-leave\";\n\nimport { NEW_NODE_DRAG_OBJECT } from \"../../drag-items/new-node\";\nimport { useViewportContext } from \"../../contexts/viewport-context\";\n\nimport { FieldSvgElementProvider } from \"./contexts/fieldSvgElement\";\n\nimport DragNewNodeLayer from \"./components/DragNewNodeLayer\";\nimport DragNodePreviewLayer from \"./components/DragNodePreviewLayer\";\nimport DragJointPreviewLayer from \"./components/DragJointPreviewLayer\";\nimport DragSelectLayer from \"./components/DragSelectLayer\";\nimport GridBackground from \"./components/GridBackground\";\nimport NodesLayer from \"./components/NodesLayer\";\nimport WiresLayer from \"./components/WiresLayer\";\nimport NodePinsLayer from \"./components/NodePinsLayer\";\nimport DragAttachWirePreviewLayer from \"./components/DragAttachWirePreviewLayer\";\nimport EditorDragReceiver from \"./components/EditorDragReceiver\";\n\nimport styles from \"./CircuitFieldSurface.module.css\";\n\nexport interface CircuitFieldSurfaceProps {\n  width: number;\n  height: number;\n  onContextMenu(e: React.MouseEvent): void;\n}\nconst CircuitFieldSurface: React.FC<CircuitFieldSurfaceProps> = ({\n  width,\n  height,\n  onContextMenu: openContextMenu,\n}) => {\n  const dispatch = useDispatch();\n  const { zoomFactor } = useViewportContext();\n\n  const svgRef = React.useRef<SVGSVGElement | null>(null);\n  const scalerRef = React.useRef<SVGGElement | null>(null);\n\n  const onMouseDown = React.useCallback(() => {\n    svgRef.current?.focus();\n  }, []);\n\n  const onMouseLeave = React.useCallback(() => {\n    dispatch(circuitEditorMouseLeave());\n  }, [dispatch]);\n\n  const onContextMenu = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n      openContextMenu(e);\n    },\n    [openContextMenu]\n  );\n\n  // We need to capture the drag event at a deeper parent,\n  // because mouse events cannot pass through DragNewNodeLayer's\n  // drag capture rect to the underlying DragSelectLayer and other elements.\n  // In contrast, we cannot handle the drag here as\n  // we do not know the coordinate system from our scaler.\n  // Instead, just capture whether or not we are being dragged into,\n  // and enable the new node drag layer only when we are dragging.\n  const [{ isDraggingNewNode }, dragRef] = useDrop({\n    accept: NEW_NODE_DRAG_OBJECT,\n    collect: (monitor) => {\n      return {\n        isDraggingNewNode: monitor.isOver(),\n      };\n    },\n  });\n\n  return (\n    <svg\n      tabIndex={-1}\n      ref={(ref) => {\n        svgRef.current = ref;\n        dragRef(ref);\n      }}\n      width={width}\n      height={height}\n      onMouseDown={onMouseDown}\n      onMouseLeave={onMouseLeave}\n      onContextMenu={onContextMenu}\n      className={styles[\"circuit-field-svg\"]}\n    >\n      <GridBackground />\n      <g\n        ref={scalerRef}\n        transform-origin=\"0 0\"\n        transform={`scale(${zoomFactor})`}\n      >\n        <FieldSvgElementProvider svgRef={svgRef} scalerRef={scalerRef}>\n          <DragSelectLayer />\n          <NodesLayer />\n          <WiresLayer />\n          <NodePinsLayer />\n          <DragAttachWirePreviewLayer />\n          <DragNodePreviewLayer />\n          <DragJointPreviewLayer />\n          {isDraggingNewNode && <DragNewNodeLayer />}\n          <EditorDragReceiver />\n        </FieldSvgElementProvider>\n      </g>\n    </svg>\n  );\n};\n\nexport default CircuitFieldSurface;\n","// extracted by mini-css-extract-plugin\nexport default {\"circuit-field-svg\":\"circuit-field-svg--o7YIn\"};","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\nimport { calcSize } from \"@/geometry\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useNativeEvent } from \"@/hooks/useNativeEvent\";\nimport { useComponentBounds } from \"@/hooks/useComponentBounds\";\n\nimport { fieldRectSelector } from \"@/services/node-layout/selectors/field\";\nimport { isSimActiveSelector } from \"@/services/simulator-control/selectors/run\";\n\nimport { useContextMenu } from \"@/components/ContextMenu\";\n\nimport FieldContextMenu from \"./components/FieldContextMenu\";\nimport CircuitFieldSurface from \"./components/CircuitFieldSurface\";\n\nimport { CircuitEditorProvider } from \"./contexts/circuit-editor-context\";\nimport {\n  useViewportContext,\n  ViewportContextProvider,\n} from \"./contexts/viewport-context\";\n\nimport styles from \"./CircuitEditor.module.css\";\n\nexport interface CircuitEditorProps {\n  className?: string;\n  editorId: string;\n}\n\nconst CircuitEditor: React.FC<CircuitEditorProps> = ({\n  className,\n  editorId,\n}) => {\n  const isSimActive = useSelector(isSimActiveSelector);\n\n  const { openContextMenu, renderContextMenu } = useContextMenu();\n\n  // svg seems to have an implicit bottom margin against its parent div\n  // Wrapping it in a div of the same size fixes it.\n  return (\n    <CircuitEditorProvider editorId={editorId}>\n      <div\n        id={`circuit-editor-${editorId}`}\n        className={cls(\n          \"circuit-editor\",\n          styles[\"circuit-editor\"],\n          isSimActive && \"simulator-active\",\n          className\n        )}\n      >\n        <div className={styles[\"circuit-editor-scrollarea\"]}>\n          <ViewportContextProvider>\n            <ZoomingCircuitFieldSurface onContextMenu={openContextMenu} />\n          </ViewportContextProvider>\n        </div>\n        {renderContextMenu(<FieldContextMenu />)}\n      </div>\n    </CircuitEditorProvider>\n  );\n};\n\nexport default CircuitEditor;\n\ninterface ZoomingCircuitFieldSurface {\n  onContextMenu(e: React.MouseEvent): void;\n}\nconst ZoomingCircuitFieldSurface: React.FC<ZoomingCircuitFieldSurface> = ({\n  onContextMenu,\n}) => {\n  const sizeRef = React.useRef<HTMLDivElement | null>(null);\n  const { width: componentWidth, height: componentHeight } = useComponentBounds(\n    sizeRef\n  );\n\n  const { zoomFactor, zoom } = useViewportContext();\n\n  const fieldRect = useSelector(fieldRectSelector);\n  const { width: fieldWidth, height: fieldHeight } = calcSize(fieldRect);\n\n  const width = Math.max(componentWidth, fieldWidth * zoomFactor);\n  const height = Math.max(componentHeight, fieldHeight * zoomFactor);\n\n  const onWheel = React.useCallback(\n    (e: WheelEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      if (e.ctrlKey) {\n        zoom(e.deltaY > 0 ? -1 : 1);\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    },\n    [zoom]\n  );\n\n  // React listens to the root listener for all events,\n  //  and chrome assumes the root event listener for mouse events\n  //  never wants to preventDefault.\n  // We need to take a local event listener and mark it as not passive.\n  // https://github.com/facebook/react/issues/14856\n  useNativeEvent(sizeRef, \"wheel\", onWheel, { passive: false });\n\n  return (\n    <div ref={sizeRef} style={{ width: \"100%\", height: \"100%\" }}>\n      <CircuitFieldSurface\n        width={width}\n        height={height}\n        onContextMenu={onContextMenu}\n      />\n    </div>\n  );\n};\n","import CircuitEditor from \"./CircuitEditor\";\nexport default CircuitEditor;\n","// extracted by mini-css-extract-plugin\nexport default {\"circuit-editor\":\"circuit-editor--2jFUa\",\"circuit-editor-scrollarea\":\"circuit-editor-scrollarea--12k0x\"};","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Icons.module.css\";\n\nconst CloseIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => {\n  return (\n    <svg\n      width={16}\n      height={16}\n      {...props}\n      className={cls(styles.icon, props.className)}\n    >\n      <path d=\"M4,4 L12,12 M4,12 L12,4\" />\n    </svg>\n  );\n};\n\nexport default CloseIcon;\n","import * as React from \"react\";\n\nimport { useDrag } from \"react-dnd\";\n\nimport { cls } from \"@/utils\";\n\nimport { tesselWindowDragObject } from \"./drag-items/tessel-window\";\n\nimport { useTesselInteraction, useTesselPath } from \"./TesselContext\";\nimport TesselDropCapture from \"./TesselDropCapture\";\n\nimport styles from \"./Tessel.module.css\";\nimport CloseIcon from \"../Icons/Close\";\n\nexport interface TesselWindowProps {\n  className?: string;\n  title: string;\n}\nconst TesselWindow: React.FC<TesselWindowProps> = ({\n  title,\n  className,\n  children,\n}) => {\n  const path = useTesselPath();\n\n  const { closeWindow } = useTesselInteraction();\n  const onCloseWindow = React.useCallback(() => {\n    closeWindow(path);\n  }, [closeWindow, path]);\n\n  const [, dragSourceRef] = useDrag({\n    item: tesselWindowDragObject(path),\n  });\n\n  return (\n    <TesselDropCapture className={styles[\"tessel-window\"]}>\n      <div ref={dragSourceRef} className={styles[\"tessel-window-titlebar\"]}>\n        <div className={styles[\"tessel-window-title\"]}>{title}</div>\n        <div className={styles[\"tessel-window-controls\"]}>\n          <CloseIcon\n            className={styles[\"tessel-window-controls-close\"]}\n            onClick={onCloseWindow}\n          />\n        </div>\n      </div>\n      <div className={cls(styles[\"tessel-window-content\"], className)}>\n        {children}\n      </div>\n    </TesselDropCapture>\n  );\n};\n\nexport default TesselWindow;\n","import { keyboardCommandModifier } from \"@/runtime-env\";\n\nexport const KEYMAP_SIM_STEP = \"keymap:CircuitEditor/SimStep\" as const;\nexport const KEYMAP_SELECT_ALL = \"keymap:CircuitEditor/SelectAll\" as const;\nexport const KEYMAP_COPY = \"keymap:CircuitEditor/Copy\" as const;\nexport const KEYMAP_PASTE = \"keymap:CircuitEditor/Paste\" as const;\nexport const KEYMAP_DELETE = \"keymap:CircuitEditor/Delete\" as const;\nexport const KEYMAP_UNDO = \"keymap:CircuitEditor/Undo\" as const;\nexport const KEYMAP_REDO = \"keymap:CircuitEditor/Redo\" as const;\n\nconst keymap = {\n  [KEYMAP_SIM_STEP]: \"space\",\n  [KEYMAP_SELECT_ALL]: `${keyboardCommandModifier}+a`,\n  [KEYMAP_COPY]: `${keyboardCommandModifier}+c`,\n  [KEYMAP_PASTE]: `${keyboardCommandModifier}+v`,\n  [KEYMAP_DELETE]: [\"backspace\", \"del\"],\n  [KEYMAP_UNDO]: `${keyboardCommandModifier}+z`,\n  [KEYMAP_REDO]: [\n    `${keyboardCommandModifier}+y`,\n    `${keyboardCommandModifier}+shift+z`,\n  ],\n};\nexport default keymap;\n\nexport type KeymapKeys = keyof typeof keymap;\nexport type KeymapHandler = Record<KeymapKeys, HotkeyHandler>;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { HotKeys } from \"react-hotkeys\";\nimport { AnyAction } from \"redux\";\n\nimport { cls } from \"@/utils\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport sizing from \"@/styles/sizing.module.css\";\nimport flex from \"@/styles/flex.module.css\";\n\nimport { circuitEditorStateFromIdSelector } from \"@/services/circuit-editors/selectors/editor\";\nimport { circuitNameFromIdSelector } from \"@/services/circuits/selectors/circuits\";\n\nimport { paste } from \"@/actions/clipboard-paste\";\nimport { copySelection } from \"@/actions/selection-copy\";\nimport { deleteSelection } from \"@/actions/selection-delete\";\nimport { selectAll } from \"@/actions/select-all\";\nimport { undo } from \"@/actions/undo\";\nimport { redo } from \"@/actions/redo\";\nimport { circuitEditorReceiveFocus } from \"@/actions/circuit-editor-receive-focus\";\nimport { stepSim } from \"@/actions/sim-step\";\n\nimport CircuitNodeBreadcrumb from \"@/components/CircuitNodeBreadcrumb\";\nimport CircuitField from \"@/components/CircuitEditor\";\nimport TesselWindow from \"@/components/Tessel/TesselWindow\";\n\nimport keymap, {\n  KeymapHandler,\n  KEYMAP_SIM_STEP,\n  KEYMAP_COPY,\n  KEYMAP_PASTE,\n  KEYMAP_DELETE,\n  KEYMAP_SELECT_ALL,\n  KEYMAP_UNDO,\n  KEYMAP_REDO,\n} from \"./keymap\";\n\nexport interface CircuitEditorWindowProps {\n  editorId: string;\n}\nconst CircuitEditorWindow: React.FC<CircuitEditorWindowProps> = ({\n  editorId,\n}) => {\n  const dispatch = useDispatch();\n  const { circuitId, circuitNodeIdPath } = useSelector((state) =>\n    circuitEditorStateFromIdSelector(state, editorId)\n  ) ?? { circuitId: null, circuitNodeIdPath: [] };\n\n  const circuitName =\n    useSelector((state) => circuitNameFromIdSelector(state, circuitId)) ??\n    \"<Circuit Missing>\";\n\n  // FIXME: Move key handling into CircuitEditor\n  const keyHandlers = React.useMemo(() => {\n    function createEventDispatcher(action: AnyAction): HotkeyHandler {\n      return (e?: KeyboardEvent) => {\n        if (e) {\n          if (e.defaultPrevented) {\n            return;\n          }\n          e.preventDefault();\n        }\n        dispatch(action);\n      };\n    }\n    const keyHandlers: KeymapHandler = {\n      [KEYMAP_SIM_STEP]: createEventDispatcher(stepSim()),\n      [KEYMAP_SELECT_ALL]: createEventDispatcher(selectAll(circuitId)),\n      [KEYMAP_COPY]: createEventDispatcher(copySelection()),\n      [KEYMAP_PASTE]: createEventDispatcher(paste(circuitId)),\n      [KEYMAP_DELETE]: createEventDispatcher(deleteSelection()),\n      [KEYMAP_UNDO]: createEventDispatcher(undo()),\n      [KEYMAP_REDO]: createEventDispatcher(redo()),\n    };\n    return keyHandlers;\n  }, [dispatch, circuitId]);\n\n  const onViewActivated = React.useCallback(() => {\n    dispatch(circuitEditorReceiveFocus(editorId));\n  }, [dispatch, editorId]);\n\n  return (\n    <TesselWindow title={`${circuitName} [Circuit]`}>\n      <HotKeys keyMap={keymap} handlers={keyHandlers} component={FillParent}>\n        <div\n          onFocus={onViewActivated}\n          className={cls(\n            \"circuit-field-view\",\n            sizing[\"fill-parent\"],\n            flex[\"flex-column\"]\n          )}\n        >\n          <CircuitNodeBreadcrumb\n            circuitId={circuitId}\n            circuitNodeIdPath={circuitNodeIdPath}\n          />\n          <CircuitField\n            className={cls(sizing[\"fill-parent\"], flex[\"flexitem-shrink\"])}\n            editorId={editorId}\n          />\n        </div>\n      </HotKeys>\n    </TesselWindow>\n  );\n};\n\nconst FillParent: React.FC = ({ children, ...props }) => {\n  return (\n    <div {...props} className={sizing[\"fill-parent\"]}>\n      {children}\n    </div>\n  );\n};\n\nexport default CircuitEditorWindow;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport styles from \"./SelectionList.module.css\";\n\nexport interface SelectionListItem {\n  value: string;\n  label: React.ReactNode;\n  isSelected?: boolean;\n}\n\nexport interface SelectionListProps {\n  className?: string;\n  items: SelectionListItem[];\n  onItemSelected(value: string): void;\n}\n\nconst SelectionList: React.FC<SelectionListProps> = ({\n  className,\n  items,\n  onItemSelected,\n}) => {\n  return (\n    <ul className={cls(\"selection-list\", styles[\"selection-list\"], className)}>\n      {items.map((item) => (\n        <SelectionListItemNode\n          key={item.value}\n          {...item}\n          onItemSelected={onItemSelected}\n        />\n      ))}\n    </ul>\n  );\n};\n\nexport default SelectionList;\n\ninterface SelectionListItemNodeProps extends SelectionListItem {\n  onItemSelected(value: string): void;\n}\n\nconst SelectionListItemNode: React.FC<SelectionListItemNodeProps> = ({\n  value,\n  label,\n  isSelected,\n  onItemSelected,\n}) => {\n  const onClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      e.preventDefault();\n      onItemSelected(value);\n    },\n    [onItemSelected, value]\n  );\n\n  return (\n    <li\n      className={cls(\n        \"selection-list-item\",\n        styles[\"selection-list-item\"],\n        isSelected && styles[\"selection-list-item--selected\"]\n      )}\n      onClick={onClick}\n    >\n      <div\n        className={cls(\n          styles[\"selection-list-item-content\"],\n          interaction[\"text-unselectable\"]\n        )}\n      >\n        {label}\n      </div>\n    </li>\n  );\n};\n","// extracted by mini-css-extract-plugin\nexport default {\"selection-list\":\"selection-list--3yujH\",\"selection-list-item\":\"selection-list-item--errDr\",\"selection-list-item--selected\":\"selection-list-item--selected--3MkqB\",\"selection-list-item-content\":\"selection-list-item-content--321YU\"};","import SelectionList from \"./SelectionList\";\nexport * from \"./SelectionList\";\nexport default SelectionList;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\n\nimport sizing from \"@/styles/sizing.module.css\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { deleteCircuit } from \"@/actions/circuit-delete\";\nimport { viewCircuit } from \"@/actions/view-circuit\";\nimport { addCircuit } from \"@/actions/circuit-add\";\nimport { renameCircuit } from \"@/actions/circuit-rename\";\n\nimport {\n  circuitNameFromIdSelector,\n  circuitNamesByIdSelector,\n} from \"@/services/circuits/selectors/circuits\";\nimport { ROOT_CIRCUIT_ID } from \"@/services/circuits/constants\";\n\nimport { useContextMenu } from \"@/components/ContextMenu\";\nimport Menu from \"@/components/Menus/Menu\";\nimport MenuItem from \"@/components/Menus/MenuItem\";\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\nimport SelectionList, { SelectionListItem } from \"@/components/SelectionList\";\nimport EditableText from \"@/components/EditableText\";\nimport TesselWindow from \"@/components/Tessel/TesselWindow\";\n\nimport styles from \"./CircuitsTreeWindow.module.css\";\n\nconst CircuitsTreeWindow: React.FC = () => {\n  const dispatch = useDispatch();\n\n  const circuitNamesById = useSelector(circuitNamesByIdSelector);\n\n  const { openContextMenu, renderContextMenu } = useContextMenu();\n\n  const onCircuitSelected = React.useCallback(\n    (circuitId: string) => {\n      dispatch(viewCircuit(circuitId));\n    },\n    [dispatch]\n  );\n\n  const onContextMenu = React.useCallback(\n    (e: React.MouseEvent<HTMLDivElement>) => {\n      e.preventDefault();\n      openContextMenu(e);\n    },\n    [openContextMenu]\n  );\n\n  const listItems: SelectionListItem[] = React.useMemo(\n    () =>\n      Object.keys(circuitNamesById).map((circuitId) => {\n        return {\n          value: circuitId,\n          label: <CircuitTreeNodeCircuitLabel circuitId={circuitId} />,\n        };\n      }),\n    [circuitNamesById]\n  );\n\n  return (\n    <TesselWindow title=\"Circuits\" className={cls(styles.circuitstree)}>\n      <div className={sizing[\"fill-parent\"]} onContextMenu={onContextMenu}>\n        <SelectionList\n          className={sizing[\"fill-parent\"]}\n          items={listItems}\n          onItemSelected={onCircuitSelected}\n        />\n      </div>\n      {renderContextMenu(<CircuitTreeContextMenu />)}\n    </TesselWindow>\n  );\n};\n\nexport default CircuitsTreeWindow;\n\ninterface CircuitTreeNodeLabelProps {\n  circuitId: string;\n}\n\nconst CircuitTreeNodeCircuitLabel: React.FC<CircuitTreeNodeLabelProps> = ({\n  circuitId,\n}) => {\n  const dispatch = useDispatch();\n  const circuitName = useSelector((state) =>\n    circuitNameFromIdSelector(state, circuitId)\n  );\n  const [isRenaming, setIsRenaming] = React.useState(false);\n\n  const { openContextMenu, renderContextMenu } = useContextMenu();\n\n  const onRequestRename = React.useCallback(() => {\n    if (circuitId === ROOT_CIRCUIT_ID) {\n      return;\n    }\n    setIsRenaming(true);\n  }, [circuitId]);\n\n  const onCancelRename = React.useCallback(() => {\n    setIsRenaming(false);\n  }, []);\n\n  const onRename = React.useCallback(\n    (newName) => {\n      dispatch(renameCircuit(circuitId, newName));\n      setIsRenaming(false);\n    },\n    [circuitId, dispatch]\n  );\n\n  const onOpenNewWindow = React.useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      dispatch(viewCircuit(circuitId, null, { newWindow: true }));\n    },\n    [circuitId, dispatch]\n  );\n\n  const onDelete = React.useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      dispatch(deleteCircuit(circuitId));\n    },\n    [dispatch, circuitId]\n  );\n\n  const onContextMenu = React.useCallback(\n    (e: React.MouseEvent<HTMLElement>) => {\n      e.preventDefault();\n      e.stopPropagation();\n      openContextMenu(e);\n    },\n    [openContextMenu]\n  );\n\n  return (\n    <div\n      style={{ width: \"100%\" }}\n      onContextMenu={onContextMenu}\n      onDoubleClick={onRequestRename}\n    >\n      <EditableText\n        defaultValue={circuitName}\n        isEditing={isRenaming}\n        onRequestEdit={onRequestRename}\n        onCommit={onRename}\n        onCancel={onCancelRename}\n      />\n      {renderContextMenu(\n        <Menu>\n          {circuitId !== ROOT_CIRCUIT_ID && (\n            <>\n              <MenuItem onClick={onRequestRename}>Rename Circuit</MenuItem>\n              <DividerMenuItem />\n            </>\n          )}\n          <MenuItem onClick={onOpenNewWindow}>Open in New Window</MenuItem>\n          {circuitId !== ROOT_CIRCUIT_ID && (\n            <>\n              <DividerMenuItem />\n              <MenuItem onClick={onDelete}>Delete Circuit</MenuItem>\n            </>\n          )}\n        </Menu>\n      )}\n    </div>\n  );\n};\n\nconst CircuitTreeContextMenu: React.FC = () => {\n  const dispatch = useDispatch();\n  const onNewCircuit = React.useCallback(() => {\n    dispatch(addCircuit());\n  }, [dispatch]);\n\n  return (\n    <Menu>\n      <MenuItem onClick={onNewCircuit}>New Circuit</MenuItem>\n    </Menu>\n  );\n};\n","import Tooltip from \"./Tooltip\";\nexport default Tooltip;\n","import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport { Options, VirtualElement } from \"@popperjs/core\";\nimport { usePopper } from \"react-popper\";\n\nexport interface PopoverProps {\n  anchorEl: Element | VirtualElement | null;\n  placement?: Options[\"placement\"];\n  isOpen: boolean;\n}\n\nimport styles from \"./Tooltip.module.css\";\n\nconst Tooltip: React.FC<PopoverProps> = ({\n  isOpen,\n  anchorEl,\n  placement = \"auto\",\n  children,\n}) => {\n  const [popoverRef, setPopoverRef] = React.useState<HTMLDivElement | null>(\n    null\n  );\n  const [arrowRef, setArrowRef] = React.useState<HTMLDivElement | null>(null);\n\n  const { attributes, styles: popperStyles } = usePopper(\n    isOpen ? anchorEl : null,\n    popoverRef,\n    {\n      placement,\n      modifiers: [\n        {\n          name: \"arrow\",\n          options: {\n            element: arrowRef,\n          },\n        },\n        {\n          name: \"offset\",\n          options: {\n            offset: [0, 8],\n          },\n        },\n      ],\n    }\n  );\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return createPortal(\n    <div\n      ref={setPopoverRef}\n      className={styles[\"tooltip\"]}\n      style={popperStyles.popper}\n      role=\"tooltip\"\n      {...attributes.popper}\n    >\n      {children}\n      <div\n        ref={setArrowRef}\n        data-popper-arrow\n        className={styles[\"tooltip-arrow\"]}\n        style={popperStyles.arrow}\n        {...attributes.arrow}\n      />\n    </div>,\n    document.body\n  );\n};\n\nexport default Tooltip;\n","// extracted by mini-css-extract-plugin\nexport default {\"tooltip\":\"tooltip--2yxRI\",\"tooltip-arrow\":\"tooltip-arrow--2mJMo\"};","import * as React from \"react\";\nimport uniq from \"lodash/uniq\";\nimport { useDrag } from \"react-dnd\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport {\n  nodeDefinitionFromTypeSelector,\n  nodeDefinitionsSelector,\n} from \"@/services/node-types/selectors/node-types\";\nimport { NodeDefinition } from \"@/nodes/types\";\n\nimport { newNodeDragObject } from \"@/components/CircuitEditor/drag-items/new-node\";\nimport TesselWindow from \"@/components/Tessel/TesselWindow\";\nimport Tooltip from \"@/components/Tooltip\";\n\nimport styles from \"./NodeTrayWindow.module.css\";\nimport { getNodeVisualElement } from \"@/nodes/visuals\";\n\nconst CategoryNames: Record<NodeDefinition[\"category\"], string> = {\n  \"input-output\": \"I/O\",\n  \"integrated-circuit\": \"Integrated Circuits\",\n  logic: \"Logic\",\n};\n\nconst NodeTrayWindow: React.FC = () => {\n  const nodeDefinitions = useSelector(nodeDefinitionsSelector);\n  const categories = uniq(nodeDefinitions.map((x) => x.category));\n\n  return (\n    <TesselWindow title=\"Elements\" className={styles[\"node-tray\"]}>\n      <ul className={styles[\"node-tray-elements\"]}>\n        {categories.map((category) => (\n          <TrayCategory key={category} category={category} />\n        ))}\n      </ul>\n    </TesselWindow>\n  );\n};\nexport default NodeTrayWindow;\n\ninterface TrayCategoryProps {\n  category: NodeDefinition[\"category\"];\n}\n\nconst TrayCategory: React.FC<TrayCategoryProps> = ({ category }) => {\n  const nodeDefinitions = useSelector(nodeDefinitionsSelector);\n  const defInCategory = nodeDefinitions.filter(\n    (def) => def.category === category\n  );\n\n  const nodes = defInCategory\n    .filter((def) => def.category === category)\n    .map((def) => {\n      return <TrayNode key={def.type} nodeType={def.type} />;\n    });\n\n  return (\n    <>\n      <li className={styles[\"node-tray-category\"]}>\n        {CategoryNames[category]}\n      </li>\n      {nodes}\n    </>\n  );\n};\n\ninterface TrayNodeProps {\n  nodeType: string;\n}\nconst TrayNode: React.FC<TrayNodeProps> = ({ nodeType }) => {\n  const [liRef, setLiRef] = React.useState<HTMLElement | null>(null);\n  const def = useSelector((state) =>\n    nodeDefinitionFromTypeSelector(state, nodeType)\n  );\n\n  const [showTooltip, setShowTooltip] = React.useState(false);\n  const onShowTooltip = React.useCallback((e: React.MouseEvent) => {\n    e.preventDefault();\n    setShowTooltip(true);\n  }, []);\n  const onHideTooltip = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.target !== liRef) {\n        return;\n      }\n      setShowTooltip(false);\n    },\n    [liRef]\n  );\n\n  const [, dragRef] = useDrag({\n    item: newNodeDragObject(nodeType),\n  });\n\n  let nodeTrayVisual: JSX.Element;\n  let displayName = nodeType;\n  let viewBox = \"0 0 50 50\";\n  if (def) {\n    const { trayComponent, hitRect } = def.visual;\n    if (trayComponent) {\n      const TrayComponent = trayComponent;\n      nodeTrayVisual = <TrayComponent />;\n    } else {\n      nodeTrayVisual = getNodeVisualElement(\n        undefined,\n        [],\n        undefined,\n        def.visual\n      );\n      viewBox = `${hitRect.p1.x} ${hitRect.p1.y} ${hitRect.p2.x} ${hitRect.p2.y}`;\n    }\n    displayName = def.displayName;\n  } else {\n    nodeTrayVisual = <NodeTrayErrorComponent />;\n  }\n\n  return (\n    <li\n      ref={(ref) => {\n        setLiRef(ref);\n        dragRef(ref);\n      }}\n      className={styles[\"node-tray-item\"]}\n      onClick={onShowTooltip}\n      onMouseOut={onHideTooltip}\n    >\n      <Tooltip placement=\"top\" isOpen={showTooltip} anchorEl={liRef}>\n        Click and drag to create a new circuit element.\n      </Tooltip>\n      <span className={styles[\"node-tray-item-preview\"]}>\n        <svg width={30} height={30} viewBox={viewBox}>\n          {nodeTrayVisual}\n        </svg>\n      </span>\n      <span className={interaction[\"text-unselectable\"]}>{displayName}</span>\n    </li>\n  );\n};\n\nconst NodeTrayErrorComponent = () => (\n  <rect fill=\"red\" x1={0} y1={0} x2={50} y2={50} />\n);\n","// extracted by mini-css-extract-plugin\nexport default {\"node-tray\":\"node-tray--3lZIP\",\"node-tray-elements\":\"node-tray-elements--1GkKn\",\"node-tray-category\":\"node-tray-category--2EvV3\",\"node-tray-item\":\"node-tray-item--16YJl\",\"node-tray-item-preview\":\"node-tray-item-preview--1SRbp\"};","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\n\nimport sizing from \"@/styles/sizing.module.css\";\nimport flex from \"@/styles/flex.module.css\";\n\nimport { rearrangeLayout } from \"@/actions/layout-rearrange\";\nimport { circuitEditorDragAbort } from \"@/actions/circuit-editor-drag-abort\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useNativeEvent } from \"@/hooks/useNativeEvent\";\n\nimport Tessel, { TesselValue, TesselWindowItem } from \"@/components/Tessel\";\n\nimport { layoutSelector } from \"@/services/ui-layout/selectors/layout\";\n\nimport ProjectEditorTitleBar from \"./components/ProjectEditorTitleBar\";\n\nimport CircuitFieldWindow from \"./windows/CircuitEditorWindow\";\nimport CircuitsTreeWindow from \"./windows/CircuitsTreeWindow\";\nimport NodeTrayWindow from \"./windows/NodeTrayWindow\";\n\nconst WindowsById: Record<string, React.ComponentType<any>> = {\n  \"node-tray\": NodeTrayWindow,\n  \"circuit-field\": CircuitFieldWindow,\n  \"circuits-list\": CircuitsTreeWindow,\n};\n\nfunction renderWindow(window: TesselWindowItem): React.ReactElement | null {\n  const Component = WindowsById[window.windowId];\n  if (!Component) {\n    return null;\n  }\n  return <Component {...window.windowProps} />;\n}\n\nconst ProjectEditorPage: React.FC = () => {\n  const dispatch = useDispatch();\n  const layout = useSelector(layoutSelector);\n  const onLayoutChange = React.useCallback(\n    (layout: TesselValue) => {\n      dispatch(rearrangeLayout(layout));\n    },\n    [dispatch]\n  );\n\n  // A bit hacky, but we need some singleton component to install a global check\n  // to look for drag cancellations when we mouse up outside of any circuit editor.\n  const onMouseUp = React.useCallback(\n    (e: MouseEvent) => {\n      let element: Element | null = e.target as Element;\n      while (element != null) {\n        if (element.classList.contains(\"circuit-editor\")) {\n          return;\n        }\n        element = element.parentElement;\n      }\n      dispatch(circuitEditorDragAbort());\n    },\n    [dispatch]\n  );\n\n  useNativeEvent({ current: document.body }, \"mouseup\", onMouseUp);\n\n  return (\n    <div className={cls(sizing[\"fill-parent\"], flex[\"flex-column\"])}>\n      <ProjectEditorTitleBar className={flex[\"flexitem-fix\"]} />\n      <div className={cls(sizing[\"fill-parent\"], flex[\"flexitem-shrink\"])}>\n        <Tessel\n          className={cls(\"project-editor\", sizing[\"fill-parent\"])}\n          rootItem={layout}\n          onLayoutChange={onLayoutChange}\n          renderWindow={renderWindow}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default ProjectEditorPage;\n","// extracted by mini-css-extract-plugin\nexport default {\"circuitstree\":\"circuitstree--QeaI9\"};","import ProjectEditorPage from \"./ProjectEditorPage\";\nexport default ProjectEditorPage;\n","import ProjectImporterPage from \"./ProjectImporterPage\";\nexport default ProjectImporterPage;\n","import { importProjectLink } from \"@/actions/project-import-link\";\nimport * as React from \"react\";\n\nimport { useDispatch } from \"react-redux\";\nimport { RouteChildrenProps } from \"react-router-dom\";\n\nconst ProjectImporterPage: React.FC<RouteChildrenProps> = ({ location }) => {\n  const dispatch = useDispatch();\n  const [importError, setImportError] = React.useState(false);\n\n  React.useEffect(() => {\n    let searchParams: URLSearchParams;\n    try {\n      searchParams = new URLSearchParams(location.search);\n    } catch (e) {\n      setImportError(true);\n      return;\n    }\n\n    const data = searchParams.get(\"data\");\n    if (!data) {\n      setImportError(true);\n      return;\n    }\n\n    dispatch(importProjectLink(data));\n\n    // This is an effect, these are not dependencies.  Stop warning me about this.\n    // We only want to run on page load.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // TODO: better styling.\n\n  if (importError) {\n    // TODO: Better error message\n    return <div>Failed to import project</div>;\n  }\n\n  return <div>Importing Project...</div>;\n};\n\nexport default ProjectImporterPage;\n","import * as React from \"react\";\n\nimport { Switch, Route } from \"react-router-dom\";\n\nimport ProjectEditorPage from \"@/pages/ProjectEditorPage\";\nimport ProjectImporterPage from \"@/pages/ProjectImporterPage\";\n\nconst Routes: React.FC = () => {\n  return (\n    <Switch>\n      <Route exact path=\"/\" component={ProjectEditorPage} />\n      <Route exact path=\"/import\" component={ProjectImporterPage} />\n    </Switch>\n  );\n};\n\nexport default Routes;\n","import { createDialogSelector } from \"../utils\";\n\nexport const dialogTypeSelector = createDialogSelector((s) => s.dialogType);\nexport const dialogDataSelector = createDialogSelector((s) => s.data);\n","// extracted by mini-css-extract-plugin\nexport default {\"modal\":\"modal--25LBN\",\"modal-content\":\"modal-content--1H0T_\"};","export * from \"./Modal\";\nimport Modal from \"./Modal\";\nexport default Modal;\n","import { cls } from \"@/utils\";\nimport * as React from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { FocusOn, AutoFocusInside } from \"react-focus-on\";\n\nimport sizing from \"@/styles/sizing.module.css\";\n\nimport styles from \"./Modal.module.css\";\n\nexport interface ModalProps {\n  className?: string;\n  isOpen: boolean;\n  onRequestClose?(): void;\n}\n\nconst Modal: React.FC<ModalProps> = ({\n  className,\n  isOpen,\n  onRequestClose,\n  children,\n}) => {\n  if (!isOpen) {\n    return null;\n  }\n\n  return createPortal(\n    <div className={cls(\"modal\", styles[\"modal\"])}>\n      <FocusOn onClickOutside={onRequestClose} onEscapeKey={onRequestClose}>\n        <div className={cls(styles[\"modal-content\"], className)}>\n          <AutoFocusInside className={sizing[\"fill-parent\"]}>\n            {children}\n          </AutoFocusInside>\n        </div>\n      </FocusOn>\n    </div>,\n    document.body\n  );\n};\n\nexport default Modal;\n","export * from \"./Dialog\";\nimport Dialog from \"./Dialog\";\nexport default Dialog;\n","import * as React from \"react\";\n\nimport Button from \"@/components/Button\";\nimport Modal from \"@/components/Modal\";\n\nimport styles from \"./Dialog.module.css\";\n\nexport interface DialogProps {\n  isOpen: boolean;\n  title: string;\n  acceptText?: string;\n  cancelText?: string;\n  footer?: React.ReactNode;\n  onAccept?(): void;\n  onCancel?(): void;\n}\n\nconst Dialog: React.FC<DialogProps> = ({\n  isOpen,\n  title,\n  acceptText,\n  cancelText,\n  onAccept,\n  onCancel,\n  footer,\n  children,\n}) => {\n  return (\n    <Modal\n      className={styles[\"dialog\"]}\n      isOpen={isOpen}\n      onRequestClose={onCancel}\n    >\n      <div className={styles[\"dialog-title\"]}>{title}</div>\n      <div>{children}</div>\n      <div className={styles[\"dialog-footer\"]}>\n        {footer}\n        {onCancel && (\n          <Button onClick={onCancel}>{cancelText ?? \"Cancel\"}</Button>\n        )}\n        {onAccept && (\n          <Button variant=\"primary\" onClick={onAccept}>\n            {acceptText ?? \"Accept\"}\n          </Button>\n        )}\n      </div>\n    </Modal>\n  );\n};\n\nexport default Dialog;\n","// extracted by mini-css-extract-plugin\nexport default {\"dialog\":\"dialog--1eQi6\",\"dialog-title\":\"dialog-title--1DWsL\",\"dialog-footer\":\"dialog-footer--2hYdr\"};","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useAction } from \"@/hooks/useAction\";\n\nimport { acceptDialog } from \"@/actions/dialog-response-accept\";\n\nimport { dialogDataSelector } from \"@/services/dialog/selectors/dialog\";\n\nimport Button from \"@/components/Button\";\nimport Dialog from \"@/components/Dialog\";\n\nimport styles from \"./ExportProjectLinkDialog.module.css\";\n\nimport { ExportProjectLinkDialogData } from \"./types\";\n\nconst ExportProjectLinkDialog: React.FC = () => {\n  const onCloseDialog = useAction(acceptDialog);\n  const dialogData: ExportProjectLinkDialogData | null = useSelector(\n    dialogDataSelector\n  ) as any;\n\n  const projectLink = dialogData?.projectLink;\n\n  const onCopy = React.useCallback(() => {\n    if (!projectLink) {\n      return;\n    }\n    // TODO: Show link in dialog on failure\n    navigator.clipboard.writeText(projectLink).catch(() => {\n      /* do nothing */\n    });\n  }, [projectLink]);\n\n  if (!projectLink) {\n    return null;\n  }\n\n  const dialogFooter = <Button onClick={onCopy}>Copy to Clipboard</Button>;\n\n  return (\n    <Dialog\n      isOpen={true}\n      title=\"Export Project Link\"\n      cancelText=\"Close\"\n      onCancel={onCloseDialog}\n      footer={dialogFooter}\n    >\n      <div className={styles[\"export-link-dialog-link-container\"]}>\n        <code className={styles[\"export-link-dialog-link\"]}>{projectLink}</code>\n      </div>\n    </Dialog>\n  );\n};\n\nexport default ExportProjectLinkDialog;\n","// extracted by mini-css-extract-plugin\nexport default {\"export-link-dialog-link-container\":\"export-link-dialog-link-container--phwUA\",\"export-link-dialog-link\":\"export-link-dialog-link--1dOdK\"};","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport uniq from \"lodash/uniq\";\n\nimport { useAction } from \"@/hooks/useAction\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { acceptDialog } from \"@/actions/dialog-response-accept\";\nimport { cancelDialog } from \"@/actions/dialog-response-cancel\";\n\nimport { dialogDataSelector } from \"@/services/dialog/selectors/dialog\";\n\nimport Dialog from \"@/components/Dialog\";\nimport Checkbox from \"@/components/Checkbox\";\n\nimport styles from \"./ImportProjectCircuitsDialog.module.css\";\nimport { ImportProjectCircuitsDialogData } from \"./types\";\n\nconst ImportProjectCircuitsDialog: React.FC = () => {\n  const dispatch = useDispatch();\n  const dialogData: ImportProjectCircuitsDialogData | null = useSelector(\n    dialogDataSelector\n  ) as any;\n\n  const [selectedIds, setSelectedIds] = React.useState<string[]>([]);\n\n  const onCloseDialog = useAction(cancelDialog);\n  const onAcceptDialog = React.useCallback(() => {\n    dispatch(acceptDialog(selectedIds));\n  }, [dispatch, selectedIds]);\n\n  if (!dialogData) {\n    return null;\n  }\n\n  const { circuits } = dialogData;\n\n  return (\n    <Dialog\n      isOpen={true}\n      title=\"Import Circuits\"\n      onAccept={onAcceptDialog}\n      onCancel={onCloseDialog}\n      acceptText=\"Import Circuits\"\n    >\n      <div>\n        <p>Choose the circuits to import.</p>\n        <p>\n          Any chosen circuits that depend on other circuits will import their\n          dependencies automatically.\n        </p>\n        <p>\n          If any circuits already exist in your project, they will not be\n          re-imported.\n        </p>\n      </div>\n      <ul className={styles[\"import-project-circuits-list\"]}>\n        {circuits.map(({ circuitId, circuitName }) => (\n          <li key={circuitId}>\n            <ImportCircuitCheckbox\n              circuitId={circuitId}\n              circuitName={circuitName}\n              selectedIds={selectedIds}\n              onSetSelectedIds={setSelectedIds}\n            />\n          </li>\n        ))}\n      </ul>\n    </Dialog>\n  );\n};\n\ninterface ImportCircuitCheckboxProps {\n  circuitId: string;\n  circuitName: string;\n  selectedIds: string[];\n  onSetSelectedIds(selectedIds: string[]): void;\n}\nconst ImportCircuitCheckbox: React.FC<ImportCircuitCheckboxProps> = ({\n  circuitId,\n  circuitName,\n  selectedIds,\n  onSetSelectedIds,\n}) => {\n  const onChange = React.useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      if (e.target.checked) {\n        onSetSelectedIds(uniq([...selectedIds, circuitId]));\n      }\n    },\n    [circuitId, onSetSelectedIds, selectedIds]\n  );\n\n  return (\n    <Checkbox onChange={onChange} value={selectedIds.indexOf(circuitId) !== -1}>\n      {circuitName}\n    </Checkbox>\n  );\n};\n\nexport default ImportProjectCircuitsDialog;\n","// extracted by mini-css-extract-plugin\nexport default {\"import-project-circuits-list\":\"import-project-circuits-list--2ODCz\"};","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { dialogTypeSelector } from \"@/services/dialog/selectors/dialog\";\n\nimport { getDialogComponent } from \"@/dialogs/renderer\";\n\nconst DialogManager: React.FC = () => {\n  const dialogType = useSelector(dialogTypeSelector);\n\n  if (!dialogType) {\n    return null;\n  }\n\n  const DialogComponent = getDialogComponent(dialogType);\n  return <DialogComponent />;\n};\n\nexport default DialogManager;\n","import DialogManager from \"./DialogManager\";\nexport default DialogManager;\n","import React from \"react\";\nimport { DialogType } from \"./types\";\n\nimport { ExportProjectLinkDialog } from \"./dialog-types/export-project-link\";\nimport { ImportProjectCircuitsDialog } from \"./dialog-types/import-project-circuits\";\n\nexport function getDialogComponent(type: DialogType): React.ComponentType {\n  switch (type) {\n    case \"export-project-link\":\n      return ExportProjectLinkDialog;\n    case \"import-project-circuits\":\n      return ImportProjectCircuitsDialog;\n    default:\n      return unknownDialog(type);\n  }\n}\n\nfunction unknownDialog(dialogType: never): never {\n  throw new Error(`Unknown dialog type ${dialogType}`);\n}\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport \"resize-observer-polyfill\";\n\nimport { Provider } from \"react-redux\";\nimport { Router } from \"react-router-dom\";\n\nimport { DndProvider } from \"react-dnd\";\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\n\nimport history from \"./history\";\nimport \"./styles\";\n\nimport { store } from \"./store\";\n\nimport App from \"./components/App\";\n\nconst rootEl = document.getElementById(\"root\");\n\nReactDOM.render(\n  <DndProvider backend={HTML5Backend}>\n    <Router history={history}>\n      <Provider store={store}>\n        <App />\n      </Provider>\n    </Router>\n  </DndProvider>,\n  rootEl\n);\n","import * as React from \"react\";\n\nimport Routes from \"@/router\";\n\nimport DialogManager from \"../DialogManager\";\n\nconst App: React.FC = () => {\n  return (\n    <>\n      <Routes />\n      <DialogManager />\n    </>\n  );\n};\n\nexport default App;\n","import { NodeDefinition } from \"../../types\";\n\nconst toggleElementDefinition: NodeDefinition = {\n  type: \"interaction-momentary\",\n  category: \"input-output\",\n  displayName: \"Momentary Switch\",\n  elementProduction: \"input-momentary\",\n  visual: {\n    hitRect: {\n      p1: { x: 5, y: 5 },\n      p2: { x: 45, y: 45 },\n    },\n    component: \"interaction-momentary\",\n  },\n  pins: {\n    OUT: {\n      direction: \"output\",\n      x: 50,\n      y: 25,\n    },\n  },\n};\n\nexport default toggleElementDefinition;\n","import { NodeDefinition } from \"../../types\";\n\nconst toggleElementDefinition: NodeDefinition = {\n  type: \"interaction-toggle\",\n  category: \"input-output\",\n  displayName: \"Toggle Switch\",\n  elementProduction: \"input-toggle\",\n  visual: {\n    hitRect: {\n      p1: { x: 5, y: 5 },\n      p2: { x: 45, y: 45 },\n    },\n    component: \"interaction-toggle\",\n  },\n  pins: {\n    OUT: {\n      direction: \"output\",\n      x: 50,\n      y: 25,\n    },\n  },\n};\n\nexport default toggleElementDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { NodeDefinition } from \"../../types\";\nimport { createStaticNodeVisual } from \"../../visuals/static-node-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:AND_ANSI.svg\n\nconst hitPath = `M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30z`;\n\nconst andNodeDefinition: NodeDefinition = {\n  type: \"logic-and\",\n  category: \"logic\",\n  displayName: \"AND\",\n  elementProduction: \"logic-and\",\n  visual: createStaticNodeVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"node-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M70,25 h30 M31,15 H5 M32,35 H5\"\n      />\n      <path\n        className=\"node-select-highlight--fill\"\n        d=\"M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30zm2.857143 2.857143H50.47619c9.760663 0 16.666667 7.639955 16.666667 17.142857 0 9.502902-7.382195 17.142857-17.142857 17.142857H32.857143V7.857143z\"\n      />\n    </g>\n  ),\n  pins: {\n    A: { direction: \"input\", x: 0, y: 14.5 },\n    B: { direction: \"input\", x: 0, y: 35 },\n    OUT: { direction: \"output\", x: 100, y: 25 },\n  },\n};\nexport default andNodeDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { NodeDefinition } from \"../../types\";\nimport { createStaticNodeVisual } from \"../../visuals/static-node-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:Buffer_ANSI.svg\n\nconst hitPath = `M 28.96875,2.59375 L 28.96875,5 L 28.96875,45 L 28.96875,47.40625 L 31.125,46.34375 L 72.15625,26.34375 L 75,25 L 72.15625,23.65625 L 31.125,3.65625 L 28.96875,2.59375 z`;\n\nconst bufferNodeDefinition: NodeDefinition = {\n  type: \"logic-buffer\",\n  category: \"logic\",\n  displayName: \"Buffer\",\n  elementProduction: \"logic-buffer\",\n  visual: createStaticNodeVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"node-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"black\"\n        strokeWidth=\"2\"\n        d=\"M72,25 L 100,25\"\n      />\n      <path\n        className=\"node-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"black\"\n        strokeWidth=\"2\"\n        d=\"M 29.043478,25 L 5.0434781,25\"\n      />\n      <path\n        className=\"node-select-highlight--fill\"\n        stroke=\"none\"\n        fill=\"black\"\n        d=\"M 28.96875,2.59375 L 28.96875,5 L 28.96875,45 L 28.96875,47.40625 L 31.125,46.34375 L 72.15625,26.34375 L 75,25 L 72.15625,23.65625 L 31.125,3.65625 L 28.96875,2.59375 z M 31.96875,7.40625 L 68.09375,25 L 31.96875,42.59375 L 31.96875,7.40625 z\"\n      />\n    </g>\n  ),\n  pins: {\n    IN: {\n      direction: \"input\",\n      x: 0,\n      y: 25,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default bufferNodeDefinition;\n","import * as React from \"react\";\n\nimport { Rectangle } from \"@/geometry\";\n\nimport { NodeDefinition } from \"../../types\";\nimport { createStaticNodeVisual } from \"../../visuals/static-node-visual\";\n\n// Shape path from https://en.wikipedia.org/wiki/NAND_logic#/media/File:NAND_ANSI_Labelled.svg\n\nconst hitRect: Rectangle = {\n  p1: {\n    x: 24,\n    y: 5,\n  },\n  p2: {\n    x: 80,\n    y: 45,\n  },\n};\n\nconst nandNodeDefinition: NodeDefinition = {\n  type: \"logic-nand\",\n  category: \"logic\",\n  displayName: \"NAND\",\n  elementProduction: \"logic-nand\",\n  visual: createStaticNodeVisual(\n    hitRect,\n    <g transform=\"translate(-10,0)\">\n      <path\n        d=\"M 40,5 L 40,6.4285714 L 40,43.571429 L 40,45 L 41.428571,45 L 60.47619,45 C 71.744098,45 80.47619,35.999955 80.47619,25 C 80.47619,14.000045 71.744099,5.0000002 60.47619,5 C 60.47619,5 60.47619,5 41.428571,5 L 40,5 z\"\n        stroke=\"none\"\n        fill=\"transparent\"\n      />\n      <path\n        className=\"node-select-highlight--stroke\"\n        strokeWidth=\"2\"\n        stroke=\"black\"\n        fill=\"none\"\n        d=\"M 88,25 H110\"\n      />\n      <path\n        className=\"node-select-highlight--stroke\"\n        strokeWidth=\"2\"\n        stroke=\"black\"\n        fill=\"none\"\n        d=\"M 41,15 L 15,15\"\n      />\n      <path\n        className=\"node-select-highlight--stroke\"\n        strokeWidth=\"2\"\n        stroke=\"black\"\n        fill=\"none\"\n        d=\"M 42,35 L 15,35\"\n      />\n      <path\n        className=\"node-select-highlight--fill\"\n        d=\"M 40,5 L 40,6.4285714 L 40,43.571429 L 40,45 L 41.428571,45 L 60.47619,45 C 71.744098,45 80.47619,35.999955 80.47619,25 C 80.47619,14.000045 71.744099,5.0000002 60.47619,5 C 60.47619,5 60.47619,5 41.428571,5 L 40,5 z M 42.857143,7.8571429 C 50.834264,7.8571429 55.918368,7.8571429 58.095238,7.8571429 C 59.285714,7.8571429 59.880952,7.8571429 60.178571,7.8571429 C 60.327381,7.8571429 60.409227,7.8571429 60.446429,7.8571429 C 60.465029,7.8571429 60.471543,7.8571429 60.47619,7.8571429 C 70.236853,7.857143 77.142857,15.497098 77.142857,25 C 77.142857,34.502902 69.760662,42.142857 60,42.142857 L 42.857143,42.142857 L 42.857143,7.8571429 z\"\n      />\n      <path\n        className=\"node-select-highlight--stroke\"\n        strokeWidth=\"2\"\n        stroke=\"black\"\n        fill=\"none\"\n        d=\"M 79,25 A 4,4 0 1 1 71,25 A 4,4 0 1 1 79,25 z\"\n        transform=\"translate(9,0)\"\n      />\n    </g>\n  ),\n  pins: {\n    A: {\n      direction: \"input\",\n      x: 0,\n      y: 14.5,\n    },\n    B: {\n      direction: \"input\",\n      x: 0,\n      y: 35,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default nandNodeDefinition;\n","import * as React from \"react\";\n\nimport { Rectangle } from \"@/geometry\";\n\nimport { NodeDefinition } from \"../../types\";\nimport { createStaticNodeVisual } from \"../../visuals/static-node-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:NOR_ANSI.svg\n\nconst hitRect: Rectangle = {\n  p1: {\n    x: 24,\n    y: 5,\n  },\n  p2: {\n    x: 80,\n    y: 45,\n  },\n};\n\nconst norNodeDefinition: NodeDefinition = {\n  type: \"logic-nor\",\n  category: \"logic\",\n  displayName: \"NOR\",\n  elementProduction: \"logic-nor\",\n  visual: createStaticNodeVisual(\n    hitRect,\n    <g>\n      <path\n        fill=\"transparent\"\n        stroke=\"none\"\n        d=\"M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z\"\n      />\n      <path\n        className=\"node-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M79,25 h21 M31,15 H5 M32,35 H5\"\n      />\n      <path\n        className=\"node-select-highlight--fill\"\n        fillRule=\"evenodd\"\n        d=\"M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375zm5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z\"\n      />\n      <path\n        className=\"node-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z\"\n      />\n    </g>\n  ),\n  pins: {\n    A: {\n      direction: \"input\",\n      x: 0,\n      y: 14.5,\n    },\n    B: {\n      direction: \"input\",\n      x: 0,\n      y: 35,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default norNodeDefinition;\n","import * as React from \"react\";\n\nimport { Rectangle } from \"@/geometry\";\n\nimport { NodeDefinition } from \"../../types\";\nimport { createStaticNodeVisual } from \"../../visuals/static-node-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:NOT_ANSI.svg\n\nconst hitRect: Rectangle = {\n  p1: {\n    x: 24,\n    y: 5,\n  },\n  p2: {\n    x: 80,\n    y: 45,\n  },\n};\n\nconst notNodeDefinition: NodeDefinition = {\n  type: \"logic-not\",\n  category: \"logic\",\n  displayName: \"NOT\",\n  elementProduction: \"logic-not\",\n  visual: createStaticNodeVisual(\n    hitRect,\n    <g>\n      <path\n        fill=\"transparent\"\n        stroke=\"none\"\n        d=\"M28.96875 2.59375v44.8125l2.15625-1.0625 41.03125-20v-2.6875l-41.03125-20-2.15625-1.0625z\"\n      />\n      <path\n        className=\"node-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M79,25 H100 M29,25 h-24\"\n      />\n      <path\n        className=\"node-select-highlight--fill\"\n        d=\"M28.96875 2.59375v44.8125l2.15625-1.0625 41.03125-20v-2.6875l-41.03125-20-2.15625-1.0625zm3 4.8125L68.09375 25l-36.125 17.59375V7.40625z\"\n      />\n      <path\n        className=\"node-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z\"\n      />\n    </g>\n  ),\n  pins: {\n    IN: {\n      direction: \"input\",\n      x: 0,\n      y: 25,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default notNodeDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { NodeDefinition } from \"../../types\";\nimport { createStaticNodeVisual } from \"../../visuals/static-node-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:OR_ANSI.svg\n\nconst hitPath = `M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z`;\n\nconst orNodeDefinition: NodeDefinition = {\n  type: \"logic-or\",\n  category: \"logic\",\n  displayName: \"OR\",\n  elementProduction: \"logic-or\",\n  visual: createStaticNodeVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"node-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M70,25 h30 M31,15 H5 M32,35 H5\"\n      />\n      <path\n        className=\"node-select-highlight--fill\"\n        fillRule=\"evenodd\"\n        d=\"M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375zm5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z\"\n      />\n    </g>\n  ),\n  pins: {\n    A: {\n      direction: \"input\",\n      x: 0,\n      y: 14.5,\n    },\n    B: {\n      direction: \"input\",\n      x: 0,\n      y: 35,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default orNodeDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { NodeDefinition } from \"../../types\";\nimport { createStaticNodeVisual } from \"../../visuals/static-node-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:XOR_ANSI.svg\n\nconst hitPath = `M24.09375 5l2 2.4375S31.75 14.43755 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.40808 0 7.6897.02451 13.625-2.40625s12.53654-7.34327 17.6875-16.875L71.25 25l1.3125-.71875C62.25939 5.21559 46.00657 5 41.25 5H24.09375z`;\n\nconst xorNodeDefinition: NodeDefinition = {\n  type: \"logic-xor\",\n  category: \"logic\",\n  displayName: \"XOR\",\n  elementProduction: \"logic-xor\",\n  visual: createStaticNodeVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"node-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M70,25 h30 M30,15 H5 M31,35 H5\"\n      />\n      <g fillRule=\"evenodd\" className=\"node-select-highlight--fill\">\n        <path d=\"M24.25 42C22.65263 44.6444 22 45 22 45h-3.65625l2-2.4375S26 35.56245 26 25 20.34375 7.4375 20.34375 7.4375l-2-2.4375H22c.78125.9375 1.42188 1.65625 2.21875 3C26.09147 11.09981 29 17.02665 29 25c0 7.95065-2.8967 13.87942-4.75 17z\" />\n        <path d=\"M24.09375 5l2 2.4375S31.75 14.43755 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.40808 0 7.6897.02451 13.625-2.40625s12.53654-7.34327 17.6875-16.875L71.25 25l1.3125-.71875C62.25939 5.21559 46.00657 5 41.25 5H24.09375zm5.875 3H41.25c4.68417 0 18.28685-.1302 27.96875 17C64.45196 33.42907 58.69747 37.68391 53.5 39.8125 48.13934 42.00792 43.65808 42 41.25 42H30c1.87359-3.10843 4.75-9.04935 4.75-17 0-7.97335-2.90853-13.90019-4.78125-17z\" />\n      </g>\n    </g>\n  ),\n  pins: {\n    A: {\n      direction: \"input\",\n      x: 0,\n      y: 14.5,\n    },\n    B: {\n      direction: \"input\",\n      x: 0,\n      y: 35,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default xorNodeDefinition;\n","import { LedElementState } from \"@/elements/definitions/output-led\";\n\nimport { NodeDefinition } from \"../../types\";\nimport { createShapePathVisual } from \"../../visuals/ShapePathNode\";\n\nfunction genCirclePath(cx: number, cy: number, r: number): string {\n  return `M ${cx - r}, ${cy}\n    a ${r},${r} 0 1,0 ${r * 2},0\n    a ${r},${r} 0 1,0 ${-(r * 2)},0`;\n}\n\nconst path = genCirclePath(25, 25, 20);\n\nconst ledNodeDefinition: NodeDefinition = {\n  type: \"output-led\",\n  category: \"input-output\",\n  displayName: \"Indicator Light\",\n  elementProduction: \"output-led\",\n  visual: createShapePathVisual(path, {\n    path,\n    stroke: \"black\",\n    strokeWidth: 3,\n    fill: (state: LedElementState) =>\n      state.value ? \"lightgreen\" : \"darkgreen\",\n  }),\n  pins: {\n    IN: {\n      direction: \"input\",\n      x: 0,\n      y: 25,\n    },\n  },\n};\nexport default ledNodeDefinition;\n","import { NodeDefinition } from \"../../types\";\nimport {\n  createShapePathVisual,\n  NodeVisualPathDefinition,\n} from \"../../visuals/ShapePathNode\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:7-segment_abcdefg.svg\n\nconst SCALE = 3;\nconst OFFSET = [15, 0];\n\n/**\n * Produce a visual path definition of a segment given a series of polygon points.\n * The path definition will color itself based on the state key specified by 'name'\n * @param name The state key to select color based on.  The key should represent a boolean value.\n * @param points An array of [x,y] pairs that make up the polygon.\n */\nfunction createSeg(\n  name: string,\n  points: [number, number][]\n): NodeVisualPathDefinition {\n  const start = points[0];\n  let path = `M${start[0] * SCALE + OFFSET[0]},${start[1] * SCALE + OFFSET[1]}`;\n  for (const p of points.slice(1)) {\n    const [x, y] = p;\n    path += `L${x * SCALE + OFFSET[0]},${y * SCALE + OFFSET[1]}`;\n  }\n  path += \"z\";\n  return {\n    path,\n    fill: (state) => (state[name] ? \"red\" : \"gray\"),\n    strokeWidth: 0,\n  };\n}\n\nconst seg7ElementDefinition: NodeDefinition = {\n  type: \"output-seg7\",\n  category: \"input-output\",\n  displayName: \"7-Segment Display\",\n  elementProduction: \"output-seg7\",\n  visual: createShapePathVisual(`M15,0 V63 H45 V0 z`, [\n    createSeg(\"A\", [\n      [1, 1],\n      [2, 0],\n      [8, 0],\n      [9, 1],\n      [8, 2],\n      [2, 2],\n    ]),\n    createSeg(\"B\", [\n      [9, 1],\n      [10, 2],\n      [10, 8],\n      [9, 9],\n      [8, 8],\n      [8, 2],\n    ]),\n    createSeg(\"C\", [\n      [9, 9],\n      [10, 10],\n      [10, 16],\n      [9, 17],\n      [8, 16],\n      [8, 10],\n    ]),\n    createSeg(\"D\", [\n      [9, 17],\n      [8, 18],\n      [2, 18],\n      [1, 17],\n      [2, 16],\n      [8, 16],\n    ]),\n    createSeg(\"E\", [\n      [1, 17],\n      [0, 16],\n      [0, 10],\n      [1, 9],\n      [2, 10],\n      [2, 16],\n    ]),\n    createSeg(\"F\", [\n      [1, 9],\n      [0, 8],\n      [0, 2],\n      [1, 1],\n      [2, 2],\n      [2, 8],\n    ]),\n    createSeg(\"G\", [\n      [1, 9],\n      [2, 8],\n      [8, 8],\n      [9, 9],\n      [8, 10],\n      [2, 10],\n    ]),\n  ]),\n  pins: {\n    A: {\n      direction: \"input\",\n      x: 0,\n      y: 5,\n    },\n    B: {\n      direction: \"input\",\n      x: 0,\n      y: 15,\n    },\n    C: {\n      direction: \"input\",\n      x: 0,\n      y: 25,\n    },\n    D: {\n      direction: \"input\",\n      x: 0,\n      y: 35,\n    },\n    E: {\n      direction: \"input\",\n      x: 0,\n      y: 45,\n    },\n    F: {\n      direction: \"input\",\n      x: 0,\n      y: 55,\n    },\n    G: {\n      direction: \"input\",\n      x: 0,\n      y: 65,\n    },\n  },\n};\nexport default seg7ElementDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { NodeDefinition } from \"../../types\";\nimport { createStaticNodeVisual } from \"../../visuals/static-node-visual\";\n\nconst hitPath = `M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0`;\n\nconst pinHighElementDefinition: NodeDefinition = {\n  type: \"pin-high\",\n  category: \"input-output\",\n  elementProduction: \"pin-high\",\n  displayName: \"High Pin\",\n  visual: createStaticNodeVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"node-select-highlight--stroke\"\n        d=\"M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0 M35,25 h15\"\n        stroke=\"black\"\n        strokeWidth={2}\n        fill=\"none\"\n      />\n      <path\n        className=\"node-select-highlight--stroke\"\n        d=\"M25,20 v10 M20,25 h10\"\n        fill=\"none\"\n        stroke=\"black\"\n        strokeWidth={2}\n      />\n    </g>\n  ),\n  pins: {\n    OUT: {\n      direction: \"output\",\n      x: 50,\n      y: 25,\n    },\n  },\n};\nexport default pinHighElementDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\nimport { describeArc } from \"@/svg\";\n\nimport { NodeDefinition } from \"../../types\";\nimport { createStaticNodeVisual } from \"../../visuals/static-node-visual\";\n\nconst hitPath = `M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0`;\n\nconst pinInputElementDefinition: NodeDefinition = {\n  type: \"pin-input\",\n  category: \"input-output\",\n  displayName: \"Input Pin\",\n  visual: createStaticNodeVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"node-select-highlight--stroke\"\n        d=\"M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0 M35,25 h15\"\n        stroke=\"black\"\n        strokeWidth={2}\n        fill=\"none\"\n      />\n      <path\n        className=\"node-select-highlight--stroke\"\n        d={describeArc(25, 25, 3, -45, 225)}\n        fill=\"none\"\n        stroke=\"black\"\n        strokeWidth={2}\n      />\n    </g>\n  ),\n  pins: {\n    OUT: {\n      direction: \"output\",\n      x: 50,\n      y: 25,\n    },\n  },\n};\nexport default pinInputElementDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { NodeDefinition } from \"../../types\";\nimport { createStaticNodeVisual } from \"../../visuals/static-node-visual\";\n\nconst hitPath = `M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0`;\n\nconst pinOutputElementDefinition: NodeDefinition = {\n  type: \"pin-output\",\n  category: \"input-output\",\n  displayName: \"Output Pin\",\n  visual: createStaticNodeVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"node-select-highlight--stroke\"\n        d=\"M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0 M15,25 h-15\"\n        stroke=\"black\"\n        strokeWidth={2}\n        fill=\"none\"\n      />\n      <circle\n        className=\"node-select-highlight--fill\"\n        cx={25}\n        cy={25}\n        r={3}\n        fill=\"black\"\n        stroke=\"none\"\n      />\n    </g>\n  ),\n  pins: {\n    IN: {\n      direction: \"input\",\n      x: 0,\n      y: 25,\n    },\n  },\n};\nexport default pinOutputElementDefinition;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect, Rectangle } from \"@/geometry\";\n\nimport { interactNode } from \"@/actions/node-interact\";\n\nimport { NodeComponentProps, NodeVisualDefinition } from \"../types\";\n\nexport interface NodeVisualPathDefinition {\n  /**\n   * The svg path of this visual element.\n   */\n  path: string;\n  /**\n   * The fill or fill-producing function for this visual element.\n   */\n  fill?: string | ((state: any) => string);\n  stroke?: string | ((state: any) => string);\n  strokeWidth?: number | ((state: any) => number);\n}\n\nexport type NodeVisualPath = string | NodeVisualPathDefinition;\n\ninterface ShapePathNodeProps {\n  /**\n   * The path or paths that make up the visual component of this node.\n   */\n  shapePath: NodeVisualPath | NodeVisualPath[];\n  hitPath: string;\n}\n\nconst ShapePathNode: React.FC<ShapePathNodeProps & NodeComponentProps> = ({\n  circuitNodeId,\n  circuitNodePath,\n  shapePath,\n  hitPath,\n  elementState,\n}) => {\n  const dispatch = useDispatch();\n\n  const onClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (!circuitNodeId) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      e.preventDefault();\n\n      dispatch(interactNode([...(circuitNodePath || []), circuitNodeId]));\n    },\n    [circuitNodeId, dispatch, circuitNodePath]\n  );\n\n  const visuals = normalizeVisuals(shapePath, elementState);\n  const body = visuals.map((v, i) => (\n    <path\n      key={i}\n      d={v.path}\n      className=\"node-select-highlight--stroke node-select-highlight--fill\"\n      fill={v.fill}\n      stroke={v.stroke}\n      strokeWidth={v.strokeWidth}\n    />\n  ));\n\n  return (\n    <g onClick={onClick}>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      {body}\n    </g>\n  );\n};\n\ninterface TrayShapePathNodeProps {\n  shapePath: NodeVisualPath | NodeVisualPath[];\n  hitRect: Rectangle;\n}\nconst TrayShapePadding = 5;\nconst TrayShapePathNode: React.FC<TrayShapePathNodeProps> = ({\n  shapePath,\n  hitRect,\n}) => {\n  const visuals = normalizeVisuals(shapePath, {});\n  const body = visuals.map((v, i) => (\n    <path\n      key={i}\n      d={v.path}\n      className=\"node-select-highlight--stroke node-select-highlight--fill\"\n      fill={v.fill}\n      stroke={v.stroke}\n      strokeWidth={v.strokeWidth}\n    />\n  ));\n\n  return (\n    <svg\n      width={50}\n      height={50}\n      viewBox={`${hitRect.p1.x - TrayShapePadding} ${\n        hitRect.p1.y - TrayShapePadding\n      } ${hitRect.p2.x - hitRect.p1.x + TrayShapePadding * 2} ${\n        hitRect.p2.y - hitRect.p1.y + TrayShapePadding * 2\n      }`}\n    >\n      {body}\n    </svg>\n  );\n};\n\nexport function createShapePathVisual(\n  hitPath: string,\n  shapePath: NodeVisualPath | NodeVisualPath[]\n): NodeVisualDefinition {\n  const hitRect = boundsToRect(getBounds(hitPath));\n  return {\n    trayComponent: () => (\n      <TrayShapePathNode shapePath={shapePath} hitRect={hitRect} />\n    ),\n    component: (props: NodeComponentProps) => (\n      <ShapePathNode shapePath={shapePath} hitPath={hitPath} {...props} />\n    ),\n    hitRect,\n  };\n}\n\nfunction normalizeVisuals(\n  v: NodeVisualPath | NodeVisualPath[],\n  state: any\n): { path: string; fill?: string; stroke?: string; strokeWidth?: number }[] {\n  const asArray = Array.isArray(v) ? v : [v];\n\n  return asArray.map((x) => {\n    if (typeof x === \"string\") {\n      return {\n        path: x,\n        fill: \"black\",\n        stroke: \"black\",\n        strokeWidth: 2,\n      };\n    }\n    const fill = typeof x.fill === \"function\" ? x.fill(state || {}) : x.fill;\n    const stroke =\n      typeof x.stroke === \"function\" ? x.stroke(state || {}) : x.stroke;\n    const strokeWidth =\n      typeof x.strokeWidth === \"function\"\n        ? x.strokeWidth(state || {})\n        : x.strokeWidth;\n    return {\n      path: x.path,\n      fill,\n      stroke,\n      strokeWidth,\n    };\n  });\n}\n","import * as React from \"react\";\n\nimport { Rectangle } from \"@/geometry\";\n\nimport { NodeVisualDefinition } from \"../types\";\n\nconst TrayComponentPadding = 5;\n\nexport function createStaticNodeVisual(\n  hitRect: Rectangle,\n  element: JSX.Element\n): NodeVisualDefinition {\n  return {\n    hitRect,\n    trayComponent: () => (\n      <svg\n        width={50}\n        height={50}\n        viewBox={`${hitRect.p1.x - TrayComponentPadding} ${\n          hitRect.p1.y - TrayComponentPadding\n        } ${hitRect.p2.x - hitRect.p1.x + TrayComponentPadding * 2} ${\n          hitRect.p2.y - hitRect.p1.y + TrayComponentPadding * 2\n        }`}\n      >\n        {element}\n      </svg>\n    ),\n    component: () => element,\n  };\n}\n","import { Point } from \"./geometry\";\n\n// Arc code from https://stackoverflow.com/questions/5736398/how-to-calculate-the-svg-path-for-an-arc-of-a-circle\nexport function describeArc(\n  x: number,\n  y: number,\n  radius: number,\n  startAngle: number,\n  endAngle: number\n): string {\n  const start = polarToCartesian(x, y, radius, endAngle);\n  const end = polarToCartesian(x, y, radius, startAngle);\n\n  const largeArcFlag = endAngle - startAngle <= 180 ? \"0\" : \"1\";\n\n  const d = [\n    \"M\",\n    start.x,\n    start.y,\n    \"A\",\n    radius,\n    radius,\n    0,\n    largeArcFlag,\n    0,\n    end.x,\n    end.y,\n  ].join(\" \");\n\n  return d;\n}\n\nfunction polarToCartesian(\n  centerX: number,\n  centerY: number,\n  radius: number,\n  angleInDegrees: number\n): Point {\n  const angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180.0;\n\n  return {\n    x: centerX + radius * Math.cos(angleInRadians),\n    y: centerY + radius * Math.sin(angleInRadians),\n  };\n}\n"],"sourceRoot":""}