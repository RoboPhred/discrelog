{"version":3,"sources":["webpack://discrelog/./src/actions/element-interact.ts","webpack://discrelog/./src/elements/definitions/interaction/momentary.tsx","webpack://discrelog/./src/elements/definitions/interaction/toggle.tsx","webpack://discrelog/./src/elements/definitions/logic/and.tsx","webpack://discrelog/./src/elements/definitions/logic/buffer.tsx","webpack://discrelog/./src/elements/definitions/logic/nand.tsx","webpack://discrelog/./src/elements/definitions/logic/nor.tsx","webpack://discrelog/./src/elements/definitions/logic/not.tsx","webpack://discrelog/./src/elements/definitions/logic/or.tsx","webpack://discrelog/./src/elements/definitions/logic/xor.tsx","webpack://discrelog/./src/elements/definitions/output/led.ts","webpack://discrelog/./src/elements/definitions/output/seg7.ts","webpack://discrelog/./src/elements/definitions/pins/high.tsx","webpack://discrelog/./src/elements/definitions/pins/input.tsx","webpack://discrelog/./src/elements/definitions/pins/output.tsx","webpack://discrelog/./src/elements/visuals/ShapePathElementVisual.tsx","webpack://discrelog/./src/elements/visuals/static-element-visual.tsx","webpack://discrelog/./src/evolvers/constants.ts","webpack://discrelog/./src/evolvers/definitions/input-momentary.ts","webpack://discrelog/./src/evolvers/definitions/input-toggle.ts","webpack://discrelog/./src/evolvers/definitions/logic-and.ts","webpack://discrelog/./src/evolvers/definitions/logic-buffer.ts","webpack://discrelog/./src/evolvers/definitions/logic-nand.ts","webpack://discrelog/./src/evolvers/definitions/logic-nor.ts","webpack://discrelog/./src/evolvers/definitions/logic-not.ts","webpack://discrelog/./src/evolvers/definitions/logic-or.ts","webpack://discrelog/./src/evolvers/definitions/logic-xor.ts","webpack://discrelog/./src/evolvers/definitions/output-led.ts","webpack://discrelog/./src/evolvers/definitions/output-seg7.ts","webpack://discrelog/./src/evolvers/definitions/pin-high.ts","webpack://discrelog/./src/geometry.ts","webpack://discrelog/./src/history.ts","webpack://discrelog/./src/services/circuit-editor-drag/state.ts","webpack://discrelog/./src/services/circuits/constants.ts","webpack://discrelog/./src/services/circuit-editors/constants.ts","webpack://discrelog/./src/services/circuit-editors/state.ts","webpack://discrelog/./src/services/circuit-graph/state.ts","webpack://discrelog/./src/services/circuit-layout/state.ts","webpack://discrelog/./src/services/circuit-properties/state.ts","webpack://discrelog/./src/services/clipboard/state.ts","webpack://discrelog/./src/services/dialog/state.ts","webpack://discrelog/./src/services/project/state.ts","webpack://discrelog/./src/services/selection/state.ts","webpack://discrelog/./src/services/simulator/state.ts","webpack://discrelog/./src/services/simulator-control/state.ts","webpack://discrelog/./src/services/tutorial/state.ts","webpack://discrelog/./src/utils.ts","webpack://discrelog/./src/styles/sizing.module.css?9a43","webpack://discrelog/./src/styles/flex.module.css?f6f1","webpack://discrelog/./src/components/Tessel/types.ts","webpack://discrelog/./src/hooks/useRefValue.ts","webpack://discrelog/./src/components/Tessel/Tessel.module.css?d43a","webpack://discrelog/./src/components/Tessel/TesselSplit.tsx","webpack://discrelog/./src/components/Tessel/TesselContext.tsx","webpack://discrelog/./src/components/Tessel/TesselSplitFrame.tsx","webpack://discrelog/./src/components/Tessel/TesselFrame.tsx","webpack://discrelog/./src/arrays.ts","webpack://discrelog/./src/hooks/useComponentBounds.ts","webpack://discrelog/./src/components/Tessel/drag-items/tessel-window.tsx","webpack://discrelog/./src/components/Tessel/TesselDropCapture.tsx","webpack://discrelog/./src/components/Tessel/utils.ts","webpack://discrelog/./src/components/Tessel/Tessel.tsx","webpack://discrelog/./src/components/Tessel/index.ts","webpack://discrelog/./src/pages/ProjectEditorPage/windows/CircuitEditorWindow/tessel-window.ts","webpack://discrelog/./src/services/ui-layout/state.ts","webpack://discrelog/./src/services/ui-settings/state.ts","webpack://discrelog/./src/services/state.ts","webpack://discrelog/./src/undo/state.ts","webpack://discrelog/./src/store/state.ts","webpack://discrelog/./src/env.ts","webpack://discrelog/./src/actions/init.ts","webpack://discrelog/./src/actions/circuit-add.ts","webpack://discrelog/./src/actions/circuit-delete.ts","webpack://discrelog/./src/actions/circuit-rename.ts","webpack://discrelog/./src/actions/element-add.ts","webpack://discrelog/./src/actions/element-delete.ts","webpack://discrelog/./src/actions/element-rename.ts","webpack://discrelog/./src/actions/selection-align-to-grid.ts","webpack://discrelog/./src/actions/selection-delete.ts","webpack://discrelog/./src/actions/selection-move.ts","webpack://discrelog/./src/actions/wire-attach.ts","webpack://discrelog/./src/actions/wire-detatch.ts","webpack://discrelog/./src/actions/wire-joint-add.ts","webpack://discrelog/./src/actions/wire-joint-move.ts","webpack://discrelog/./src/actions/wire-joint-delete.ts","webpack://discrelog/./src/actions/clipboard-paste.ts","webpack://discrelog/./src/actions/circuit-editor-drag-end.ts","webpack://discrelog/./src/actions/undo.ts","webpack://discrelog/./src/actions/redo.ts","webpack://discrelog/./src/actions/project-new.ts","webpack://discrelog/./src/actions/project-receive.ts","webpack://discrelog/./src/project-mutation-actions.ts","webpack://discrelog/./src/services/service-state-utils.ts","webpack://discrelog/./src/services/circuit-editors/utils.ts","webpack://discrelog/./src/services/circuit-editors/selectors/editor.ts","webpack://discrelog/./src/undo/utils.ts","webpack://discrelog/./src/store/utils.ts","webpack://discrelog/./src/actions/circuit-editor-drag-abort.ts","webpack://discrelog/./src/services/circuit-editor-drag/utils.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-abort.ts","webpack://discrelog/./src/actions/circuit-editor-drag-continue.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-continue.ts","webpack://discrelog/./src/selection-mode.ts","webpack://discrelog/./src/actions/select-region.ts","webpack://discrelog/./src/services/circuit-graph/utils.ts","webpack://discrelog/./src/services/circuit-graph/selectors/elements.ts","webpack://discrelog/./src/services/circuit-layout/utils.ts","webpack://discrelog/./src/services/circuit-layout/selectors/element-positions.ts","webpack://discrelog/./src/services/circuit-properties/utils.ts","webpack://discrelog/./src/services/circuit-properties/selectors/circuits.ts","webpack://discrelog/./src/elements/definitions/integrated-circuits/utils.ts","webpack://discrelog/./src/elements/definitions/integrated-circuits/index.tsx","webpack://discrelog/./src/elements/definitions/interaction/index.ts","webpack://discrelog/./src/elements/definitions/index.ts","webpack://discrelog/./src/elements/definitions/logic/index.ts","webpack://discrelog/./src/elements/definitions/output/index.ts","webpack://discrelog/./src/elements/definitions/pins/index.ts","webpack://discrelog/./src/services/element-types/selectors/element-types.ts","webpack://discrelog/./src/services/circuit-graph/types.ts","webpack://discrelog/./src/services/circuit-layout/selectors/element-pin-positions.ts","webpack://discrelog/./src/services/circuit-editor-drag/selectors/snap.ts","webpack://discrelog/./src/actions/circuit-editor-drag-start-element.ts","webpack://discrelog/./src/actions/select-elements.ts","webpack://discrelog/./src/services/selection/utils.ts","webpack://discrelog/./src/services/selection/selectors/selection.ts","webpack://discrelog/./src/actions/circuit-editor-drag-start-joint.ts","webpack://discrelog/./src/actions/select-wire-joints.ts","webpack://discrelog/./src/actions/circuit-editor-drag-start-newjoint.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-start-newjoint.ts","webpack://discrelog/./src/actions/circuit-editor-drag-start-select.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-start-select.ts","webpack://discrelog/./src/actions/circuit-editor-drag-start-wire.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-start-wire.ts","webpack://discrelog/./src/actions/circuit-editor-mouse-leave.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/index.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-end.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-start-joint.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/drag-start-element.ts","webpack://discrelog/./src/services/circuit-editor-drag/reducer/mouse-leave.ts","webpack://discrelog/./src/services/circuit-editors/reducer/circuit-delete.ts","webpack://discrelog/./src/actions/circuit-editor-receive-focus.ts","webpack://discrelog/./src/services/circuit-editors/reducer/editor-focus.ts","webpack://discrelog/./src/actions/view-circuit.ts","webpack://discrelog/./src/services/circuit-editors/reducer/view-circuit.ts","webpack://discrelog/./src/services/circuit-editors/reducer/index.ts","webpack://discrelog/./src/actions/clipboard-copy-elements.ts","webpack://discrelog/./src/services/circuit-graph/selectors/connections.ts","webpack://discrelog/./src/services/circuit-graph/selectors/element-def.ts","webpack://discrelog/./src/services/circuit-graph/selectors/pins.ts","webpack://discrelog/./src/services/circuit-layout/selectors/wires.ts","webpack://discrelog/./src/services/clipboard/utils.ts","webpack://discrelog/./src/services/clipboard/reducer/index.ts","webpack://discrelog/./src/services/clipboard/reducer/clipboard-copy.ts","webpack://discrelog/./src/services/clipboard/reducer/clipboard-paste.ts","webpack://discrelog/./src/actions/dialog-response-accept.ts","webpack://discrelog/./src/services/dialog/utils.ts","webpack://discrelog/./src/services/dialog/reducer/dialog-response-accept.ts","webpack://discrelog/./src/actions/dialog-response-cancel.ts","webpack://discrelog/./src/services/dialog/reducer/dialog-response-cancel.ts","webpack://discrelog/./src/actions/dialog-show.ts","webpack://discrelog/./src/services/dialog/reducer/index.ts","webpack://discrelog/./src/services/dialog/reducer/dialog-show.ts","webpack://discrelog/./src/services/circuit-graph/reducer/circuit-add.ts","webpack://discrelog/./src/services/circuit-graph/reducer/operations/element-delete.ts","webpack://discrelog/./src/services/circuit-graph/reducer/circuit-delete.ts","webpack://discrelog/./src/store/priorities.ts","webpack://discrelog/./src/services/circuit-graph/reducer/element-add.ts","webpack://discrelog/./src/services/circuit-graph/reducer/element-delete.ts","webpack://discrelog/./src/services/circuit-graph/reducer/element-rename.ts","webpack://discrelog/./src/services/circuit-graph/reducer/index.ts","webpack://discrelog/./src/services/circuit-graph/reducer/project-new.ts","webpack://discrelog/./src/services/circuit-graph/reducer/wire-attach.ts","webpack://discrelog/./src/services/circuit-graph/reducer/wire-detatch.ts","webpack://discrelog/./src/services/circuit-layout/reducer/element-add.ts","webpack://discrelog/./src/services/circuit-layout/reducer/element-delete.ts","webpack://discrelog/./src/services/circuit-layout/reducer/operations/element-delete.ts","webpack://discrelog/./src/actions/element-move.ts","webpack://discrelog/./src/services/circuit-layout/reducer/element-move.ts","webpack://discrelog/./src/services/circuit-layout/reducer/index.ts","webpack://discrelog/./src/services/circuit-layout/reducer/project-new.ts","webpack://discrelog/./src/services/circuit-layout/reducer/wire-attach.ts","webpack://discrelog/./src/services/circuit-layout/reducer/wire-detatch.ts","webpack://discrelog/./src/services/circuit-layout/reducer/wire-joint-add.ts","webpack://discrelog/./src/services/circuit-layout/reducer/wire-joint-delete.ts","webpack://discrelog/./src/services/circuit-layout/reducer/wire-joint-move.ts","webpack://discrelog/./src/services/circuit-properties/reducer/index.ts","webpack://discrelog/./src/services/circuit-properties/reducer/circuit-add.ts","webpack://discrelog/./src/services/circuit-properties/reducer/circuit-delete.ts","webpack://discrelog/./src/services/circuit-properties/reducer/circuit-rename.ts","webpack://discrelog/./src/services/circuit-properties/reducer/project-new.ts","webpack://discrelog/./src/actions/circuit-import.ts","webpack://discrelog/./src/services/savedata/types.ts","webpack://discrelog/./src/services/savedata/errors.ts","webpack://discrelog/./src/services/savedata/api.ts","webpack://discrelog/./src/services/circuits/reducer/index.ts","webpack://discrelog/./src/services/tutorial/utils.ts","webpack://discrelog/./src/services/tutorial/selectors/tutorial.ts","webpack://discrelog/./src/services/project/reducer/autosave.ts","webpack://discrelog/./src/services/project/utils.ts","webpack://discrelog/./src/services/project/reducer/project-modified.ts","webpack://discrelog/./src/services/project/reducer/project-new.ts","webpack://discrelog/./src/actions/project-rename.ts","webpack://discrelog/./src/services/project/reducer/project-rename.ts","webpack://discrelog/./src/actions/project-save.ts","webpack://discrelog/./src/services/project/reducer/index.ts","webpack://discrelog/./src/services/project/reducer/init.ts","webpack://discrelog/./src/services/project/reducer/project-receive.ts","webpack://discrelog/./src/services/project/reducer/project-save-success.ts","webpack://discrelog/./src/services/selection/reducer/element-delete.ts","webpack://discrelog/./src/services/selection/reducer/project-new.ts","webpack://discrelog/./src/actions/select-all.ts","webpack://discrelog/./src/services/selection/reducer/select-all.ts","webpack://discrelog/./src/actions/select-clear.ts","webpack://discrelog/./src/services/selection/reducer/select-clear.ts","webpack://discrelog/./src/services/selection/reducer/select-elements.ts","webpack://discrelog/./src/services/selection/reducer/select-joints.ts","webpack://discrelog/./src/services/circuit-layout/selectors/element-bounds.ts","webpack://discrelog/./src/services/selection/reducer/select-region.ts","webpack://discrelog/./src/actions/select-wires.ts","webpack://discrelog/./src/services/selection/reducer/select-wires.ts","webpack://discrelog/./src/actions/selection-copy.ts","webpack://discrelog/./src/services/selection/reducer/index.ts","webpack://discrelog/./src/services/selection/reducer/selection-align-to-grid.ts","webpack://discrelog/./src/services/selection/reducer/selection-copy.ts","webpack://discrelog/./src/services/selection/reducer/selection-delete.ts","webpack://discrelog/./src/services/selection/reducer/selection-move.ts","webpack://discrelog/./src/services/selection/reducer/wire-detatch.ts","webpack://discrelog/./src/services/simulator/utils.ts","webpack://discrelog/./src/services/simulator/reducer/circuit-graph-invalidated.ts","webpack://discrelog/./src/evolvers/definitions/index.ts","webpack://discrelog/./src/services/simulator-graph/utils.ts","webpack://discrelog/./src/services/simulator-graph/graph-production.ts","webpack://discrelog/./src/elements/types/element-production.ts","webpack://discrelog/./src/services/simulator-graph/types.ts","webpack://discrelog/./src/services/simulator-graph/selectors/graph.ts","webpack://discrelog/./src/services/simulator-graph/selectors/elements.ts","webpack://discrelog/./src/services/simulator-graph/selectors/connections.ts","webpack://discrelog/./src/services/simulator/reducer/utils.ts","webpack://discrelog/./src/services/simulator/reducer/element-interact.ts","webpack://discrelog/./src/actions/sim-start.ts","webpack://discrelog/./src/services/simulator/reducer/sim-start.ts","webpack://discrelog/./src/actions/sim-step.ts","webpack://discrelog/./src/actions/sim-tick.ts","webpack://discrelog/./src/actions/sim-stop.ts","webpack://discrelog/./src/services/simulator/reducer/sim-stop.ts","webpack://discrelog/./src/services/simulator/reducer/index.ts","webpack://discrelog/./src/services/simulator/reducer/sim-step.ts","webpack://discrelog/./src/services/simulator/reducer/sim-tick.ts","webpack://discrelog/./src/services/simulator-control/utils.ts","webpack://discrelog/./src/services/simulator-control/reducers/circuit-graph-invalidated.ts","webpack://discrelog/./src/actions/sim-pause.ts","webpack://discrelog/./src/services/simulator-control/selectors/run.ts","webpack://discrelog/./src/services/simulator-control/reducers/index.ts","webpack://discrelog/./src/services/simulator-control/reducers/sim-pause.ts","webpack://discrelog/./src/services/simulator-control/reducers/sim-start.ts","webpack://discrelog/./src/services/simulator-control/reducers/sim-step.ts","webpack://discrelog/./src/services/simulator-control/reducers/sim-stop.ts","webpack://discrelog/./src/actions/tutorial-annotate.ts","webpack://discrelog/./src/services/tutorial/reducer/tutorial-annotate.ts","webpack://discrelog/./src/actions/tutorial-dismiss.ts","webpack://discrelog/./src/actions/tutorial-start.ts","webpack://discrelog/./src/services/tutorial/reducer/index.ts","webpack://discrelog/./src/services/tutorial/reducer/tutorial-dismiss.ts","webpack://discrelog/./src/services/tutorial/reducer/tutorial-start.ts","webpack://discrelog/./src/services/ui-layout/utils.ts","webpack://discrelog/./src/services/ui-layout/reducer/circuit-delete.ts","webpack://discrelog/./src/actions/layout-rearrange.ts","webpack://discrelog/./src/services/ui-layout/reducer/layout-rearrange.ts","webpack://discrelog/./src/services/ui-layout/reducer/view-circuit.ts","webpack://discrelog/./src/actions/view-reset.ts","webpack://discrelog/./src/services/ui-layout/reducer/index.ts","webpack://discrelog/./src/services/ui-layout/reducer/view-reset.ts","webpack://discrelog/./src/actions/view-element-names.ts","webpack://discrelog/./src/services/ui-settings/utils.ts","webpack://discrelog/./src/services/ui-settings/reducer/index.ts","webpack://discrelog/./src/services/ui-settings/reducer/view-element-names.ts","webpack://discrelog/./src/store/reducer.ts","webpack://discrelog/./src/services/reducer.ts","webpack://discrelog/./src/services/circuits/reducer/circuit-import.ts","webpack://discrelog/./src/store/devtool-sanitizer.ts","webpack://discrelog/./src/services/dialog/api.ts","webpack://discrelog/./src/actions/project-export-link.ts","webpack://discrelog/./src/services/project/saga/project-export-link.ts","webpack://discrelog/./src/actions/project-import-circuits.ts","webpack://discrelog/./src/services/project/saga/project-import-circuits.ts","webpack://discrelog/./src/actions/project-import-link.ts","webpack://discrelog/./src/services/project/saga/project-import-link.ts","webpack://discrelog/./src/actions/project-load.ts","webpack://discrelog/./src/services/project/saga/project-load.ts","webpack://discrelog/./src/services/project/selectors/project.ts","webpack://discrelog/./src/services/project/saga/project-save.ts","webpack://discrelog/./src/services/project/saga/index.ts","webpack://discrelog/./src/services/simulator-control/saga/mode-run.ts","webpack://discrelog/./src/services/simulator-control/saga/index.ts","webpack://discrelog/./src/components/CircuitEditor/ids.ts","webpack://discrelog/./src/actions/tutorial-next.ts","webpack://discrelog/./src/services/tutorial/saga/tutorials/utils.ts","webpack://discrelog/./src/services/tutorial/saga/tutorials/basic.ts","webpack://discrelog/./src/pages/ProjectEditorPage/windows/CircuitsTreeWindow/ids.ts","webpack://discrelog/./src/services/tutorial/saga/tutorials/circuits.ts","webpack://discrelog/./src/services/tutorial/saga/tutorials.ts","webpack://discrelog/./src/services/tutorial/saga/index.ts","webpack://discrelog/./src/store/saga.ts","webpack://discrelog/./src/store/store.ts","webpack://discrelog/./src/undo/reducer/index.ts","webpack://discrelog/./src/undo/reducer/undo.ts","webpack://discrelog/./src/undo/reducer/redo.ts","webpack://discrelog/./src/undo/reducer/capture-undo-state.ts","webpack://discrelog/./src/hooks/useSelector.ts","webpack://discrelog/./src/hooks/useNativeEvent.ts","webpack://discrelog/./src/services/saga.ts","webpack://discrelog/./src/services/ui-layout/selectors/layout.ts","webpack://discrelog/./src/components/TitleBar/index.ts","webpack://discrelog/./src/components/TitleBar/TitleBar.tsx","webpack://discrelog/./src/components/TitleBar/TitleBar.module.css?c6e3","webpack://discrelog/./src/components/Popover/PopoverChildContext.tsx","webpack://discrelog/./src/components/Popover/Popover.tsx","webpack://discrelog/./src/components/Popover/index.ts","webpack://discrelog/./src/hooks/useArrayState.ts","webpack://discrelog/./src/hooks/useOutsideMouseEvent.ts","webpack://discrelog/./src/components/Menus/MenuCloseContext.ts","webpack://discrelog/./src/components/AutoPopover.tsx","webpack://discrelog/./src/components/Button/Button.module.css?a282","webpack://discrelog/./src/components/Button/Button.tsx","webpack://discrelog/./src/components/Button/index.ts","webpack://discrelog/./src/hooks/useAction.ts","webpack://discrelog/./src/components/Menus/Menus.module.css?27a7","webpack://discrelog/./src/components/Menus/Menu.tsx","webpack://discrelog/./src/components/Menus/MenuItem.tsx","webpack://discrelog/./src/components/Menus/DividerMenuItem.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/components/FileMenu.tsx","webpack://discrelog/./src/runtime-env.ts","webpack://discrelog/./src/undo/selectors.ts","webpack://discrelog/./src/services/clipboard/selectors/clipboard.ts","webpack://discrelog/./src/pages/ProjectEditorPage/components/EditMenu.tsx","webpack://discrelog/./src/services/ui-settings/selectors/element-name.ts","webpack://discrelog/./src/components/Checkbox/index.ts","webpack://discrelog/./src/components/Checkbox/Checkbox.tsx","webpack://discrelog/./src/components/Checkbox/Checkbox.module.css?4fe9","webpack://discrelog/./src/components/Menus/CheckboxMenuItem.tsx","webpack://discrelog/./src/components/Menus/SubMenuItem.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/components/ViewMenu.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/components/HelpMenu.tsx","webpack://discrelog/./src/services/simulator/selectors/performance.ts","webpack://discrelog/./src/components/Icons/Icons.module.css?682c","webpack://discrelog/./src/components/Icons/Play.tsx","webpack://discrelog/./src/components/Icons/Stop.tsx","webpack://discrelog/./src/components/Icons/Pause.tsx","webpack://discrelog/./src/components/Icons/Step.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/components/SimControls/SimControls.module.css?e05b","webpack://discrelog/./src/pages/ProjectEditorPage/components/SimControls/index.ts","webpack://discrelog/./src/pages/ProjectEditorPage/components/SimControls/SimControls.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/components/ProjectEditorTitleBar/index.ts","webpack://discrelog/./src/pages/ProjectEditorPage/components/ProjectEditorTitleBar/ProjectEditorTitleBar.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/components/ProjectEditorTitleBar/ProjectEditorTitleBar.module.css?4065","webpack://discrelog/./src/components/CircuitNodeBreadcrumb/CircuitNodeBreadcrumb.module.css?4319","webpack://discrelog/./src/components/CircuitNodeBreadcrumb/CircuitNodeBreadcrumb.tsx","webpack://discrelog/./src/components/CircuitNodeBreadcrumb/index.ts","webpack://discrelog/./src/services/circuit-layout/selectors/field.ts","webpack://discrelog/./src/components/CircuitEditor/drag-items/new-element.ts","webpack://discrelog/./src/components/CircuitEditor/contexts/viewport-context.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/contexts/fieldSvgElement.tsx","webpack://discrelog/./src/services/circuit-graph/selectors/circuits.ts","webpack://discrelog/./src/components/CircuitEditor/contexts/circuit-editor-context.tsx","webpack://discrelog/./src/components/CircuitEditor/utils.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/hooks/useMouseCoords.ts","webpack://discrelog/./src/styles/interaction.module.css?621c","webpack://discrelog/./src/services/simulator/selectors/elements.ts","webpack://discrelog/./src/elements/visuals/element-visuals.module.css?2bb3","webpack://discrelog/./src/elements/visuals/index.tsx","webpack://discrelog/./src/elements/visuals/IntegratedCircuitElementVisual.tsx","webpack://discrelog/./src/elements/visuals/MomentaryInteractionElementVisual.tsx","webpack://discrelog/./src/elements/visuals/ToggleInteractionElementVisual.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/ElementVisual.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/DragNewElementLayer.tsx","webpack://discrelog/./src/services/circuit-editor-drag/selectors/drag.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/DragElementPreviewLayer.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WireJointVisual/WireJointVisual.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WireJointVisual/index.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WireJointVisual/WireJointVisual.module.css?d60b","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/DragJointPreviewLayer.tsx","webpack://discrelog/./src/hooks/useMouseDragDetector.ts","webpack://discrelog/./src/modifier-keys.ts","webpack://discrelog/./src/components/ContextMenu.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/ContextMenuItems.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/FieldContextMenu.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/FieldMouseLayer.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/GridBackground.tsx","webpack://discrelog/./src/components/AtomicTextInput.tsx","webpack://discrelog/./src/components/EditableText.tsx","webpack://discrelog/./src/components/Menus/EditableTextMenuItem.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/ElementContextMenu.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/Element/Element.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/Element/index.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/ElementsLayer.tsx","webpack://discrelog/./src/services/simulator/selectors/wires.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WireSegment.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WireJoint.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/Wire/index.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/Wire/Wire.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/Wire/Wire.module.css?e4ef","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/WiresLayer.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/ElementPin/ElementPin.module.css?534f","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/ElementPin/index.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/ElementPin/ElementPin.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/ElementPins.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/ElementPinsLayer.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/DragAttachWirePreviewLayer.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/components/EditorDragReceiver.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/index.ts","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/CircuitFieldSurface.tsx","webpack://discrelog/./src/components/CircuitEditor/components/CircuitFieldSurface/CircuitFieldSurface.module.css?4f8f","webpack://discrelog/./src/components/CircuitEditor/CircuitEditor.tsx","webpack://discrelog/./src/components/CircuitEditor/index.ts","webpack://discrelog/./src/components/CircuitEditor/CircuitEditor.module.css?a428","webpack://discrelog/./src/components/Icons/Close.tsx","webpack://discrelog/./src/components/Tessel/TesselWindow.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/windows/CircuitEditorWindow/keymap.ts","webpack://discrelog/./src/pages/ProjectEditorPage/windows/CircuitEditorWindow/CircuitEditorWindow.tsx","webpack://discrelog/./src/components/SelectionList/SelectionList.tsx","webpack://discrelog/./src/components/SelectionList/SelectionList.module.css?89a4","webpack://discrelog/./src/components/SelectionList/index.ts","webpack://discrelog/./src/pages/ProjectEditorPage/windows/CircuitsTreeWindow/CircuitsTreeWindow.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/windows/CircuitsTreeWindow/CircuitsTreeWindow.module.css?916b","webpack://discrelog/./src/components/Tooltip/index.ts","webpack://discrelog/./src/components/Tooltip/Tooltip.tsx","webpack://discrelog/./src/components/Tooltip/Tooltip.module.css?a017","webpack://discrelog/./src/pages/ProjectEditorPage/windows/ElementTrayWindow/ElementTrayWindow.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/windows/ElementTrayWindow/ElementTrayWindow.module.css?56cd","webpack://discrelog/./src/pages/ProjectEditorPage/ProjectEditorPage.tsx","webpack://discrelog/./src/pages/ProjectEditorPage/index.ts","webpack://discrelog/./src/pages/ProjectImporterPage/index.ts","webpack://discrelog/./src/pages/ProjectImporterPage/ProjectImporterPage.tsx","webpack://discrelog/./src/router.tsx","webpack://discrelog/./src/services/dialog/selectors/dialog.ts","webpack://discrelog/./src/components/Modal/Modal.module.css?d409","webpack://discrelog/./src/components/Modal/index.ts","webpack://discrelog/./src/components/Modal/Modal.tsx","webpack://discrelog/./src/components/Dialog/index.ts","webpack://discrelog/./src/components/Dialog/Dialog.tsx","webpack://discrelog/./src/components/Dialog/Dialog.module.css?a332","webpack://discrelog/./src/dialogs/dialog-types/export-project-link/ExportProjectLinkDialog.tsx","webpack://discrelog/./src/dialogs/dialog-types/export-project-link/ExportProjectLinkDialog.module.css?13e0","webpack://discrelog/./src/dialogs/dialog-types/import-project-circuits/ImportProjectCircuitsDialog.tsx","webpack://discrelog/./src/dialogs/dialog-types/import-project-circuits/ImportProjectCircuitsDialog.module.css?16e9","webpack://discrelog/./src/components/DialogManager/DialogManager.tsx","webpack://discrelog/./src/components/DialogManager/index.ts","webpack://discrelog/./src/dialogs/renderer.tsx","webpack://discrelog/./src/components/Tutorial/Tutorial.tsx","webpack://discrelog/./src/hooks/useQuerySelector.ts","webpack://discrelog/./src/components/Tutorial/Tutorial.module.css?c91d","webpack://discrelog/./src/components/Tutorial/index.ts","webpack://discrelog/./src/index.tsx","webpack://discrelog/./src/components/App/App.tsx","webpack://discrelog/./src/svg.ts"],"names":["ACTION_ELEMENT_INTERACT","interactElement","elementIdPath","data","type","payload","isInteractElementAction","action","category","displayName","elementProduction","visual","hitRect","p1","x","y","p2","component","pins","OUT","direction","hitPath","d","fill","stroke","className","strokeWidth","A","B","IN","transform","fillRule","path","state","value","OFFSET","createSeg","name","points","start","p","slice","C","D","E","F","G","cx","cy","r","ShapePathElementVisual","elementId","elementPath","shapePath","evolverState","dispatch","onClick","e","defaultPrevented","preventDefault","body","normalizeVisuals","map","v","i","key","ShapePathElementTrayItem","width","height","viewBox","TrayShapePadding","createShapePathVisual","trayComponent","props","Array","isArray","createStaticElementVisual","element","TrayComponentPadding","EVOLVER_RESPONSE_TIME","inputPins","outputPins","interact","undefined","transitions","tickOffset","valuesByPin","Math","round","defaultToggleState","toggleState","nextState","Object","assign","evolve","_","inputs","pointSchema","shape","required","ZeroPoint","freeze","ZeroRect","boundsToRect","bounds","snapPoint","snap","magnitude","sqrt","normalize","m","dotProduct","a","b","scale","scaler","normalizeRectangle","args","length","min","max","offsetRectangle","rect","offset","pointAdd","pointSubtract","pointEquals","pointIntersects","calcSize","union","r1","r2","intersects","defaultCircuitEditorDragServiceState","dragMode","ROOT_CIRCUIT_ID","DEFAULT_CIRCUIT_EDITOR_ID","circucitEditorsById","circuitId","activeEditorId","defaultCircuitEditorServiceState","elementIdsByCircuitId","elementsById","connectionsById","defaultCircuitGraphServiceState","defaultCircuitLayoutServiceState","elementPositionsById","wireJointIdsByConnectionId","wireJointPositionsByJointId","circuitNamesByCircuitId","defaultCircuitPropertiesServiceState","defaultClipboardServiceState","clipboardElements","clipboardPasteOrigin","defaultDialogServiceState","dialogType","defaultProjectServiceState","projectName","projectModified","defaultSelectionServiceState","selectedElementIds","selectedConnectionIds","selectedJointIds","defaultSimulatorServiceState","initialized","tick","lastTickProcessingTimeMs","evolverStatesByEvolverId","evolverOutputValuesByEvolverId","transitionsById","transitionWindows","defaultSimulatorControlServiceState","mode","ticksPerSecond","defaultTutorialServiceState","activeTutorial","annotatedElements","preTutorialState","cls","values","filter","Boolean","join","fpSet","fpSetByArray","String","target","firstPaths","lastPath","newData","clone","rollingTarget","seg","obj","isTruthy","windowId","isTesselWindow","item","normalizeTesselDivision","firstPercent","isTesselPercentDivision","isTesselFixedDivision","useRefValue","ref","current","top","left","bottom","right","toJSON","onChangePercentage","pointerCaptureRef","directionRef","onChangePercentageRef","onHandlePointerMove","parentRect","parentElement","getBoundingClientRect","percentage","position","pageX","isNaN","pageY","leading","onPointerMove","persist","onPointerDown","setPointerCapture","pointerId","onPointerUp","releasePointerCapture","tesselPathContext","useTesselPath","TesselPathProvider","pathKey","children","newPath","Provider","noop","tesselInteractionContext","moveWindow","closeWindow","useTesselInteraction","TesselInteractionProvider","context","applyDivisionChange","division","percent","absolute","secondSize","firstSize","renderWindow","onLayoutChange","first","second","divisionValue","sizeDirection","onFirstLayoutChange","onSecondLayoutChange","firstFix","secondFix","firstSizeDiv","secondSizeDiv","style","asArray","arrayEquals","every","dropIndexFp","array","index","newArray","push","useComponentBounds","size","setSize","observer","el","observe","disconnect","TESSEL_WINDOW_DRAG_OBJECT","tesselWindowDragObject","isTesselWindowDragObject","id","forwardRef","tesselPath","dropPos","setDropPos","onHover","monitor","isOver","shallow","pos","getClientOffset","xPercent","yPercent","onDrop","draggingPath","draggingSelf","dropRef","useDrop","accept","collect","getItem","hover","drop","dropMarkerClassname","divRef","filterTesselValues","normalized","pruneEmptyTesselValues","rootItem","from","to","newRoot","movingElement","newItem","Error","CIRCUIT_FIELD_WINDOW_ID","circuitEditorTesselWindow","circuitEditorId","windowProps","editorId","isCircuitEditorTesselWindow","layout","defaultUiLayoutServiceState","defaultUiSettingsState","elementNameMode","_defaultServiceState","circuitEditorDrag","circuitEditors","circuitGraph","circuitLayout","circuitProperties","clipboard","dialog","project","selection","simulator","simulatorControl","tutorial","uiLayout","uiSettings","defaultServicesState","UndoServicesStateKeys","_defaultAppState","services","undo","undoStack","redoStack","defaultAppState","rootUrlBuilder","URL","window","location","origin","pathname","rootUrl","toString","ACTION_INIT","ACTION_CIRCUIT_ADD","addCircuit","circuitName","edit","isAddCircuitAction","ACTION_CIRCUIT_DELETE","isDeleteCircuitAction","ACTION_CIRCUIT_RENAME","ACTION_ELEMENT_ADD","addElement","elementType","opts","isAddElementAction","ACTION_ELEMENT_DELETE","isDeleteElementAction","ACTION_ELEMENT_RENAME","ACTION_SELECTION_ALIGN_TO_GRID","selectionAlignToGrid","ACTION_SELECTION_DELETE","deleteSelection","ACTION_SELECTION_MOVE","ACTION_WIRE_ATTACH","attachWire","connectionId","joints","isAttachWireAction","ACTION_WIRE_DETATCH","isDetatchWireAction","ACTION_WIRE_JOINT_ADD","ACTION_WIRE_JOINT_MOVE","moveWireJoint","jointId","jointIds","relative","snapMode","ACTION_WIRE_JOINT_DELETE","ACTION_PASTE","paste","ACTION_CIRCUIT_EDITOR_DRAG_END","ACTION_UNDO","isUndoAction","ACTION_REDO","redo","isRedoAction","ACTION_PROJECT_NEW","newProject","isNewProjectAction","ACTION_PROJECT_RECEIVE","receiveProject","fileName","saveData","PROJECT_MUTATION_ACTIONS","isProjectMutationAction","indexOf","createServiceReducerCreator","service","reducer","newState","createServiceSelectorCreator","selector","appSelector","s","local","createCircuitEditorsReducer","createCircuitEditorsSelector","circuitEditorStateFromIdSelector","circuitIdForEditorIdSelector","editorState","activeCircuitEditorIdSelector","keys","activeCircuitEditorStateSelector","activeCircuitIdSelector","editorIdsFromCircuitIdSelector","captureUndoState","viewCircuitId","activeEditor","serviceStates","concatReducers","reducers","concat","ACTION_CIRCUIT_EDITOR_DRAG_ABORT","circuitEditorDragAbort","createCircuitEditorDragReducer","createCircuitEditorDragSelector","isCircuitEditorDragAbortAction","ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE","isCircuitEditorDragContinueAction","dragPos","modifierKeys","dragEnd","dragEndEditorId","dragModifierKeys","getSelectMode","modifiers","defaultMode","shiftKey","ctrlMetaKey","combineSelection","selectedIds","chosenIds","chosen","ACTION_SELECT_REGION","createCircuitGraphReducer","createCircuitGraphSelector","elementsByElementIdSelector","elementIdsSelector","elementTypesByElementIdSelector","elementFromElementIdSelector","elementIdsFromTypeSelector","desiredType","elementIds","elementTypeFromElementIdSelector","elementIdsByCircuitIdSelector","EmptyElementIds","elementIdsFromCircuitIdSelector","circuitIdFromElementIdSelector","elementNamesByElementIdSelector","elementName","elementNameOrDefaultFromElementIdSelector","substr","elementNameFromElementIdSelector","createCircuitLayoutReducer","createCircuitLayoutSelector","elementPositionsByElementIdSelector","elementPositionFromElementIdSelector","createCircuitPropertiesReducer","createCircuitPropertiesSelector","circuitIdsSelector","circuitNamesByIdSelector","circuitNameFromIdSelector","circuitIdToElementType","elementTypeToCircuitId","startsWith","getICBorderPath","inputPinCount","outputPinCount","circuitPinPosition","pinIndex","elementTypesByElementId","elementPositionsByElementId","circuitNamesById","pinElementIds","inputPinIds","outputPinIds","pinElementId","componentProps","x1","y1","x2","y2","cachedDefinitionsSelector","elementDefinitionsSelector","definitions","source","resolved","resolveSources","def","elementDefinitionsByTypeSelector","defs","defsByType","elementDefinitionFromTypeSelector","elementPinSchema","pinId","elementPinEquals","elementPinPositionsByPinIdByElementIdSelector","elementDefsByType","elementPinPositionsByPinIdByElementId","elementPinPositionsByPinId","elementPosition","pinIds","relPinPosition","pinPosition","cachedPinFromPoint","elementPinFromPointSelector","point","pinPositionsByPinIdByElementId","pinPositionsByPinId","pin","gridElementSnapSelector","gridJointSnapSelector","applyGridElementSnapSelector","applyGridJointSnapSelector","ACTION_CIRCUIT_EDITOR_DRAG_START_ELEMENT","ACTION_SELECT_ELEMENTS","selectElements","createSelectionReducer","createSelectionSelector","selectedElementIdsSelector","isElementSelectedFromElementIdSelector","isWireSelectedFromConnectionIdSelector","selectedJointIdsSelector","isJointSelectedFromJointIdSelector","ACTION_CIRCUIT_EDITOR_DRAG_START_JOINT","ACTION_SELECT_WIRE_JOINTS","selectWireJoints","ACTION_CIRCUIT_EDITOR_DRAG_START_NEWJOINT","isCircuitEditorDragStartNewJointAction","addAfterJointId","dragStart","dragStartEditorId","dragNewJointConnectionId","dragNewJointAfterJointId","ACTION_CIRCUIT_EDITOR_DRAG_START_SELECT","isCircuitEditorDragStartSelectAction","ACTION_CIRCUIT_EDITOR_DRAG_START_WIRE","isCircuitEditorDragStartWireAction","dragWireSource","ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE","isCircuitEditorDragEndAction","dragState","selectionMode","region","selectRegion","moveBy","hasElements","offsetX","offsetY","moveSelection","addWireJoint","endPin","isCircuitEditorDragStartJointAction","isCircuitEditorDragStartElementAction","isCircuitEditorMouseLeaveAction","keepIds","ACTION_CIRCUIT_EDITOR_RECEIVE_FOCUS","isCircuitEditorReceiveFocusAction","ACTION_VIEW_CIRCUIT","viewCircuit","newWindowId","newWindow","isViewCircuitAction","appState","targetWindowId","findActiveEditorId","ACTION_COPY_ELEMENTS","connectionsByIdSelector","connectionIdsSelector","connectionFromConnectionIdSelector","connectionsSelector","connectionIdsByCircuitIdSelector","connectionIdsByCircuitId","connectionIds","circuitIds","connId","inputPin","outputPin","EmptyConnectionIds","connectionIdFromInputPinSelector","elementInputConnectionIdsFromElementIdSelector","elementOutputConnectionIdsFromElementIdSelector","elementConnectionIdsFromElementIdSelector","outputs","elementDefinitionFromElementIdSelector","elementPinsFromPinElementSelector","icElementType","icElementId","startPositionCacheByConnectionId","endPositionCacheByConnectionId","wireJointIdsByConnectionIdSelector","wireJointIdsFromConnectionIdSelector","wireJointPositionFromJointIdSelector","wireJointPositionsByJointIdSelector","createClipboardReducer","createClipboardSelector","isCopyElementsAction","copyIds","rootPosition","copyElements","connections","outputConnections","result","connection","elementOutputSourcesByPinIdFromElementIdSelector","elementIsSelected","jointPos","isPasteAction","pastePosition","gridSnap","pasteIds","sourceId","output","targetCopyId","targetPin","targetId","ACTION_DIALOG_RESPONSE_ACCEPT","acceptDialog","createDialogReducer","createDialogSelector","isAcceptDialogAction","ACTION_DIALOG_RESPONSE_CANCEL","cancelDialog","isCancelDialogAction","ACTION_DIALOG_SHOW","isShowDialogAction","elementDelete","rootState","remainingElementIds","removedIcPins","circuitElementIds","some","remainingCircuitIds","elementIdsForCircuit","circuitElementType","removedElementIds","reducerPriority","priority","weight","priorityBefore","isRenameElementAction","trim","conn","p1Node","p2Node","p1Def","p2Def","p1Pin","p2Pin","pinsToConnection","c","remainingIds","removingElementConnectionIds","reduce","removingPinConnectionIds","removedPin","removingJointIds","remainingConnectionIds","remainingJointIds","ACTION_ELEMENT_MOVE","moveElement","isMoveElementAction","movedElementPositions","movedP","isAddWireJointAction","wireJoints","insertionIndex","isDeleteWireJointAction","isMoveWireJointAction","movedJoints","isRenameCircuitAction","trimmedName","ACTION_CIRCUIT_IMPORT","saveCircuitSchema","saveElementSchema","nullable","saveWireSchema","input","of","saveDataSchema","circuits","elements","wires","SaveFormatError","message","super","this","code","createSave","jointPositions","wire","loadSave","save","validateSync","console","error","createTutorialReducer","createTutorialSelector","isTutorialActiveSelector","tutorialAnnotationsSelector","localStorage","setItem","JSON","stringify","createProjectReducer","createProjectSelector","removeItem","ACTION_PROJECT_RENAME","isRenameProjectAction","ACTION_PROJECT_SAVE","saveProject","ACTION_PROJECT_SAVE_SUCCESS","autosave","isInitAction","str","parse","loadAutosave","isReceiveProjectAction","isSaveProjectSuccessAction","ACTION_SELECT_CLEAR","isSelectAllAction","wireJointIdsFromConnectionId","isClearSelectionAction","isSelectElementsAction","isSelectWireJointsAction","elementRectsByIdSelector","positionsById","elementTypesById","isSelectRegionAction","rects","chosenElementIds","chosenJointIds","jointIdsFromCircuitIdSelector","ACTION_SELECT_WIRES","isSelectWiresAction","ACTION_SELECTION_COPY","copySelection","isSelectionAlignToGridAction","elementPositions","elementPos","snappedPos","isCopySelectionAction","selectedElements","isDeleteSelectionAction","detatchWire","deleteWireJoint","isMoveSelectionAction","elementSnapMode","jointSnapMode","createSimulatorReducer","createSimulatorSelector","asEvolverDef","module","default","EvolverDefinitionsByType","getEvolverIdFromElementIdPath","evolverIdPath","pop","evolverIdItem","evolverId","EMPTY_PRODUCTION","evolversById","evolverIdsByElementId","inputElementPinsByCircuitPinId","outputElementPinsByCircuitPinId","produceCircuitGraph","dependencies","inputElementIds","outputElementIds","elementInputPinsByPinIdByElementId","elementOutputPinsByPinIdByElementId","productionResult","produceEvolver","circuitConnectionsById","outputSimPin","inputSimPins","outputEvolver","outputsByOutputPin","outputsByPin","inputSimPin","inputsByPin","elementDefsByElementType","production","simProduction","evolverType","subElementIds","produceElementNode","circuitProuction","produceCircuitNode","EmptySimulatorGraph","evolverTypeFromEvolverId","evolver","evolverDefFromEvolverId","EmptyPinArray","EmptyPinInputs","simInit","evolverIdsSelector","outputValues","forEach","initNode","collectNodeTransitions","tickWindow","readonlyState","transitionIds","updatedEvolverIds","Set","tid","valuesByOutputPin","updates","outputEvolverIdsFromEvolverIdSelector","add","inputSourcesByPin","inputPinsByPinIdFromEvolverIdSelector","inputConn","sourcePinId","collectNodeInputs","applyEvolutionResult","evolutionResult","transition","defaultMerger","transitionMerger","transitionTick","isElementTransition","transitionId","transitionWindowIndex","transitionWindow","tickWindowTransitionIndex","removeTransitionById","removeTransitionsByEvolverId","newTransition","splice","addTransition","applyOutputTransition","evolverIdFromElementIdSelector","ACTION_SIM_START","startSim","isStartSimAction","ACTION_SIM_STEP","stepSim","isStepSimAction","ACTION_SIM_TICK","tickSim","tickCount","ACTION_SIM_STOP","stopSim","isStopSimAction","simState","windowTick","isTickSimAction","performance","now","endTick","saftyCount","shift","simTick","updateTime","createSimulatorControlReducer","createSimulatorControlSelector","ACTION_SIM_PAUSE","pauseSim","isSimActiveSelector","isSimRunningSelector","isSimPausedSelector","ticksPerSecondSelector","isPauseSimAction","runMode","ACTION_TUTORIAL_ANNOTATE","tutorialAnnotate","annotations","isTutorialAnnotateAction","ACTION_TUTORIAL_DISMISS","tutorialDismiss","ACTION_TUTORIAL_START","tutorialStart","isTutorialDismissAction","isTutorialStartAction","createUiLayoutReducer","createUiLayoutSelector","removedWindowIds","ACTION_LAYOUT_REARRANGE","isRearrangeLayoutAction","inserted","replace","doWork","newValue","VIEW_RESET","resetView","isResetViewAction","VIEW_ELEMENT_NAMES","viewElementNames","createUiSettingsReducer","createUiSettingsSelector","isViewElementNamesAction","finalizedList","finalizeReducerList","isImportCircuitAction","existingCircuits","importCircuits","importNodes","importCircuitsFromSave","actionsBlacklist","displayDialogSaga","showDialog","response","ACTION_PROJECT_EXPORT_LINK","exportProjectLink","projectExportLinkSaga","onExportLink","saveText","encoded","encodedText","urlData","encodeURIComponent","projectLink","search","ACTION_PROJECT_IMPORT_CIRCUITS","importCircuitFromProject","projectImportCircuitsSaga","handleProjectImportCircuits","file","contents","text","bind","scanCircuitIds","targetCircuitIds","elementCircuitId","elementIcCircuitId","ACTION_PROJECT_IMPORT_LINK","projectImportLinkSaga","onImportLink","dewrapped","decodeURIComponent","deflated","ACTION_PROJECT_LOAD","loadProject","projectLoadSaga","lastIndexOf","warn","projectNameSelector","projectModifiedSelector","projectSaveSaga","showSaveFilePicker","saveNativeFileApi","saveLegacy","fileHandle","suggestedName","types","description","getFile","renameProject","writable","createWritable","write","close","blob","Blob","saveAs","saveDataSaga","runModeSaga","handleRunSim","tps","timeToWait","ceil","simulatorSaga","getCircuitEditorHtmlId","getElementHtmlId","getElementPinHtmlId","ACTION_TUTORIAL_NEXT","addElementTutorialStep","trayMessage","fieldMessage","placement","waitFilterAction","addedElementType","waitNodeWired","isWired","connInputPin","connOutputPin","actionType","tutorialNextMessage","additionalSelectors","runBasicsTutorial","gateId","switchId","ledId","getCircuitListItemHtmlId","runCircuitsTutorial","addCircuitAction","inputPinId","outputPinId1","outputPinId2","bufferId","notId","icType","icId","led1Id","led2Id","startTutorial","handleStartTutorial","tutorialSaga","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","actionSanitizer","stateSanitizer","sagaMiddleware","store","stackItem","undoReducer","redoReducer","undoState","captureUndoStateReducer","useSelector","useNativeEvent","listener","options","listenTarget","addEventListener","removeEventListener","run","layoutSelector","title","noopPopoverChildContext","registerPopoverChild","unregisterPopoverChild","PopoverChildContext","PopoverChildContextProvider","contextRegister","contextUnregister","parent","parentRegister","parentUnregister","providedContext","isOpen","anchorEl","onRequestClose","popoverRef","setPopoverRef","attributes","styles","usePopper","popoverContext","ctxRef","usePopoverChild","popoverChildren","defaultValue","items","setItems","addItem","useArrayState","onOutsideEvent","when","onEvent","contains","document","useOutsideMouseEvent","createPortal","popper","zIndex","MenuCloseContext","useMenuCloseContext","MenuCloseContextProvider","content","open","setOpen","onClose","variant","useAction","actionCreator","preBind","useClickAction","disabled","secondary","requestMenuClose","onItemClick","onNewProject","onSaveProject","onLoadProject","onImportProjectCircuits","keyboardIsMac","test","os","keyboardCommandModifier","canUndoSelector","canRedoSelector","canPasteSelector","canUndo","onUndo","canRedo","onRedo","canCopy","onCopy","canPaste","onPaste","elementNameModeSelector","onChange","checked","ElementNamesMenu","onAlwaysVisible","onNamedOnly","onHidden","onResetView","TutorialsMenu","onBasicsTutorial","onCircuitsTutorial","averageMsecsPerTickSelector","isActive","isPaused","avgMsecsPerTick","onPlayClick","onStopClick","onPauseClick","onStepClick","onMuteMouseDown","toFixed","Stop","onMouseDown","Play","Step","Pause","CircuitNodeBreadcrumbRootItem","rootCircuitName","CircuitNodeBreadcrumbItem","MinFieldRect","fieldRectSelector","elementRectsById","wireJointsById","NEW_ELEMENT_DRAG_OBJECT","newElementDragObject","isNewElementDragObject","viewportContext","zoomFactor","zoom","useViewportContext","ViewportContextProvider","setZoomFactor","delta","nullRef","fieldSvgElementContext","svgRef","scalerRef","ContextProvider","FieldSvgElementProvider","circuitIdForElementIdSelector","circuitWouldRecurseSelector","targetCircuitId","targetCircuitNodeType","targetContainingCircuitId","circuitEditorContext","useCircuitEditor","CircuitEditorProvider","getFieldCoord","field","ctm","getScreenCTM","pt","createSVGPoint","translated","matrixTransform","inverse","useMouseCoords","elementOutputsFromCircuitElementIdSelector","elementOutputsBySimulatorElementId","NamedElementComponents","elementNamesById","borderPath","onViewCircuit","alignmentBaseline","fontSize","textAnchor","onDoubleClick","isSimActive","circuitIdPath","onPress","onRelease","onColor","onTextColor","onMouseUp","onMouseLeave","offColor","ErrorComponent","componentName","getNodeVisualElement","elementProps","Component","EmptyState","getMouseCoords","counterScale","dragType","setDragType","setDragPos","dropTargetWouldRecurse","coords","snapDragPos","counterScaledSize","opacity","dragModeSelector","isEditorDraggingSelector","isDraggingSelector","dragStartSelector","dragEndSelector","selectionRectSelector","cachedDragMoveOffset","dragMoveOffsetSelector","dragNewJointPositionSelector","dragDropTargetPinSelector","selectedElementPositionsByIdSelector","selectedElementTypesByIdSelector","isDragging","selectedElementPositionsById","selectedElementTypesById","dragMoveOffset","interactable","selected","mouseOver","setMouseOver","onMouseOver","onMouseOut","selectedJointPositionsByIdSelector","jointPositionsById","newJointPosition","newJointElement","useMouseDragDetector","dragThreshold","onDragStart","isTracking","setTracking","mouseDownRef","onMouseMove","abs","startTracking","getModifiers","ctrlKey","altKey","metaKey","ContextMenu","useContextMenu","ctxPos","setCtxPos","openContextMenu","onCloseContextMenu","renderContextMenu","fieldPosition","onAlignToGrid","onDelete","selectionRect","getCoords","onContextMenu","button","originalPoint","circuitEditorDragStartSelect","strokeDasharray","gridId","gridSize","xmlns","patternUnits","autoFocus","onBeginEdit","onCommit","onCancel","onBlur","onKeyUp","editValue","setEditValue","onInputChange","onInputKeyUp","onInputBlur","textClassname","inputClassname","label","isEditing","onRequestEdit","inputRef","onSpanDoubleClick","select","onEditableCommit","isRenaming","setIsRenaming","onRename","onRenameCancel","onRenameCommit","renameElement","onOpenCircuitInNewWindow","fontWeight","Element","evolverStateFromCircuitElementIdSelector","isSelected","circuitEditorDragStartElement","NodeName","elementFieldDisplayNameFromElementId","textScale","textYOffset","wireValueFromConnectionIdSelector","icElementPath","nextIcElementPath","nextPin","nextConnectionId","startJointId","endJointId","cacheData","inputElementDef","inputElementPosition","outputPosition","wireStartPositionFromConnectionIdSelector","end","wireEndPositionFromConnectionIdSelector","mousePos","setMousePos","origionalPoint","circuitEditorDragStartNewJoint","selectWires","onJointInsertMouseDown","insertJointPos","lineDir","circuitEditorDragStartJoint","onJointMouseDown","isPowered","segmentElements","jointElements","connectorElements","connectionIdsForCircuitIdSelector","highlight","setHighlight","elementPinPositions","elementPinPositionFromElementPinSelector","pinDef","pinDirectionFromElementPinSelector","dragTargetPin","circuitEditorDragStartWire","stopPropagation","onMouseEnter","isDragTarget","pinVisual","isEditorDragging","useEventMouseCoords","buttons","circuitEditorDragContinue","circuitEditorDragEnd","focus","isDraggingNewElement","dragRef","tabIndex","FieldMouseLayer","ZoomingCircuitFieldSurface","sizeRef","componentWidth","componentHeight","fieldRect","fieldWidth","fieldHeight","deltaY","passive","onCloseWindow","dragSourceRef","useDrag","Close","KEYMAP_SIM_STEP","KEYMAP_SELECT_ALL","KEYMAP_COPY","KEYMAP_PASTE","KEYMAP_DELETE","KEYMAP_UNDO","KEYMAP_REDO","FillParent","SelectionListItem","onItemSelected","CircuitTreeNodeCircuitLabel","onRequestRename","onCancelRename","newName","renameCircuit","onOpenNewWindow","deleteCircuit","CircuitTreeContextMenu","onNewCircuit","arrowRef","setArrowRef","popperStyles","role","arrow","CategoryNames","logic","TrayCategory","toLowerCase","TrayElement","liRef","setLiRef","showTooltip","setShowTooltip","onShowTooltip","onHideTooltip","elementTrayVisual","TrayComponent","NodeTrayErrorComponent","WindowsById","elementDefinitions","categories","setSearch","onSearchChanged","placeholder","keyHandlers","createEventDispatcher","onViewActivated","circuitEditorReceiveFocus","HotKeys","keyMap","handlers","onFocus","onCircuitSelected","listItems","rearrangeLayout","classList","importError","setImportError","searchParams","URLSearchParams","get","importProjectLink","exact","dialogTypeSelector","dialogDataSelector","onClickOutside","onEscapeKey","AutoFocusInside","acceptText","cancelText","onAccept","footer","onCloseDialog","dialogData","navigator","writeText","catch","dialogFooter","ImportCircuitCheckbox","onSetSelectedIds","setSelectedIds","onAcceptDialog","DialogComponent","unknownDialog","getDialogComponent","Annotation","setElement","MutationObserver","querySelector","childList","subtree","useQuerySelector","scrollIntoView","actions","actionElements","isTutorialActive","tutorialAnnotations","annotation","css","rootEl","getElementById","DndProvider","backend","history","describeArc","radius","startAngle","endAngle","polarToCartesian","largeArcFlag","centerX","centerY","angleInDegrees","angleInRadians","PI","cos","sin"],"mappings":"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","file":"client.3471dcc2bf3777d025a2.bundle.js","sourcesContent":["import { AnyAction } from \"redux\";\n\nexport const ACTION_ELEMENT_INTERACT = \"@element/interact\" as const;\nexport const interactElement = (elementIdPath: string[], data?: any) => ({\n  type: ACTION_ELEMENT_INTERACT,\n  payload: { elementIdPath, data },\n});\nexport type InteractElementAction = ReturnType<typeof interactElement>;\nexport function isInteractElementAction(\n  action: AnyAction\n): action is InteractElementAction {\n  return action.type === ACTION_ELEMENT_INTERACT;\n}\n","import { ElementDefinition } from \"../../types\";\n\nconst toggleElementDefinition: ElementDefinition = {\n  type: \"interaction-momentary\",\n  category: \"input-output\",\n  displayName: \"Momentary Switch\",\n  elementProduction: \"input-momentary\",\n  visual: {\n    hitRect: {\n      p1: { x: 5, y: 5 },\n      p2: { x: 45, y: 45 },\n    },\n    component: \"interaction-momentary\",\n  },\n  pins: {\n    OUT: {\n      direction: \"output\",\n      x: 50,\n      y: 25,\n    },\n  },\n};\n\nexport default toggleElementDefinition;\n","import { ElementDefinition } from \"../../types\";\n\nconst toggleElementDefinition: ElementDefinition = {\n  type: \"interaction-toggle\",\n  category: \"input-output\",\n  displayName: \"Toggle Switch\",\n  elementProduction: \"input-toggle\",\n  visual: {\n    hitRect: {\n      p1: { x: 5, y: 5 },\n      p2: { x: 45, y: 45 },\n    },\n    component: \"interaction-toggle\",\n  },\n  pins: {\n    OUT: {\n      direction: \"output\",\n      x: 50,\n      y: 25,\n    },\n  },\n};\n\nexport default toggleElementDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { ElementDefinition } from \"../../types\";\nimport { createStaticElementVisual } from \"../../visuals/static-element-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:AND_ANSI.svg\n\nconst hitPath = `M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30z`;\n\nconst andElementDefinition: ElementDefinition = {\n  type: \"logic-and\",\n  category: \"logic\",\n  displayName: \"AND\",\n  elementProduction: \"logic-and\",\n  visual: createStaticElementVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"element-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M70,25 h30 M31,15 H5 M32,35 H5\"\n      />\n      <path\n        className=\"element-select-highlight--fill\"\n        d=\"M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30zm2.857143 2.857143H50.47619c9.760663 0 16.666667 7.639955 16.666667 17.142857 0 9.502902-7.382195 17.142857-17.142857 17.142857H32.857143V7.857143z\"\n      />\n    </g>\n  ),\n  pins: {\n    A: { direction: \"input\", x: 0, y: 14.5 },\n    B: { direction: \"input\", x: 0, y: 35 },\n    OUT: { direction: \"output\", x: 100, y: 25 },\n  },\n};\nexport default andElementDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { ElementDefinition } from \"../../types\";\nimport { createStaticElementVisual } from \"../../visuals/static-element-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:Buffer_ANSI.svg\n\nconst hitPath = `M 28.96875,2.59375 L 28.96875,5 L 28.96875,45 L 28.96875,47.40625 L 31.125,46.34375 L 72.15625,26.34375 L 75,25 L 72.15625,23.65625 L 31.125,3.65625 L 28.96875,2.59375 z`;\n\nconst bufferElementDefinition: ElementDefinition = {\n  type: \"logic-buffer\",\n  category: \"logic\",\n  displayName: \"Buffer\",\n  elementProduction: \"logic-buffer\",\n  visual: createStaticElementVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"element-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"black\"\n        strokeWidth=\"2\"\n        d=\"M72,25 L 100,25\"\n      />\n      <path\n        className=\"element-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"black\"\n        strokeWidth=\"2\"\n        d=\"M 29.043478,25 L 5.0434781,25\"\n      />\n      <path\n        className=\"element-select-highlight--fill\"\n        stroke=\"none\"\n        fill=\"black\"\n        d=\"M 28.96875,2.59375 L 28.96875,5 L 28.96875,45 L 28.96875,47.40625 L 31.125,46.34375 L 72.15625,26.34375 L 75,25 L 72.15625,23.65625 L 31.125,3.65625 L 28.96875,2.59375 z M 31.96875,7.40625 L 68.09375,25 L 31.96875,42.59375 L 31.96875,7.40625 z\"\n      />\n    </g>\n  ),\n  pins: {\n    IN: {\n      direction: \"input\",\n      x: 0,\n      y: 25,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default bufferElementDefinition;\n","import * as React from \"react\";\n\nimport { Rectangle } from \"@/geometry\";\n\nimport { ElementDefinition } from \"../../types\";\nimport { createStaticElementVisual } from \"../../visuals/static-element-visual\";\n\n// Shape path from https://en.wikipedia.org/wiki/NAND_logic#/media/File:NAND_ANSI_Labelled.svg\n\nconst hitRect: Rectangle = {\n  p1: {\n    x: 24,\n    y: 5,\n  },\n  p2: {\n    x: 80,\n    y: 45,\n  },\n};\n\nconst nandElementDefinition: ElementDefinition = {\n  type: \"logic-nand\",\n  category: \"logic\",\n  displayName: \"NAND\",\n  elementProduction: \"logic-nand\",\n  visual: createStaticElementVisual(\n    hitRect,\n    <g transform=\"translate(-10,0)\">\n      <path\n        d=\"M 40,5 L 40,6.4285714 L 40,43.571429 L 40,45 L 41.428571,45 L 60.47619,45 C 71.744098,45 80.47619,35.999955 80.47619,25 C 80.47619,14.000045 71.744099,5.0000002 60.47619,5 C 60.47619,5 60.47619,5 41.428571,5 L 40,5 z\"\n        stroke=\"none\"\n        fill=\"transparent\"\n      />\n      <path\n        className=\"element-select-highlight--stroke\"\n        strokeWidth=\"2\"\n        stroke=\"black\"\n        fill=\"none\"\n        d=\"M 88,25 H110\"\n      />\n      <path\n        className=\"element-select-highlight--stroke\"\n        strokeWidth=\"2\"\n        stroke=\"black\"\n        fill=\"none\"\n        d=\"M 41,15 L 15,15\"\n      />\n      <path\n        className=\"element-select-highlight--stroke\"\n        strokeWidth=\"2\"\n        stroke=\"black\"\n        fill=\"none\"\n        d=\"M 42,35 L 15,35\"\n      />\n      <path\n        className=\"element-select-highlight--fill\"\n        d=\"M 40,5 L 40,6.4285714 L 40,43.571429 L 40,45 L 41.428571,45 L 60.47619,45 C 71.744098,45 80.47619,35.999955 80.47619,25 C 80.47619,14.000045 71.744099,5.0000002 60.47619,5 C 60.47619,5 60.47619,5 41.428571,5 L 40,5 z M 42.857143,7.8571429 C 50.834264,7.8571429 55.918368,7.8571429 58.095238,7.8571429 C 59.285714,7.8571429 59.880952,7.8571429 60.178571,7.8571429 C 60.327381,7.8571429 60.409227,7.8571429 60.446429,7.8571429 C 60.465029,7.8571429 60.471543,7.8571429 60.47619,7.8571429 C 70.236853,7.857143 77.142857,15.497098 77.142857,25 C 77.142857,34.502902 69.760662,42.142857 60,42.142857 L 42.857143,42.142857 L 42.857143,7.8571429 z\"\n      />\n      <path\n        className=\"element-select-highlight--stroke\"\n        strokeWidth=\"2\"\n        stroke=\"black\"\n        fill=\"none\"\n        d=\"M 79,25 A 4,4 0 1 1 71,25 A 4,4 0 1 1 79,25 z\"\n        transform=\"translate(9,0)\"\n      />\n    </g>\n  ),\n  pins: {\n    A: {\n      direction: \"input\",\n      x: 0,\n      y: 14.5,\n    },\n    B: {\n      direction: \"input\",\n      x: 0,\n      y: 35,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default nandElementDefinition;\n","import * as React from \"react\";\n\nimport { Rectangle } from \"@/geometry\";\n\nimport { ElementDefinition } from \"../../types\";\nimport { createStaticElementVisual } from \"../../visuals/static-element-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:NOR_ANSI.svg\n\nconst hitRect: Rectangle = {\n  p1: {\n    x: 24,\n    y: 5,\n  },\n  p2: {\n    x: 80,\n    y: 45,\n  },\n};\n\nconst norElementDefinition: ElementDefinition = {\n  type: \"logic-nor\",\n  category: \"logic\",\n  displayName: \"NOR\",\n  elementProduction: \"logic-nor\",\n  visual: createStaticElementVisual(\n    hitRect,\n    <g>\n      <path\n        fill=\"transparent\"\n        stroke=\"none\"\n        d=\"M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z\"\n      />\n      <path\n        className=\"element-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M79,25 h21 M31,15 H5 M32,35 H5\"\n      />\n      <path\n        className=\"element-select-highlight--fill\"\n        fillRule=\"evenodd\"\n        d=\"M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375zm5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z\"\n      />\n      <path\n        className=\"element-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z\"\n      />\n    </g>\n  ),\n  pins: {\n    A: {\n      direction: \"input\",\n      x: 0,\n      y: 14.5,\n    },\n    B: {\n      direction: \"input\",\n      x: 0,\n      y: 35,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default norElementDefinition;\n","import * as React from \"react\";\n\nimport { Rectangle } from \"@/geometry\";\n\nimport { ElementDefinition } from \"../../types\";\nimport { createStaticElementVisual } from \"../../visuals/static-element-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:NOT_ANSI.svg\n\nconst hitRect: Rectangle = {\n  p1: {\n    x: 24,\n    y: 5,\n  },\n  p2: {\n    x: 80,\n    y: 45,\n  },\n};\n\nconst notElementDefinition: ElementDefinition = {\n  type: \"logic-not\",\n  category: \"logic\",\n  displayName: \"NOT\",\n  elementProduction: \"logic-not\",\n  visual: createStaticElementVisual(\n    hitRect,\n    <g>\n      <path\n        fill=\"transparent\"\n        stroke=\"none\"\n        d=\"M28.96875 2.59375v44.8125l2.15625-1.0625 41.03125-20v-2.6875l-41.03125-20-2.15625-1.0625z\"\n      />\n      <path\n        className=\"element-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M79,25 H100 M29,25 h-24\"\n      />\n      <path\n        className=\"element-select-highlight--fill\"\n        d=\"M28.96875 2.59375v44.8125l2.15625-1.0625 41.03125-20v-2.6875l-41.03125-20-2.15625-1.0625zm3 4.8125L68.09375 25l-36.125 17.59375V7.40625z\"\n      />\n      <path\n        className=\"element-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z\"\n      />\n    </g>\n  ),\n  pins: {\n    IN: {\n      direction: \"input\",\n      x: 0,\n      y: 25,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default notElementDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { ElementDefinition } from \"../../types\";\nimport { createStaticElementVisual } from \"../../visuals/static-element-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:OR_ANSI.svg\n\nconst hitPath = `M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z`;\n\nconst orElementDefinition: ElementDefinition = {\n  type: \"logic-or\",\n  category: \"logic\",\n  displayName: \"OR\",\n  elementProduction: \"logic-or\",\n  visual: createStaticElementVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"element-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M70,25 h30 M31,15 H5 M32,35 H5\"\n      />\n      <path\n        className=\"element-select-highlight--fill\"\n        fillRule=\"evenodd\"\n        d=\"M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375zm5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z\"\n      />\n    </g>\n  ),\n  pins: {\n    A: {\n      direction: \"input\",\n      x: 0,\n      y: 14.5,\n    },\n    B: {\n      direction: \"input\",\n      x: 0,\n      y: 35,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default orElementDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { ElementDefinition } from \"../../types\";\nimport { createStaticElementVisual } from \"../../visuals/static-element-visual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:XOR_ANSI.svg\n\nconst hitPath = `M24.09375 5l2 2.4375S31.75 14.43755 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.40808 0 7.6897.02451 13.625-2.40625s12.53654-7.34327 17.6875-16.875L71.25 25l1.3125-.71875C62.25939 5.21559 46.00657 5 41.25 5H24.09375z`;\n\nconst xorElementDefinition: ElementDefinition = {\n  type: \"logic-xor\",\n  category: \"logic\",\n  displayName: \"XOR\",\n  elementProduction: \"logic-xor\",\n  visual: createStaticElementVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"element-select-highlight--stroke\"\n        fill=\"none\"\n        stroke=\"#000\"\n        strokeWidth=\"2\"\n        d=\"M70,25 h30 M30,15 H5 M31,35 H5\"\n      />\n      <g fillRule=\"evenodd\" className=\"element-select-highlight--fill\">\n        <path d=\"M24.25 42C22.65263 44.6444 22 45 22 45h-3.65625l2-2.4375S26 35.56245 26 25 20.34375 7.4375 20.34375 7.4375l-2-2.4375H22c.78125.9375 1.42188 1.65625 2.21875 3C26.09147 11.09981 29 17.02665 29 25c0 7.95065-2.8967 13.87942-4.75 17z\" />\n        <path d=\"M24.09375 5l2 2.4375S31.75 14.43755 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.40808 0 7.6897.02451 13.625-2.40625s12.53654-7.34327 17.6875-16.875L71.25 25l1.3125-.71875C62.25939 5.21559 46.00657 5 41.25 5H24.09375zm5.875 3H41.25c4.68417 0 18.28685-.1302 27.96875 17C64.45196 33.42907 58.69747 37.68391 53.5 39.8125 48.13934 42.00792 43.65808 42 41.25 42H30c1.87359-3.10843 4.75-9.04935 4.75-17 0-7.97335-2.90853-13.90019-4.78125-17z\" />\n      </g>\n    </g>\n  ),\n  pins: {\n    A: {\n      direction: \"input\",\n      x: 0,\n      y: 14.5,\n    },\n    B: {\n      direction: \"input\",\n      x: 0,\n      y: 35,\n    },\n    OUT: {\n      direction: \"output\",\n      x: 100,\n      y: 25,\n    },\n  },\n};\nexport default xorElementDefinition;\n","import { LedEvolverState } from \"@/evolvers/definitions/output-led\";\n\nimport { ElementDefinition } from \"../../types\";\nimport { createShapePathVisual } from \"../../visuals/ShapePathElementVisual\";\n\nfunction genCirclePath(cx: number, cy: number, r: number): string {\n  return `M ${cx - r}, ${cy}\n    a ${r},${r} 0 1,0 ${r * 2},0\n    a ${r},${r} 0 1,0 ${-(r * 2)},0`;\n}\n\nconst path = genCirclePath(25, 25, 20);\n\nconst ledElementDefinition: ElementDefinition = {\n  type: \"output-led\",\n  category: \"input-output\",\n  displayName: \"Indicator Light\",\n  elementProduction: \"output-led\",\n  visual: createShapePathVisual(path, {\n    path,\n    stroke: \"black\",\n    strokeWidth: 3,\n    fill: (state: LedEvolverState) =>\n      state.value ? \"lightgreen\" : \"darkgreen\",\n  }),\n  pins: {\n    IN: {\n      direction: \"input\",\n      x: 0,\n      y: 25,\n    },\n  },\n};\nexport default ledElementDefinition;\n","import { ElementDefinition } from \"../../types\";\nimport {\n  createShapePathVisual,\n  ShapePathDefinition,\n} from \"../../visuals/ShapePathElementVisual\";\n\n// Shape path from https://commons.wikimedia.org/wiki/File:7-segment_abcdefg.svg\n\nconst SCALE = 3;\nconst OFFSET = [15, 0];\n\n/**\n * Produce a visual path definition of a segment given a series of polygon points.\n * The path definition will color itself based on the state key specified by 'name'\n * @param name The state key to select color based on.  The key should represent a boolean value.\n * @param points An array of [x,y] pairs that make up the polygon.\n */\nfunction createSeg(\n  name: string,\n  points: [number, number][]\n): ShapePathDefinition {\n  const start = points[0];\n  let path = `M${start[0] * SCALE + OFFSET[0]},${start[1] * SCALE + OFFSET[1]}`;\n  for (const p of points.slice(1)) {\n    const [x, y] = p;\n    path += `L${x * SCALE + OFFSET[0]},${y * SCALE + OFFSET[1]}`;\n  }\n  path += \"z\";\n  return {\n    path,\n    fill: (state) => (state[name] ? \"red\" : \"gray\"),\n    strokeWidth: 0,\n  };\n}\n\nconst seg7ElementDefinition: ElementDefinition = {\n  type: \"output-seg7\",\n  category: \"input-output\",\n  displayName: \"7-Segment Display\",\n  elementProduction: \"output-seg7\",\n  visual: createShapePathVisual(`M15,0 V63 H45 V0 z`, [\n    createSeg(\"A\", [\n      [1, 1],\n      [2, 0],\n      [8, 0],\n      [9, 1],\n      [8, 2],\n      [2, 2],\n    ]),\n    createSeg(\"B\", [\n      [9, 1],\n      [10, 2],\n      [10, 8],\n      [9, 9],\n      [8, 8],\n      [8, 2],\n    ]),\n    createSeg(\"C\", [\n      [9, 9],\n      [10, 10],\n      [10, 16],\n      [9, 17],\n      [8, 16],\n      [8, 10],\n    ]),\n    createSeg(\"D\", [\n      [9, 17],\n      [8, 18],\n      [2, 18],\n      [1, 17],\n      [2, 16],\n      [8, 16],\n    ]),\n    createSeg(\"E\", [\n      [1, 17],\n      [0, 16],\n      [0, 10],\n      [1, 9],\n      [2, 10],\n      [2, 16],\n    ]),\n    createSeg(\"F\", [\n      [1, 9],\n      [0, 8],\n      [0, 2],\n      [1, 1],\n      [2, 2],\n      [2, 8],\n    ]),\n    createSeg(\"G\", [\n      [1, 9],\n      [2, 8],\n      [8, 8],\n      [9, 9],\n      [8, 10],\n      [2, 10],\n    ]),\n  ]),\n  pins: {\n    A: {\n      direction: \"input\",\n      x: 0,\n      y: 5,\n    },\n    B: {\n      direction: \"input\",\n      x: 0,\n      y: 15,\n    },\n    C: {\n      direction: \"input\",\n      x: 0,\n      y: 25,\n    },\n    D: {\n      direction: \"input\",\n      x: 0,\n      y: 35,\n    },\n    E: {\n      direction: \"input\",\n      x: 0,\n      y: 45,\n    },\n    F: {\n      direction: \"input\",\n      x: 0,\n      y: 55,\n    },\n    G: {\n      direction: \"input\",\n      x: 0,\n      y: 65,\n    },\n  },\n};\nexport default seg7ElementDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { ElementDefinition } from \"../../types\";\nimport { createStaticElementVisual } from \"../../visuals/static-element-visual\";\n\nconst hitPath = `M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0`;\n\nconst pinHighElementDefinition: ElementDefinition = {\n  type: \"pin-high\",\n  category: \"input-output\",\n  elementProduction: \"pin-high\",\n  displayName: \"High Pin\",\n  visual: createStaticElementVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"element-select-highlight--stroke\"\n        d=\"M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0 M35,25 h15\"\n        stroke=\"black\"\n        strokeWidth={2}\n        fill=\"none\"\n      />\n      <path\n        className=\"element-select-highlight--stroke\"\n        d=\"M25,20 v10 M20,25 h10\"\n        fill=\"none\"\n        stroke=\"black\"\n        strokeWidth={2}\n      />\n    </g>\n  ),\n  pins: {\n    OUT: {\n      direction: \"output\",\n      x: 50,\n      y: 25,\n    },\n  },\n};\nexport default pinHighElementDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\nimport { describeArc } from \"@/svg\";\n\nimport { ElementDefinition } from \"../../types\";\nimport { createStaticElementVisual } from \"../../visuals/static-element-visual\";\n\nconst hitPath = `M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0`;\n\nconst pinInputElementDefinition: ElementDefinition = {\n  type: \"pin-input\",\n  category: \"input-output\",\n  displayName: \"Input Pin\",\n  visual: createStaticElementVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"element-select-highlight--stroke\"\n        d=\"M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0 M35,25 h15\"\n        stroke=\"black\"\n        strokeWidth={2}\n        fill=\"none\"\n      />\n      <path\n        className=\"element-select-highlight--stroke\"\n        d={describeArc(25, 25, 3, -45, 225)}\n        fill=\"none\"\n        stroke=\"black\"\n        strokeWidth={2}\n      />\n    </g>\n  ),\n  pins: {\n    OUT: {\n      direction: \"output\",\n      x: 50,\n      y: 25,\n    },\n  },\n};\nexport default pinInputElementDefinition;\n","import * as React from \"react\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect } from \"@/geometry\";\n\nimport { ElementDefinition } from \"../../types\";\nimport { createStaticElementVisual } from \"../../visuals/static-element-visual\";\n\nconst hitPath = `M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0`;\n\nconst pinOutputElementDefinition: ElementDefinition = {\n  type: \"pin-output\",\n  category: \"input-output\",\n  displayName: \"Output Pin\",\n  visual: createStaticElementVisual(\n    boundsToRect(getBounds(hitPath)),\n    <g>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      <path\n        className=\"element-select-highlight--stroke\"\n        d=\"M15,25 a 10,10 0 1,0 20 0 a 10,10 0 1,0 -20,0 M15,25 h-15\"\n        stroke=\"black\"\n        strokeWidth={2}\n        fill=\"none\"\n      />\n      <circle\n        className=\"element-select-highlight--fill\"\n        cx={25}\n        cy={25}\n        r={3}\n        fill=\"black\"\n        stroke=\"none\"\n      />\n    </g>\n  ),\n  pins: {\n    IN: {\n      direction: \"input\",\n      x: 0,\n      y: 25,\n    },\n  },\n};\nexport default pinOutputElementDefinition;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { boundsToRect, Rectangle } from \"@/geometry\";\n\nimport { interactElement } from \"@/actions/element-interact\";\n\nimport { ElementComponentProps, ElementVisualDefinition } from \"../types\";\n\nexport interface ShapePathDefinition {\n  /**\n   * The svg path of this visual element.\n   */\n  path: string;\n  /**\n   * The fill or fill-producing function for this visual element.\n   */\n  fill?: string | ((state: any) => string);\n  stroke?: string | ((state: any) => string);\n  strokeWidth?: number | ((state: any) => number);\n}\n\nexport type ShapePath = string | ShapePathDefinition;\n\ninterface ShapePathElementVisualProps {\n  /**\n   * The path or paths that make up the visual component of this element.\n   */\n  shapePath: ShapePath | ShapePath[];\n  hitPath: string;\n}\n\nconst ShapePathElementVisual: React.FC<\n  ShapePathElementVisualProps & ElementComponentProps\n> = ({ elementId, elementPath, shapePath, hitPath, evolverState }) => {\n  const dispatch = useDispatch();\n\n  const onClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (!elementId) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      e.preventDefault();\n\n      dispatch(interactElement([...(elementPath || []), elementId]));\n    },\n    [elementId, dispatch, elementPath]\n  );\n\n  const visuals = normalizeVisuals(shapePath, evolverState);\n  const body = visuals.map((v, i) => (\n    <path\n      key={i}\n      d={v.path}\n      className=\"element-select-highlight--stroke element-select-highlight--fill\"\n      fill={v.fill}\n      stroke={v.stroke}\n      strokeWidth={v.strokeWidth}\n    />\n  ));\n\n  return (\n    <g onClick={onClick}>\n      <path d={hitPath} fill=\"transparent\" stroke=\"none\" />\n      {body}\n    </g>\n  );\n};\n\ninterface ShapePathElementTrayItemProps {\n  shapePath: ShapePath | ShapePath[];\n  hitRect: Rectangle;\n}\nconst TrayShapePadding = 5;\nconst ShapePathElementTrayItem: React.FC<ShapePathElementTrayItemProps> = ({\n  shapePath,\n  hitRect,\n}) => {\n  const visuals = normalizeVisuals(shapePath, {});\n  const body = visuals.map((v, i) => (\n    <path\n      key={i}\n      d={v.path}\n      className=\"element-select-highlight--stroke element-select-highlight--fill\"\n      fill={v.fill}\n      stroke={v.stroke}\n      strokeWidth={v.strokeWidth}\n    />\n  ));\n\n  return (\n    <svg\n      width={50}\n      height={50}\n      viewBox={`${hitRect.p1.x - TrayShapePadding} ${\n        hitRect.p1.y - TrayShapePadding\n      } ${hitRect.p2.x - hitRect.p1.x + TrayShapePadding * 2} ${\n        hitRect.p2.y - hitRect.p1.y + TrayShapePadding * 2\n      }`}\n    >\n      {body}\n    </svg>\n  );\n};\n\nexport function createShapePathVisual(\n  hitPath: string,\n  shapePath: ShapePath | ShapePath[]\n): ElementVisualDefinition {\n  const hitRect = boundsToRect(getBounds(hitPath));\n  return {\n    trayComponent: () => (\n      <ShapePathElementTrayItem shapePath={shapePath} hitRect={hitRect} />\n    ),\n    component: (props: ElementComponentProps) => (\n      <ShapePathElementVisual\n        shapePath={shapePath}\n        hitPath={hitPath}\n        {...props}\n      />\n    ),\n    hitRect,\n  };\n}\n\nfunction normalizeVisuals(\n  v: ShapePath | ShapePath[],\n  state: any\n): { path: string; fill?: string; stroke?: string; strokeWidth?: number }[] {\n  const asArray = Array.isArray(v) ? v : [v];\n\n  return asArray.map((x) => {\n    if (typeof x === \"string\") {\n      return {\n        path: x,\n        fill: \"black\",\n        stroke: \"black\",\n        strokeWidth: 2,\n      };\n    }\n    const fill = typeof x.fill === \"function\" ? x.fill(state || {}) : x.fill;\n    const stroke =\n      typeof x.stroke === \"function\" ? x.stroke(state || {}) : x.stroke;\n    const strokeWidth =\n      typeof x.strokeWidth === \"function\"\n        ? x.strokeWidth(state || {})\n        : x.strokeWidth;\n    return {\n      path: x.path,\n      fill,\n      stroke,\n      strokeWidth,\n    };\n  });\n}\n","import * as React from \"react\";\n\nimport { Rectangle } from \"@/geometry\";\n\nimport { ElementVisualDefinition } from \"../types\";\n\nconst TrayComponentPadding = 5;\n\nexport function createStaticElementVisual(\n  hitRect: Rectangle,\n  element: JSX.Element\n): ElementVisualDefinition {\n  return {\n    hitRect,\n    trayComponent: () => (\n      <svg\n        width={50}\n        height={50}\n        viewBox={`${hitRect.p1.x - TrayComponentPadding} ${\n          hitRect.p1.y - TrayComponentPadding\n        } ${hitRect.p2.x - hitRect.p1.x + TrayComponentPadding * 2} ${\n          hitRect.p2.y - hitRect.p1.y + TrayComponentPadding * 2\n        }`}\n      >\n        {element}\n      </svg>\n    ),\n    component: () => element,\n  };\n}\n","export const EVOLVER_RESPONSE_TIME = 4;\n","import { EvolutionResult } from \"@/logic\";\n\nimport { EVOLVER_RESPONSE_TIME } from \"../constants\";\nimport { EvolverDefinition } from \"../types\";\n\nconst inputMomentaryEvolverDefinition: EvolverDefinition = {\n  inputPins: [],\n  outputPins: [\"OUT\"],\n  interact(state: any, data: any): EvolutionResult {\n    if (data === undefined) {\n      return {\n        transitions: [\n          {\n            tickOffset: 1,\n            valuesByPin: { OUT: true },\n          },\n          {\n            tickOffset: 1 + Math.round(EVOLVER_RESPONSE_TIME * 1.5),\n            valuesByPin: { OUT: false },\n          },\n        ],\n      };\n    } else if (data) {\n      return {\n        transitions: {\n          tickOffset: 1,\n          valuesByPin: { OUT: true },\n        },\n      };\n    } else {\n      return {\n        transitions: {\n          tickOffset: 1,\n          valuesByPin: { OUT: false },\n        },\n      };\n    }\n  },\n};\nexport default inputMomentaryEvolverDefinition;\n","import { EvolverDefinition } from \"../types\";\n\nexport interface ToggleEvolverState {\n  toggleState: boolean;\n}\nconst defaultToggleState: ToggleEvolverState = {\n  toggleState: false,\n};\n\nconst inputToggleEvolverDefinition: EvolverDefinition = {\n  inputPins: [],\n  outputPins: [\"OUT\"],\n  interact(state: ToggleEvolverState = defaultToggleState) {\n    const nextState = !state.toggleState;\n    return {\n      state: Object.assign({}, state, {\n        toggleState: nextState,\n      }),\n      transitions: {\n        tickOffset: 1,\n        valuesByPin: { OUT: nextState },\n      },\n    };\n  },\n  evolve: (state: ToggleEvolverState = defaultToggleState) => {\n    return {\n      state,\n      transitions: {\n        tickOffset: 1,\n        valuesByPin: { OUT: state.toggleState },\n      },\n    };\n  },\n};\nexport default inputToggleEvolverDefinition;\n","import { EVOLVER_RESPONSE_TIME } from \"../constants\";\nimport { EvolverDefinition } from \"../types\";\n\nconst logicAndEvolverDefinition: EvolverDefinition = {\n  inputPins: [\"A\", \"B\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: EVOLVER_RESPONSE_TIME,\n        valuesByPin: { OUT: inputs.A && inputs.B },\n      },\n    };\n  },\n};\nexport default logicAndEvolverDefinition;\n","import { EVOLVER_RESPONSE_TIME } from \"../constants\";\nimport { EvolverDefinition } from \"../types\";\n\nconst logicBufferEvolverDefinition: EvolverDefinition = {\n  inputPins: [\"IN\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: EVOLVER_RESPONSE_TIME,\n        valuesByPin: { OUT: inputs.IN },\n      },\n    };\n  },\n};\nexport default logicBufferEvolverDefinition;\n","import { EVOLVER_RESPONSE_TIME } from \"../constants\";\nimport { EvolverDefinition } from \"../types\";\n\nconst logicNandEvolverDefinition: EvolverDefinition = {\n  inputPins: [\"A\", \"B\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: EVOLVER_RESPONSE_TIME,\n        valuesByPin: { OUT: !(inputs.A && inputs.B) },\n      },\n    };\n  },\n};\nexport default logicNandEvolverDefinition;\n","import { EVOLVER_RESPONSE_TIME } from \"../constants\";\nimport { EvolverDefinition } from \"../types\";\n\nconst logicNorEvolverDefinition: EvolverDefinition = {\n  inputPins: [\"A\", \"B\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: EVOLVER_RESPONSE_TIME,\n        valuesByPin: { OUT: !(inputs.A || inputs.B) },\n      },\n    };\n  },\n};\nexport default logicNorEvolverDefinition;\n","import { EVOLVER_RESPONSE_TIME } from \"../constants\";\nimport { EvolverDefinition } from \"../types\";\n\nconst logicNotEvolverDefinition: EvolverDefinition = {\n  inputPins: [\"IN\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: EVOLVER_RESPONSE_TIME,\n        valuesByPin: { OUT: !inputs.IN },\n      },\n    };\n  },\n};\nexport default logicNotEvolverDefinition;\n","import { EVOLVER_RESPONSE_TIME } from \"../constants\";\nimport { EvolverDefinition } from \"../types\";\n\nconst logicOrEvolverDefinition: EvolverDefinition = {\n  inputPins: [\"A\", \"B\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: EVOLVER_RESPONSE_TIME,\n        valuesByPin: { OUT: inputs.A || inputs.B },\n      },\n    };\n  },\n};\nexport default logicOrEvolverDefinition;\n","import { EVOLVER_RESPONSE_TIME } from \"../constants\";\nimport { EvolverDefinition } from \"../types\";\n\nconst logicXorEvolverDefinition: EvolverDefinition = {\n  inputPins: [\"A\", \"B\"],\n  outputPins: [\"OUT\"],\n  evolve(_, inputs) {\n    return {\n      transitions: {\n        tickOffset: EVOLVER_RESPONSE_TIME,\n        valuesByPin: { OUT: (inputs.A || inputs.B) && inputs.A != inputs.B },\n      },\n    };\n  },\n};\nexport default logicXorEvolverDefinition;\n","import { EvolverDefinition } from \"../types\";\n\nexport interface LedEvolverState {\n  value: boolean;\n}\n\nconst outputLedEvolverDefinition: EvolverDefinition = {\n  inputPins: [\"IN\"],\n  outputPins: [],\n  evolve(_, inputs) {\n    return {\n      state: {\n        value: inputs.IN,\n      },\n    };\n  },\n};\nexport default outputLedEvolverDefinition;\n","import { EvolverDefinition } from \"../types\";\n\nconst outputSeg7EvolverDefinition: EvolverDefinition = {\n  inputPins: [\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\"],\n  outputPins: [],\n  evolve(_, inputs) {\n    return {\n      state: { ...inputs },\n    };\n  },\n};\nexport default outputSeg7EvolverDefinition;\n","import { EvolverDefinition } from \"../types\";\n\nconst pinHighEvolverDefinition: EvolverDefinition = {\n  inputPins: [],\n  outputPins: [\"OUT\"],\n  evolve() {\n    return {\n      transitions: {\n        tickOffset: 1,\n        valuesByPin: { OUT: true },\n      },\n    };\n  },\n};\nexport default pinHighEvolverDefinition;\n","import * as yup from \"yup\";\n\nexport interface Point {\n  x: number;\n  y: number;\n}\nexport const pointSchema = yup.object().shape({\n  x: yup.number().required(),\n  y: yup.number().required(),\n});\n\nexport interface Size {\n  width: number;\n  height: number;\n}\n\nexport interface Rectangle {\n  p1: Point;\n  p2: Point;\n}\n\n// Bit silly to have two ways of tracking a rectangular region, but this is inherited from svg-path-bounds\nexport type Bounds = [left: number, top: number, right: number, bottom: number];\n\nexport const ZeroPoint = Object.freeze({ x: 0, y: 0 });\nexport const ZeroRect = Object.freeze({ p1: ZeroPoint, p2: ZeroPoint });\n\nexport function boundsToRect(bounds: Bounds): Rectangle {\n  return {\n    p1: { x: bounds[0], y: bounds[1] },\n    p2: { x: bounds[2], y: bounds[3] },\n  };\n}\n\nexport function snapPoint(p: Point, snap: number) {\n  return {\n    x: Math.round(p.x / snap) * snap,\n    y: Math.round(p.y / snap) * snap,\n  };\n}\n\nexport function magnitude(v: Point): number {\n  return Math.sqrt(v.x * v.x + v.y * v.y);\n}\nexport function normalize(p: Point): Point {\n  const m = magnitude(p);\n  return {\n    x: p.x / m,\n    y: p.y / m,\n  };\n}\n\nexport function dotProduct(a: Point, b: Point): number {\n  return a.x * b.x + a.y * b.y;\n}\n\nexport function scale(p: Point, scaler: number) {\n  return { x: p.x * scaler, y: p.y * scaler };\n}\n\nexport function normalizeRectangle(p1: Point, p2: Point): Rectangle;\nexport function normalizeRectangle(r: Rectangle): Rectangle;\nexport function normalizeRectangle(...args: any[]): Rectangle {\n  let p1: Point;\n  let p2: Point;\n  if (args.length === 1) {\n    const r = args[0] as Rectangle;\n    p1 = r.p1;\n    p2 = r.p2;\n  } else {\n    p1 = args[0] as Point;\n    p2 = args[1] as Point;\n  }\n  return {\n    p1: {\n      x: Math.min(p1.x, p2.x),\n      y: Math.min(p1.y, p2.y),\n    },\n    p2: {\n      x: Math.max(p1.x, p2.x),\n      y: Math.max(p1.y, p2.y),\n    },\n  };\n}\n\nexport function offsetRectangle(rect: Rectangle, offset: Point) {\n  return {\n    p1: pointAdd(rect.p1, offset),\n    p2: pointAdd(rect.p2, offset),\n  };\n}\n\nexport function pointAdd(p1: Point, p2: Point): Point {\n  return {\n    x: p1.x + p2.x,\n    y: p1.y + p2.y,\n  };\n}\nexport function pointSubtract(p1: Point, p2: Point): Point {\n  return {\n    x: p1.x - p2.x,\n    y: p1.y - p2.y,\n  };\n}\nexport function pointEquals(p1: Point, p2: Point): boolean {\n  return p1.x === p2.x && p1.y === p2.y;\n}\n\nexport function pointIntersects(p: Point, r: Rectangle): boolean {\n  r = normalizeRectangle(r);\n\n  if (r.p1.x > p.x || r.p2.x < p.x) {\n    return false;\n  }\n\n  if (r.p1.y > p.y || r.p2.y < p.y) {\n    return false;\n  }\n\n  return true;\n}\n\nexport function calcSize(r: Rectangle): Size {\n  r = normalizeRectangle(r);\n  return {\n    width: r.p2.x - r.p1.x,\n    height: r.p2.y - r.p1.y,\n  };\n}\n\nexport function union(r1: Rectangle, r2: Rectangle): Rectangle {\n  r1 = normalizeRectangle(r1);\n  r2 = normalizeRectangle(r2);\n  return {\n    p1: {\n      x: Math.min(r1.p1.x, r2.p1.x),\n      y: Math.min(r1.p1.y, r2.p1.y),\n    },\n    p2: {\n      x: Math.max(r1.p2.x, r2.p2.x),\n      y: Math.max(r1.p2.y, r2.p2.y),\n    },\n  };\n}\n\nexport function intersects(r1: Rectangle, r2: Rectangle): boolean {\n  r1 = normalizeRectangle(r1);\n  r2 = normalizeRectangle(r2);\n\n  // r1 starts after p2's extent, or does not reach r2's start.\n  if (r1.p1.x > r2.p2.x || r1.p2.x < r2.p1.x) {\n    return false;\n  }\n\n  // r1 starts after p2's extent, or does not reach r2's start.\n  if (r1.p1.y > r2.p2.y || r1.p2.y < r2.p1.y) {\n    return false;\n  }\n\n  return true;\n}\n","import { createHashHistory } from \"history\";\n\nconst history = createHashHistory();\n\nexport default history;\n","import { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nimport { ElementPin } from \"../circuit-graph/types\";\n\nexport interface CircuitEditorDragNullState {\n  dragMode: null;\n}\n\nexport interface CircuitEditorDragActiveState {\n  /**\n   * The editor this drag operation started in.\n   */\n  dragStartEditorId: string;\n\n  /**\n   * The start of the drag operation.\n   */\n  dragStart: Point;\n\n  /**\n   * The editor the drag operation is currently in.\n   */\n  dragEndEditorId: string | null;\n\n  /**\n   * The current end point for the drag operation.  This does not indicate the final\n   * drag position, but the current most up to date position.\n   */\n  dragEnd: Point | null;\n}\n\nexport interface CircuitEditorDragMoveState\n  extends CircuitEditorDragActiveState {\n  dragMode: \"move\";\n\n  /**\n   * The modifier keys in play for the drag operation.\n   */\n  dragModifierKeys: ModifierKeys;\n}\n\nexport interface CircuitEditorDragSelectState\n  extends CircuitEditorDragActiveState {\n  dragMode: \"select\";\n\n  /**\n   * The modifier keys in play for the drag operation.\n   */\n  dragModifierKeys: ModifierKeys;\n}\n\nexport interface CircuitEditorDragNewJointState\n  extends CircuitEditorDragActiveState {\n  dragMode: \"new-joint\";\n\n  /**\n   * The modifier keys in play for the drag operation.\n   */\n  dragModifierKeys: ModifierKeys;\n\n  /**\n   * The connection id to create the joint on.\n   */\n  dragNewJointConnectionId: string | null;\n\n  /**\n   * The joint id to add the new joint after.\n   */\n  dragNewJointAfterJointId: string | null;\n}\n\nexport interface CircuitEditorDragWireState\n  extends CircuitEditorDragActiveState {\n  dragMode: \"wire\";\n\n  /**\n   * If drag mode is \"wire\", this is the source pin being wired by the drag.\n   */\n  dragWireSource: ElementPin | null;\n}\n\nexport type CircuitEditorDragServiceState =\n  | CircuitEditorDragNullState\n  | CircuitEditorDragMoveState\n  | CircuitEditorDragSelectState\n  | CircuitEditorDragNewJointState\n  | CircuitEditorDragWireState;\n\nconst _defaultState: CircuitEditorDragServiceState = {\n  dragMode: null,\n};\n\nexport const defaultCircuitEditorDragServiceState = Object.freeze(\n  _defaultState\n);\n","export const ROOT_CIRCUIT_ID = \"root\";\n","export const DEFAULT_CIRCUIT_EDITOR_ID = \"root-editor\";\n","import { ROOT_CIRCUIT_ID } from \"../circuits/constants\";\n\nimport { DEFAULT_CIRCUIT_EDITOR_ID } from \"./constants\";\n\nexport interface CircuitEditorState {\n  circuitId: string;\n  elementIdPath: string[];\n}\n\nexport interface CircuitEditorsServiceState {\n  circucitEditorsById: Record<string, CircuitEditorState>;\n  activeEditorId: string | null;\n}\n\nconst _defaultState: CircuitEditorsServiceState = {\n  circucitEditorsById: {\n    [DEFAULT_CIRCUIT_EDITOR_ID]: {\n      circuitId: ROOT_CIRCUIT_ID,\n      elementIdPath: [],\n    },\n  },\n  activeEditorId: null,\n};\n\nexport const defaultCircuitEditorServiceState = Object.freeze(_defaultState);\n","import { ROOT_CIRCUIT_ID } from \"../circuits/constants\";\n\nimport { Element, Connection } from \"./types\";\n\nexport interface CircuitGraphServiceState {\n  /**\n   * Arrays of element ids contained in a circuit by the containing circuit id.\n   */\n  elementIdsByCircuitId: Record<string, string[]>;\n\n  /**\n   * A map of elements by element id.\n   */\n  elementsById: Record<string, Element>;\n\n  /**\n   * A map of connections between elements, by connection id.\n   */\n  connectionsById: Record<string, Connection>;\n}\n\nconst _defaultState: CircuitGraphServiceState = {\n  elementIdsByCircuitId: {\n    [ROOT_CIRCUIT_ID]: [],\n  },\n  elementsById: {},\n  connectionsById: {},\n};\n\nexport const defaultCircuitGraphServiceState = Object.freeze(_defaultState);\n","import { Point } from \"@/geometry\";\n\nexport interface CircuitLayoutServiceState {\n  elementPositionsById: Record<string, Point>;\n  wireJointIdsByConnectionId: Record<string, string[]>;\n  wireJointPositionsByJointId: Record<string, Point>;\n}\n\nconst _defaultState: CircuitLayoutServiceState = {\n  elementPositionsById: {},\n  wireJointIdsByConnectionId: {},\n  wireJointPositionsByJointId: {},\n};\n\nexport const defaultCircuitLayoutServiceState: Readonly<CircuitLayoutServiceState> = Object.freeze(\n  _defaultState\n);\n","import { ROOT_CIRCUIT_ID } from \"../circuits/constants\";\n\nexport interface CircuitPropertiesServiceState {\n  /**\n   * The user-provided names for circuits by circuit id.\n   */\n  circuitNamesByCircuitId: Record<string, string>;\n}\n\nconst _defaultState: CircuitPropertiesServiceState = {\n  circuitNamesByCircuitId: {\n    [ROOT_CIRCUIT_ID]: \"Root\",\n  },\n};\n\nexport const defaultCircuitPropertiesServiceState = Object.freeze(\n  _defaultState\n);\n","import { Point, ZeroPoint } from \"@/geometry\";\n\nimport { ClipboardElement } from \"./types\";\n\nexport interface ClipboardServiceState {\n  clipboardElements: ClipboardElement[];\n  clipboardPasteOrigin: Point;\n}\n\nexport const defaultClipboardServiceState: Readonly<ClipboardServiceState> = Object.freeze(\n  {\n    clipboardElements: [],\n    clipboardPasteOrigin: ZeroPoint,\n  }\n);\n","// FIXME: There has got to be a better way of typing these, so api and selectors are type safe.\n\nimport { DialogType } from \"@/dialogs/types\";\n\nexport interface DialogServiceState {\n  dialogType: DialogType | null;\n  data: any;\n}\n\nconst _defaultState: DialogServiceState = {\n  dialogType: null,\n  data: null,\n};\n\nexport const defaultDialogServiceState: Readonly<DialogServiceState> = Object.freeze(\n  _defaultState\n);\n","export interface ProjectServiceState {\n  projectName: string;\n  projectModified: boolean;\n}\n\nconst _defaultProps: ProjectServiceState = {\n  projectName: \"New Project\",\n  projectModified: false,\n};\n\nexport const defaultProjectServiceState = Object.freeze(_defaultProps);\n","export interface SelectionServiceState {\n  selectedElementIds: string[];\n  selectedConnectionIds: string[];\n  selectedJointIds: string[];\n}\n\nconst _defaultState: SelectionServiceState = {\n  selectedElementIds: [],\n  selectedConnectionIds: [],\n  selectedJointIds: [],\n};\n\nexport const defaultSelectionServiceState = Object.freeze(_defaultState);\n","import { EvolverPinTransition, SimTransitionWindow } from \"./types\";\n\nexport interface SimulatorServiceState {\n  /**\n   * Whether the simulator has been initialized.\n   */\n  initialized: boolean;\n\n  /**\n   * The current tick the simulator is on.\n   */\n  tick: number;\n\n  /**\n   * The time it took in milliseconds to process the last tick.\n   */\n  lastTickProcessingTimeMs: number;\n\n  /**\n   * A map of evolver states by evolver id.\n   */\n  evolverStatesByEvolverId: Record<string, any>;\n\n  /**\n   * A map of output-to-value maps by evolver id.\n   */\n  evolverOutputValuesByEvolverId: Record<string, Record<string, boolean>>;\n\n  /**\n   * A map of pending transitions by id.\n   */\n  transitionsById: Record<string, EvolverPinTransition>;\n\n  /**\n   * Transition windows in ascending order of tick.\n   */\n  transitionWindows: SimTransitionWindow[];\n}\n\nconst _defaultState: SimulatorServiceState = {\n  initialized: false,\n  tick: 0,\n  lastTickProcessingTimeMs: 0,\n  evolverStatesByEvolverId: {},\n  evolverOutputValuesByEvolverId: {},\n  transitionsById: {},\n  transitionWindows: [],\n};\n\nexport const defaultSimulatorServiceState = Object.freeze(_defaultState);\n","export interface SimulatorControlServiceState {\n  /**\n   * The overall application mode.\n   * Might not belong in simulator state?\n   *\n   * - edit: User is editing, no simulator is running\n   * - step: Sim is paused and only ticks on user command\n   * - run: Sim is actively running and ticking forwards on its own.\n   */\n  mode: \"edit\" | \"pause\" | \"run\";\n\n  /**\n   * Tick speed in ticks per second when running.\n   */\n  ticksPerSecond: number;\n}\n\nconst _defaultState: SimulatorControlServiceState = {\n  mode: \"edit\",\n  ticksPerSecond: 1000,\n};\n\nexport const defaultSimulatorControlServiceState = Object.freeze(_defaultState);\n","import { AnyAction } from \"redux\";\nimport { Options } from \"@popperjs/core\";\n\nimport { MaybeArray } from \"@/arrays\";\nimport { AppState } from \"@/store\";\n\nexport interface TutorialAction {\n  name: string;\n  action: AnyAction;\n}\n\nexport interface AnnotatedElement {\n  selector: string;\n  message?: string;\n  placement?: Options[\"placement\"];\n  action?: MaybeArray<TutorialAction>;\n}\n\nexport interface TutorialServiceState {\n  activeTutorial: string | null;\n  annotatedElements: AnnotatedElement[];\n  preTutorialState: AppState | null;\n}\n\nconst _defaultState: TutorialServiceState = {\n  activeTutorial: null,\n  annotatedElements: [],\n  preTutorialState: null,\n};\n\nexport const defaultTutorialServiceState = Object.freeze(_defaultState);\n","export function cls(...values: (string | false | undefined)[]): string {\n  return values.filter((x) => Boolean(x) && x != \"\").join(\" \");\n}\n\nexport function typedKeys<T extends Record<string, unknown>>(\n  obj: T\n): (keyof T)[] {\n  return Object.keys(obj) as (keyof T)[];\n}\n\nexport type ValueSetter<T> = T | ((old: T) => T);\n\nexport function fpSet<\n  Target extends Record<string, any> | any[],\n  P1 extends keyof Target,\n  T extends Target[P1]\n>(target: Target, p1: P1, value: ValueSetter<T>): Target;\nexport function fpSet<\n  Target extends Record<string, any> | any[],\n  P1 extends keyof Target,\n  P2 extends keyof Target[P1],\n  T extends Target[P1][P2]\n>(target: Target, p1: P1, p2: P2, value: ValueSetter<T>): Target;\nexport function fpSet<\n  Target extends Record<string, any> | any[],\n  P1 extends keyof Target,\n  P2 extends keyof Target[P1],\n  P3 extends keyof Target[P1][P2],\n  T extends Target[P1][P2][P3]\n>(target: Target, p1: P1, p2: P2, p3: P3, value: ValueSetter<T>): Target;\nexport function fpSet(...args: any[]): any {\n  const target = args[0];\n  const path = args.slice(1, args.length - 1).map(String);\n  const value = args[args.length - 1];\n  return fpSetByArray(target, path, value);\n}\n\nexport function fpSetByArray<T extends Record<string, any>>(\n  target: T,\n  path: (string | number)[],\n  value: ValueSetter<any>\n): T {\n  if (path.length === 0) {\n    if (typeof value === \"function\") {\n      return value(target);\n    }\n    return value;\n  }\n\n  const firstPaths = path.slice(0, path.length - 1).map(String);\n  const lastPath = path[path.length - 1];\n\n  const newData = clone(target);\n\n  let rollingTarget: any = newData;\n\n  for (const seg of firstPaths) {\n    rollingTarget[seg] = clone(rollingTarget[seg]);\n    rollingTarget = rollingTarget[seg];\n  }\n\n  if (typeof value === \"function\") {\n    rollingTarget[lastPath] = value(rollingTarget[lastPath]);\n  } else {\n    rollingTarget[lastPath] = value;\n  }\n\n  return newData;\n}\n\nfunction clone<T extends Record<string, unknown> | any[]>(obj: T): T {\n  if (Array.isArray(obj)) {\n    return obj.slice() as T;\n  }\n  return Object.assign({}, obj);\n}\n\nexport function isTruthy<T>(value: T | null | undefined | false): value is T {\n  return Boolean(value);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"fill-parent\":\"fill-parent--3pw6U\"};","// extracted by mini-css-extract-plugin\nexport default {\"flex-row\":\"flex-row--sHjOY\",\"flex-column\":\"flex-column--2LT64\",\"flex-reverse\":\"flex-reverse--2Vn7L\",\"flexitem-shrink\":\"flexitem-shrink--2U9EV\",\"flexitem-fix\":\"flexitem-fix--1ARxk\"};","import has from \"lodash/has\";\n\nexport type TesselWindowRenderer = (\n  window: TesselWindowItem\n) => React.ReactElement | null;\n\nexport interface TesselWindowItem<P = Record<string, any>> {\n  windowId: string;\n  windowProps?: P;\n}\n\nexport type TesselDirection = \"row\" | \"column\";\n\nexport interface TesselPercentDivision {\n  firstPercent: number;\n}\nexport interface TesselFixedDivision {\n  firstSize?: number;\n  secondSize?: number;\n}\nexport type TesselDivision = TesselPercentDivision | TesselFixedDivision;\nexport type TesselDivisionValue = number | TesselDivision;\n\nexport interface TesselSplitItem {\n  first: TesselValue;\n  second: TesselValue;\n  direction: TesselDirection;\n  division: TesselDivisionValue;\n}\n\nexport type TesselItem = TesselWindowItem | TesselSplitItem;\nexport type TesselValue = string | TesselItem;\n\nexport type TesselDropPosition = \"left\" | \"right\" | \"top\" | \"bottom\";\n\nexport function normalizeTesselItem(value: TesselValue): TesselItem {\n  if (typeof value === \"string\") {\n    return {\n      windowId: value,\n    };\n  }\n\n  return value;\n}\n\nexport function isTesselWindow(item: TesselItem): item is TesselWindowItem {\n  return has(item, \"windowId\");\n}\n\nexport function isTesselSplit(item: TesselItem): item is TesselSplitItem {\n  return has(item, \"first\") && has(item, \"second\") && has(item, \"direction\");\n}\n\nexport function normalizeTesselDivision(\n  value: TesselDivisionValue\n): TesselDivision {\n  if (typeof value === \"number\") {\n    return {\n      firstPercent: value,\n    };\n  }\n\n  return value;\n}\n\nexport function isTesselPercentDivision(\n  value: TesselDivision\n): value is TesselPercentDivision {\n  return has(value, \"firstPercent\");\n}\n\nexport function isTesselFixedDivision(\n  value: TesselDivision\n): value is TesselFixedDivision {\n  return has(value, \"firstSize\") || has(value, \"secondSize\");\n}\n","import * as React from \"react\";\n\nexport function useRefValue<T>(value: T): React.RefObject<T> {\n  const ref = React.useRef(value);\n  React.useEffect(() => {\n    ref.current = value;\n  });\n\n  return ref;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"tessel\":\"tessel--2Q3Xd\",\"tessel-content\":\"tessel-content--3-kEA\",\"tessel-drop-capture\":\"tessel-drop-capture--3TbuI\",\"tessel-drop-capture--dragging\":\"tessel-drop-capture--dragging--Ihwyz\",\"tessel-drop-marker\":\"tessel-drop-marker--1cqr2\",\"drop-left\":\"drop-left--wqP1V\",\"drop-right\":\"drop-right--2MyGz\",\"drop-top\":\"drop-top--1S0co\",\"drop-bottom\":\"drop-bottom--2f330\",\"tessel-split\":\"tessel-split--2gDs5\",\"tessel-split--row\":\"tessel-split--row--2fC6o\",\"tessel-split--column\":\"tessel-split--column--1Hl4C\",\"tessel-window\":\"tessel-window--1qDgp\",\"tessel-window-titlebar\":\"tessel-window-titlebar--uHBdn\",\"tessel-window-title\":\"tessel-window-title--2v0hT\",\"tessel-window-controls\":\"tessel-window-controls--3i3ou\",\"tessel-window-controls-close\":\"tessel-window-controls-close--2O8Zs\",\"tessel-window-content\":\"tessel-window-content--sOnG-\"};","import { cls } from \"@/utils\";\nimport * as React from \"react\";\nimport throttle from \"lodash/throttle\";\n\nimport { useRefValue } from \"@/hooks/useRefValue\";\n\nimport { TesselDirection } from \"./types\";\n\nimport styles from \"./Tessel.module.css\";\n\nexport interface TesselSplitProps {\n  direction: TesselDirection;\n  onChangePercentage(percent: number, position: number): void;\n}\n\nconst ZeroRect: DOMRect = Object.freeze({\n  top: 0,\n  left: 0,\n  bottom: 0,\n  right: 0,\n  x: 0,\n  y: 0,\n  height: 0,\n  width: 0,\n  toJSON: () => ({}),\n});\n\nconst TesselSplit: React.FC<TesselSplitProps> = ({\n  direction,\n  onChangePercentage,\n}) => {\n  const ref = React.useRef<HTMLDivElement | null>(null);\n\n  const pointerCaptureRef = React.useRef<number | null>(null);\n\n  // Ref these up so we can continue using the same throttle across rerenders.\n  const directionRef = useRefValue(direction);\n  const onChangePercentageRef = useRefValue(onChangePercentage);\n\n  const onHandlePointerMove = React.useMemo(\n    () =>\n      throttle(\n        (e: React.PointerEvent<HTMLDivElement>) => {\n          if (pointerCaptureRef.current == null || ref.current == null) {\n            return;\n          }\n\n          const parentRect =\n            ref.current.parentElement?.getBoundingClientRect() ?? ZeroRect;\n\n          let percentage = 0;\n          let position = 0;\n          if (directionRef.current === \"row\") {\n            position = e.pageX - parentRect.left;\n            percentage = position / parentRect.width;\n            if (isNaN(percentage)) {\n              percentage = 0;\n              position = parentRect.left;\n            } else if (percentage > 1) {\n              percentage = 1;\n              position = parentRect.right;\n            }\n          } else {\n            position = e.pageY - parentRect.top;\n            percentage = position / parentRect.height;\n            if (isNaN(percentage)) {\n              percentage = 0;\n              position = parentRect.top;\n            } else if (percentage > 1) {\n              percentage = 1;\n              position = parentRect.bottom;\n            }\n          }\n\n          onChangePercentageRef.current!(percentage * 100, position);\n        },\n        1000 / 60,\n        { leading: true }\n      ),\n    [directionRef, onChangePercentageRef]\n  );\n\n  const onPointerMove = React.useCallback(\n    (e: React.PointerEvent<HTMLDivElement>) => {\n      e.persist();\n      onHandlePointerMove(e);\n    },\n    [onHandlePointerMove]\n  );\n\n  const onPointerDown = React.useCallback(\n    (e: React.PointerEvent<HTMLDivElement>) => {\n      if (e.defaultPrevented || !ref.current) {\n        return;\n      }\n\n      if (pointerCaptureRef.current) {\n        return;\n      }\n\n      e.preventDefault();\n\n      ref.current.setPointerCapture(e.pointerId);\n      pointerCaptureRef.current = e.pointerId;\n    },\n    []\n  );\n\n  const onPointerUp = React.useCallback(() => {\n    if (ref.current && pointerCaptureRef.current) {\n      ref.current.releasePointerCapture(pointerCaptureRef.current);\n      pointerCaptureRef.current = null;\n    }\n  }, []);\n\n  return (\n    <div\n      ref={ref}\n      className={cls(\n        \"tessel-split\",\n        styles[\"tessel-split\"],\n        styles[\n          direction === \"row\" ? \"tessel-split--row\" : \"tessel-split--column\"\n        ]\n      )}\n      onPointerDown={onPointerDown}\n      onPointerMove={onPointerMove}\n      onPointerUp={onPointerUp}\n    />\n  );\n};\n\nexport default TesselSplit;\n","import * as React from \"react\";\nimport { TesselDropPosition } from \"./types\";\n\nconst tesselPathContext = React.createContext<string[]>([]);\nexport function useTesselPath() {\n  return React.useContext(tesselPathContext);\n}\nexport interface TesselContextProviderProps {\n  pathKey: string;\n}\nexport const TesselPathProvider: React.FC<TesselContextProviderProps> = ({\n  pathKey,\n  children,\n}) => {\n  const path = useTesselPath();\n\n  const newPath = React.useMemo<string[]>(() => [...path, pathKey], [\n    path,\n    pathKey,\n  ]);\n\n  return (\n    <tesselPathContext.Provider value={newPath}>\n      {children}\n    </tesselPathContext.Provider>\n  );\n};\n\nexport interface TesselInteractionContext {\n  moveWindow(from: string[], to: string[], position: TesselDropPosition): void;\n  closeWindow(path: string[]): void;\n}\nfunction noop() {\n  /* no op */\n}\nconst tesselInteractionContext = React.createContext<TesselInteractionContext>({\n  moveWindow: noop,\n  closeWindow: noop,\n});\nexport function useTesselInteraction() {\n  return React.useContext(tesselInteractionContext);\n}\n\nexport type TesselInteractionProviderProps = TesselInteractionContext;\nexport const TesselInteractionProvider: React.FC<TesselInteractionProviderProps> = ({\n  moveWindow,\n  closeWindow,\n  children,\n}) => {\n  const context = React.useMemo<TesselInteractionContext>(\n    () => ({\n      moveWindow,\n      closeWindow,\n    }),\n    [moveWindow, closeWindow]\n  );\n\n  return (\n    <tesselInteractionContext.Provider value={context}>\n      {children}\n    </tesselInteractionContext.Provider>\n  );\n};\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport sizing from \"@/styles/sizing.module.css\";\nimport flex from \"@/styles/flex.module.css\";\n\nimport {\n  isTesselFixedDivision,\n  isTesselPercentDivision,\n  normalizeTesselDivision,\n  TesselDivision,\n  TesselItem,\n  TesselSplitItem,\n  TesselValue,\n  TesselWindowRenderer,\n} from \"./types\";\n\nimport TesselSplit from \"./TesselSplit\";\nimport TesselFrame from \"./TesselFrame\";\nimport { TesselPathProvider } from \"./TesselContext\";\n\nexport interface TesselSplitFrameProps {\n  item: TesselSplitItem;\n  renderWindow: TesselWindowRenderer;\n  onLayoutChange(relativeRoot: TesselItem): void;\n}\n\nconst TesselSplitFrame: React.FC<TesselSplitFrameProps> = ({\n  item,\n  renderWindow,\n  onLayoutChange,\n}) => {\n  const { direction, first, second, division: divisionValue } = item;\n  const sizeDirection = direction === \"row\" ? \"width\" : \"height\";\n\n  const onChangePercentage = React.useCallback(\n    (percentage: number, absolute: number) => {\n      const division = normalizeTesselDivision(item.division);\n      onLayoutChange({\n        ...item,\n        division: applyDivisionChange(division, percentage, absolute),\n      });\n    },\n    [item, onLayoutChange]\n  );\n\n  const onFirstLayoutChange = React.useCallback(\n    (value: TesselValue) => {\n      onLayoutChange({\n        ...item,\n        first: value,\n      });\n    },\n    [item, onLayoutChange]\n  );\n\n  const onSecondLayoutChange = React.useCallback(\n    (value: TesselValue) => {\n      onLayoutChange({\n        ...item,\n        second: value,\n      });\n    },\n    [item, onLayoutChange]\n  );\n\n  const division = normalizeTesselDivision(divisionValue);\n  let firstSize = \"50%\";\n  let secondSize = \"50%\";\n  let firstFix = false;\n  let secondFix = false;\n  if (isTesselPercentDivision(division)) {\n    const { firstPercent } = division;\n    firstSize = `${firstPercent}%`;\n    secondSize = `${100 - firstPercent}%`;\n  } else if (isTesselFixedDivision(division)) {\n    const { firstSize: firstSizeDiv, secondSize: secondSizeDiv } = division;\n    // Only support one of firstSize or secondSize\n    if (firstSizeDiv) {\n      firstSize = `${firstSizeDiv}px`;\n      firstFix = true;\n      secondSize = \"100%\";\n    } else {\n      firstSize = \"100%\";\n      secondSize = `${secondSizeDiv}px`;\n      secondFix = true;\n    }\n  }\n\n  return (\n    <div\n      className={cls(\n        sizing[\"fill-parent\"],\n        flex[direction === \"row\" ? \"flex-row\" : \"flex-column\"]\n      )}\n    >\n      <div\n        className={cls(\n          firstFix ? flex[\"flexitem-fix\"] : flex[\"flexitem-shrink\"]\n        )}\n        style={{ [sizeDirection]: firstSize }}\n      >\n        <TesselPathProvider pathKey=\"first\">\n          <TesselFrame\n            value={first}\n            renderWindow={renderWindow}\n            onLayoutChange={onFirstLayoutChange}\n          />\n        </TesselPathProvider>\n      </div>\n      <TesselSplit\n        direction={direction}\n        onChangePercentage={onChangePercentage}\n      />\n      <div\n        className={cls(\n          secondFix ? flex[\"flexitem-fix\"] : flex[\"flexitem-shrink\"]\n        )}\n        style={{ [sizeDirection]: secondSize }}\n      >\n        <TesselPathProvider pathKey=\"second\">\n          <TesselFrame\n            value={second}\n            renderWindow={renderWindow}\n            onLayoutChange={onSecondLayoutChange}\n          />\n        </TesselPathProvider>\n      </div>\n    </div>\n  );\n};\n\nfunction applyDivisionChange(\n  division: TesselDivision,\n  percent: number,\n  absolute: number\n): TesselDivision {\n  if (isTesselPercentDivision(division)) {\n    return {\n      firstPercent: percent,\n    };\n  } else if (isTesselFixedDivision(division)) {\n    if (typeof division.secondSize === \"number\") {\n      return {\n        secondSize: absolute,\n      };\n    }\n\n    return {\n      firstSize: absolute,\n    };\n  }\n\n  return division;\n}\n\nexport default TesselSplitFrame;\n","import * as React from \"react\";\nimport TesselSplitFrame from \"./TesselSplitFrame\";\n\nimport {\n  isTesselSplit,\n  isTesselWindow,\n  normalizeTesselItem,\n  TesselValue,\n  TesselWindowRenderer,\n} from \"./types\";\n\nexport interface TesselFrameProps {\n  value: TesselValue;\n  renderWindow: TesselWindowRenderer;\n  onLayoutChange(value: TesselValue): void;\n}\n\nconst TesselFrame: React.FC<TesselFrameProps> = ({\n  value,\n  renderWindow,\n  onLayoutChange,\n}) => {\n  const item = normalizeTesselItem(value);\n  if (isTesselWindow(item)) {\n    return renderWindow(item);\n  } else if (isTesselSplit(item)) {\n    return (\n      <TesselSplitFrame\n        item={item}\n        renderWindow={renderWindow}\n        onLayoutChange={onLayoutChange}\n      />\n    );\n  } else {\n    return null;\n  }\n};\n\nexport default TesselFrame;\n","export type MaybeArray<T> = T | T[];\nexport function asArray<T>(value: MaybeArray<T>): T[] {\n  return Array.isArray(value) ? value : [value];\n}\n\nexport function arrayEquals<T extends any[]>(a: T, b: T) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  return a.every((v, i) => b[i] === v);\n}\n\nconst EmptyArray: ReadonlyArray<unknown> = Object.freeze([]);\n// Would be simpler to just use EmptyArray, but we cannot type that to what the usage wants.\n// Shame the type `[]` is invalid.\nexport function immutableEmptyArray<T>(): T[] {\n  return EmptyArray as any;\n}\n\nexport function dropIndexFp<T>(array: T[], index: number) {\n  const newArray = array.slice(0, index);\n  for (let i = index + 1; i < array.length; i++) {\n    newArray.push(array[i]);\n  }\n  return newArray;\n}\n","import * as React from \"react\";\nimport ResizeObserver from \"resize-observer-polyfill\";\n\ninterface UseComponentBounds {\n  left: number;\n  top: number;\n  right: number;\n  bottom: number;\n  width: number;\n  height: number;\n}\nexport function useComponentBounds(ref: React.RefObject<HTMLElement | null>) {\n  const [size, setSize] = React.useState<UseComponentBounds>({\n    left: 0,\n    top: 0,\n    right: 0,\n    bottom: 0,\n    width: 0,\n    height: 0,\n  });\n\n  React.useLayoutEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n\n    const observer = new ResizeObserver(() => {\n      const el = ref.current;\n      if (!el) {\n        return;\n      }\n      const b = el.getBoundingClientRect();\n      setSize({\n        top: b.top,\n        left: b.left,\n        right: b.right,\n        bottom: b.bottom,\n        width: b.width,\n        height: b.height,\n      });\n    });\n\n    observer.observe(ref.current);\n\n    return () => {\n      observer.disconnect();\n    };\n  }, [ref]);\n\n  return size;\n}\n","import { DragObjectWithType } from \"react-dnd\";\n\nexport const TESSEL_WINDOW_DRAG_OBJECT = \"@tessel/window\" as const;\nexport const tesselWindowDragObject = (path: string[]) => ({\n  type: TESSEL_WINDOW_DRAG_OBJECT,\n  payload: { path },\n});\nexport type TesselWindowDragObject = ReturnType<typeof tesselWindowDragObject>;\nexport function isTesselWindowDragObject(\n  item: DragObjectWithType\n): item is TesselWindowDragObject {\n  return item.type === TESSEL_WINDOW_DRAG_OBJECT;\n}\n","import { arrayEquals } from \"@/arrays\";\nimport { useComponentBounds } from \"@/hooks/useComponentBounds\";\nimport { cls } from \"@/utils\";\nimport * as React from \"react\";\nimport { DropTargetMonitor, DragObjectWithType, useDrop } from \"react-dnd\";\n\nimport {\n  isTesselWindowDragObject,\n  TESSEL_WINDOW_DRAG_OBJECT,\n} from \"./drag-items/tessel-window\";\n\nimport styles from \"./Tessel.module.css\";\nimport { useTesselInteraction, useTesselPath } from \"./TesselContext\";\nimport { TesselDropPosition } from \"./types\";\n\nexport interface TesselDropCaptureProps {\n  className?: string;\n  id?: string;\n  children?: React.ReactNode;\n}\nconst TesselDropCapture = React.forwardRef<\n  HTMLDivElement,\n  TesselDropCaptureProps\n>(({ className, id, children }, forwardRef) => {\n  const tesselPath = useTesselPath();\n  const { moveWindow } = useTesselInteraction();\n\n  const ref = React.useRef<HTMLDivElement | null>(null);\n  const { top, left, right, bottom } = useComponentBounds(ref);\n\n  const [dropPos, setDropPos] = React.useState<TesselDropPosition | null>(null);\n\n  const onHover = React.useCallback(\n    (item: DragObjectWithType, monitor: DropTargetMonitor) => {\n      if (!monitor.isOver({ shallow: true })) {\n        setDropPos(null);\n        return;\n      }\n\n      const pos = monitor.getClientOffset();\n      if (item == null || pos == null || !isTesselWindowDragObject(item)) {\n        setDropPos(null);\n        return;\n      }\n\n      if (pos.x < left || pos.x > right) {\n        setDropPos(null);\n        return;\n      }\n\n      if (pos.y < top || pos.y > bottom) {\n        setDropPos(null);\n        return;\n      }\n\n      const relX = pos.x - left;\n      const xPercent = relX / (right - left);\n      if (xPercent <= 0.3) {\n        setDropPos(\"left\");\n        return;\n      }\n      if (xPercent >= 0.6) {\n        setDropPos(\"right\");\n        return;\n      }\n\n      const relY = pos.y - top;\n      const yPercent = relY / (bottom - top);\n      if (yPercent <= 0.3) {\n        setDropPos(\"top\");\n        return;\n      }\n      if (yPercent >= 0.6) {\n        setDropPos(\"bottom\");\n        return;\n      }\n\n      setDropPos(null);\n    },\n    [top, left, right, bottom]\n  );\n\n  const onDrop = React.useCallback(\n    (item: DragObjectWithType, monitor: DropTargetMonitor) => {\n      if (!monitor.isOver({ shallow: true })) {\n        return;\n      }\n\n      if (!isTesselWindowDragObject(item)) {\n        return;\n      }\n      const { path: draggingPath } = item.payload;\n\n      if (arrayEquals(draggingPath, tesselPath)) {\n        return;\n      }\n\n      if (dropPos == null) {\n        return;\n      }\n\n      moveWindow(draggingPath, tesselPath, dropPos);\n    },\n    [tesselPath, dropPos, moveWindow]\n  );\n\n  const [{ draggingSelf }, dropRef] = useDrop(\n    {\n      accept: TESSEL_WINDOW_DRAG_OBJECT,\n      collect: (monitor) => {\n        // This is here as hover is not called on hover exit.\n        // We need something to capture the exit event.\n        if (!monitor.isOver({ shallow: true })) {\n          setDropPos(null);\n        }\n\n        const item = monitor.getItem();\n        if (!item || !isTesselWindowDragObject(item)) {\n          return {};\n        }\n\n        return {\n          draggingSelf: arrayEquals(item.payload.path, tesselPath),\n        };\n      },\n      hover: onHover,\n      drop: onDrop,\n    },\n    [onHover, onDrop]\n  );\n\n  let dropMarkerClassname = styles[\"tessel-drop-marker\"] + \" \";\n  if (dropPos != null && !draggingSelf) {\n    switch (dropPos) {\n      case \"bottom\":\n        dropMarkerClassname += styles[\"drop-bottom\"];\n        break;\n      case \"top\":\n        dropMarkerClassname += styles[\"drop-top\"];\n        break;\n      case \"left\":\n        dropMarkerClassname += styles[\"drop-left\"];\n        break;\n      case \"right\":\n        dropMarkerClassname += styles[\"drop-right\"];\n        break;\n    }\n  }\n\n  return (\n    <div\n      id={id}\n      ref={(divRef) => {\n        ref.current = divRef;\n        dropRef(divRef);\n        if (typeof forwardRef === \"function\") {\n          forwardRef(divRef);\n        } else if (forwardRef) {\n          forwardRef.current = divRef;\n        }\n      }}\n      className={cls(\n        styles[\"tessel-drop-capture\"],\n        draggingSelf && styles[\"tessel-drop-capture--dragging\"],\n        className\n      )}\n    >\n      {children}\n      <div className={dropMarkerClassname} />\n    </div>\n  );\n});\n\nexport default TesselDropCapture;\n","import { isTesselSplit, normalizeTesselItem, TesselValue } from \"./types\";\n\nexport function walkTesselValues(\n  value: TesselValue,\n  walk: (value: TesselValue, path: string[]) => boolean | undefined\n) {\n  function doWork(value: TesselValue, path: string[]): boolean {\n    if (walk(value, []) === false) {\n      return false;\n    }\n\n    const normalized = normalizeTesselItem(value);\n    if (isTesselSplit(normalized)) {\n      if (!doWork(normalized.first, [...path, \"first\"])) {\n        return false;\n      }\n      if (!doWork(normalized.second, [...path, \"second\"])) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  doWork(value, []);\n}\n\nexport function filterTesselValues(\n  value: TesselValue,\n  filter: (value: TesselValue) => boolean\n): TesselValue | null {\n  if (!filter(value)) {\n    return null;\n  }\n\n  const normalized = normalizeTesselItem(value);\n\n  if (isTesselSplit(normalized)) {\n    const first = filterTesselValues(normalized.first, filter);\n    const second = filterTesselValues(normalized.second, filter);\n\n    if (first && second) {\n      return value;\n    }\n\n    return first ?? second ?? null;\n  }\n\n  return value;\n}\n\nexport function findAndReplaceTesselValue(\n  value: TesselValue,\n  replace: (value: TesselValue) => TesselValue | null\n): TesselValue {\n  function doWork(value: TesselValue): TesselValue | null {\n    const newValue = replace(value);\n    if (newValue) {\n      return newValue;\n    }\n\n    const normalized = normalizeTesselItem(value);\n    if (isTesselSplit(normalized)) {\n      const first = doWork(normalized.first);\n      if (first) {\n        return {\n          ...normalized,\n          first,\n        };\n      }\n\n      const second = doWork(normalized.second);\n      if (second) {\n        return {\n          ...normalized,\n          second,\n        };\n      }\n    }\n\n    return null;\n  }\n  return doWork(value) ?? value;\n}\n\nexport function pruneEmptyTesselValues(value: TesselValue): TesselValue {\n  if (typeof value === \"string\") {\n    return value;\n  }\n\n  if (isTesselSplit(value)) {\n    if (value.first == null) {\n      return pruneEmptyTesselValues(value.second);\n    }\n    if (value.second == null) {\n      return pruneEmptyTesselValues(value.first);\n    }\n    return {\n      ...value,\n      first: pruneEmptyTesselValues(value.first),\n      second: pruneEmptyTesselValues(value.second),\n    };\n  }\n\n  return value;\n}\n","import * as React from \"react\";\nimport get from \"lodash/get\";\n\nimport { cls, fpSetByArray } from \"@/utils\";\n\nimport {\n  TesselDropPosition,\n  TesselItem,\n  TesselValue,\n  TesselWindowRenderer,\n} from \"./types\";\n\nimport TesselFrame from \"./TesselFrame\";\nimport TesselDropCapture from \"./TesselDropCapture\";\n\nimport styles from \"./Tessel.module.css\";\n\nimport { TesselInteractionProvider } from \"./TesselContext\";\nimport { pruneEmptyTesselValues } from \"./utils\";\n\nexport interface TesselProps {\n  className?: string;\n  rootItem: TesselValue | null;\n  renderWindow: TesselWindowRenderer;\n  onLayoutChange(rootItem: TesselValue | null): void;\n}\n\nconst Tessel: React.FC<TesselProps> = ({\n  className,\n  rootItem,\n  renderWindow,\n  onLayoutChange,\n}) => {\n  const moveWindow = React.useCallback(\n    (from: string[], to: string[], position: TesselDropPosition) => {\n      if (from.length === 0) {\n        // If we have a window at the root, there is no place to drag it to.\n        return;\n      }\n\n      let newRoot = rootItem;\n      const movingElement = get(newRoot, from);\n      // If rootItem is a string (implicit window), than there is no way we can find our\n      // from target inside of it (given that from is not the root).\n      // This would be covered by movingElement being undefined, but we add\n      // the extra check to inform typescript of this condition.\n      if (!newRoot || typeof newRoot === \"string\" || !movingElement) {\n        return;\n      }\n\n      // Target must exist, or be the root.\n      if (to.length > 0 && !get(newRoot, to)) {\n        return;\n      }\n\n      // First, null out the from path.\n      // We cannot clean up the stack at this point as that might remove path\n      // elements that we are moving to.  Cleanup will be done later.\n      newRoot = fpSetByArray(newRoot, from, null);\n\n      // Now, insert the window at the new location\n      newRoot = fpSetByArray(newRoot, to, (item: TesselValue) => {\n        let newItem: TesselItem;\n        if (position === \"left\" || position === \"right\") {\n          newItem = {\n            direction: \"row\",\n            division: 50,\n            first: position === \"left\" ? movingElement : item,\n            second: position === \"right\" ? movingElement : item,\n          };\n        } else if (position === \"top\" || position === \"bottom\") {\n          newItem = {\n            direction: \"column\",\n            division: 50,\n            first: position === \"top\" ? movingElement : item,\n            second: position === \"bottom\" ? movingElement : item,\n          };\n        } else {\n          // Unknown position\n          throw new Error(`Unknown tessel position: ${position}`);\n        }\n        return newItem;\n      });\n\n      // Remove the empty entry from the removal of the from element.\n      newRoot = pruneEmptyTesselValues(newRoot);\n\n      onLayoutChange(newRoot);\n    },\n    [rootItem, onLayoutChange]\n  );\n\n  const closeWindow = React.useCallback(\n    (path: string[]) => {\n      let newRoot = rootItem;\n      if (!newRoot) {\n        return;\n      }\n      if (typeof newRoot === \"string\") {\n        if (path.length === 0) {\n          onLayoutChange(null);\n        }\n        return;\n      }\n\n      // First, null out the from path.\n      // We cannot clean up the stack at this point as that might remove path\n      // elements that we are moving to.  Cleanup will be done later.\n      newRoot = fpSetByArray(newRoot, path, null);\n      // Remove the empty entry from the removal of the from element.\n      newRoot = pruneEmptyTesselValues(newRoot);\n\n      onLayoutChange(newRoot);\n    },\n    [onLayoutChange, rootItem]\n  );\n\n  return (\n    <div className={cls(\"tessel\", styles[\"tessel\"], className)}>\n      <TesselInteractionProvider\n        moveWindow={moveWindow}\n        closeWindow={closeWindow}\n      >\n        <TesselDropCapture>\n          <div className={styles[\"tessel-content\"]}>\n            {rootItem && (\n              <TesselFrame\n                value={rootItem}\n                renderWindow={renderWindow}\n                onLayoutChange={onLayoutChange}\n              />\n            )}\n          </div>\n        </TesselDropCapture>\n      </TesselInteractionProvider>\n    </div>\n  );\n};\n\nexport default Tessel;\n","export * from \"./Tessel\";\nexport * from \"./types\";\n\nimport Tessel from \"./Tessel\";\nexport default Tessel;\nexport { Tessel };\n","import {\n  isTesselWindow,\n  TesselValue,\n  TesselWindowItem,\n} from \"@/components/Tessel\";\n\nimport { CircuitEditorWindowProps } from \"./CircuitEditorWindow\";\n\nexport const CIRCUIT_FIELD_WINDOW_ID = \"circuit-field\" as const;\n\nexport const circuitEditorTesselWindow = (\n  circuitEditorId: string\n): TesselWindowItem<CircuitEditorWindowProps> => ({\n  windowId: CIRCUIT_FIELD_WINDOW_ID,\n  windowProps: {\n    editorId: circuitEditorId,\n  },\n});\n\nexport function isCircuitEditorTesselWindow(\n  x: TesselValue\n): x is Required<TesselWindowItem<CircuitEditorWindowProps>> {\n  if (typeof x === \"string\") {\n    // We must have props to be a proper circuit field.\n    return false;\n  }\n  if (!isTesselWindow(x)) {\n    return false;\n  }\n  return x.windowId === CIRCUIT_FIELD_WINDOW_ID;\n}\n","import { TesselValue } from \"@/components/Tessel\";\n\nimport { circuitEditorTesselWindow } from \"@/pages/ProjectEditorPage/windows/CircuitEditorWindow/tessel-window\";\n\nimport { DEFAULT_CIRCUIT_EDITOR_ID } from \"@/services/circuit-editors/constants\";\n\nexport interface UiLayoutServiceState {\n  /**\n   * The tessel layout.\n   */\n  layout: TesselValue | null;\n}\n\nconst _defaultState: UiLayoutServiceState = {\n  layout: {\n    direction: \"row\",\n    division: {\n      firstSize: 200,\n    },\n    first: {\n      direction: \"column\",\n      division: 30,\n      first: \"circuits-list\",\n      second: \"element-tray\",\n    },\n    second: circuitEditorTesselWindow(DEFAULT_CIRCUIT_EDITOR_ID),\n  },\n};\n\nexport const defaultUiLayoutServiceState = Object.freeze(_defaultState);\n","export interface UiSettingsState {\n  elementNameMode: \"all\" | \"named-only\" | \"none\";\n}\n\nconst _defaultState: UiSettingsState = {\n  elementNameMode: \"named-only\",\n};\n\nexport const defaultUiSettingsState = Object.freeze(_defaultState);\n","import {\n  CircuitEditorDragServiceState,\n  defaultCircuitEditorDragServiceState,\n} from \"./circuit-editor-drag/state\";\nimport {\n  CircuitEditorsServiceState,\n  defaultCircuitEditorServiceState,\n} from \"./circuit-editors/state\";\nimport {\n  CircuitGraphServiceState,\n  defaultCircuitGraphServiceState,\n} from \"./circuit-graph/state\";\nimport {\n  CircuitLayoutServiceState,\n  defaultCircuitLayoutServiceState,\n} from \"./circuit-layout/state\";\nimport {\n  CircuitPropertiesServiceState,\n  defaultCircuitPropertiesServiceState,\n} from \"./circuit-properties/state\";\nimport {\n  ClipboardServiceState,\n  defaultClipboardServiceState,\n} from \"./clipboard/state\";\nimport { DialogServiceState, defaultDialogServiceState } from \"./dialog/state\";\nimport {\n  ProjectServiceState,\n  defaultProjectServiceState,\n} from \"./project/state\";\nimport {\n  SelectionServiceState,\n  defaultSelectionServiceState,\n} from \"./selection/state\";\nimport {\n  SimulatorServiceState,\n  defaultSimulatorServiceState,\n} from \"./simulator/state\";\nimport {\n  SimulatorControlServiceState,\n  defaultSimulatorControlServiceState,\n} from \"./simulator-control/state\";\nimport {\n  TutorialServiceState,\n  defaultTutorialServiceState,\n} from \"./tutorial/state\";\nimport {\n  UiLayoutServiceState,\n  defaultUiLayoutServiceState,\n} from \"./ui-layout/state\";\nimport { UiSettingsState, defaultUiSettingsState } from \"./ui-settings/state\";\n\nexport interface AppServicesState {\n  circuitEditorDrag: CircuitEditorDragServiceState;\n  circuitEditors: CircuitEditorsServiceState;\n  clipboard: ClipboardServiceState;\n  dialog: DialogServiceState;\n  circuitGraph: CircuitGraphServiceState;\n  circuitLayout: CircuitLayoutServiceState;\n  circuitProperties: CircuitPropertiesServiceState;\n  project: ProjectServiceState;\n  selection: SelectionServiceState;\n  simulator: SimulatorServiceState;\n  simulatorControl: SimulatorControlServiceState;\n  tutorial: TutorialServiceState;\n  uiLayout: UiLayoutServiceState;\n  uiSettings: UiSettingsState;\n}\n\nconst _defaultServiceState: AppServicesState = {\n  circuitEditorDrag: defaultCircuitEditorDragServiceState,\n  circuitEditors: defaultCircuitEditorServiceState,\n  circuitGraph: defaultCircuitGraphServiceState,\n  circuitLayout: defaultCircuitLayoutServiceState,\n  circuitProperties: defaultCircuitPropertiesServiceState,\n  clipboard: defaultClipboardServiceState,\n  dialog: defaultDialogServiceState,\n  project: defaultProjectServiceState,\n  selection: defaultSelectionServiceState,\n  simulator: defaultSimulatorServiceState,\n  simulatorControl: defaultSimulatorControlServiceState,\n  tutorial: defaultTutorialServiceState,\n  uiLayout: defaultUiLayoutServiceState,\n  uiSettings: defaultUiSettingsState,\n};\n\nexport const defaultServicesState = Object.freeze(_defaultServiceState);\n","import { AppServicesState } from \"@/services/state\";\n\nexport const UndoServicesStateKeys = [\n  \"circuitProperties\",\n  \"circuitGraph\",\n  \"circuitLayout\",\n] as const;\nexport type UndoServicesStates = Pick<\n  AppServicesState,\n  \"circuitProperties\" | \"circuitGraph\" | \"circuitLayout\"\n>;\n\nexport interface UndoStackState {\n  serviceStates: UndoServicesStates;\n  viewCircuitId: string | null;\n}\n\nexport interface UndoState {\n  undoStack: UndoStackState[];\n  redoStack: UndoStackState[];\n}\n\nconst _defaultState: UndoState = {\n  undoStack: [],\n  redoStack: [],\n};\n\nexport const defaultUndoState = Object.freeze(_defaultState);\n","import { AppServicesState, defaultServicesState } from \"@/services/state\";\nimport { defaultUndoState, UndoState } from \"@/undo/state\";\n\nexport interface AppState {\n  services: AppServicesState;\n  undo: UndoState;\n}\n\nconst _defaultAppState: AppState = {\n  services: defaultServicesState,\n  undo: defaultUndoState,\n};\n\nexport const defaultAppState = Object.freeze(_defaultAppState);\n","export const isProd = process.env.NODE_ENV === \"production\";\nexport const isDev = process.env.NODE_ENV === \"development\";\n\nconst rootUrlBuilder = new URL(window.location.origin);\nrootUrlBuilder.pathname = __webpack_public_path__;\nexport const rootUrl = rootUrlBuilder.toString();\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_INIT = \"@init\";\nexport const doInit = () => ({ type: ACTION_INIT });\nexport type InitAction = ReturnType<typeof doInit>;\nexport function isInitAction(action: AnyAction): action is InitAction {\n  return action.type === ACTION_INIT;\n}\n","import { AnyAction } from \"redux\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nexport const ACTION_CIRCUIT_ADD = \"@circuit/add\" as const;\nexport interface NewCircuitOpts {\n  circuitName?: string;\n  circuitId?: string;\n  edit?: boolean;\n}\nexport const addCircuit = ({\n  circuitName,\n  circuitId,\n  edit,\n}: NewCircuitOpts = {}) => ({\n  type: ACTION_CIRCUIT_ADD,\n  payload: { circuitId: circuitId ?? uuidV4(), circuitName, edit },\n});\nexport type AddCircuitAction = ReturnType<typeof addCircuit>;\nexport function isAddCircuitAction(\n  action: AnyAction\n): action is AddCircuitAction {\n  return action.type === ACTION_CIRCUIT_ADD;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_CIRCUIT_DELETE = \"@circuit/delete\" as const;\nexport const deleteCircuit = (circuitId: string) => ({\n  type: ACTION_CIRCUIT_DELETE,\n  payload: { circuitId },\n});\nexport type DeleteCircuitAction = ReturnType<typeof deleteCircuit>;\nexport function isDeleteCircuitAction(\n  action: AnyAction\n): action is DeleteCircuitAction {\n  return action.type === ACTION_CIRCUIT_DELETE;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_CIRCUIT_RENAME = \"@circuit/rename\" as const;\nexport const renameCircuit = (circuitId: string, circuitName: string) => ({\n  type: ACTION_CIRCUIT_RENAME,\n  payload: { circuitId, circuitName },\n});\nexport type RenameCircuitAction = ReturnType<typeof renameCircuit>;\nexport function isRenameCircuitAction(\n  action: AnyAction\n): action is RenameCircuitAction {\n  return action.type === ACTION_CIRCUIT_RENAME;\n}\n","import { v4 as uuidV4 } from \"uuid\";\nimport { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\n\nexport interface AddElementOptions {\n  elementId?: string;\n  elementName?: string;\n}\nexport const ACTION_ELEMENT_ADD = \"@element/add\" as const;\nexport const addElement = (\n  elementType: string,\n  circuitId: string,\n  position: Point,\n  opts?: AddElementOptions\n) => ({\n  type: ACTION_ELEMENT_ADD,\n  payload: {\n    elementId: uuidV4(),\n    elementType,\n    circuitId,\n    position,\n    ...(opts || {}),\n  },\n});\nexport type AddElementAction = ReturnType<typeof addElement>;\nexport function isAddElementAction(\n  action: AnyAction\n): action is AddElementAction {\n  return action.type === ACTION_ELEMENT_ADD;\n}\n","import { AnyAction } from \"redux\";\n\nimport { asArray, MaybeArray } from \"@/arrays\";\n\nexport const ACTION_ELEMENT_DELETE = \"@element/delete\" as const;\nexport const deleteElement = (elementId: MaybeArray<string>) => ({\n  type: ACTION_ELEMENT_DELETE,\n  payload: { elementIds: asArray(elementId) },\n});\nexport type DeleteElementAction = ReturnType<typeof deleteElement>;\nexport function isDeleteElementAction(\n  action: AnyAction\n): action is DeleteElementAction {\n  return action.type === ACTION_ELEMENT_DELETE;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_ELEMENT_RENAME = \"@element/rename\" as const;\nexport const renameElement = (elementId: string, elementName: string) => ({\n  type: ACTION_ELEMENT_RENAME,\n  payload: { elementId, elementName },\n});\nexport type RenameElementAction = ReturnType<typeof renameElement>;\nexport function isRenameElementAction(\n  action: AnyAction\n): action is RenameElementAction {\n  return action.type === ACTION_ELEMENT_RENAME;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SELECTION_ALIGN_TO_GRID = \"@selection/align-to-grid\" as const;\nexport const selectionAlignToGrid = () => ({\n  type: ACTION_SELECTION_ALIGN_TO_GRID,\n});\nexport function isSelectionAlignToGridAction(action: AnyAction): boolean {\n  return action.type === ACTION_SELECTION_ALIGN_TO_GRID;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SELECTION_DELETE = \"@selection/delete\" as const;\nexport const deleteSelection = () => ({\n  type: ACTION_SELECTION_DELETE,\n});\nexport type DeleteSelectionAction = ReturnType<typeof deleteSelection>;\nexport function isDeleteSelectionAction(\n  action: AnyAction\n): action is DeleteSelectionAction {\n  return action.type === ACTION_SELECTION_DELETE;\n}\n","import { AnyAction } from \"redux\";\n\nexport interface MoveSelectionOpts {\n  snapMode?: \"none\" | \"element\" | \"by-type\";\n}\nexport const ACTION_SELECTION_MOVE = \"@selection/move\" as const;\nexport const moveSelection = (\n  offsetX: number,\n  offsetY: number,\n  opts: MoveSelectionOpts = {}\n) => ({\n  type: ACTION_SELECTION_MOVE,\n  payload: { offsetX, offsetY, snapMode: opts.snapMode ?? \"none\" },\n});\nexport type MoveSelectionAction = ReturnType<typeof moveSelection>;\nexport function isMoveSelectionAction(\n  action: AnyAction\n): action is MoveSelectionAction {\n  return action.type === ACTION_SELECTION_MOVE;\n}\n","import { AnyAction } from \"redux\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nimport { Point } from \"@/geometry\";\n\nimport { ElementPin } from \"@/services/circuit-graph/types\";\n\nexport interface AttachWireOptions {\n  joints?: Point[];\n}\nexport const ACTION_WIRE_ATTACH = \"@wire/attach\" as const;\nexport const attachWire = (\n  p1: ElementPin,\n  p2: ElementPin,\n  opts?: AttachWireOptions\n) => ({\n  type: ACTION_WIRE_ATTACH,\n  payload: {\n    connectionId: uuidV4(),\n    p1,\n    p2,\n    joints: opts?.joints || [],\n  },\n});\nexport type AttachWireAction = ReturnType<typeof attachWire>;\nexport function isAttachWireAction(\n  action: AnyAction\n): action is AttachWireAction {\n  return action.type === ACTION_WIRE_ATTACH;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_WIRE_DETATCH = \"@wire/detatch\" as const;\nexport const detatchWire = (connectionId: string) => ({\n  type: ACTION_WIRE_DETATCH,\n  payload: {\n    connectionId,\n  },\n});\nexport type DetatchWireAction = ReturnType<typeof detatchWire>;\nexport function isDetatchWireAction(\n  action: AnyAction\n): action is DetatchWireAction {\n  return action.type === ACTION_WIRE_DETATCH;\n}\n","import { AnyAction } from \"redux\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nimport { Point } from \"@/geometry\";\n\nexport const ACTION_WIRE_JOINT_ADD = \"@wire/joint/add\" as const;\nexport const addWireJoint = (\n  connectionId: string,\n  addAfterJointId: string | null,\n  position: Point,\n  jointId?: string\n) => ({\n  type: ACTION_WIRE_JOINT_ADD,\n  payload: {\n    connectionId,\n    jointId: jointId || uuidV4(),\n    addAfterJointId,\n    position,\n  },\n});\nexport type AddWireJointAction = ReturnType<typeof addWireJoint>;\nexport function isAddWireJointAction(\n  action: AnyAction\n): action is AddWireJointAction {\n  return action.type === ACTION_WIRE_JOINT_ADD;\n}\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { asArray, MaybeArray } from \"@/arrays\";\n\nexport interface MoveWireJointOpts {\n  relative?: boolean;\n  snapMode?: \"none\" | \"element\" | \"joint\";\n}\nexport const ACTION_WIRE_JOINT_MOVE = \"@wire/joint/move\" as const;\nexport const moveWireJoint = (\n  jointId: MaybeArray<string>,\n  position: Point,\n  opts: MoveWireJointOpts = {}\n) => ({\n  type: ACTION_WIRE_JOINT_MOVE,\n  payload: {\n    jointIds: asArray(jointId),\n    position,\n    relative: opts.relative ?? false,\n    snapMode: opts.snapMode ?? \"none\",\n  },\n});\nexport type MoveWireJointAction = ReturnType<typeof moveWireJoint>;\nexport function isMoveWireJointAction(\n  action: AnyAction\n): action is MoveWireJointAction {\n  return action.type === ACTION_WIRE_JOINT_MOVE;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_WIRE_JOINT_DELETE = \"@wire/joint/delete\" as const;\nexport const deleteWireJoint = (jointId: string) => ({\n  type: ACTION_WIRE_JOINT_DELETE,\n  payload: { jointId },\n});\nexport type DeleteWireJointAction = ReturnType<typeof deleteWireJoint>;\nexport function isDeleteWireJointAction(\n  action: AnyAction\n): action is DeleteWireJointAction {\n  return action.type === ACTION_WIRE_JOINT_DELETE;\n}\n","import { Point } from \"@/geometry\";\nimport { AnyAction } from \"redux\";\n\nexport interface PasteOpts {\n  pastePosition?: Point;\n}\nexport const ACTION_PASTE = \"@clipboard/paste\" as const;\nexport const paste = (opts: PasteOpts = {}) => ({\n  type: ACTION_PASTE,\n  payload: { ...opts },\n});\nexport type PasteAction = ReturnType<typeof paste>;\nexport function isPasteAction(action: AnyAction): action is PasteAction {\n  return action.type === ACTION_PASTE;\n}\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_END = \"@circuit-editor/drag/end\" as const;\nexport const circuitEditorDragEnd = (\n  point: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_END,\n  payload: { ...point, modifierKeys, editorId },\n});\nexport type CircuitEditorDragEndAction = ReturnType<\n  typeof circuitEditorDragEnd\n>;\nexport function isCircuitEditorDragEndAction(\n  action: AnyAction\n): action is CircuitEditorDragEndAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_END;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_UNDO = \"@undo/undo\" as const;\nexport const undo = () => ({\n  type: ACTION_UNDO,\n});\nexport function isUndoAction(action: AnyAction) {\n  return action.type === ACTION_UNDO;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_REDO = \"@undo/redo\" as const;\nexport const redo = () => ({\n  type: ACTION_REDO,\n});\nexport function isRedoAction(action: AnyAction) {\n  return action.type === ACTION_REDO;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_NEW = \"@project/new\" as const;\nexport const newProject = () => ({\n  type: ACTION_PROJECT_NEW,\n});\nexport type NewProjectAction = ReturnType<typeof newProject>;\nexport function isNewProjectAction(\n  action: AnyAction\n): action is NewProjectAction {\n  return action.type === ACTION_PROJECT_NEW;\n}\n","import { AnyAction } from \"redux\";\n\nimport { SaveData } from \"@/services/savedata/types\";\n\nexport const ACTION_PROJECT_RECEIVE = \"@project/receive\" as const;\nexport const receiveProject = (fileName: string, saveData: SaveData) => ({\n  type: ACTION_PROJECT_RECEIVE,\n  payload: { fileName, saveData },\n});\nexport type ReceiveProjectAction = ReturnType<typeof receiveProject>;\nexport function isReceiveProjectAction(\n  action: AnyAction\n): action is ReceiveProjectAction {\n  return action.type === ACTION_PROJECT_RECEIVE;\n}\n","import { AnyAction } from \"redux\";\n\nimport { ACTION_CIRCUIT_ADD } from \"@/actions/circuit-add\";\nimport { ACTION_CIRCUIT_DELETE } from \"@/actions/circuit-delete\";\nimport { ACTION_CIRCUIT_RENAME } from \"@/actions/circuit-rename\";\nimport { ACTION_ELEMENT_ADD } from \"@/actions/element-add\";\nimport { ACTION_ELEMENT_DELETE } from \"@/actions/element-delete\";\nimport { ACTION_ELEMENT_RENAME } from \"@/actions/element-rename\";\nimport { ACTION_SELECTION_ALIGN_TO_GRID } from \"@/actions/selection-align-to-grid\";\nimport { ACTION_SELECTION_DELETE } from \"@/actions/selection-delete\";\nimport { ACTION_SELECTION_MOVE } from \"@/actions/selection-move\";\nimport { ACTION_WIRE_ATTACH } from \"@/actions/wire-attach\";\nimport { ACTION_WIRE_DETATCH } from \"@/actions/wire-detatch\";\nimport { ACTION_WIRE_JOINT_ADD } from \"@/actions/wire-joint-add\";\nimport { ACTION_WIRE_JOINT_MOVE } from \"@/actions/wire-joint-move\";\nimport { ACTION_WIRE_JOINT_DELETE } from \"@/actions/wire-joint-delete\";\n\nimport { ACTION_PASTE } from \"@/actions/clipboard-paste\";\nimport { ACTION_CIRCUIT_EDITOR_DRAG_END } from \"@/actions/circuit-editor-drag-end\";\n\nimport { ACTION_UNDO } from \"@/actions/undo\";\nimport { ACTION_REDO } from \"@/actions/redo\";\n\nimport { ACTION_PROJECT_NEW } from \"@/actions/project-new\";\nimport { ACTION_PROJECT_RECEIVE } from \"@/actions/project-receive\";\n\nexport const PROJECT_MUTATION_ACTIONS = [\n  ACTION_CIRCUIT_ADD,\n  ACTION_CIRCUIT_DELETE,\n  ACTION_CIRCUIT_RENAME,\n  ACTION_ELEMENT_ADD,\n  ACTION_ELEMENT_DELETE,\n  ACTION_ELEMENT_RENAME,\n  ACTION_SELECTION_ALIGN_TO_GRID,\n  ACTION_SELECTION_DELETE,\n  ACTION_SELECTION_MOVE,\n  ACTION_WIRE_ATTACH,\n  ACTION_WIRE_DETATCH,\n  ACTION_WIRE_JOINT_ADD,\n  ACTION_WIRE_JOINT_DELETE,\n  ACTION_WIRE_JOINT_MOVE,\n\n  ACTION_UNDO,\n  ACTION_REDO,\n\n  // These actions typically fire off other actions in this list,\n  // and are redundant for services that take part in the core reducer.\n  // However, undo/redo is outside of the core reducer and does not see the\n  // reentrant actions in order to produce a single undo stack entry for\n  // the entire paste operation.\n  ACTION_PASTE,\n  ACTION_CIRCUIT_EDITOR_DRAG_END,\n];\n\nexport function isProjectMutationAction(action: AnyAction) {\n  return PROJECT_MUTATION_ACTIONS.indexOf(action.type) !== -1;\n}\n\nexport const PROJECT_RESET_ACTIONS = [\n  ACTION_PROJECT_NEW,\n  ACTION_PROJECT_RECEIVE,\n];\n\nexport function isProjectResetAction(action: AnyAction) {\n  return PROJECT_RESET_ACTIONS.indexOf(action.type) !== -1;\n}\n","import { AnyAction, Reducer } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport { fpSet } from \"@/utils\";\n\nexport type ServiceKey = keyof AppState[\"services\"];\nexport type ServiceState<\n  TServiceKey extends ServiceKey\n> = AppState[\"services\"][TServiceKey];\n\nexport interface ServiceReducer<TServiceState> {\n  (\n    state: Readonly<TServiceState>,\n    action: AnyAction,\n    appState: AppState\n  ): TServiceState;\n}\n\nexport function createServiceReducerCreator<TServiceKey extends ServiceKey>(\n  service: TServiceKey\n): (\n  reducer: ServiceReducer<AppState[\"services\"][TServiceKey]>\n) => Reducer<AppState, AnyAction> {\n  return (reducer: ServiceReducer<AppState[\"services\"][TServiceKey]>) => {\n    return (state: AppState = defaultAppState, action: AnyAction) => {\n      const newState = reducer(state.services[service], action, state);\n      if (state.services[service] != newState) {\n        return fpSet(state, \"services\", service, newState);\n      }\n      return state;\n    };\n  };\n}\n\nexport interface ServiceSelectorA0<TServiceKey extends ServiceKey, TReturn> {\n  (s: AppState): TReturn;\n  local(s: ServiceState<TServiceKey>): TReturn;\n}\n\nexport interface ServiceSelectorA1<\n  TServiceKey extends ServiceKey,\n  TA1,\n  TReturn\n> {\n  (s: AppState, a1: TA1): TReturn;\n  local(s: ServiceState<TServiceKey>, a1: TA1): TReturn;\n}\n\nexport interface ServiceSelectorA2<\n  TServiceKey extends ServiceKey,\n  TA1,\n  TA2,\n  TReturn\n> {\n  (s: AppState, a1: TA1, a2: TA2): TReturn;\n  local(s: ServiceState<TServiceKey>, a1: TA1, a2: TA2): TReturn;\n}\n\nexport interface ServiceSelectorCreator<TServiceKey extends ServiceKey> {\n  <TReturn>(\n    selector: (s: ServiceState<TServiceKey>) => TReturn\n  ): ServiceSelectorA0<TServiceKey, TReturn>;\n  <TA1, TReturn>(\n    selector: (s: ServiceState<TServiceKey>, a1: TA1) => TReturn\n  ): ServiceSelectorA1<TServiceKey, TA1, TReturn>;\n  <TA1, TA2, TReturn>(\n    selector: (s: ServiceState<TServiceKey>, a1: TA1, a2: TA2) => TReturn\n  ): ServiceSelectorA2<TServiceKey, TA1, TA2, TReturn>;\n}\n\nexport function createServiceSelectorCreator<TServiceKey extends ServiceKey>(\n  service: TServiceKey\n): ServiceSelectorCreator<TServiceKey> {\n  return <TArgs, TReturn>(\n    selector: (s: ServiceState<TServiceKey>, ...args: TArgs[]) => TReturn\n  ) => {\n    const appSelector: any = (s: AppState, ...args: TArgs[]) =>\n      selector(s.services[service], ...args);\n    appSelector.local = selector;\n    return appSelector;\n  };\n}\n","import first from \"lodash/first\";\n\nimport {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\nimport { CircuitEditorsServiceState } from \"./state\";\n\nexport const createCircuitEditorsReducer = createServiceReducerCreator(\n  \"circuitEditors\"\n);\nexport const createCircuitEditorsSelector = createServiceSelectorCreator(\n  \"circuitEditors\"\n);\n\nexport function findActiveEditorId(\n  state: CircuitEditorsServiceState\n): string | null {\n  if (state.activeEditorId) {\n    return state.activeEditorId;\n  }\n  return first(Object.keys(state.circucitEditorsById)) ?? null;\n}\n","import { AppState } from \"@/store\";\n\nimport { CircuitEditorsServiceState } from \"../state\";\nimport { createCircuitEditorsSelector } from \"../utils\";\n\nexport const circuitEditorStateFromIdSelector = createCircuitEditorsSelector(\n  (s: CircuitEditorsServiceState, editorId: string) =>\n    s.circucitEditorsById[editorId]\n);\n\nexport const circuitIdForEditorIdSelector = (\n  state: AppState,\n  editorId: string\n) => {\n  const editorState = circuitEditorStateFromIdSelector(state, editorId);\n  if (!editorState) {\n    return null;\n  }\n\n  return editorState.circuitId;\n};\n\nexport const activeCircuitEditorIdSelector = createCircuitEditorsSelector(\n  (s) => {\n    if (s.activeEditorId) {\n      return s.activeEditorId;\n    }\n\n    const keys = Object.keys(s.circucitEditorsById);\n    if (keys.length > 0) {\n      return keys[0];\n    }\n\n    return null;\n  }\n);\n\nexport const activeCircuitEditorStateSelector = createCircuitEditorsSelector(\n  (s) => (s.activeEditorId ? s.circucitEditorsById[s.activeEditorId] : null)\n);\n\nexport const activeCircuitIdSelector = createCircuitEditorsSelector((s) => {\n  if (!s.activeEditorId) {\n    return null;\n  }\n  const editorState = s.circucitEditorsById[s.activeEditorId];\n  if (!editorState) {\n    return null;\n  }\n\n  return editorState.circuitId;\n});\n\nexport const editorIdsFromCircuitIdSelector = createCircuitEditorsSelector(\n  (s: CircuitEditorsServiceState, circuitId: string) => {\n    return Object.keys(s.circucitEditorsById).filter(\n      (id) => s.circucitEditorsById[id].circuitId === circuitId\n    );\n  }\n);\n","import pick from \"lodash/pick\";\n\nimport { AppState } from \"@/store\";\n\nimport { activeCircuitEditorStateSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nimport { UndoStackState, UndoServicesStateKeys } from \"./state\";\n\nexport function captureUndoState(state: AppState): UndoStackState {\n  let viewCircuitId: string | null = null;\n\n  const activeEditor = activeCircuitEditorStateSelector(state);\n  if (activeEditor) {\n    viewCircuitId = activeEditor.circuitId;\n  }\n\n  return {\n    serviceStates: pick(state.services, UndoServicesStateKeys),\n    viewCircuitId,\n  };\n}\n","import { AnyAction } from \"redux\";\nimport sortBy from \"lodash/sortBy\";\n\nimport { MaybeArray } from \"@/arrays\";\n\nimport { AppState, defaultAppState } from \"./state\";\nimport { AppReducer } from \"./types\";\n\nexport function concatReducers(\n  ...reducers: MaybeArray<AppReducer>[]\n): AppReducer[] {\n  // Previously, this was reduceReducers and generated a reducer\n  //  that invokes each child reducer.\n  // However, we need to be able to order reducers across services,\n  //  so we must now aggregate a list of reducers and do a final ordering\n  //  step after all are collected.\n  return ([] as AppReducer[]).concat(...reducers);\n}\n\nexport function finalizeReducerList(reducers: AppReducer[]): AppReducer {\n  // Order the list by weight ascending.\n  const finalizedList = sortBy(reducers, (x: AppReducer) => x.weight || 0);\n\n  return (state: AppState = defaultAppState, action: AnyAction) => {\n    return finalizedList.reduce(\n      (state, reducer) => reducer(state, action),\n      state\n    );\n  };\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_ABORT = \"@circuit-editor/drag/abort\" as const;\nexport const circuitEditorDragAbort = () => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_ABORT,\n});\nexport type CircuitEditorDragAbortAction = ReturnType<\n  typeof circuitEditorDragAbort\n>;\nexport function isCircuitEditorDragAbortAction(\n  action: AnyAction\n): action is CircuitEditorDragAbortAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_ABORT;\n}\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createCircuitEditorDragReducer = createServiceReducerCreator(\n  \"circuitEditorDrag\"\n);\nexport const createCircuitEditorDragSelector = createServiceSelectorCreator(\n  \"circuitEditorDrag\"\n);\n","import { isCircuitEditorDragAbortAction } from \"@/actions/circuit-editor-drag-abort\";\nimport { defaultCircuitEditorDragServiceState } from \"../state\";\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action) => {\n  if (!isCircuitEditorDragAbortAction(action)) {\n    return state;\n  }\n\n  return defaultCircuitEditorDragServiceState;\n});\n","import { AnyAction } from \"redux\";\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE = \"@circuit-editor/drag/continue\" as const;\nexport const circuitEditorDragContinue = (\n  p: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE,\n  payload: { dragPos: p, modifierKeys, editorId },\n});\nexport type CircuitEditorDragContinueAction = ReturnType<\n  typeof circuitEditorDragContinue\n>;\nexport function isCircuitEditorDragContinueAction(\n  action: AnyAction\n): action is CircuitEditorDragContinueAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE;\n}\n","import { isCircuitEditorDragContinueAction } from \"@/actions/circuit-editor-drag-continue\";\n\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action) => {\n  if (!isCircuitEditorDragContinueAction(action)) {\n    return state;\n  }\n\n  const { dragPos, modifierKeys, editorId } = action.payload;\n\n  return {\n    ...state,\n    dragEnd: dragPos,\n    dragEndEditorId: editorId,\n    dragModifierKeys: modifierKeys,\n  };\n});\n","import union from \"lodash/union\";\nimport difference from \"lodash/difference\";\n\nimport { ModifierKeys } from \"./modifier-keys\";\n\nexport type SelectionMode =\n  | \"set\"\n  | \"append\"\n  | \"remove\"\n  | \"toggle\"\n  | \"set-if-unselected\";\n\nexport function getSelectMode(\n  modifiers: ModifierKeys,\n  defaultMode: SelectionMode = \"set\"\n): SelectionMode {\n  if (modifiers.shiftKey && modifiers.ctrlMetaKey) {\n    return \"remove\";\n  }\n  if (modifiers.shiftKey) {\n    return \"append\";\n  }\n  if (modifiers.ctrlMetaKey) {\n    return \"toggle\";\n  }\n  return defaultMode;\n}\n\nexport function combineSelection(\n  selectedIds: string[],\n  chosenIds: string[],\n  mode: SelectionMode\n) {\n  switch (mode) {\n    case \"set\":\n      return chosenIds;\n    case \"set-if-unselected\": {\n      if (chosenIds.every((chosen) => selectedIds.indexOf(chosen) !== -1)) {\n        // All were selected.\n        return selectedIds;\n      }\n\n      // One wasn't selected, set it\n      return chosenIds;\n    }\n    case \"append\":\n      return union(selectedIds, chosenIds);\n    case \"remove\":\n      return difference(selectedIds, chosenIds);\n    case \"toggle\": {\n      return difference(selectedIds, chosenIds).concat(\n        difference(chosenIds, selectedIds)\n      );\n    }\n  }\n\n  return chosenIds;\n}\n","import { AnyAction } from \"redux\";\n\nimport { Rectangle } from \"@/geometry\";\nimport { SelectionMode } from \"@/selection-mode\";\n\nexport const ACTION_SELECT_REGION = \"@select/region\" as const;\nexport const selectRegion = (\n  region: Rectangle,\n  circuitId: string,\n  mode: SelectionMode = \"set\"\n) => ({\n  type: ACTION_SELECT_REGION,\n  payload: {\n    region,\n    circuitId,\n    mode,\n  },\n});\nexport type SelectRegionAction = ReturnType<typeof selectRegion>;\nexport function isSelectRegionAction(\n  action: AnyAction\n): action is SelectRegionAction {\n  return action.type === ACTION_SELECT_REGION;\n}\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createCircuitGraphReducer = createServiceReducerCreator(\n  \"circuitGraph\"\n);\nexport const createCircuitGraphSelector = createServiceSelectorCreator(\n  \"circuitGraph\"\n);\n","import { createSelector } from \"reselect\";\nimport mapValues from \"lodash/mapValues\";\n\nimport { createCircuitGraphSelector } from \"../utils\";\nimport { CircuitGraphServiceState } from \"../state\";\nimport { Element } from \"../types\";\n\nexport const elementsByElementIdSelector = createCircuitGraphSelector(\n  (s) => s.elementsById\n);\n\nexport const elementIdsSelector = createCircuitGraphSelector(\n  createSelector(\n    elementsByElementIdSelector.local,\n    (elementsById: Record<string, Element>) => Object.keys(elementsById)\n  )\n);\n\nexport const elementTypesByElementIdSelector = createCircuitGraphSelector(\n  createSelector(\n    elementsByElementIdSelector.local,\n    (elementsById: Record<string, Element>) =>\n      mapValues(elementsById, (x) => x.elementType)\n  )\n);\n\nexport const elementFromElementIdSelector = createCircuitGraphSelector(\n  (s: CircuitGraphServiceState, elementId: string) =>\n    s.elementsById[elementId] || null\n);\n\nexport const elementIdsFromTypeSelector = createCircuitGraphSelector(\n  (s: CircuitGraphServiceState, desiredType: string) => {\n    const elementIds: string[] = [];\n    for (const elementId of Object.keys(s.elementsById)) {\n      const { elementType } = s.elementsById[elementId];\n      if (elementType === desiredType) {\n        elementIds.push(elementId);\n      }\n    }\n    return elementIds;\n  }\n);\n\nexport const elementTypeFromElementIdSelector = createCircuitGraphSelector(\n  (s: CircuitGraphServiceState, elementId: string) => {\n    const element = elementFromElementIdSelector.local(s, elementId);\n    if (!element) {\n      return null;\n    }\n    return element.elementType;\n  }\n);\n\nexport const elementIdsByCircuitIdSelector = createCircuitGraphSelector(\n  (state) => state.elementIdsByCircuitId\n);\n\nconst EmptyElementIds: string[] = [];\nexport const elementIdsFromCircuitIdSelector = createCircuitGraphSelector<\n  string,\n  string[]\n>(\n  (state, circuitId: string) =>\n    state.elementIdsByCircuitId[circuitId] ?? EmptyElementIds\n);\n\nexport const circuitIdFromElementIdSelector = createCircuitGraphSelector<\n  string,\n  string | null\n>((state, elementId) => {\n  for (const circuitId of Object.keys(state.elementIdsByCircuitId)) {\n    const elementIds = state.elementIdsByCircuitId[circuitId];\n    if (elementIds.indexOf(elementId) !== -1) {\n      return circuitId;\n    }\n  }\n  return null;\n});\n\nexport const elementNamesByElementIdSelector = createCircuitGraphSelector(\n  createSelector(\n    (state) => state.elementsById,\n    (elementsById) => {\n      return mapValues(elementsById, (element) => element.elementName);\n    }\n  )\n);\n\nexport const elementNameOrDefaultFromElementIdSelector = createCircuitGraphSelector(\n  (s: CircuitGraphServiceState, elementId: string) => {\n    const element = elementFromElementIdSelector.local(s, elementId);\n    if (!element) {\n      return null;\n    }\n\n    return element.elementName ?? elementId.substr(0, 4);\n  }\n);\n\nexport const elementNameFromElementIdSelector = createCircuitGraphSelector(\n  (s: CircuitGraphServiceState, elementId: string) => {\n    const element = elementFromElementIdSelector.local(s, elementId);\n    if (!element) {\n      return null;\n    }\n\n    return element.elementName;\n  }\n);\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createCircuitLayoutReducer = createServiceReducerCreator(\n  \"circuitLayout\"\n);\nexport const createCircuitLayoutSelector = createServiceSelectorCreator(\n  \"circuitLayout\"\n);\n","import { ZeroPoint } from \"@/geometry\";\n\nimport { createCircuitLayoutSelector } from \"../utils\";\nimport { CircuitLayoutServiceState } from \"../state\";\n\nexport const elementPositionsByElementIdSelector = createCircuitLayoutSelector(\n  (state) => state.elementPositionsById\n);\n\nexport const elementPositionFromElementIdSelector = createCircuitLayoutSelector(\n  (state: CircuitLayoutServiceState, elementId: string) =>\n    state.elementPositionsById[elementId] ?? ZeroPoint\n);\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createCircuitPropertiesReducer = createServiceReducerCreator(\n  \"circuitProperties\"\n);\nexport const createCircuitPropertiesSelector = createServiceSelectorCreator(\n  \"circuitProperties\"\n);\n","import { CircuitPropertiesServiceState } from \"../state\";\nimport { createCircuitPropertiesSelector } from \"../utils\";\n\nexport const circuitIdsSelector = createCircuitPropertiesSelector((state) =>\n  Object.keys(state.circuitNamesByCircuitId)\n);\n\nexport const circuitNamesByIdSelector = createCircuitPropertiesSelector(\n  (state) => state.circuitNamesByCircuitId\n);\n\nexport const circuitNameFromIdSelector = createCircuitPropertiesSelector(\n  (state: CircuitPropertiesServiceState, circuitId: string) =>\n    state.circuitNamesByCircuitId[circuitId]\n);\n","export function circuitIdToElementType(circuitId: string) {\n  return `ic-${circuitId}`;\n}\n\nexport function elementTypeToCircuitId(\n  elementType: string | null\n): string | null {\n  if (!elementType || !elementType.startsWith(\"ic-\")) {\n    return null;\n  }\n  return elementType.substr(3);\n}\n\nexport function getICBorderPath(inputPinCount: number, outputPinCount: number) {\n  const height = Math.max(inputPinCount, outputPinCount, 1) * 50 - 20;\n  return `M10,10 h80 v${height} h-80 z`;\n}\n","import * as React from \"react\";\n\nimport { createSelector } from \"reselect\";\nimport sortBy from \"lodash/sortBy\";\nimport getBounds from \"svg-path-bounds\";\n\nimport { PinDirection } from \"@/logic\";\nimport { boundsToRect, Point } from \"@/geometry\";\n\nimport { IntegratedCircuitElementVisualProps } from \"@/elements/visuals/IntegratedCircuitElementVisual\";\n\nimport { elementIdsByCircuitIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { ROOT_CIRCUIT_ID } from \"@/services/circuits/constants\";\nimport { elementTypesByElementIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { elementPositionsByElementIdSelector } from \"@/services/circuit-layout/selectors/element-positions\";\nimport { circuitNamesByIdSelector } from \"@/services/circuit-properties/selectors/circuits\";\n\nimport {\n  ElementDefinition,\n  ElementDefinitionSource,\n  ElementPinDefinition,\n} from \"../../types\";\n\nimport { circuitIdToElementType, getICBorderPath } from \"./utils\";\n\nconst IntegratedCircuitDefinitionSource: ElementDefinitionSource = createSelector(\n  elementIdsByCircuitIdSelector,\n  elementTypesByElementIdSelector,\n  elementPositionsByElementIdSelector,\n  circuitNamesByIdSelector,\n  (\n    elementIdsByCircuitId,\n    elementTypesByElementId,\n    elementPositionsByElementId,\n    circuitNamesById\n  ) => {\n    return Object.keys(elementIdsByCircuitId)\n      .filter((x) => x !== ROOT_CIRCUIT_ID)\n      .map((circuitId) => {\n        const elementIds = elementIdsByCircuitId[circuitId] ?? [];\n        const circuitName =\n          circuitNamesById[circuitId] ?? circuitId.substr(0, 5);\n\n        // Sort by y axis position to get consistent pin locations.\n        let pinElementIds = elementIds.filter((elementId) =>\n          elementTypesByElementId[elementId].startsWith(\"pin-\")\n        );\n        pinElementIds = sortBy(\n          pinElementIds,\n          (elementId) => elementPositionsByElementId[elementId].y,\n          (elementId) => elementPositionsByElementId[elementId].x\n        );\n\n        const pins: Record<string, ElementPinDefinition> = {};\n        const inputPinIds: string[] = [];\n        const outputPinIds: string[] = [];\n        for (const pinElementId of pinElementIds) {\n          const type = elementTypesByElementId[pinElementId];\n          if (type === \"pin-input\") {\n            pins[pinElementId] = {\n              direction: \"input\",\n              ...circuitPinPosition(inputPinIds.length, \"input\"),\n            };\n            inputPinIds.push(pinElementId);\n          } else if (type === \"pin-output\") {\n            pins[pinElementId] = {\n              direction: \"output\",\n              ...circuitPinPosition(outputPinIds.length, \"output\"),\n            };\n            outputPinIds.push(pinElementId);\n          }\n        }\n\n        const componentProps: IntegratedCircuitElementVisualProps = {\n          circuitId,\n          inputPinIds,\n          outputPinIds,\n        };\n\n        const def: ElementDefinition = {\n          type: circuitIdToElementType(circuitId),\n          category: \"integrated-circuit\",\n          displayName: circuitName,\n          elementProduction: {\n            type: \"circuit\",\n            circuitId,\n          },\n          visual: {\n            hitRect: boundsToRect(\n              getBounds(\n                getICBorderPath(inputPinIds.length, outputPinIds.length)\n              )\n            ),\n            trayComponent: () => (\n              <g stroke=\"black\" strokeWidth={1}>\n                <rect x={10} y={10} width={30} height={30} fill=\"none\" />\n\n                <line x1={10} y1={15} x2={5} y2={15} />\n                <line x1={40} y1={15} x2={45} y2={15} />\n\n                <line x1={10} y1={35} x2={5} y2={35} />\n                <line x1={40} y1={35} x2={45} y2={35} />\n              </g>\n            ),\n            component: \"integrated-circuit\",\n            componentProps,\n          },\n          pins,\n        };\n        return def;\n      });\n  }\n);\n\nexport default [IntegratedCircuitDefinitionSource];\n\nfunction circuitPinPosition(pinIndex: number, direction: PinDirection): Point {\n  return {\n    x: direction === \"input\" ? 0 : 100,\n    y: pinIndex * 50 + 25,\n  };\n}\n","import { ElementDefinitionSource } from \"../../types\";\n\nconst InteractionDefinitionSources: ElementDefinitionSource[] = [\n  require(\"./momentary\").default,\n  require(\"./toggle\").default,\n];\n\nexport default InteractionDefinitionSources;\n","import { ElementDefinitionSource } from \"../types\";\n\nimport IntegratedCircuitDefinitionSources from \"./integrated-circuits\";\nimport InteractionDefinitionSources from \"./interaction\";\nimport LogicDefinitionSources from \"./logic\";\nimport OutputDefinitionSources from \"./output\";\nimport PinDefinitionSources from \"./pins\";\n\nconst elementDefinitionSources: ElementDefinitionSource[] = [\n  ...IntegratedCircuitDefinitionSources,\n  ...InteractionDefinitionSources,\n  ...LogicDefinitionSources,\n  ...OutputDefinitionSources,\n  ...PinDefinitionSources,\n];\n\nexport default elementDefinitionSources;\n","import { ElementDefinitionSource } from \"../../types\";\n\nconst LogicElementDefinitionSources: ElementDefinitionSource[] = [\n  require(\"./and\").default,\n  require(\"./buffer\").default,\n  require(\"./nand\").default,\n  require(\"./nor\").default,\n  require(\"./not\").default,\n  require(\"./or\").default,\n  require(\"./xor\").default,\n];\n\nexport default LogicElementDefinitionSources;\n","import { ElementDefinitionSource } from \"../../types\";\n\nconst OutputElementDefinitionSources: ElementDefinitionSource[] = [\n  require(\"./led\").default,\n  require(\"./seg7\").default,\n];\n\nexport default OutputElementDefinitionSources;\n","import { ElementDefinitionSource } from \"../../types\";\n\nconst PinElementDefinitionSources: ElementDefinitionSource[] = [\n  require(\"./high\").default,\n  require(\"./input\").default,\n  require(\"./output\").default,\n];\n\nexport default PinElementDefinitionSources;\n","import flatMap from \"lodash/flatMap\";\nimport find from \"lodash/find\";\nimport { createSelector } from \"reselect\";\n\nimport { asArray, MaybeArray } from \"@/arrays\";\nimport { AppState } from \"@/store\";\n\nimport elementDefinitionSources from \"@/elements/definitions\";\n\nimport { ElementDefinition, ElementDefinitionSource } from \"@/elements/types\";\n\n/**\n * Gets an array of element definitions from the current state.\n * WARN: Returns an unstable reference, not react safe.\n */\nlet cachedDefinitionsSelector: ElementDefinition[] = [];\nexport const elementDefinitionsSelector = (state: AppState) => {\n  const definitions = flatMap(elementDefinitionSources, (source) =>\n    resolveSources(source, state)\n  );\n\n  if (\n    definitions.every((def, index) => def === cachedDefinitionsSelector[index])\n  ) {\n    return cachedDefinitionsSelector;\n  }\n\n  cachedDefinitionsSelector = definitions;\n  return definitions;\n};\n\nexport const elementDefinitionsByTypeSelector = createSelector(\n  elementDefinitionsSelector,\n  (defs) => {\n    const defsByType: Record<string, ElementDefinition> = {};\n    for (const def of defs) {\n      defsByType[def.type] = def;\n    }\n    return defsByType;\n  }\n);\n\nexport const elementDefinitionFromTypeSelector = (\n  state: AppState,\n  elementType: string\n) => {\n  const definitions = elementDefinitionsSelector(state);\n  return find(definitions, (x) => x.type === elementType) ?? null;\n};\n\nfunction resolveSources(\n  source: ElementDefinitionSource,\n  state: AppState\n): ElementDefinition[] {\n  let resolved: MaybeArray<ElementDefinition>;\n  if (typeof source === \"function\") {\n    resolved = source(state);\n  } else {\n    resolved = source;\n  }\n\n  return asArray(resolved);\n}\n","import * as yup from \"yup\";\n\nexport interface Element {\n  /**\n   * The type of this element.\n   */\n  elementType: string;\n\n  /**\n   * The user provided name of this element.\n   */\n  elementName: string | null;\n}\n\n/**\n * Identifies a pin on a specific element.\n */\nexport interface ElementPin {\n  elementId: string;\n  pinId: string;\n}\nexport const elementPinSchema = yup.object().shape({\n  elementId: yup.string().required().min(1),\n  pinId: yup.string().required().min(1),\n});\nexport function elementPinEquals(a: ElementPin, b: ElementPin) {\n  return a.elementId === b.elementId && a.pinId === b.pinId;\n}\n\n/**\n * A connection from an element output to an element input.\n */\nexport interface Connection {\n  /**\n   * The output pin on an element, sending a value outwards.\n   */\n  outputPin: ElementPin;\n\n  /**\n   * The input pin on an element to receive the value.\n   */\n  inputPin: ElementPin;\n}\n","import { createSelector } from \"reselect\";\n\nimport { AppState } from \"@/store\";\n\nimport {\n  magnitude,\n  Point,\n  pointAdd,\n  pointSubtract,\n  ZeroPoint,\n} from \"@/geometry\";\n\nimport { elementTypesByElementIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { elementDefinitionsByTypeSelector } from \"@/services/element-types/selectors/element-types\";\nimport { elementIdsFromCircuitIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { ElementPin, elementPinEquals } from \"@/services/circuit-graph/types\";\n\nimport { elementPositionsByElementIdSelector } from \"./element-positions\";\n\nexport const elementPinPositionsByPinIdByElementIdSelector = createSelector(\n  elementDefinitionsByTypeSelector,\n  elementPositionsByElementIdSelector,\n  elementTypesByElementIdSelector,\n  (elementDefsByType, elementPositionsByElementId, elementTypesByElementId) => {\n    const elementPinPositionsByPinIdByElementId: Record<\n      string,\n      Record<string, Point>\n    > = {};\n\n    const elementIds = Object.keys(elementTypesByElementId);\n    for (const elementId of elementIds) {\n      const elementPinPositionsByPinId: Record<string, Point> = {};\n      elementPinPositionsByPinIdByElementId[\n        elementId\n      ] = elementPinPositionsByPinId;\n\n      const elementPosition =\n        elementPositionsByElementId[elementId] ?? ZeroPoint;\n\n      const elementType = elementTypesByElementId[elementId];\n      if (!elementType) {\n        continue;\n      }\n      const def = elementDefsByType[elementType];\n      if (!def) {\n        continue;\n      }\n\n      const pinIds = Object.keys(def.pins);\n      for (const pinId of pinIds) {\n        const relPinPosition = def.pins[pinId];\n        const pinPosition = pointAdd(elementPosition, relPinPosition);\n        elementPinPositionsByPinId[pinId] = pinPosition;\n      }\n    }\n\n    return elementPinPositionsByPinIdByElementId;\n  }\n);\n\nexport const elementPinPositionFromElementPinSelector = (\n  state: AppState,\n  elementId: string,\n  pinId: string\n) => {\n  const positonsByPinIdByElementId = elementPinPositionsByPinIdByElementIdSelector(\n    state\n  );\n  const elementPinPositions = positonsByPinIdByElementId[elementId];\n  if (!elementPinPositions) {\n    return ZeroPoint;\n  }\n  return elementPinPositions[pinId] ?? ZeroPoint;\n};\n\nlet cachedPinFromPoint: ElementPin | null = null;\nexport const elementPinFromPointSelector = (\n  state: AppState,\n  point: Point,\n  circuitId: string\n) => {\n  const pinPositionsByPinIdByElementId = elementPinPositionsByPinIdByElementIdSelector(\n    state\n  );\n  const elementIds = elementIdsFromCircuitIdSelector(state, circuitId);\n  if (!elementIds) {\n    return null;\n  }\n\n  for (const elementId of elementIds) {\n    const pinPositionsByPinId =\n      pinPositionsByPinIdByElementId[elementId] ?? ZeroPoint;\n    const pinIds = Object.keys(pinPositionsByPinId);\n    for (const pinId of pinIds) {\n      const pinPosition = pinPositionsByPinId[pinId];\n      const offset = pointSubtract(point, pinPosition);\n      const length = magnitude(offset);\n      if (length > 6) {\n        continue;\n      }\n\n      const pin: ElementPin = { elementId, pinId };\n      if (!cachedPinFromPoint || !elementPinEquals(pin, cachedPinFromPoint)) {\n        cachedPinFromPoint = pin;\n      }\n      return cachedPinFromPoint;\n    }\n  }\n\n  return null;\n};\n","import { Point, snapPoint } from \"@/geometry\";\nimport { AppState } from \"@/store\";\n\nimport { createCircuitEditorDragSelector } from \"../utils\";\n\nexport const gridElementSnapSelector = createCircuitEditorDragSelector(\n  () => 50\n);\n\nexport const gridJointSnapSelector = createCircuitEditorDragSelector(() => 5);\n\nexport const applyGridElementSnapSelector = (s: AppState, p: Point) => {\n  const snap = gridElementSnapSelector(s);\n  return snapPoint(p, snap);\n};\n\nexport const applyGridJointSnapSelector = (s: AppState, p: Point) => {\n  const snap = gridJointSnapSelector(s);\n  return snapPoint(p, snap);\n};\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_START_ELEMENT = \"@field/drag/start/element\" as const;\nexport const circuitEditorDragStartElement = (\n  elementId: string,\n  p: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_START_ELEMENT,\n  payload: {\n    ...p,\n    elementId,\n    modifierKeys,\n    editorId,\n  },\n});\nexport type CircuitEditorDragStartElementAction = ReturnType<\n  typeof circuitEditorDragStartElement\n>;\nexport function isCircuitEditorDragStartElementAction(\n  action: AnyAction\n): action is CircuitEditorDragStartElementAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_START_ELEMENT;\n}\n","import { AnyAction } from \"redux\";\n\nimport { SelectionMode } from \"@/selection-mode\";\n\nexport const ACTION_SELECT_ELEMENTS = \"@select/elements\" as const;\nexport const selectElements = (\n  elementId: string | string[],\n  mode: SelectionMode = \"set\"\n) => ({\n  type: ACTION_SELECT_ELEMENTS,\n  payload: {\n    elementIds: Array.isArray(elementId) ? elementId : [elementId],\n    mode,\n  },\n});\nexport type SelectElementsAction = ReturnType<typeof selectElements>;\nexport function isSelectElementsAction(\n  action: AnyAction\n): action is SelectElementsAction {\n  return action.type === ACTION_SELECT_ELEMENTS;\n}\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createSelectionReducer = createServiceReducerCreator(\"selection\");\nexport const createSelectionSelector = createServiceSelectorCreator(\n  \"selection\"\n);\n","import { createSelector } from \"reselect\";\n\nimport pick from \"lodash/pick\";\n\nimport { elementsByElementIdSelector } from \"@/services/circuit-graph/selectors/elements\";\n\nimport { createSelectionSelector } from \"../utils\";\nimport { SelectionServiceState } from \"../state\";\n\nexport const selectedElementIdsSelector = createSelectionSelector(\n  (state) => state.selectedElementIds\n);\n\nexport const isElementSelectedFromElementIdSelector = createSelectionSelector(\n  (s: SelectionServiceState, elementId: string) =>\n    s.selectedElementIds.indexOf(elementId) !== -1\n);\n\nexport const selectedElementsByIdSelector = createSelector(\n  elementsByElementIdSelector,\n  selectedElementIdsSelector,\n  (elementsById, selectedElementIds) => pick(elementsById, selectedElementIds)\n);\n\nexport const selectedConnectionIdsSelector = createSelectionSelector(\n  (state) => state.selectedConnectionIds\n);\n\nexport const isWireSelectedFromConnectionIdSelector = createSelectionSelector(\n  (s: SelectionServiceState, connectionId: string) =>\n    s.selectedConnectionIds.indexOf(connectionId) !== -1\n);\n\nexport const selectedJointIdsSelector = createSelectionSelector(\n  (state) => state.selectedJointIds\n);\n\nexport const isJointSelectedFromJointIdSelector = createSelectionSelector(\n  (s: SelectionServiceState, jointId: string) =>\n    s.selectedJointIds.indexOf(jointId) !== -1\n);\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_START_JOINT = \"@circuit-editor/drag/start/joint\" as const;\nexport const circuitEditorDragStartJoint = (\n  jointId: string,\n  p: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_START_JOINT,\n  payload: {\n    ...p,\n    jointId,\n    modifierKeys,\n    editorId,\n  },\n});\nexport type CircuitEditorDragStartJointAction = ReturnType<\n  typeof circuitEditorDragStartJoint\n>;\nexport function isCircuitEditorDragStartJointAction(\n  action: AnyAction\n): action is CircuitEditorDragStartJointAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_START_JOINT;\n}\n","import { AnyAction } from \"redux\";\n\nimport { SelectionMode } from \"@/selection-mode\";\n\nexport const ACTION_SELECT_WIRE_JOINTS = \"@select/wire-joints\" as const;\nexport const selectWireJoints = (\n  jointId: string | string[],\n  mode: SelectionMode = \"set\"\n) => ({\n  type: ACTION_SELECT_WIRE_JOINTS,\n  payload: {\n    jointIds: Array.isArray(jointId) ? jointId : [jointId],\n    mode,\n  },\n});\nexport type SelectWireJointsAction = ReturnType<typeof selectWireJoints>;\nexport function isSelectWireJointsAction(\n  action: AnyAction\n): action is SelectWireJointsAction {\n  return action.type === ACTION_SELECT_WIRE_JOINTS;\n}\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_START_NEWJOINT = \"@circuit-editor/drag/start/new-joint\" as const;\nexport const circuitEditorDragStartNewJoint = (\n  connectionId: string,\n  addAfterJointId: string | null,\n  p: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_START_NEWJOINT,\n  payload: {\n    ...p,\n    connectionId,\n    addAfterJointId,\n    modifierKeys,\n    editorId,\n  },\n});\nexport type CircuitEditorDragStartNewJointAction = ReturnType<\n  typeof circuitEditorDragStartNewJoint\n>;\nexport function isCircuitEditorDragStartNewJointAction(\n  action: AnyAction\n): action is CircuitEditorDragStartNewJointAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_START_NEWJOINT;\n}\n","import { isCircuitEditorDragStartNewJointAction } from \"@/actions/circuit-editor-drag-start-newjoint\";\n\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action) => {\n  if (!isCircuitEditorDragStartNewJointAction(action)) {\n    return state;\n  }\n\n  const {\n    connectionId,\n    addAfterJointId,\n    modifierKeys,\n    x,\n    y,\n    editorId,\n  } = action.payload;\n\n  return {\n    ...state,\n    dragMode: \"new-joint\" as const,\n    dragStart: {\n      x,\n      y,\n    },\n    dragStartEditorId: editorId,\n    dragEnd: null,\n    dragEndEditorId: null,\n    dragNewJointConnectionId: connectionId,\n    dragNewJointAfterJointId: addAfterJointId,\n    dragModifierKeys: modifierKeys,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { ModifierKeys } from \"@/modifier-keys\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_START_SELECT = \"@circuit-editor/drag/start/select\" as const;\nexport const circuitEditorDragStartSelect = (\n  p: Point,\n  modifierKeys: ModifierKeys,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_START_SELECT,\n  payload: {\n    ...p,\n    modifierKeys,\n    editorId,\n  },\n});\nexport type CircuitEditorDragStartSelectAction = ReturnType<\n  typeof circuitEditorDragStartSelect\n>;\nexport function isCircuitEditorDragStartSelectAction(\n  action: AnyAction\n): action is CircuitEditorDragStartSelectAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_START_SELECT;\n}\n","import { isCircuitEditorDragStartSelectAction } from \"@/actions/circuit-editor-drag-start-select\";\n\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action) => {\n  if (!isCircuitEditorDragStartSelectAction(action)) {\n    return state;\n  }\n\n  const { x, y, modifierKeys, editorId } = action.payload;\n\n  return {\n    ...state,\n    dragMode: \"select\",\n    dragStart: {\n      x,\n      y,\n    },\n    dragStartEditorId: editorId,\n    dragModifierKeys: modifierKeys,\n    dragEnd: null,\n    dragEndEditorId: null,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { ElementPin } from \"@/services/circuit-graph/types\";\n\nexport const ACTION_CIRCUIT_EDITOR_DRAG_START_WIRE = \"@circuit-editor/drag/start/wire\" as const;\nexport const circuitEditorDragStartWire = (\n  dragStart: Point,\n  pin: ElementPin,\n  editorId: string\n) => ({\n  type: ACTION_CIRCUIT_EDITOR_DRAG_START_WIRE,\n  payload: {\n    ...dragStart,\n    pin,\n    editorId,\n  },\n});\nexport type CircuitEditorDragStartWireAction = ReturnType<\n  typeof circuitEditorDragStartWire\n>;\nexport function isCircuitEditorDragStartWireAction(\n  action: AnyAction\n): action is CircuitEditorDragStartWireAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_DRAG_START_WIRE;\n}\n","import { isCircuitEditorDragStartWireAction } from \"@/actions/circuit-editor-drag-start-wire\";\n\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action) => {\n  if (!isCircuitEditorDragStartWireAction(action)) {\n    return state;\n  }\n\n  const { x, y, pin, editorId } = action.payload;\n\n  return {\n    ...state,\n    dragMode: \"wire\",\n    dragStart: { x, y },\n    dragStartEditorId: editorId,\n    dragWireSource: pin,\n    dragEnd: null,\n    dragEndEditorId: null,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE = \"@circuit-editor/mouse/leave\" as const;\nexport const circuitEditorMouseLeave = () => ({\n  type: ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE,\n});\nexport type CircuitEditorMouseLeaveAction = ReturnType<\n  typeof circuitEditorMouseLeave\n>;\nexport function isCircuitEditorMouseLeaveAction(\n  action: AnyAction\n): action is CircuitEditorMouseLeaveAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE;\n}\n","import { concatReducers } from \"@/store/utils\";\n\nimport dragAbortReducer from \"./drag-abort\";\nimport dragContinueReducer from \"./drag-continue\";\nimport dragEndReducer from \"./drag-end\";\nimport dragStartElementReducer from \"./drag-start-element\";\nimport dragStartJointReducer from \"./drag-start-joint\";\nimport dragStartNewJointReducer from \"./drag-start-newjoint\";\nimport dragStartSelectReducer from \"./drag-start-select\";\nimport dragStartWireReducer from \"./drag-start-wire\";\nimport mouseLeaveReducer from \"./mouse-leave\";\n\nexport default concatReducers(\n  dragAbortReducer,\n  dragContinueReducer,\n  dragEndReducer,\n  dragStartJointReducer,\n  dragStartNewJointReducer,\n  dragStartElementReducer,\n  dragStartSelectReducer,\n  dragStartWireReducer,\n  mouseLeaveReducer\n);\n","import { AnyAction } from \"redux\";\n\nimport { normalizeRectangle, pointSubtract } from \"@/geometry\";\nimport { fpSet } from \"@/utils\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isCircuitEditorDragEndAction } from \"@/actions/circuit-editor-drag-end\";\nimport { selectRegion } from \"@/actions/select-region\";\nimport { moveSelection } from \"@/actions/selection-move\";\nimport { addWireJoint } from \"@/actions/wire-joint-add\";\nimport { attachWire } from \"@/actions/wire-attach\";\n\nimport { elementPinFromPointSelector } from \"@/services/circuit-layout/selectors/element-pin-positions\";\nimport { circuitIdForEditorIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nimport {\n  applyGridJointSnapSelector,\n  applyGridElementSnapSelector,\n} from \"../selectors/snap\";\n\nimport { defaultCircuitEditorDragServiceState } from \"../state\";\n\nexport default function dragEndReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n) {\n  if (!isCircuitEditorDragEndAction(action)) {\n    return state;\n  }\n\n  const dragState = state.services.circuitEditorDrag;\n\n  if (dragState.dragMode === null) {\n    return state;\n  }\n\n  const { x, y } = action.payload;\n\n  const { dragStart, dragStartEditorId, dragEndEditorId } = dragState;\n\n  if (dragStartEditorId != dragEndEditorId) {\n    // TODO: Should allow this if dragMode is move.  Just be sure to cut the cross-circuit wires.\n    state = fpSet(\n      state,\n      \"services\",\n      \"circuitEditorDrag\",\n      defaultCircuitEditorDragServiceState\n    );\n    return state;\n  }\n\n  switch (dragState.dragMode) {\n    case \"select\": {\n      const circuitId = circuitIdForEditorIdSelector(state, dragStartEditorId);\n      if (circuitId) {\n        const { dragModifierKeys } = dragState;\n        const selectionMode = getSelectMode(dragModifierKeys);\n        const rect = normalizeRectangle(dragStart, { x, y });\n        state = rootReducer(\n          state,\n          selectRegion(rect, circuitId, selectionMode)\n        );\n      }\n      break;\n    }\n    case \"move\": {\n      const { dragModifierKeys } = dragState;\n      let moveBy = pointSubtract({ x, y }, dragStart);\n      const hasElements =\n        state.services.selection.selectedElementIds.length > 0;\n      if (!dragModifierKeys.ctrlMetaKey) {\n        // We apply the snap here because we want to snap the offset, not the resulting positions.\n        // Applying the snap in moveSelection can result in different objects moving different distances\n        // depending on their snap.\n        if (hasElements) {\n          moveBy = applyGridElementSnapSelector(state, moveBy);\n        } else {\n          moveBy = applyGridJointSnapSelector(state, moveBy);\n        }\n      }\n      state = rootReducer(state, moveSelection(moveBy.x, moveBy.y));\n      break;\n    }\n    case \"new-joint\": {\n      const { dragNewJointConnectionId, dragNewJointAfterJointId } = dragState;\n      const position = applyGridJointSnapSelector(state, { x, y });\n      state = rootReducer(\n        state,\n        addWireJoint(\n          dragNewJointConnectionId!,\n          dragNewJointAfterJointId,\n          position\n        )\n      );\n      break;\n    }\n    case \"wire\": {\n      const circuitId = circuitIdForEditorIdSelector(state, dragStartEditorId);\n      if (circuitId) {\n        const { dragWireSource } = dragState;\n        const endPin = elementPinFromPointSelector(state, { x, y }, circuitId);\n        if (dragWireSource && endPin) {\n          state = rootReducer(state, attachWire(dragWireSource, endPin));\n        }\n      }\n      break;\n    }\n  }\n\n  state = fpSet(\n    state,\n    \"services\",\n    \"circuitEditorDrag\",\n    defaultCircuitEditorDragServiceState\n  );\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nimport { fpSet } from \"@/utils\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isCircuitEditorDragStartJointAction } from \"@/actions/circuit-editor-drag-start-joint\";\nimport { selectWireJoints } from \"@/actions/select-wire-joints\";\n\nimport { isJointSelectedFromJointIdSelector } from \"@/services/selection/selectors/selection\";\n\nexport default function dragStartJointReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n) {\n  if (!isCircuitEditorDragStartJointAction(action)) {\n    return state;\n  }\n\n  const { jointId, x, y, modifierKeys, editorId } = action.payload;\n\n  state = fpSet(state, \"services\", \"circuitEditorDrag\", (value) => ({\n    ...value,\n    dragMode: \"move\" as const,\n    dragStart: {\n      x,\n      y,\n    },\n    dragStartEditorId: editorId,\n    dragModifierKeys: modifierKeys,\n    dragEnd: null,\n    dragEndEditorId: null,\n  }));\n\n  if (!isJointSelectedFromJointIdSelector(state, jointId)) {\n    const selectionMode = getSelectMode(modifierKeys);\n    // Dragging an element that was not previously selected.  Perform a selection on the element.\n    state = rootReducer(state, selectWireJoints(jointId, selectionMode));\n  }\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nimport { fpSet } from \"@/utils\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isCircuitEditorDragStartElementAction } from \"@/actions/circuit-editor-drag-start-element\";\nimport { selectElements } from \"@/actions/select-elements\";\n\nimport { isElementSelectedFromElementIdSelector } from \"@/services/selection/selectors/selection\";\n\nexport default function dragStartNodeReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n) {\n  if (!isCircuitEditorDragStartElementAction(action)) {\n    return state;\n  }\n\n  const { elementId, x, y, modifierKeys, editorId } = action.payload;\n\n  state = fpSet(state, \"services\", \"circuitEditorDrag\", (value) => ({\n    ...value,\n    dragMode: \"move\" as const,\n    dragStart: {\n      x,\n      y,\n    },\n    dragStartEditorId: editorId,\n    dragModifierKeys: modifierKeys,\n    dragEnd: null,\n    dragEndEditorId: null,\n  }));\n\n  if (!isElementSelectedFromElementIdSelector(state, elementId)) {\n    const selectionMode = getSelectMode(modifierKeys);\n    // Dragging an element that was not previously selected.  Perform a selection on the element.\n    state = rootReducer(state, selectElements(elementId, selectionMode));\n  }\n\n  return state;\n}\n","import { isCircuitEditorMouseLeaveAction } from \"@/actions/circuit-editor-mouse-leave\";\n\nimport { createCircuitEditorDragReducer } from \"../utils\";\n\nexport default createCircuitEditorDragReducer((state, action) => {\n  if (!isCircuitEditorMouseLeaveAction(action)) {\n    return state;\n  }\n\n  if (state.dragMode == null) {\n    return state;\n  }\n\n  return {\n    ...state,\n    dragEnd: null,\n  };\n});\n","import pick from \"lodash/pick\";\n\nimport { isDeleteCircuitAction } from \"@/actions/circuit-delete\";\n\nimport { createCircuitEditorsReducer } from \"../utils\";\n\nexport default createCircuitEditorsReducer((state, action) => {\n  if (!isDeleteCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitId } = action.payload;\n\n  const keepIds = Object.keys(state.circucitEditorsById).filter(\n    (id) => state.circucitEditorsById[id].circuitId !== circuitId\n  );\n\n  let activeEditorId = state.activeEditorId;\n  if (!activeEditorId || keepIds.indexOf(activeEditorId) === -1) {\n    activeEditorId = null;\n  }\n\n  return {\n    ...state,\n    circucitEditorsById: pick(state.circucitEditorsById, keepIds),\n    activeEditorId,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_CIRCUIT_EDITOR_RECEIVE_FOCUS = \"@circuit-editor/receive-focus\" as const;\nexport const circuitEditorReceiveFocus = (editorId: string) => ({\n  type: ACTION_CIRCUIT_EDITOR_RECEIVE_FOCUS,\n  payload: { editorId },\n});\nexport type CircuitEditorFocusAction = ReturnType<\n  typeof circuitEditorReceiveFocus\n>;\nexport function isCircuitEditorReceiveFocusAction(\n  action: AnyAction\n): action is CircuitEditorFocusAction {\n  return action.type === ACTION_CIRCUIT_EDITOR_RECEIVE_FOCUS;\n}\n","import { isCircuitEditorReceiveFocusAction } from \"@/actions/circuit-editor-receive-focus\";\n\nimport { createCircuitEditorsReducer } from \"../utils\";\n\nexport default createCircuitEditorsReducer((state, action) => {\n  if (!isCircuitEditorReceiveFocusAction(action)) {\n    return state;\n  }\n\n  const { editorId } = action.payload;\n\n  if (Object.keys(state.circucitEditorsById).indexOf(editorId) === -1) {\n    return state;\n  }\n\n  return {\n    ...state,\n    activeEditorId: editorId,\n  };\n});\n","import { AnyAction } from \"redux\";\nimport { v4 as uuidV4 } from \"uuid\";\n\ninterface ViewCircuitOpts {\n  newWindow?: boolean;\n}\nexport const ACTION_VIEW_CIRCUIT = \"@view/circuit\" as const;\nexport const viewCircuit = (\n  circuitId: string,\n  elementIdPath: string[] | null = null,\n  opts: ViewCircuitOpts = {}\n) => ({\n  type: ACTION_VIEW_CIRCUIT,\n  payload: {\n    circuitId,\n    elementIdPath,\n    newWindowId: opts.newWindow ? uuidV4() : null,\n  },\n});\nexport type ViewCircuitAction = ReturnType<typeof viewCircuit>;\nexport function isViewCircuitAction(\n  action: AnyAction\n): action is ViewCircuitAction {\n  return action.type === ACTION_VIEW_CIRCUIT;\n}\n","import { circuitIdsSelector } from \"@/services/circuit-properties/selectors/circuits\";\n\nimport { isViewCircuitAction } from \"@/actions/view-circuit\";\n\nimport { createCircuitEditorsReducer, findActiveEditorId } from \"../utils\";\n\nexport default createCircuitEditorsReducer((state, action, appState) => {\n  if (!isViewCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitId, elementIdPath, newWindowId } = action.payload;\n\n  if (circuitIdsSelector(appState).indexOf(circuitId) === -1) {\n    return state;\n  }\n\n  let targetWindowId = newWindowId;\n  if (!targetWindowId) {\n    targetWindowId = findActiveEditorId(state);\n  }\n\n  if (!targetWindowId) {\n    return state;\n  }\n\n  return {\n    ...state,\n    circucitEditorsById: {\n      ...state.circucitEditorsById,\n      [targetWindowId]: {\n        circuitId,\n        elementIdPath: elementIdPath ?? [],\n      },\n    },\n    activeEditorId: targetWindowId,\n  };\n});\n","import { concatReducers } from \"@/store/utils\";\n\nimport circuitDeleteReducer from \"./circuit-delete\";\nimport editorFocusReducer from \"./editor-focus\";\nimport viewCircuitReducer from \"./view-circuit\";\n\nexport default concatReducers(\n  circuitDeleteReducer,\n  editorFocusReducer,\n  viewCircuitReducer\n);\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_COPY_ELEMENTS = \"@clipboard/copy-elements\" as const;\nexport const copyElements = (elementId: string | string[]) => ({\n  type: ACTION_COPY_ELEMENTS,\n  payload: {\n    elementIds: Array.isArray(elementId) ? elementId : [elementId],\n  },\n});\nexport type CopyElementsAction = ReturnType<typeof copyElements>;\nexport function isCopyElementsAction(\n  action: AnyAction\n): action is CopyElementsAction {\n  return action.type === ACTION_COPY_ELEMENTS;\n}\n","import { createSelector } from \"reselect\";\nimport values from \"lodash/values\";\nimport uniq from \"lodash/uniq\";\nimport includes from \"lodash/includes\";\n\nimport { CircuitGraphServiceState } from \"../state\";\nimport { createCircuitGraphSelector } from \"../utils\";\nimport { ElementPin, elementPinEquals } from \"../types\";\nimport { AppState } from \"@/store\";\n\nexport const connectionsByIdSelector = createCircuitGraphSelector(\n  (s) => s.connectionsById\n);\n\nexport const connectionIdsSelector = createCircuitGraphSelector(\n  createSelector(\n    (s) => s.connectionsById,\n    (connectionsById) => Object.keys(connectionsById)\n  )\n);\n\nexport const connectionFromConnectionIdSelector = createCircuitGraphSelector(\n  (s: CircuitGraphServiceState, connectionId: string) =>\n    s.connectionsById[connectionId]\n);\n\nexport const connectionsSelector = createCircuitGraphSelector(\n  createSelector(\n    (state: CircuitGraphServiceState) => state.connectionsById,\n    (connectionsById) => values(connectionsById)\n  )\n);\n\nconst elementIdsByCircuitIdSelector = createCircuitGraphSelector(\n  (state) => state.elementIdsByCircuitId\n);\n\nexport const connectionIdsByCircuitIdSelector = createSelector(\n  elementIdsByCircuitIdSelector,\n  connectionsByIdSelector,\n  (elementIdsByCircuitId, connectionsById) => {\n    const connectionIdsByCircuitId: Record<string, string[]> = {};\n    const connectionIds = Object.keys(connectionsById);\n    const circuitIds = Object.keys(elementIdsByCircuitId);\n    for (const circuitId of circuitIds) {\n      const elementIds = elementIdsByCircuitId[circuitId];\n      connectionIdsByCircuitId[circuitId] = connectionIds.filter((connId) => {\n        const { inputPin, outputPin } = connectionsById[connId];\n        return (\n          includes(elementIds, inputPin.elementId) &&\n          includes(elementIds, outputPin.elementId)\n        );\n      });\n    }\n\n    return connectionIdsByCircuitId;\n  }\n);\n\nconst EmptyConnectionIds: string[] = [];\nexport const connectionIdsForCircuitIdSelector = (\n  state: AppState,\n  circuitId: string\n) => {\n  const connectionIdsByCircuitId = connectionIdsByCircuitIdSelector(state);\n  return connectionIdsByCircuitId[circuitId] ?? EmptyConnectionIds;\n};\n\nexport const connectionIdFromInputPinSelector = createCircuitGraphSelector(\n  (state: CircuitGraphServiceState, pin: ElementPin) => {\n    const { connectionsById } = state;\n    const connectionIds = Object.keys(connectionsById);\n    for (const connectionId of connectionIds) {\n      const connection = connectionsById[connectionId];\n      if (elementPinEquals(connection.inputPin, pin)) {\n        return connectionId;\n      }\n    }\n\n    return null;\n  }\n);\n\nexport const connectionIdFromOutputPinSelector = createCircuitGraphSelector(\n  (state: CircuitGraphServiceState, pin: ElementPin) => {\n    const { connectionsById } = state;\n    const connectionIds = Object.keys(connectionsById);\n    for (const connectionId of connectionIds) {\n      const connection = connectionsById[connectionId];\n      if (elementPinEquals(connection.outputPin, pin)) {\n        return connectionId;\n      }\n    }\n\n    return null;\n  }\n);\n\n/**\n * Gets an array of connection ids supplying input to the specified element.\n * WARN: Not react safe.  For reducer use only.\n */\nexport const elementInputConnectionIdsFromElementIdSelector = createCircuitGraphSelector(\n  (state: CircuitGraphServiceState, elementId: string) =>\n    Object.keys(state.connectionsById).filter(\n      (connectionId) =>\n        state.connectionsById[connectionId].inputPin.elementId === elementId\n    )\n);\n\n/**\n * Gets an array of connection ids leaving the given element.\n * WARN: Not react safe.  For reducer use only.\n */\nexport const elementOutputConnectionIdsFromElementIdSelector = createCircuitGraphSelector(\n  (state: CircuitGraphServiceState, elementId: string) =>\n    Object.keys(state.connectionsById).filter(\n      (connectionId) =>\n        state.connectionsById[connectionId].outputPin.elementId === elementId\n    )\n);\n\n/**\n * Gets an array of connection ids attached to the given element.\n * WARN: Not react safe.  For reducer use only.\n */\nexport const elementConnectionIdsFromElementIdSelector = createCircuitGraphSelector(\n  (state: CircuitGraphServiceState, elementId: string) => {\n    const inputs = elementInputConnectionIdsFromElementIdSelector.local(\n      state,\n      elementId\n    );\n    const outputs = elementOutputConnectionIdsFromElementIdSelector.local(\n      state,\n      elementId\n    );\n    return uniq([...inputs, ...outputs]);\n  }\n);\n","import { AppState } from \"@/store\";\n\nimport { elementDefinitionFromTypeSelector } from \"@/services/element-types/selectors/element-types\";\n\nimport { elementTypeFromElementIdSelector } from \"./elements\";\n\nexport const elementDefinitionFromElementIdSelector = (\n  state: AppState,\n  elementId: string\n) => {\n  const elementType = elementTypeFromElementIdSelector(state, elementId);\n  if (!elementType) {\n    return null;\n  }\n\n  const def = elementDefinitionFromTypeSelector(state, elementType);\n\n  return def;\n};\n","import { circuitIdFromElementIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { circuitIdToElementType } from \"@/elements/definitions/integrated-circuits/utils\";\nimport { AppState } from \"@/store\";\n\nimport { ElementPin } from \"../types\";\n\nimport { connectionsSelector } from \"./connections\";\nimport { elementDefinitionFromElementIdSelector } from \"./element-def\";\nimport {\n  elementIdsFromTypeSelector,\n  elementTypeFromElementIdSelector,\n} from \"./elements\";\n\nexport const pinDirectionFromElementPinSelector = (\n  state: AppState,\n  elementId: string,\n  pinId: string\n) => {\n  const def = elementDefinitionFromElementIdSelector(state, elementId);\n  if (!def) {\n    return null;\n  }\n\n  const pinDef = def.pins[pinId];\n  if (!pinDef) {\n    return null;\n  }\n  return pinDef.direction;\n};\n\n/**\n * Gets a map of element input pins to their output sources given an element id.\n *\n * WARN: Not react safe.  For reducer use only\n */\nexport const elementOutputSourcesByPinIdFromElementIdSelector = (\n  state: AppState,\n  elementId: string\n) => {\n  const connections = connectionsSelector(state);\n  const def = elementDefinitionFromElementIdSelector(state, elementId);\n\n  if (!def) {\n    return {};\n  }\n\n  let outputPins: string[] = [];\n  outputPins = Object.keys(def.pins).filter(\n    (x) => def.pins[x].direction === \"output\"\n  );\n\n  const outputConnections = connections.filter(\n    (x) => x.outputPin.elementId === elementId\n  );\n\n  const result: Record<string, ElementPin[]> = {};\n  for (const pin of outputPins) {\n    result[pin] = [];\n  }\n\n  for (const connection of outputConnections) {\n    const { outputPin, inputPin } = connection;\n    result[outputPin.pinId].push(inputPin);\n  }\n\n  return result;\n};\n\nexport const elementPinsFromPinElementSelector = (\n  state: AppState,\n  elementId: string\n): ElementPin[] => {\n  const elementType = elementTypeFromElementIdSelector(state, elementId);\n  if (elementType !== \"pin-input\" && elementType !== \"pin-output\") {\n    return [];\n  }\n\n  const circuitId = circuitIdFromElementIdSelector(state, elementId);\n  if (!circuitId) {\n    return [];\n  }\n\n  const icElementType = circuitIdToElementType(circuitId);\n  const icElementIds = elementIdsFromTypeSelector(state, icElementType);\n\n  return icElementIds.map((icElementId) => ({\n    elementId: icElementId,\n    pinId: elementId,\n  }));\n};\n","import flatMap from \"lodash/flatMap\";\nimport uniq from \"lodash/uniq\";\n\nimport { AppState } from \"@/store\";\nimport { Point, pointAdd, ZeroPoint } from \"@/geometry\";\n\nimport { ElementDefinition } from \"@/elements/types\";\nimport { elementDefinitionFromElementIdSelector } from \"@/services/circuit-graph/selectors/element-def\";\nimport { elementConnectionIdsFromElementIdSelector } from \"@/services/circuit-graph/selectors/connections\";\nimport { elementIdsFromCircuitIdSelector } from \"@/services/circuit-graph/selectors/elements\";\n\nimport { createCircuitLayoutSelector } from \"../utils\";\nimport { CircuitLayoutServiceState } from \"../state\";\n\nimport { elementPositionFromElementIdSelector } from \"./element-positions\";\n\ninterface PositionCache {\n  inputElementDef: ElementDefinition;\n  inputElementPosition: Point;\n  outputPosition: Point;\n}\n\n// TODO: These build up forever, need to wipe it on occasion.\n// Probably should use LRU cache.\n// Not fixing it right now as we previously used re-reselect, which\n//  also builds up forever.\nconst startPositionCacheByConnectionId: Record<string, PositionCache> = {};\nconst endPositionCacheByConnectionId: Record<string, PositionCache> = {};\n\nexport const wireStartPositionFromConnectionIdSelector = (\n  state: AppState,\n  connectionId: string\n) => {\n  const {\n    outputPin: { elementId, pinId },\n  } = state.services.circuitGraph.connectionsById[connectionId];\n\n  const def = elementDefinitionFromElementIdSelector(state, elementId);\n  if (!def) {\n    return ZeroPoint;\n  }\n\n  const elementPosition = elementPositionFromElementIdSelector(\n    state,\n    elementId\n  );\n\n  // Caching is to get a consistent reference to avoid component rerenders.\n  //  We are not concerned about performance here.\n  const cacheData = startPositionCacheByConnectionId[connectionId];\n  if (\n    cacheData &&\n    cacheData.inputElementDef === def &&\n    cacheData.inputElementPosition.x === elementPosition.x &&\n    cacheData.inputElementPosition.y === elementPosition.y\n  ) {\n    return cacheData.outputPosition;\n  }\n\n  let offset = ZeroPoint;\n  if (def && def.pins[pinId]) {\n    offset = def.pins[pinId];\n  }\n  const position = pointAdd(elementPosition, offset);\n  startPositionCacheByConnectionId[connectionId] = {\n    inputElementDef: def,\n    inputElementPosition: elementPosition,\n    outputPosition: position,\n  };\n\n  return position;\n};\n\nexport const wireEndPositionFromConnectionIdSelector = (\n  state: AppState,\n  connectionId: string\n) => {\n  const {\n    inputPin: { elementId, pinId },\n  } = state.services.circuitGraph.connectionsById[connectionId];\n  const def = elementDefinitionFromElementIdSelector(state, elementId);\n  if (!def) {\n    return ZeroPoint;\n  }\n\n  const elementPosition = elementPositionFromElementIdSelector(\n    state,\n    elementId\n  );\n\n  // Caching is to get a consistent reference to avoid component rerenders.\n  //  We are not concerned about performance here.\n  const cacheData = endPositionCacheByConnectionId[connectionId];\n  if (\n    cacheData &&\n    cacheData.inputElementDef === def &&\n    cacheData.inputElementPosition.x === elementPosition.x &&\n    cacheData.inputElementPosition.y === elementPosition.y\n  ) {\n    return cacheData.outputPosition;\n  }\n\n  let offset = ZeroPoint;\n  if (def && def.pins[pinId]) {\n    offset = def.pins[pinId];\n  }\n  const position = pointAdd(elementPosition, offset);\n  endPositionCacheByConnectionId[connectionId] = {\n    inputElementDef: def,\n    inputElementPosition: elementPosition,\n    outputPosition: position,\n  };\n\n  return position;\n};\n\n// WARN: Returns new object with each invocation.  Not safe for react use.\n//  Currently used to get all joint ids in reducers.\nexport const jointIdsSelector = createCircuitLayoutSelector(\n  (state: CircuitLayoutServiceState) =>\n    Object.keys(state.wireJointPositionsByJointId)\n);\n\n/**\n * Gets all joint ids in the editing circuit.\n * WARN: Not react safe, for reducer use only.\n */\nexport const jointIdsFromCircuitIdSelector = (\n  state: AppState,\n  circuitId: string\n) => {\n  const elementIds = elementIdsFromCircuitIdSelector(state, circuitId);\n  const connectionIds = flatMap(elementIds, (elementId) =>\n    elementConnectionIdsFromElementIdSelector(state, elementId)\n  );\n  const jointIds = flatMap(connectionIds, (connectionId) =>\n    wireJointIdsFromConnectionIdSelector(state, connectionId)\n  );\n  return uniq(jointIds);\n};\n\nexport const wireJointIdsByConnectionIdSelector = createCircuitLayoutSelector(\n  (state) => state.wireJointIdsByConnectionId\n);\n\nexport const wireJointIdsFromConnectionIdSelector = createCircuitLayoutSelector(\n  (state: CircuitLayoutServiceState, connectionId: string) =>\n    state.wireJointIdsByConnectionId[connectionId]\n);\n\nexport const wireJointPositionFromJointIdSelector = createCircuitLayoutSelector(\n  (state: CircuitLayoutServiceState, jointId: string) =>\n    state.wireJointPositionsByJointId[jointId]\n);\n\n// WARN: Returns new object with each invocation.  Not safe for react use.\n//  Currently used to get all joint ids in reducers.\nexport const wireJointPositionsByJointIdSelector = createCircuitLayoutSelector(\n  (state: CircuitLayoutServiceState) => {\n    return state.wireJointPositionsByJointId;\n  }\n);\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createClipboardReducer = createServiceReducerCreator(\"clipboard\");\nexport const createClipboardSelector = createServiceSelectorCreator(\n  \"clipboard\"\n);\n","import { concatReducers } from \"@/store/utils\";\n\nimport clipboardCopyReducer from \"./clipboard-copy\";\nimport clipboardPasteReducer from \"./clipboard-paste\";\n\nconst clipboardReducer = concatReducers(\n  clipboardCopyReducer,\n  clipboardPasteReducer\n);\n\nexport default clipboardReducer;\n","import { v4 as uuidV4 } from \"uuid\";\nimport map from \"lodash/map\";\nimport mapValues from \"lodash/mapValues\";\nimport findIndex from \"lodash/findIndex\";\nimport zipObject from \"lodash/zipObject\";\n\nimport { pointSubtract } from \"@/geometry\";\n\nimport { isCopyElementsAction } from \"@/actions/clipboard-copy-elements\";\n\nimport { elementFromElementIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { elementOutputSourcesByPinIdFromElementIdSelector } from \"@/services/circuit-graph/selectors/pins\";\nimport { elementPositionsByElementIdSelector } from \"@/services/circuit-layout/selectors/element-positions\";\nimport { connectionIdFromInputPinSelector } from \"@/services/circuit-graph/selectors/connections\";\nimport {\n  wireJointIdsFromConnectionIdSelector,\n  wireJointPositionFromJointIdSelector,\n} from \"@/services/circuit-layout/selectors/wires\";\n\nimport { ClipboardElement } from \"../types\";\nimport { createClipboardReducer } from \"../utils\";\n\nexport default createClipboardReducer((state, action, appState) => {\n  if (!isCopyElementsAction(action)) {\n    return state;\n  }\n\n  const { elementIds } = action.payload;\n  if (elementIds.length === 0) {\n    return state;\n  }\n\n  const elementPositionsById = elementPositionsByElementIdSelector(appState);\n\n  const copyIds = zipObject(\n    elementIds,\n    map(elementIds, () => uuidV4())\n  );\n\n  function elementIsSelected(id: string): boolean {\n    return findIndex(elementIds, (x) => x === id) !== -1;\n  }\n\n  const rootPosition = elementPositionsById[elementIds[0]];\n\n  const copyElements: ClipboardElement[] = elementIds.map((elementId) => {\n    const element = elementFromElementIdSelector(appState, elementId);\n    const outputs = elementOutputSourcesByPinIdFromElementIdSelector(\n      appState,\n      elementId\n    );\n    const copyElement: ClipboardElement = {\n      id: copyIds[elementId],\n      elementType: element.elementType,\n      offset: pointSubtract(elementPositionsById[elementId], rootPosition),\n      outputs: mapValues(outputs, (pins) =>\n        pins\n          .filter((x) => elementIsSelected(x.elementId))\n          .map((pin) => {\n            const connId = connectionIdFromInputPinSelector(appState, pin);\n            const jointIds = connId\n              ? wireJointIdsFromConnectionIdSelector(appState, connId)\n              : [];\n            const joints = jointIds\n              .map((id) => wireJointPositionFromJointIdSelector(appState, id))\n              .map((jointPos) => pointSubtract(jointPos, rootPosition));\n            return {\n              pin: {\n                elementId: copyIds[pin.elementId],\n                pinId: pin.pinId,\n              },\n              joints,\n            };\n          })\n      ),\n    };\n    return copyElement;\n  });\n\n  return {\n    ...state,\n    clipboardElements: copyElements,\n    clipboardPasteOrigin: rootPosition,\n  };\n});\n","import { AnyAction } from \"redux\";\nimport zipObject from \"lodash/zipObject\";\nimport map from \"lodash/map\";\nimport values from \"lodash/values\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nimport { pointAdd, snapPoint } from \"@/geometry\";\nimport { AppState, defaultAppState } from \"@/store\";\nimport { fpSet } from \"@/utils\";\n\nimport rootReducer from \"@/store/reducer\";\n\nimport { addElement } from \"@/actions/element-add\";\nimport { attachWire } from \"@/actions/wire-attach\";\nimport { isPasteAction } from \"@/actions/clipboard-paste\";\nimport { selectElements } from \"@/actions/select-elements\";\n\nimport { gridElementSnapSelector } from \"@/services/circuit-editor-drag/selectors/snap\";\nimport { activeCircuitIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nexport default function clipboardPasteReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isPasteAction(action)) {\n    return state;\n  }\n\n  const circuitId = activeCircuitIdSelector(state);\n  if (!circuitId) {\n    return state;\n  }\n\n  const { clipboardElements, clipboardPasteOrigin } = state.services.clipboard;\n\n  if (!clipboardElements.length) {\n    return state;\n  }\n\n  let { pastePosition } = action.payload;\n\n  const gridSnap = gridElementSnapSelector(state);\n  if (!pastePosition) {\n    pastePosition = pointAdd(clipboardPasteOrigin, {\n      x: gridSnap,\n      y: gridSnap,\n    });\n  } else {\n    pastePosition = snapPoint(pastePosition, gridSnap);\n  }\n\n  const pasteIds = zipObject(\n    clipboardElements.map((x) => x.id),\n    map(clipboardElements, () => uuidV4())\n  );\n\n  // Two passes: Create and Wire.\n\n  // Create the elements.\n  for (const element of clipboardElements) {\n    const { id, elementType: elementType, offset } = element;\n    const p = pointAdd(pastePosition, offset);\n    state = rootReducer(\n      state,\n      addElement(elementType, circuitId, p, { elementId: pasteIds[id] })\n    );\n  }\n\n  // Wire the elements\n  for (const element of clipboardElements) {\n    const { id, outputs } = element;\n    const sourceId = pasteIds[id];\n    for (const outputPin of Object.keys(outputs)) {\n      for (const output of outputs[outputPin]) {\n        const {\n          pin: { elementId: targetCopyId, pinId: targetPin },\n          joints,\n        } = output;\n        const targetId = pasteIds[targetCopyId];\n        state = rootReducer(\n          state,\n          attachWire(\n            { elementId: sourceId, pinId: outputPin },\n            { elementId: targetId, pinId: targetPin },\n            {\n              joints: joints.map((jointPos) =>\n                pointAdd(jointPos, pastePosition!)\n              ),\n            }\n          )\n        );\n      }\n    }\n  }\n\n  state = fpSet(\n    state,\n    \"services\",\n    \"clipboard\",\n    \"clipboardPasteOrigin\",\n    pastePosition\n  );\n  state = rootReducer(state, selectElements(values(pasteIds)));\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_DIALOG_RESPONSE_ACCEPT = \"@dialog/response/accept\" as const;\nexport const acceptDialog = (result: any) => ({\n  type: ACTION_DIALOG_RESPONSE_ACCEPT,\n  payload: { result },\n});\nexport type AcceptDialogAction = ReturnType<typeof acceptDialog>;\nexport function isAcceptDialogAction(\n  action: AnyAction\n): action is AcceptDialogAction {\n  return action.type === ACTION_DIALOG_RESPONSE_ACCEPT;\n}\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createDialogReducer = createServiceReducerCreator(\"dialog\");\nexport const createDialogSelector = createServiceSelectorCreator(\"dialog\");\n","import { isAcceptDialogAction } from \"@/actions/dialog-response-accept\";\n\nimport { defaultDialogServiceState } from \"../state\";\nimport { createDialogReducer } from \"../utils\";\n\nexport default createDialogReducer((state, action) => {\n  if (!isAcceptDialogAction(action)) {\n    return state;\n  }\n\n  return defaultDialogServiceState;\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_DIALOG_RESPONSE_CANCEL = \"@dialog/response/cancel\" as const;\nexport const cancelDialog = () => ({\n  type: ACTION_DIALOG_RESPONSE_CANCEL,\n});\nexport type CancelDialogAction = ReturnType<typeof cancelDialog>;\nexport function isCancelDialogAction(\n  action: AnyAction\n): action is CancelDialogAction {\n  return action.type === ACTION_DIALOG_RESPONSE_CANCEL;\n}\n","import { isCancelDialogAction } from \"@/actions/dialog-response-cancel\";\n\nimport { defaultDialogServiceState } from \"../state\";\nimport { createDialogReducer } from \"../utils\";\n\nexport default createDialogReducer((state, action) => {\n  if (!isCancelDialogAction(action)) {\n    return state;\n  }\n\n  return defaultDialogServiceState;\n});\n","import { AnyAction } from \"redux\";\n\nimport { DialogType } from \"@/dialogs/types\";\n\nexport const ACTION_DIALOG_SHOW = \"@dialog/show\" as const;\nexport const showDialog = (dialogType: DialogType, data: any) => ({\n  type: ACTION_DIALOG_SHOW,\n  payload: { dialogType, data },\n});\nexport type ShowDialogAction = ReturnType<typeof showDialog>;\nexport function isShowDialogAction(\n  action: AnyAction\n): action is ShowDialogAction {\n  return action.type === ACTION_DIALOG_SHOW;\n}\n","import { concatReducers } from \"@/store/utils\";\n\nimport dialogResponseAcceptReducer from \"./dialog-response-accept\";\nimport dialogResponseCancelReducer from \"./dialog-response-cancel\";\nimport dialogShowReducer from \"./dialog-show\";\n\nexport default concatReducers(\n  dialogResponseAcceptReducer,\n  dialogResponseCancelReducer,\n  dialogShowReducer\n);\n","import { isShowDialogAction } from \"@/actions/dialog-show\";\nimport { createDialogReducer } from \"../utils\";\n\nexport default createDialogReducer((state, action) => {\n  if (!isShowDialogAction(action)) {\n    return state;\n  }\n\n  const { dialogType, data } = action.payload;\n\n  return {\n    ...state,\n    dialogType,\n    data,\n  };\n});\n","import { isAddCircuitAction } from \"@/actions/circuit-add\";\n\nimport { createCircuitGraphReducer } from \"../utils\";\n\nexport default createCircuitGraphReducer((state, action) => {\n  if (!isAddCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitId } = action.payload;\n  return {\n    ...state,\n    elementIdsByCircuitId: {\n      ...state.elementIdsByCircuitId,\n      [circuitId]: [],\n    },\n  };\n});\n","import pick from \"lodash/pick\";\nimport difference from \"lodash/difference\";\nimport pickBy from \"lodash/pickBy\";\nimport flatMap from \"lodash/flatMap\";\nimport mapValues from \"lodash/mapValues\";\n\nimport { AppState } from \"@/store\";\n\nimport { CircuitGraphServiceState } from \"../../state\";\nimport { Connection, elementPinEquals } from \"../../types\";\nimport { elementPinsFromPinElementSelector } from \"../../selectors/pins\";\n\nexport default function elementDelete(\n  state: CircuitGraphServiceState,\n  elementIds: string[],\n  rootState: AppState\n): CircuitGraphServiceState {\n  const remainingElementIds = difference(\n    Object.keys(state.elementsById),\n    elementIds\n  );\n\n  const removedIcPins = flatMap(elementIds, (elementId) =>\n    elementPinsFromPinElementSelector(rootState, elementId)\n  );\n\n  function isRemainingConnection({ inputPin, outputPin }: Connection) {\n    if (\n      elementIds.indexOf(inputPin.elementId) !== -1 ||\n      elementIds.indexOf(outputPin.elementId) !== -1\n    ) {\n      // Connection went to a removed element\n      return false;\n    }\n\n    // Connection was to a removed element pin\n    if (\n      removedIcPins.some(\n        (pin) =>\n          elementPinEquals(pin, inputPin) || elementPinEquals(pin, outputPin)\n      )\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  const elementIdsByCircuitId = mapValues(\n    state.elementIdsByCircuitId,\n    (circuitElementIds) => difference(circuitElementIds, elementIds)\n  );\n\n  return {\n    ...state,\n    elementsById: pick(state.elementsById, remainingElementIds),\n    connectionsById: pickBy(state.connectionsById, isRemainingConnection),\n    elementIdsByCircuitId,\n  };\n}\n","import pick from \"lodash/pick\";\nimport { isDeleteCircuitAction } from \"@/actions/circuit-delete\";\n\nimport { circuitIdToElementType } from \"@/elements/definitions/integrated-circuits/utils\";\n\nimport { createCircuitGraphReducer } from \"../utils\";\n\nimport elementDelete from \"./operations/element-delete\";\n\nexport default createCircuitGraphReducer((state, action, rootState) => {\n  if (!isDeleteCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitId } = action.payload;\n  const remainingCircuitIds = Object.keys(state.elementIdsByCircuitId).filter(\n    (x) => x !== circuitId\n  );\n\n  const elementIdsForCircuit = state.elementIdsByCircuitId[circuitId] ?? [];\n\n  const circuitElementType = circuitIdToElementType(circuitId);\n  const elementIdsOfCircuit = Object.keys(state.elementsById).filter(\n    (id) => state.elementsById[id].elementType === circuitElementType\n  );\n\n  const removedElementIds = [...elementIdsForCircuit, ...elementIdsOfCircuit];\n\n  state = elementDelete(state, removedElementIds, rootState);\n\n  return {\n    ...state,\n    elementIdsByCircuitId: pick(\n      state.elementIdsByCircuitId,\n      remainingCircuitIds\n    ),\n  };\n});\n","import { AppReducer } from \"./types\";\n\nexport const PRIORITY_PRE = -10;\nexport const PRIORITY_POST = 10;\nexport const PRIORITY_SAVE = 50;\n\nexport function reducerPriority(\n  priority: number,\n  reducer: AppReducer\n): AppReducer {\n  reducer.weight = priority;\n  return reducer;\n}\n\nexport function priorityBefore(reducer: AppReducer) {\n  return (reducer.weight ?? 0) - 1;\n}\n","import { AnyAction } from \"redux\";\n\nimport { reducerPriority, PRIORITY_PRE } from \"@/store/priorities\";\n\nimport { isAddElementAction } from \"@/actions/element-add\";\n\nimport { createCircuitGraphReducer } from \"../utils\";\n\nexport default reducerPriority(\n  PRIORITY_PRE,\n  createCircuitGraphReducer((state, action: AnyAction) => {\n    if (!isAddElementAction(action)) {\n      return state;\n    }\n\n    const { elementId, elementType, elementName, circuitId } = action.payload;\n    return {\n      ...state,\n      elementsById: {\n        ...state.elementsById,\n        [elementId]: {\n          elementType,\n          elementName: elementName ?? null,\n        },\n      },\n      elementIdsByCircuitId: {\n        ...state.elementIdsByCircuitId,\n        [circuitId]: [...state.elementIdsByCircuitId[circuitId], elementId],\n      },\n    };\n  })\n);\n","import { isDeleteElementAction } from \"@/actions/element-delete\";\n\nimport { createCircuitGraphReducer } from \"../utils\";\n\nimport elementDelete from \"./operations/element-delete\";\n\n// We need to know what circuit the element was a part of\nexport default createCircuitGraphReducer((state, action, rootState) => {\n  if (!isDeleteElementAction(action)) {\n    return state;\n  }\n\n  const { elementIds } = action.payload;\n\n  return elementDelete(state, elementIds, rootState);\n});\n","import { AnyAction } from \"redux\";\n\nimport { isRenameElementAction } from \"@/actions/element-rename\";\n\nimport { createCircuitGraphReducer } from \"../utils\";\n\nexport default createCircuitGraphReducer((state, action: AnyAction) => {\n  if (!isRenameElementAction(action)) {\n    return state;\n  }\n\n  const { elementId } = action.payload;\n  if (!state.elementsById[elementId]) {\n    return state;\n  }\n\n  let elementName: string | null = action.payload.elementName;\n  if (!elementName && elementName.trim() === \"\") {\n    elementName = null;\n  }\n\n  return {\n    ...state,\n    elementsById: {\n      ...state.elementsById,\n      [elementId]: {\n        ...state.elementsById[elementId],\n        elementName: elementName,\n      },\n    },\n  };\n});\n","import { concatReducers } from \"@/store/utils\";\n\nimport circuitAddReducer from \"./circuit-add\";\nimport circuitDeleteReducer from \"./circuit-delete\";\nimport elementAddReducer from \"./element-add\";\nimport elementDeleteReducer from \"./element-delete\";\nimport elementRenameReducer from \"./element-rename\";\nimport projectNewReducer from \"./project-new\";\nimport wireAttachReducer from \"./wire-attach\";\nimport wireDetatchReducer from \"./wire-detatch\";\n\nconst graphReducer = concatReducers(\n  circuitAddReducer,\n  circuitDeleteReducer,\n  elementAddReducer,\n  projectNewReducer,\n  elementDeleteReducer,\n  elementRenameReducer,\n  wireAttachReducer,\n  wireDetatchReducer\n);\n\nexport default graphReducer;\n","import { isNewProjectAction } from \"@/actions/project-new\";\n\nimport { createCircuitGraphReducer } from \"../utils\";\nimport { defaultCircuitGraphServiceState } from \"../state\";\n\nexport default createCircuitGraphReducer((state, action) => {\n  if (!isNewProjectAction(action)) {\n    return state;\n  }\n\n  return defaultCircuitGraphServiceState;\n});\n","import find from \"lodash/find\";\n\nimport { AppState } from \"@/store\";\n\nimport { isAttachWireAction } from \"@/actions/wire-attach\";\n\nimport { elementDefinitionFromTypeSelector } from \"@/services/element-types/selectors/element-types\";\n\nimport { createCircuitGraphReducer } from \"../utils\";\nimport { Connection, ElementPin, elementPinEquals } from \"../types\";\nimport { CircuitGraphServiceState } from \"../state\";\n\nexport default createCircuitGraphReducer((state, action, rootState) => {\n  if (!isAttachWireAction(action)) {\n    return state;\n  }\n\n  const { connectionId, p1, p2 } = action.payload;\n  const conn = pinsToConnection(state, p1, p2, rootState);\n  if (!conn) {\n    return state;\n  }\n\n  const { inputPin } = conn;\n\n  // Only one source per input.\n  if (\n    find(state.connectionsById, (c) => elementPinEquals(c.inputPin, inputPin))\n  ) {\n    return state;\n  }\n\n  return {\n    ...state,\n    connectionsById: {\n      ...state.connectionsById,\n      [connectionId]: {\n        id: connectionId,\n        ...conn,\n      },\n    },\n  };\n});\n\n/**\n * Check two pins to see if they can form a valid connection.\n * Returns null if no connection can be made (both inputs or both outputs)\n *\n * Does not check to see if the pins are already connected, or other connections prevent this connection from forming.\n */\nexport function pinsToConnection(\n  state: CircuitGraphServiceState,\n  p1: ElementPin,\n  p2: ElementPin,\n  rootState: AppState\n): Connection | null {\n  const p1Node = state.elementsById[p1.elementId];\n  const p2Node = state.elementsById[p2.elementId];\n\n  if (!p1Node || !p2Node) {\n    return null;\n  }\n\n  const p1Def = elementDefinitionFromTypeSelector(\n    rootState,\n    p1Node.elementType\n  );\n  const p2Def = elementDefinitionFromTypeSelector(\n    rootState,\n    p2Node.elementType\n  );\n\n  if (!p1Def || !p2Def) {\n    return null;\n  }\n\n  const p1Pin = p1Def.pins[p1.pinId];\n  const p2Pin = p2Def.pins[p2.pinId];\n\n  if (!p1Pin || !p2Pin) {\n    return null;\n  }\n\n  // Pins are in same direction and cannot be connected.\n  if (p1Pin.direction === p2Pin.direction) {\n    return null;\n  }\n\n  const outputPin = p1Pin.direction === \"output\" ? p1 : p2;\n  const inputPin = p1Pin.direction === \"input\" ? p1 : p2;\n\n  return {\n    outputPin,\n    inputPin,\n  };\n}\n","import pick from \"lodash/pick\";\n\nimport { isDetatchWireAction } from \"@/actions/wire-detatch\";\n\nimport { createCircuitGraphReducer } from \"../utils\";\n\nexport default createCircuitGraphReducer((state, action) => {\n  if (!isDetatchWireAction(action)) {\n    return state;\n  }\n\n  const { connectionId } = action.payload;\n\n  const remainingIds = Object.keys(state.connectionsById).filter(\n    (x) => x !== connectionId\n  );\n\n  return {\n    ...state,\n    connectionsById: pick(state.connectionsById, remainingIds),\n  };\n});\n","import { fpSet } from \"@/utils\";\n\nimport { ZeroPoint } from \"@/geometry\";\nimport { isAddElementAction } from \"@/actions/element-add\";\n\nimport { createCircuitLayoutReducer } from \"../utils\";\n\nexport default createCircuitLayoutReducer((state, action) => {\n  if (!isAddElementAction(action)) {\n    return state;\n  }\n  const { elementId, position = ZeroPoint } = action.payload;\n\n  return fpSet(state, \"elementPositionsById\", elementId, position);\n});\n","import { priorityBefore, reducerPriority } from \"@/store/priorities\";\n\nimport { isDeleteElementAction } from \"@/actions/element-delete\";\n\nimport circuitGraphElementDeleteReducer from \"@/services/circuit-graph/reducer/element-delete\";\n\nimport { createCircuitLayoutReducer } from \"../utils\";\n\nimport elementDeleteOperation from \"./operations/element-delete\";\n\n// We need to run this reducer before graph runs, as we want to check what wires are connected to the element being deleted.\nexport default reducerPriority(\n  priorityBefore(circuitGraphElementDeleteReducer),\n  createCircuitLayoutReducer((state, action, rootState) => {\n    if (!isDeleteElementAction(action)) {\n      return state;\n    }\n\n    const { elementIds } = action.payload;\n\n    return elementDeleteOperation(state, elementIds, rootState);\n  })\n);\n","import difference from \"lodash/difference\";\nimport pick from \"lodash/pick\";\nimport flatMap from \"lodash/flatMap\";\n\nimport { AppState } from \"@/store\";\n\nimport {\n  connectionsByIdSelector,\n  elementInputConnectionIdsFromElementIdSelector,\n  elementOutputConnectionIdsFromElementIdSelector,\n} from \"@/services/circuit-graph/selectors/connections\";\n\nimport { CircuitLayoutServiceState } from \"../../state\";\nimport { elementPinsFromPinElementSelector } from \"@/services/circuit-graph/selectors/pins\";\nimport { elementPinEquals } from \"@/services/circuit-graph/types\";\n\nexport default function elementDelete(\n  state: CircuitLayoutServiceState,\n  elementIds: string[],\n  rootState: AppState\n): CircuitLayoutServiceState {\n  // Connection ids connected to elements being removed.\n  const removingElementConnectionIds = elementIds.reduce(\n    (connectionIds, elementId) => {\n      // Get all inputs and outputs to the element.\n      const inputs = elementInputConnectionIdsFromElementIdSelector(\n        rootState,\n        elementId\n      );\n      const outputs = elementOutputConnectionIdsFromElementIdSelector(\n        rootState,\n        elementId\n      );\n\n      connectionIds.push(...inputs, ...outputs);\n\n      return connectionIds;\n    },\n    [] as string[]\n  );\n\n  // Connections going to IC element pins whose pin elements were removed.\n  const removedIcPins = flatMap(elementIds, (elementId) =>\n    // If not a pin, this will return an empty array.\n    elementPinsFromPinElementSelector(rootState, elementId)\n  );\n  const connectionsById = connectionsByIdSelector(rootState);\n  const removingPinConnectionIds = Object.keys(connectionsById).filter(\n    (connectionId) => {\n      const { inputPin, outputPin } = connectionsById[connectionId];\n      // We will need to remove this connection if it went to a pin generated by\n      // an input or output pin element being removed.\n      return removedIcPins.some(\n        (removedPin) =>\n          elementPinEquals(removedPin, inputPin) ||\n          elementPinEquals(removedPin, outputPin)\n      );\n    }\n  );\n\n  const removingConnectionIds = [\n    ...removingElementConnectionIds,\n    ...removingPinConnectionIds,\n  ];\n\n  // Remove any joint that is part of a removed connection.\n  const removingJointIds = removingConnectionIds.reduce(\n    (jointIds, connectionId) => {\n      jointIds.push(...state.wireJointIdsByConnectionId[connectionId]);\n      return jointIds;\n    },\n    [] as string[]\n  );\n\n  const remainingConnectionIds = difference(\n    Object.keys(state.wireJointIdsByConnectionId),\n    removingElementConnectionIds\n  );\n\n  const remainingJointIds = difference(\n    Object.keys(state.wireJointPositionsByJointId),\n    removingJointIds\n  );\n\n  const remainingElementIds = difference(\n    Object.keys(state.elementPositionsById),\n    elementIds\n  );\n\n  return {\n    ...state,\n    elementPositionsById: pick(state.elementPositionsById, remainingElementIds),\n    wireJointIdsByConnectionId: pick(\n      state.wireJointIdsByConnectionId,\n      remainingConnectionIds\n    ),\n    wireJointPositionsByJointId: pick(\n      state.wireJointPositionsByJointId,\n      remainingJointIds\n    ),\n  };\n}\n","import { AnyAction } from \"redux\";\n\nimport { asArray, MaybeArray } from \"@/arrays\";\nimport { Point } from \"@/geometry\";\n\nexport interface MoveElementOpts {\n  relative?: boolean;\n  snapMode?: \"none\" | \"element\";\n}\nexport const ACTION_ELEMENT_MOVE = \"@element/move\" as const;\nexport const moveElement = (\n  elementId: MaybeArray<string>,\n  position: Point,\n  opts: MoveElementOpts = {}\n) => ({\n  type: ACTION_ELEMENT_MOVE,\n  payload: {\n    elementIds: asArray(elementId),\n    position,\n    relative: opts.relative ?? false,\n    snapMode: opts.snapMode ?? \"none\",\n  },\n});\nexport type MoveElementAction = ReturnType<typeof moveElement>;\nexport function isMoveElementAction(\n  action: AnyAction\n): action is MoveElementAction {\n  return action.type === ACTION_ELEMENT_MOVE;\n}\n","import mapValues from \"lodash/mapValues\";\nimport pick from \"lodash/pick\";\n\nimport { isMoveElementAction } from \"@/actions/element-move\";\n\nimport { applyGridElementSnapSelector } from \"@/services/circuit-editor-drag/selectors/snap\";\n\nimport { createCircuitLayoutReducer } from \"../utils\";\n\nexport default createCircuitLayoutReducer((state, action, appState) => {\n  if (!isMoveElementAction(action)) {\n    return state;\n  }\n\n  const { elementIds, position, relative, snapMode } = action.payload;\n\n  const movedElementPositions = mapValues(\n    pick(state.elementPositionsById, elementIds),\n    (p) => {\n      let movedP = {\n        x: relative ? p.x + position.x : position.x,\n        y: relative ? p.y + position.y : position.y,\n      };\n      if (snapMode === \"element\") {\n        movedP = applyGridElementSnapSelector(appState, movedP);\n      }\n      return movedP;\n    }\n  );\n\n  return {\n    ...state,\n    elementPositionsById: {\n      ...state.elementPositionsById,\n      ...movedElementPositions,\n    },\n  };\n});\n","import { concatReducers } from \"@/store/utils\";\n\nimport elementAddReducer from \"./element-add\";\nimport elementDeleteReducer from \"./element-delete\";\nimport elementMoveReducer from \"./element-move\";\nimport projectNewReducer from \"./project-new\";\nimport wireAttachReducer from \"./wire-attach\";\nimport wireDetatchReducer from \"./wire-detatch\";\nimport wireJointAddReducer from \"./wire-joint-add\";\nimport wireJointDeleteReducer from \"./wire-joint-delete\";\nimport wireJointMoveReducer from \"./wire-joint-move\";\n\nconst fieldReducer = concatReducers(\n  elementAddReducer,\n  projectNewReducer,\n  elementDeleteReducer,\n  elementMoveReducer,\n  wireAttachReducer,\n  wireDetatchReducer,\n  wireJointAddReducer,\n  wireJointDeleteReducer,\n  wireJointMoveReducer\n);\n\nexport default fieldReducer;\n","import { isNewProjectAction } from \"@/actions/project-new\";\n\nimport { createCircuitLayoutReducer } from \"../utils\";\nimport { defaultCircuitLayoutServiceState } from \"../state\";\n\nexport default createCircuitLayoutReducer((state, action) => {\n  if (!isNewProjectAction(action)) {\n    return state;\n  }\n\n  return defaultCircuitLayoutServiceState;\n});\n","import { v4 as uuidV4 } from \"uuid\";\nimport zipObject from \"lodash/zipObject\";\n\nimport { isAttachWireAction } from \"@/actions/wire-attach\";\nimport { fpSet } from \"@/utils\";\n\nimport { createCircuitLayoutReducer } from \"../utils\";\n\nexport default createCircuitLayoutReducer((state, action) => {\n  if (!isAttachWireAction(action)) {\n    return state;\n  }\n\n  const { connectionId, joints } = action.payload;\n\n  // Might want to use addWireJoint action, but field is the only thing that cares about joints.\n  if (joints.length > 0) {\n    const jointIds = joints.map(() => uuidV4());\n    state = fpSet(state, \"wireJointIdsByConnectionId\", connectionId, jointIds);\n    state = fpSet(state, \"wireJointPositionsByJointId\", (value) => ({\n      ...value,\n      ...zipObject(jointIds, joints),\n    }));\n  } else {\n    state = fpSet(state, \"wireJointIdsByConnectionId\", connectionId, []);\n  }\n\n  return state;\n});\n","import pick from \"lodash/pick\";\nimport difference from \"lodash/difference\";\n\nimport { isDetatchWireAction } from \"@/actions/wire-detatch\";\n\nimport { createCircuitLayoutReducer } from \"../utils\";\n\nexport default createCircuitLayoutReducer((state, action) => {\n  if (!isDetatchWireAction(action)) {\n    return state;\n  }\n\n  const { connectionId } = action.payload;\n\n  const remainingConnectionIds = Object.keys(\n    state.wireJointIdsByConnectionId\n  ).filter((x) => x != connectionId);\n\n  const remainingJointIds = difference(\n    Object.keys(state.wireJointPositionsByJointId),\n    state.wireJointIdsByConnectionId[connectionId]\n  );\n\n  return {\n    ...state,\n    wireJointIdsByConnectionId: pick(\n      state.wireJointIdsByConnectionId,\n      remainingConnectionIds\n    ),\n    wireJointPositionsByJointId: pick(\n      state.wireJointPositionsByJointId,\n      remainingJointIds\n    ),\n  };\n});\n","import { isAddWireJointAction } from \"@/actions/wire-joint-add\";\n\nimport { createCircuitLayoutReducer } from \"../utils\";\n\nexport default createCircuitLayoutReducer((state, action) => {\n  if (!isAddWireJointAction(action)) {\n    return state;\n  }\n\n  const { connectionId, addAfterJointId, position, jointId } = action.payload;\n  let wireJoints = state.wireJointIdsByConnectionId[connectionId];\n  const insertionIndex = addAfterJointId\n    ? wireJoints.indexOf(addAfterJointId) + 1\n    : 0;\n\n  wireJoints = [\n    ...wireJoints.slice(0, insertionIndex),\n    jointId,\n    ...wireJoints.slice(insertionIndex),\n  ];\n\n  return {\n    ...state,\n    wireJointIdsByConnectionId: {\n      ...state.wireJointIdsByConnectionId,\n      [connectionId]: wireJoints,\n    },\n    wireJointPositionsByJointId: {\n      ...state.wireJointPositionsByJointId,\n      [jointId]: position,\n    },\n  };\n});\n","import pick from \"lodash/pick\";\nimport mapValues from \"lodash/mapValues\";\n\nimport { isDeleteWireJointAction } from \"@/actions/wire-joint-delete\";\n\nimport { createCircuitLayoutReducer } from \"../utils\";\n\nexport default createCircuitLayoutReducer((state, action) => {\n  if (!isDeleteWireJointAction(action)) {\n    return state;\n  }\n\n  const { jointId } = action.payload;\n\n  const remainingJointIds = Object.keys(\n    state.wireJointPositionsByJointId\n  ).filter((x) => x !== jointId);\n\n  return {\n    ...state,\n    wireJointIdsByConnectionId: mapValues(\n      state.wireJointIdsByConnectionId,\n      (connectionIds) => connectionIds.filter((x) => x !== jointId)\n    ),\n    wireJointPositionsByJointId: pick(\n      state.wireJointPositionsByJointId,\n      remainingJointIds\n    ),\n  };\n});\n","import mapValues from \"lodash/mapValues\";\nimport pick from \"lodash/pick\";\n\nimport { isMoveWireJointAction } from \"@/actions/wire-joint-move\";\n\nimport { createCircuitLayoutReducer } from \"../utils\";\nimport {\n  applyGridJointSnapSelector,\n  applyGridElementSnapSelector,\n} from \"@/services/circuit-editor-drag/selectors/snap\";\n\nexport default createCircuitLayoutReducer((state, action, appState) => {\n  if (!isMoveWireJointAction(action)) {\n    return state;\n  }\n\n  const { jointIds, position, relative, snapMode } = action.payload;\n\n  const movedJoints = mapValues(\n    pick(state.wireJointPositionsByJointId, jointIds),\n    (p) => {\n      let movedP = {\n        x: relative ? p.x + position.x : position.x,\n        y: relative ? p.y + position.y : position.y,\n      };\n\n      if (snapMode === \"element\") {\n        movedP = applyGridElementSnapSelector(appState, movedP);\n      } else if (snapMode === \"joint\") {\n        movedP = applyGridJointSnapSelector(appState, movedP);\n      }\n\n      return movedP;\n    }\n  );\n\n  return {\n    ...state,\n    wireJointPositionsByJointId: {\n      ...state.wireJointPositionsByJointId,\n      ...movedJoints,\n    },\n  };\n});\n","import { concatReducers } from \"@/store/utils\";\n\nimport circuitAddReducer from \"./circuit-add\";\nimport circuitDeleteReducer from \"./circuit-delete\";\nimport circuitRenameReducer from \"./circuit-rename\";\nimport projectNewReducer from \"./project-new\";\n\nexport default concatReducers(\n  circuitAddReducer,\n  circuitDeleteReducer,\n  circuitRenameReducer,\n  projectNewReducer\n);\n","import { isAddCircuitAction } from \"@/actions/circuit-add\";\nimport { createCircuitPropertiesReducer } from \"../utils\";\n\nexport default createCircuitPropertiesReducer((state, action) => {\n  if (!isAddCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitId } = action.payload;\n  let circuitName = action.payload.circuitName;\n\n  if (!circuitName) {\n    circuitName = `Circuit ${\n      Object.keys(state.circuitNamesByCircuitId).length + 1\n    }`;\n  }\n\n  return {\n    ...state,\n    circuitNamesByCircuitId: {\n      ...state.circuitNamesByCircuitId,\n      [circuitId]: circuitName,\n    },\n  };\n});\n","import pick from \"lodash/pick\";\n\nimport { isDeleteCircuitAction } from \"@/actions/circuit-delete\";\n\nimport { createCircuitPropertiesReducer } from \"../utils\";\n\nexport default createCircuitPropertiesReducer((state, action) => {\n  if (!isDeleteCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitId } = action.payload;\n\n  const remainingCircuitIds = Object.keys(state.circuitNamesByCircuitId).filter(\n    (x) => x !== circuitId\n  );\n\n  return {\n    ...state,\n    circuitNamesByCircuitId: pick(\n      state.circuitNamesByCircuitId,\n      remainingCircuitIds\n    ),\n  };\n});\n","import { isRenameCircuitAction } from \"@/actions/circuit-rename\";\nimport { createCircuitPropertiesReducer } from \"../utils\";\n\nexport default createCircuitPropertiesReducer((state, action) => {\n  if (!isRenameCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitId, circuitName } = action.payload;\n\n  const trimmedName = circuitName.trim();\n\n  if (trimmedName === \"\") {\n    return state;\n  }\n\n  return {\n    ...state,\n    circuitNamesByCircuitId: {\n      ...state.circuitNamesByCircuitId,\n      [circuitId]: trimmedName,\n    },\n  };\n});\n","import { isNewProjectAction } from \"@/actions/project-new\";\n\nimport { ROOT_CIRCUIT_ID } from \"../../circuits/constants\";\nimport { createCircuitPropertiesReducer } from \"../utils\";\n\nexport default createCircuitPropertiesReducer((state, action) => {\n  if (!isNewProjectAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    circuitNamesByCircuitId: {\n      [ROOT_CIRCUIT_ID]: \"Root\",\n    },\n    elementIdsByCircuitId: {\n      [ROOT_CIRCUIT_ID]: [],\n    },\n  };\n});\n","import { AnyAction } from \"redux\";\n\nimport { asArray, MaybeArray } from \"@/arrays\";\n\nimport { SaveData } from \"@/services/savedata/types\";\n\nexport const ACTION_CIRCUIT_IMPORT = \"@circuit/import\" as const;\nexport const importCircuits = (\n  circuitId: MaybeArray<string>,\n  saveData: SaveData\n) => ({\n  type: ACTION_CIRCUIT_IMPORT,\n  payload: { circuitIds: asArray(circuitId), saveData },\n});\nexport type ImportCircuitAction = ReturnType<typeof importCircuits>;\nexport function isImportCircuitAction(\n  action: AnyAction\n): action is ImportCircuitAction {\n  return action.type === ACTION_CIRCUIT_IMPORT;\n}\n","import * as yup from \"yup\";\n\nimport { Point, pointSchema } from \"@/geometry\";\n\nimport { ElementPin, elementPinSchema } from \"../circuit-graph/types\";\n\nexport interface SaveCircuit {\n  circuitId: string;\n  circuitName: string;\n}\nexport const saveCircuitSchema = yup.object().shape({\n  circuitId: yup.string().required().min(1),\n  circuitName: yup.string().required().min(1),\n});\n\nexport interface SaveElement {\n  elementId: string;\n  elementType: string;\n  elementName: string | null;\n  circuitId: string;\n  x: number;\n  y: number;\n}\nexport const saveElementSchema = yup.object().shape({\n  elementId: yup.string().required().min(1),\n  elementType: yup.string().required().min(1),\n  elementName: yup.string().nullable().min(1),\n  circuitId: yup.string().required().min(1),\n  x: yup.number().required(),\n  y: yup.number().required(),\n});\n\nexport interface SaveWire {\n  output: ElementPin;\n  input: ElementPin;\n  joints: Point[];\n}\nexport const saveWireSchema = yup.object().shape({\n  output: elementPinSchema.required(),\n  input: elementPinSchema.required(),\n  // Cannot make this required, as yup says required on an array is min length 1...\n  joints: yup.array().of(pointSchema),\n});\n\nexport interface SaveData {\n  circuits: SaveCircuit[];\n  elements: SaveElement[];\n  wires: SaveWire[];\n}\nexport const saveDataSchema = yup.object().shape({\n  circuits: yup.array().of(saveCircuitSchema).min(0),\n  elements: yup.array().of(saveElementSchema).min(0),\n  wires: yup.array().of(saveWireSchema).min(0),\n});\n","export class SaveFormatError extends Error {\n  code: string;\n\n  constructor(message: string) {\n    super(message);\n    this.message = message;\n    this.code = \"SAVE_FORMAT_ERROR\";\n  }\n}\n","import {\n  SaveCircuit,\n  SaveData,\n  saveDataSchema,\n  SaveElement,\n  SaveWire,\n} from \"./types\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { addElement } from \"@/actions/element-add\";\nimport { attachWire } from \"@/actions/wire-attach\";\n\nimport {\n  elementIdsSelector,\n  elementFromElementIdSelector,\n} from \"../circuit-graph/selectors/elements\";\nimport {\n  connectionIdsSelector,\n  connectionFromConnectionIdSelector,\n} from \"../circuit-graph/selectors/connections\";\nimport { elementPositionFromElementIdSelector } from \"../circuit-layout/selectors/element-positions\";\nimport {\n  circuitIdsSelector,\n  circuitNameFromIdSelector,\n} from \"../circuit-properties/selectors/circuits\";\nimport { ROOT_CIRCUIT_ID } from \"../circuits/constants\";\n\nimport { circuitIdFromElementIdSelector } from \"../circuit-graph/selectors/elements\";\nimport {\n  wireJointPositionsByJointIdSelector,\n  wireJointIdsFromConnectionIdSelector,\n} from \"../circuit-layout/selectors/wires\";\n\nimport { SaveFormatError } from \"./errors\";\nimport { addCircuit } from \"@/actions/circuit-add\";\n\nexport function createSave(state: AppState): SaveData {\n  const jointPositions = wireJointPositionsByJointIdSelector(state);\n  return {\n    circuits: circuitIdsSelector(state).map((circuitId) => {\n      const circuitName = circuitNameFromIdSelector(state, circuitId);\n      const saveCircuit: SaveCircuit = {\n        circuitId,\n        circuitName,\n      };\n      return saveCircuit;\n    }),\n    elements: elementIdsSelector(state).map((elementId) => {\n      const element = elementFromElementIdSelector(state, elementId);\n      const position = elementPositionFromElementIdSelector(state, elementId);\n      const circuitId = circuitIdFromElementIdSelector(state, elementId);\n      const saveElement: SaveElement = {\n        elementId: elementId,\n        elementType: element.elementType,\n        elementName: element.elementName,\n        circuitId: circuitId ?? ROOT_CIRCUIT_ID,\n        x: position.x,\n        y: position.y,\n      };\n      return saveElement;\n    }),\n    wires: connectionIdsSelector(state).map((connectionId) => {\n      const wire = connectionFromConnectionIdSelector(state, connectionId);\n      const jointIds = wireJointIdsFromConnectionIdSelector(\n        state,\n        connectionId\n      );\n      const saveWire: SaveWire = {\n        input: wire.inputPin,\n        output: wire.outputPin,\n        joints: jointIds.map((jointId) => jointPositions[jointId]),\n      };\n      return saveWire;\n    }),\n  };\n}\n\nexport function loadSave(state: AppState, save: SaveData): AppState {\n  try {\n    saveDataSchema.validateSync(save);\n  } catch (e) {\n    throw new SaveFormatError(e.message);\n  }\n\n  // TODO: There may be some services that want to persist data across projects.\n  state = defaultAppState;\n\n  try {\n    state = (save.circuits ?? []).reduce(\n      (state, { circuitId, circuitName }) =>\n        rootReducer(state, addCircuit({ circuitId, circuitName })),\n      state\n    );\n\n    state = (save.elements ?? []).reduce(\n      (state, element) =>\n        rootReducer(\n          state,\n          addElement(\n            element.elementType,\n            element.circuitId,\n            { x: element.x, y: element.y },\n            {\n              elementId: element.elementId,\n              elementName: element.elementName ?? undefined,\n            }\n          )\n        ),\n      state\n    );\n\n    state = (save.wires ?? []).reduce(\n      (state, wire) =>\n        rootReducer(\n          state,\n          attachWire(wire.output, wire.input, { joints: wire.joints })\n        ),\n      state\n    );\n  } catch (e) {\n    console.error(\"Failed to rehydrate SaveData:\", e);\n    throw new SaveFormatError(\"Failed to load project.\");\n  }\n\n  return state;\n}\n\nexport function importCircuitsFromSave(\n  state: AppState,\n  circuitIds: string[],\n  save: SaveData\n): AppState {\n  try {\n    saveDataSchema.validateSync(save);\n  } catch (e) {\n    throw new SaveFormatError(e.message);\n  }\n\n  const existingCircuits = Object.keys(\n    state.services.circuitProperties.circuitNamesByCircuitId\n  );\n  const importCircuits = save.circuits.filter(\n    (c) =>\n      circuitIds.indexOf(c.circuitId) !== -1 &&\n      existingCircuits.indexOf(c.circuitId) === -1\n  );\n  if (importCircuits.length === 0) {\n    return state;\n  }\n\n  try {\n    state = importCircuits.reduce(\n      (state, { circuitId, circuitName }) =>\n        rootReducer(state, addCircuit({ circuitId, circuitName })),\n      state\n    );\n\n    const importNodes = (save.elements ?? []).filter((x) =>\n      importCircuits.some(({ circuitId }) => circuitId === x.circuitId)\n    );\n    state = importNodes.reduce(\n      (state, element) =>\n        rootReducer(\n          state,\n          addElement(\n            element.elementType,\n            element.circuitId,\n            { x: element.x, y: element.y },\n            {\n              elementId: element.elementId,\n              elementName: element.elementName ?? undefined,\n            }\n          )\n        ),\n      state\n    );\n\n    function isImportableWire(wire: SaveWire) {\n      return importNodes.some(\n        ({ elementId }) =>\n          wire.input.elementId === elementId ||\n          wire.output.elementId === elementId\n      );\n    }\n\n    const importWires = (save.wires ?? []).filter(isImportableWire);\n    state = importWires.reduce(\n      (state, wire) =>\n        rootReducer(\n          state,\n          attachWire(wire.output, wire.input, { joints: wire.joints })\n        ),\n      state\n    );\n  } catch (e) {\n    console.error(\"Failed to import circuit from SaveData:\", e);\n    throw new SaveFormatError(\"Failed to import circuit.\");\n  }\n\n  return state;\n}\n\nexport function storeAutosave(save: SaveData): void {\n  localStorage.setItem(\"autosave\", JSON.stringify(save));\n}\n\nexport function loadAutosave(): SaveData | null {\n  const str = localStorage.getItem(\"autosave\");\n  if (!str) {\n    return null;\n  }\n\n  try {\n    return JSON.parse(str);\n  } catch {\n    return null;\n  }\n}\n\nexport function deleteAutosave() {\n  localStorage.removeItem(\"autosave\");\n}\n","import circuitImportReducer from \"./circuit-import\";\n\nexport default circuitImportReducer;\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createTutorialReducer = createServiceReducerCreator(\"tutorial\");\nexport const createTutorialSelector = createServiceSelectorCreator(\"tutorial\");\n","import { createTutorialSelector } from \"../utils\";\n\nexport const isTutorialActiveSelector = createTutorialSelector(\n  (s) => s.activeTutorial != null\n);\n\nexport const tutorialAnnotationsSelector = createTutorialSelector(\n  (s) => s.annotatedElements\n);\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport { reducerPriority, PRIORITY_SAVE } from \"@/store/priorities\";\nimport { isProjectMutationAction } from \"@/project-mutation-actions\";\n\nimport { createSave, storeAutosave } from \"@/services/savedata/api\";\nimport { isTutorialActiveSelector } from \"@/services/tutorial/selectors/tutorial\";\n\nexport default reducerPriority(\n  PRIORITY_SAVE,\n  (state: AppState = defaultAppState, action: AnyAction): AppState => {\n    if (!isProjectMutationAction(action)) {\n      return state;\n    }\n\n    if (isTutorialActiveSelector(state)) {\n      return state;\n    }\n\n    // FIXME: Side effect.  Should be a saga.\n    const save = createSave(state);\n    storeAutosave(save);\n\n    return state;\n  }\n);\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createProjectReducer = createServiceReducerCreator(\"project\");\nexport const createProjectSelector = createServiceSelectorCreator(\"project\");\n","import { isProjectMutationAction } from \"@/project-mutation-actions\";\nimport { createProjectReducer } from \"../utils\";\n\nexport default createProjectReducer((state, action) => {\n  if (!isProjectMutationAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    projectModified: true,\n  };\n});\n","import { isNewProjectAction } from \"@/actions/project-new\";\n\nimport { deleteAutosave } from \"@/services/savedata/api\";\nimport { createProjectReducer } from \"../utils\";\n\nexport default createProjectReducer((state, action) => {\n  if (!isNewProjectAction(action)) {\n    return state;\n  }\n\n  // FIXME: Side effect, move to saga.\n  deleteAutosave();\n\n  return {\n    ...state,\n    projectName: \"New Project\",\n    projectModified: false,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_RENAME = \"@project/rename\" as const;\nexport const renameProject = (projectName: string) => ({\n  type: ACTION_PROJECT_RENAME,\n  payload: { projectName },\n});\nexport type RenameProjectAction = ReturnType<typeof renameProject>;\nexport function isRenameProjectAction(\n  action: AnyAction\n): action is RenameProjectAction {\n  return action.type === ACTION_PROJECT_RENAME;\n}\n","import { isRenameProjectAction } from \"@/actions/project-rename\";\n\nimport { createProjectReducer } from \"../utils\";\n\nexport default createProjectReducer((state, action) => {\n  if (!isRenameProjectAction(action)) {\n    return state;\n  }\n\n  let { projectName } = action.payload;\n  projectName = projectName.trim();\n\n  if (projectName === \"\") {\n    return state;\n  }\n\n  return {\n    ...state,\n    projectName,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_SAVE = \"@project/save\" as const;\nexport const saveProject = () => ({\n  type: ACTION_PROJECT_SAVE,\n});\nexport type SaveProjectAction = ReturnType<typeof saveProject>;\nexport function isSaveProjectAction(\n  action: AnyAction\n): action is SaveProjectAction {\n  return action.type === ACTION_PROJECT_SAVE;\n}\n\nexport const ACTION_PROJECT_SAVE_SUCCESS = \"@project/save:success\" as const;\nexport const saveProjectSuccess = () => ({\n  type: ACTION_PROJECT_SAVE_SUCCESS,\n});\nexport type SaveProjectSuccessAction = ReturnType<typeof saveProjectSuccess>;\nexport function isSaveProjectSuccessAction(\n  action: AnyAction\n): action is SaveProjectSuccessAction {\n  return action.type === ACTION_PROJECT_SAVE_SUCCESS;\n}\n","import { concatReducers } from \"@/store/utils\";\n\nimport autosaveReducer from \"./autosave\";\nimport initReducer from \"./init\";\nimport projectModifiedReducer from \"./project-modified\";\nimport projectNewReducer from \"./project-new\";\nimport projectReceiveReducer from \"./project-receive\";\nimport projectRenameReducer from \"./project-rename\";\nimport projectSaveSuccessReducer from \"./project-save-success\";\n\nexport default concatReducers(\n  autosaveReducer,\n  initReducer,\n  projectModifiedReducer,\n  projectNewReducer,\n  projectReceiveReducer,\n  projectRenameReducer,\n  projectSaveSuccessReducer\n);\n","import { AnyAction } from \"redux\";\nimport { AppState, defaultAppState } from \"@/store\";\n\nimport { isInitAction } from \"@/actions/init\";\n\nimport { loadAutosave, loadSave } from \"@/services/savedata/api\";\nimport { fpSet } from \"@/utils\";\n\nexport default function initReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isInitAction(action)) {\n    return state;\n  }\n\n  const save = loadAutosave();\n  if (!save) {\n    return state;\n  }\n\n  try {\n    state = loadSave(state, save);\n    state = fpSet(state, \"services\", \"project\", (state) => ({\n      ...state,\n      projectName: \"Previous Project\",\n      projectModified: true,\n    }));\n  } catch {\n    // TODO: Reprot error\n  }\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport { fpSet } from \"@/utils\";\n\nimport { isReceiveProjectAction } from \"@/actions/project-receive\";\n\nimport { loadSave } from \"@/services/savedata/api\";\n\nexport default function projectReceiveReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isReceiveProjectAction(action)) {\n    return state;\n  }\n\n  const { fileName, saveData } = action.payload;\n\n  try {\n    state = loadSave(state, saveData);\n    state = fpSet(state, \"services\", \"project\", (state) => ({\n      ...state,\n      projectName: fileName,\n      projectModified: false,\n    }));\n  } catch (e) {\n    // TODO: display error\n    console.error(\"Failed to load save\", e);\n  }\n\n  return state;\n}\n","import { isSaveProjectSuccessAction } from \"@/actions/project-save\";\nimport { createProjectReducer } from \"../utils\";\n\nexport default createProjectReducer((state, action) => {\n  if (!isSaveProjectSuccessAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    projectModified: false,\n  };\n});\n","import difference from \"lodash/difference\";\n\nimport { isDeleteElementAction } from \"@/actions/element-delete\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isDeleteElementAction(action)) {\n    return state;\n  }\n\n  const { elementIds } = action.payload;\n\n  return {\n    ...state,\n    selectedElementIds: difference(state.selectedElementIds, elementIds),\n    selectedConnectionIds: [], // Might be removing an element attached to a selected wire\n  };\n});\n","import { isNewProjectAction } from \"@/actions/project-new\";\n\nimport { createSelectionReducer } from \"../utils\";\nimport { defaultSelectionServiceState } from \"../state\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isNewProjectAction(action)) {\n    return state;\n  }\n\n  return defaultSelectionServiceState;\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SELECT_CLEAR = \"@select/all\" as const;\nexport const selectAll = () => ({\n  type: ACTION_SELECT_CLEAR,\n});\nexport type SelectAllAction = ReturnType<typeof selectAll>;\nexport function isSelectAllAction(\n  action: AnyAction\n): action is SelectAllAction {\n  return action.type === ACTION_SELECT_CLEAR;\n}\n","import flatten from \"lodash/flatten\";\n\nimport { isSelectAllAction } from \"@/actions/select-all\";\n\nimport {\n  connectionIdsSelector,\n  connectionsByIdSelector,\n} from \"@/services/circuit-graph/selectors/connections\";\nimport { wireJointIdsByConnectionIdSelector } from \"@/services/circuit-layout/selectors/wires\";\nimport { elementIdsFromCircuitIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { activeCircuitIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action, appState) => {\n  if (!isSelectAllAction(action)) {\n    return state;\n  }\n\n  const circuitId = activeCircuitIdSelector(appState);\n  if (!circuitId) {\n    return state;\n  }\n\n  const elementIds = elementIdsFromCircuitIdSelector(appState, circuitId);\n\n  let connectionIds = connectionIdsSelector(appState);\n  const connectionsById = connectionsByIdSelector(appState);\n  connectionIds = connectionIds.filter((connectionId) => {\n    const { inputPin, outputPin } = connectionsById[connectionId];\n    if (\n      elementIds.indexOf(inputPin.elementId) === -1 ||\n      elementIds.indexOf(outputPin.elementId) === -1\n    ) {\n      return false;\n    }\n    return true;\n  });\n\n  const wireJointIdsFromConnectionId = wireJointIdsByConnectionIdSelector(\n    appState\n  );\n  const jointIds = flatten(\n    connectionIds.map((connId) => wireJointIdsFromConnectionId[connId])\n  );\n\n  return {\n    ...state,\n    selectedElementIds: elementIds,\n    selectedConnectionIds: connectionIds,\n    selectedJointIds: jointIds,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SELECT_CLEAR = \"@select/clear\" as const;\nexport const clearSelection = () => ({\n  type: ACTION_SELECT_CLEAR,\n});\nexport type ClearSelectionAction = ReturnType<typeof clearSelection>;\nexport function isClearSelectionAction(\n  action: AnyAction\n): action is ClearSelectionAction {\n  return action.type === ACTION_SELECT_CLEAR;\n}\n","import { isClearSelectionAction } from \"@/actions/select-clear\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isClearSelectionAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    selectedElementIds: [],\n    selectedConnectionIds: [],\n    selectedJointIds: [],\n  };\n});\n","import { combineSelection } from \"@/selection-mode\";\n\nimport { isSelectElementsAction } from \"@/actions/select-elements\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isSelectElementsAction(action)) {\n    return state;\n  }\n\n  const { elementIds, mode } = action.payload;\n\n  return {\n    ...state,\n    selectedElementIds: combineSelection(\n      state.selectedElementIds,\n      elementIds,\n      mode\n    ),\n    selectedConnectionIds: mode === \"set\" ? [] : state.selectedConnectionIds,\n    selectedJointIds: mode === \"set\" ? [] : state.selectedJointIds,\n  };\n});\n","import { combineSelection } from \"@/selection-mode\";\n\nimport { isSelectWireJointsAction } from \"@/actions/select-wire-joints\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isSelectWireJointsAction(action)) {\n    return state;\n  }\n\n  const { jointIds, mode } = action.payload;\n\n  return {\n    ...state,\n    selectedElementIds: mode === \"set\" ? [] : state.selectedElementIds,\n    selectedConnectionIds: mode === \"set\" ? [] : state.selectedConnectionIds,\n    selectedJointIds: combineSelection(state.selectedJointIds, jointIds, mode),\n  };\n});\n","import { createSelector } from \"reselect\";\n\nimport mapValues from \"lodash/mapValues\";\n\nimport { offsetRectangle, ZeroRect } from \"@/geometry\";\n\nimport { elementTypesByElementIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { elementDefinitionsByTypeSelector } from \"@/services/element-types/selectors/element-types\";\n\nimport { elementPositionsByElementIdSelector } from \"./element-positions\";\n\nexport const elementRectsByIdSelector = createSelector(\n  elementPositionsByElementIdSelector,\n  elementDefinitionsByTypeSelector,\n  elementTypesByElementIdSelector,\n  (positionsById, elementDefsByType, elementTypesById) =>\n    mapValues(positionsById, (position, id) => {\n      const type = elementTypesById[id];\n      if (!type) {\n        return ZeroRect;\n      }\n      const def = elementDefsByType[type];\n      if (!def) {\n        return ZeroRect;\n      }\n\n      return offsetRectangle(def.visual.hitRect, position);\n    })\n);\n","import forOwn from \"lodash/forOwn\";\nimport pick from \"lodash/pick\";\n\nimport { intersects, pointIntersects } from \"@/geometry\";\nimport { combineSelection } from \"@/selection-mode\";\n\nimport { isSelectRegionAction } from \"@/actions/select-region\";\n\nimport { elementIdsFromCircuitIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { elementRectsByIdSelector } from \"@/services/circuit-layout/selectors/element-bounds\";\nimport {\n  wireJointPositionsByJointIdSelector,\n  jointIdsFromCircuitIdSelector,\n} from \"@/services/circuit-layout/selectors/wires\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action, appState) => {\n  if (!isSelectRegionAction(action)) {\n    return state;\n  }\n\n  const { region, circuitId, mode } = action.payload;\n\n  const elementIds = elementIdsFromCircuitIdSelector(appState, circuitId);\n  const rects = pick(elementRectsByIdSelector(appState), elementIds);\n\n  const chosenElementIds: string[] = [];\n  forOwn(rects, (rect, id) => {\n    if (intersects(rect, region)) {\n      chosenElementIds.push(id);\n    }\n  });\n\n  const jointPositions = wireJointPositionsByJointIdSelector(appState);\n  const jointIds = jointIdsFromCircuitIdSelector(appState, circuitId);\n  const chosenJointIds = jointIds.filter((jointId) => {\n    const position = jointPositions[jointId];\n    return pointIntersects(position, region);\n  });\n\n  return {\n    ...state,\n    selectedElementIds: combineSelection(\n      state.selectedElementIds,\n      chosenElementIds,\n      mode\n    ),\n    selectedConnectionIds: mode === \"set\" ? [] : state.selectedConnectionIds,\n    selectedJointIds: combineSelection(\n      state.selectedJointIds,\n      chosenJointIds,\n      mode\n    ),\n  };\n});\n","import { AnyAction } from \"redux\";\n\nimport { SelectionMode } from \"@/selection-mode\";\n\nexport const ACTION_SELECT_WIRES = \"@select/wires\" as const;\nexport const selectWires = (\n  connectionId: string | string[],\n  mode: SelectionMode = \"set\"\n) => ({\n  type: ACTION_SELECT_WIRES,\n  payload: {\n    connectionIds: Array.isArray(connectionId) ? connectionId : [connectionId],\n    mode,\n  },\n});\nexport type SelectWiresAction = ReturnType<typeof selectWires>;\nexport function isSelectWiresAction(\n  action: AnyAction\n): action is SelectWiresAction {\n  return action.type === ACTION_SELECT_WIRES;\n}\n","import { combineSelection } from \"@/selection-mode\";\n\nimport { isSelectWiresAction } from \"@/actions/select-wires\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isSelectWiresAction(action)) {\n    return state;\n  }\n\n  const { connectionIds, mode } = action.payload;\n\n  return {\n    ...state,\n    selectedElementIds: mode === \"set\" ? [] : state.selectedElementIds,\n    selectedConnectionIds: combineSelection(\n      state.selectedConnectionIds,\n      connectionIds,\n      mode\n    ),\n    selectedJointIds: mode === \"set\" ? [] : state.selectedJointIds,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SELECTION_COPY = \"@selection/copy\" as const;\nexport const copySelection = () => ({\n  type: ACTION_SELECTION_COPY,\n});\nexport type CopySelectionAction = ReturnType<typeof copySelection>;\nexport function isCopySelectionAction(\n  action: AnyAction\n): action is CopySelectionAction {\n  return action.type === ACTION_SELECTION_COPY;\n}\n","import { concatReducers } from \"@/store/utils\";\n\nimport elementDeleteReducer from \"./element-delete\";\nimport projectNewReducer from \"./project-new\";\nimport selectAllReducer from \"./select-all\";\nimport selectClearReducer from \"./select-clear\";\nimport selectElementsReducer from \"./select-elements\";\nimport selectJointsReducer from \"./select-joints\";\nimport selectRegionReducer from \"./select-region\";\nimport selectWiresReducer from \"./select-wires\";\nimport selectionAlignToGrid from \"./selection-align-to-grid\";\nimport selectionCopyReducer from \"./selection-copy\";\nimport selectionDeleteReducer from \"./selection-delete\";\nimport selectionMoveReducer from \"./selection-move\";\nimport wireDetatchReducer from \"./wire-detatch\";\n\nconst selectionReducer = concatReducers(\n  projectNewReducer,\n  elementDeleteReducer,\n  selectAllReducer,\n  selectClearReducer,\n  selectJointsReducer,\n  selectElementsReducer,\n  selectRegionReducer,\n  selectWiresReducer,\n  selectionAlignToGrid,\n  selectionCopyReducer,\n  selectionDeleteReducer,\n  selectionMoveReducer,\n  wireDetatchReducer\n);\n\nexport default selectionReducer;\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\nimport { pointEquals } from \"@/geometry\";\n\nimport { isSelectionAlignToGridAction } from \"@/actions/selection-align-to-grid\";\nimport { moveElement } from \"@/actions/element-move\";\nimport { moveWireJoint } from \"@/actions/wire-joint-move\";\n\nimport { elementPositionsByElementIdSelector } from \"@/services/circuit-layout/selectors/element-positions\";\nimport {\n  applyGridJointSnapSelector,\n  applyGridElementSnapSelector,\n} from \"@/services/circuit-editor-drag/selectors/snap\";\nimport { wireJointPositionsByJointIdSelector } from \"@/services/circuit-layout/selectors/wires\";\n\nexport default function selectionAlignToGridReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isSelectionAlignToGridAction(action)) {\n    return state;\n  }\n\n  const {\n    selectedElementIds: selectedElementIds,\n    selectedJointIds,\n  } = state.services.selection;\n\n  // Align elements.\n  const elementPositions = elementPositionsByElementIdSelector(state);\n  for (const elementId of selectedElementIds) {\n    const elementPos = elementPositions[elementId];\n    if (!elementPos) {\n      continue;\n    }\n\n    const snappedPos = applyGridElementSnapSelector(state, elementPos);\n    if (!pointEquals(elementPos, snappedPos)) {\n      state = rootReducer(state, moveElement(elementId, snappedPos));\n    }\n  }\n\n  // Align joints.\n  const jointPositions = wireJointPositionsByJointIdSelector(state);\n  for (const jointId of selectedJointIds) {\n    const jointPos = jointPositions[jointId];\n    if (!jointPos) {\n      continue;\n    }\n\n    const snappedPos = applyGridJointSnapSelector(state, jointPos);\n    if (!pointEquals(jointPos, snappedPos)) {\n      state = rootReducer(state, moveWireJoint(jointId, snappedPos));\n    }\n  }\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isCopySelectionAction } from \"@/actions/selection-copy\";\nimport { copyElements } from \"@/actions/clipboard-copy-elements\";\n\nimport { selectedElementIdsSelector } from \"@/services/selection/selectors/selection\";\n\nexport default function selectionCopyReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isCopySelectionAction(action)) {\n    return state;\n  }\n\n  const selectedElements = selectedElementIdsSelector(state);\n  if (selectedElements.length === 0) {\n    return state;\n  }\n\n  return rootReducer(state, copyElements(selectedElements));\n}\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isDeleteSelectionAction } from \"@/actions/selection-delete\";\nimport { deleteElement } from \"@/actions/element-delete\";\nimport { detatchWire } from \"@/actions/wire-detatch\";\nimport { deleteWireJoint } from \"@/actions/wire-joint-delete\";\n\nexport default function selectionDeleteReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isDeleteSelectionAction(action)) {\n    return state;\n  }\n\n  const {\n    selectedElementIds: selectedElementIds,\n    selectedConnectionIds,\n    selectedJointIds,\n  } = state.services.selection;\n\n  if (selectedElementIds.length > 0) {\n    state = rootReducer(state, deleteElement(selectedElementIds));\n  }\n  state = selectedConnectionIds.reduce(\n    (state, connectionId) => rootReducer(state, detatchWire(connectionId)),\n    state\n  );\n  state = selectedJointIds.reduce(\n    (state, jointId) => rootReducer(state, deleteWireJoint(jointId)),\n    state\n  );\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nimport { Point } from \"@/geometry\";\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isMoveSelectionAction } from \"@/actions/selection-move\";\nimport { moveElement, MoveElementOpts } from \"@/actions/element-move\";\nimport { moveWireJoint, MoveWireJointOpts } from \"@/actions/wire-joint-move\";\n\nimport {\n  selectedElementIdsSelector,\n  selectedJointIdsSelector,\n} from \"@/services/selection/selectors/selection\";\n\nexport default function selectionMoveReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n) {\n  if (!isMoveSelectionAction(action)) {\n    return state;\n  }\n\n  const { offsetX, offsetY, snapMode } = action.payload;\n\n  const elementIds = selectedElementIdsSelector(state);\n  const jointIds = selectedJointIdsSelector(state);\n\n  const offset: Point = {\n    x: offsetX,\n    y: offsetY,\n  };\n\n  let elementSnapMode: MoveElementOpts[\"snapMode\"] = \"none\";\n  if (snapMode === \"element\" || snapMode === \"by-type\") {\n    elementSnapMode = \"element\";\n  }\n\n  let jointSnapMode: MoveWireJointOpts[\"snapMode\"] = \"none\";\n  if (snapMode === \"by-type\") {\n    jointSnapMode = \"joint\";\n  } else {\n    jointSnapMode = snapMode;\n  }\n\n  state = rootReducer(\n    state,\n    moveElement(elementIds, offset, {\n      relative: true,\n      snapMode: elementSnapMode,\n    })\n  );\n  state = rootReducer(\n    state,\n    moveWireJoint(jointIds, offset, { relative: true, snapMode: jointSnapMode })\n  );\n\n  return state;\n}\n","import { isDetatchWireAction } from \"@/actions/wire-detatch\";\n\nimport { createSelectionReducer } from \"../utils\";\n\nexport default createSelectionReducer((state, action) => {\n  if (!isDetatchWireAction(action)) {\n    return state;\n  }\n\n  const { connectionId } = action.payload;\n\n  return {\n    ...state,\n    selectedConnectionIds: state.selectedConnectionIds.filter(\n      (x) => x !== connectionId\n    ),\n  };\n});\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createSimulatorReducer = createServiceReducerCreator(\"simulator\");\nexport const createSimulatorSelector = createServiceSelectorCreator(\n  \"simulator\"\n);\n","import { isProjectMutationAction } from \"@/project-mutation-actions\";\n\nimport { defaultSimulatorServiceState } from \"../state\";\nimport { createSimulatorReducer } from \"../utils\";\n\nexport default createSimulatorReducer((state, action) => {\n  if (!isProjectMutationAction(action)) {\n    return state;\n  }\n\n  return defaultSimulatorServiceState;\n});\n","import { EvolverDefinition } from \"../types\";\n\nfunction asEvolverDef(module: any): EvolverDefinition {\n  return module.default as EvolverDefinition;\n}\n\nexport const EvolverDefinitionsByType = {\n  \"input-momentary\": asEvolverDef(require(\"./input-momentary\")),\n  \"input-toggle\": asEvolverDef(require(\"./input-toggle\")),\n\n  \"logic-and\": asEvolverDef(require(\"./logic-and\")),\n  \"logic-buffer\": asEvolverDef(require(\"./logic-buffer\")),\n  \"logic-nand\": asEvolverDef(require(\"./logic-nand\")),\n  \"logic-nor\": asEvolverDef(require(\"./logic-nor\")),\n  \"logic-not\": asEvolverDef(require(\"./logic-not\")),\n  \"logic-or\": asEvolverDef(require(\"./logic-or\")),\n  \"logic-xor\": asEvolverDef(require(\"./logic-xor\")),\n\n  \"output-led\": asEvolverDef(require(\"./output-led\")),\n  \"output-seg7\": asEvolverDef(require(\"./output-seg7\")),\n\n  \"pin-high\": asEvolverDef(require(\"./pin-high\")),\n};\nexport type EvolverType = keyof typeof EvolverDefinitionsByType;\n","import flatMap from \"lodash/flatMap\";\nimport get from \"lodash/get\";\n\nimport { EvolverIdMappingTreeItem, EvolverIdToElementIdMap } from \"./types\";\n\nexport function walkSimulatorElementIdToCircuitElementIdMap(\n  map: EvolverIdToElementIdMap,\n  visit: (elementIdPath: string[], evolverId: string) => void,\n  elementIdPath: string[] = []\n) {\n  const elementIds = Object.keys(map);\n  for (const elementId of elementIds) {\n    const { evolverId, subElementIds: subCircuitIds } = map[elementId];\n    const currentPath = [...elementIdPath, elementId];\n    if (evolverId) {\n      visit(currentPath, evolverId);\n    }\n    walkSimulatorElementIdToCircuitElementIdMap(\n      subCircuitIds,\n      visit,\n      currentPath\n    );\n  }\n}\n\nexport function getEvolverIdFromElementIdPath(\n  map: EvolverIdToElementIdMap,\n  elementIdPath: string[]\n): string | null {\n  // Look up the path through the ic element to reach this element.\n  const evolverIdPath = flatMap(elementIdPath, (icElementId) => [\n    icElementId,\n    \"subElementIds\",\n  ]);\n\n  // Remove the last subCircuitIds\n  evolverIdPath.pop();\n\n  const evolverIdItem: EvolverIdMappingTreeItem = get(map, evolverIdPath);\n\n  if (!evolverIdItem) {\n    return null;\n  }\n\n  const { evolverId: evolverId } = evolverIdItem;\n  return evolverId ?? null;\n}\n","import get from \"lodash/get\";\nimport merge from \"lodash/merge\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nimport {\n  CircuitSimProduction,\n  ElementSimProduction,\n  normalizeSimProduction,\n} from \"../../elements/types/element-production\";\n\nimport {\n  SimulatorGraph,\n  SimulatorGraphDependencies,\n  SimulatorEvolver,\n  EvolverIdMappingTreeItem,\n  EvolverPin,\n} from \"./types\";\n\ntype CircuitProductionResult = SimulatorGraph & {\n  inputElementPinsByCircuitPinId: Record<string, EvolverPin[]>;\n  outputElementPinsByCircuitPinId: Record<string, EvolverPin>;\n};\n\nconst EMPTY_PRODUCTION = Object.freeze<CircuitProductionResult>({\n  evolversById: {},\n  evolverIdsByElementId: {},\n  inputElementPinsByCircuitPinId: {},\n  outputElementPinsByCircuitPinId: {},\n});\n\nexport function produceCircuitGraph(\n  circuitId: string,\n  dependencies: SimulatorGraphDependencies,\n  path: string[] = []\n): CircuitProductionResult {\n  if (path.indexOf(circuitId) !== -1) {\n    throw new Error(\n      `Circuit graph encountered loop on ${path.join(\n        \" => \"\n      )} while trying to add circuit ${circuitId}`\n    );\n  }\n\n  path = [...path, circuitId];\n\n  const evolversById: Record<string, SimulatorEvolver> = {};\n  const evolverIdsByElementId: Record<string, EvolverIdMappingTreeItem> = {};\n  const inputElementPinsByCircuitPinId: Record<string, EvolverPin[]> = {};\n  const outputElementPinsByCircuitPinId: Record<string, EvolverPin> = {};\n\n  const inputElementIds: string[] = [];\n  const outputElementIds: string[] = [];\n\n  // 1. Create new elements\n  // 2. Wire elements amongs themselves.\n  // 3. Pass input and output mapping to parent.\n\n  const elementInputPinsByPinIdByElementId: Record<\n    string,\n    Record<string, EvolverPin[]>\n  > = {};\n  const elementOutputPinsByPinIdByElementId: Record<\n    string,\n    Record<string, EvolverPin>\n  > = {};\n\n  const elementIds = dependencies.elementIdsByCircuitId[circuitId] ?? [];\n  for (const elementId of elementIds) {\n    const elementType = dependencies.elementTypesByElementId[elementId];\n    if (!elementType) {\n      continue;\n    }\n\n    // If this element is a pin, remember it to calculate circuit inputs and outputs.\n    if (elementType === \"pin-input\") {\n      inputElementIds.push(elementId);\n      inputElementPinsByCircuitPinId[elementId] = [];\n      continue;\n    } else if (elementType === \"pin-output\") {\n      outputElementIds.push(elementId);\n      continue;\n    }\n\n    const productionResult = produceEvolver(elementId, dependencies, path);\n\n    // Merge the produced simulator elements.\n    merge(evolversById, productionResult.evolversById);\n\n    // Merge the mapping from circuit element to evolver.\n    merge(evolverIdsByElementId, productionResult.evolverIdsByElementId);\n\n    // Remember what these element pins translate to.\n    elementInputPinsByPinIdByElementId[elementId] =\n      productionResult.inputElementPinsByCircuitPinId;\n    elementOutputPinsByPinIdByElementId[elementId] =\n      productionResult.outputElementPinsByCircuitPinId;\n  }\n\n  const circuitConnectionsById = dependencies.connectionsById;\n  for (const connectionId of Object.keys(circuitConnectionsById)) {\n    const { inputPin, outputPin } = circuitConnectionsById[connectionId];\n    // We are only interested in connections within this circuit.\n    // There should not be any cross-circuit connections.\n    // It might be ok to skip this step, and rely on not finding the element mapping.\n\n    if (\n      elementIds.indexOf(inputPin.elementId) === -1 ||\n      elementIds.indexOf(outputPin.elementId) === -1\n    ) {\n      continue;\n    }\n\n    // We need to find the one output, and connect it to all inputs that match.\n    // There might be more than one input if the input was on an IC / circuit production.\n    const outputSimPin = get(elementOutputPinsByPinIdByElementId, [\n      outputPin.elementId,\n      outputPin.pinId,\n    ]);\n    const inputSimPins = get(elementInputPinsByPinIdByElementId, [\n      inputPin.elementId,\n      inputPin.pinId,\n    ]);\n\n    // If the output is one of our input elements, then the inputs\n    //  need to be saved for our circuit inputs\n    if (inputElementIds.indexOf(outputPin.elementId) !== -1 && inputSimPins) {\n      // pin id is the pin-input elementId\n      inputElementPinsByCircuitPinId[outputPin.elementId].push(...inputSimPins);\n      continue;\n    } else if (\n      outputElementIds.indexOf(inputPin.elementId) !== -1 &&\n      outputSimPin\n    ) {\n      outputElementPinsByCircuitPinId[inputPin.elementId] = outputSimPin;\n      continue;\n    }\n\n    if (!outputSimPin || !inputSimPins) {\n      continue;\n    }\n\n    const outputEvolver = evolversById[outputSimPin.evolverId];\n    let outputsByOutputPin = outputEvolver.outputsByPin[outputSimPin.pinId];\n    if (outputsByOutputPin == null) {\n      outputEvolver.outputsByPin[outputSimPin.pinId] = outputsByOutputPin = [];\n    }\n\n    // Wire up the output to all of the inputs\n    for (const inputSimPin of inputSimPins) {\n      outputsByOutputPin.push({\n        evolverId: inputSimPin.evolverId,\n        pinId: inputSimPin.pinId,\n      });\n\n      const inputNode = evolversById[inputSimPin.evolverId];\n      inputNode.inputsByPin[inputSimPin.pinId] = {\n        evolverId: outputSimPin.evolverId,\n        pinId: outputSimPin.pinId,\n      };\n    }\n  }\n\n  return {\n    evolversById,\n    evolverIdsByElementId: evolverIdsByElementId,\n    inputElementPinsByCircuitPinId,\n    outputElementPinsByCircuitPinId,\n  };\n}\n\nfunction produceEvolver(\n  elementId: string,\n  dependencies: SimulatorGraphDependencies,\n  path: string[]\n): CircuitProductionResult {\n  const elementType = dependencies.elementTypesByElementId[elementId];\n  if (!elementType) {\n    return EMPTY_PRODUCTION;\n  }\n\n  const def = dependencies.elementDefsByElementType[elementType];\n  if (!def || !def.elementProduction) {\n    return EMPTY_PRODUCTION;\n  }\n\n  const production = normalizeSimProduction(def.elementProduction);\n  switch (production.type) {\n    case \"element\":\n      return produceElementNode(elementId, production, dependencies);\n    case \"circuit\":\n      return produceCircuitNode(elementId, production, dependencies, path);\n    default:\n      throw new Error(\n        \"Unsupported production type \" + (production as any).type\n      );\n  }\n}\n\nfunction produceElementNode(\n  elementId: string,\n  production: ElementSimProduction,\n  {\n    elementTypesByElementId,\n    elementDefsByElementType,\n  }: SimulatorGraphDependencies\n): CircuitProductionResult {\n  const elementType = elementTypesByElementId[elementId];\n  const def = elementDefsByElementType[elementType];\n  if (!def) {\n    return EMPTY_PRODUCTION;\n  }\n\n  const evolversById: Record<string, SimulatorEvolver> = {};\n  const evolverIdsByElementId: Record<string, EvolverIdMappingTreeItem> = {};\n\n  const evolverId = uuidV4();\n  evolversById[evolverId] = {\n    evolverType: production.evolverType,\n    // We do not have any internal pins.\n    // These will be wired by produceCircuit as\n    // it completes is cross-circuit connections.\n    inputsByPin: {},\n    outputsByPin: {},\n  };\n\n  evolverIdsByElementId[elementId] = {\n    evolverId,\n    subElementIds: {},\n  };\n\n  const inputElementPinsByCircuitPinId: Record<string, EvolverPin[]> = {};\n  const outputElementPinsByCircuitPinId: Record<string, EvolverPin> = {};\n\n  // We have a one to one pin mapping between element and evolver\n  for (const pinId of Object.keys(def.pins)) {\n    const { direction } = def.pins[pinId];\n    if (direction === \"input\") {\n      inputElementPinsByCircuitPinId[pinId] = [\n        {\n          pinId,\n          evolverId: evolverId,\n        },\n      ];\n    } else if (direction === \"output\") {\n      outputElementPinsByCircuitPinId[pinId] = {\n        pinId,\n        evolverId: evolverId,\n      };\n    }\n  }\n\n  return {\n    evolversById,\n    evolverIdsByElementId: evolverIdsByElementId,\n    inputElementPinsByCircuitPinId,\n    outputElementPinsByCircuitPinId,\n  };\n}\n\nfunction produceCircuitNode(\n  elementId: string,\n  production: CircuitSimProduction,\n  dependencies: SimulatorGraphDependencies,\n  path: string[]\n): CircuitProductionResult {\n  const circuitProuction = produceCircuitGraph(\n    production.circuitId,\n    dependencies,\n    path\n  );\n\n  return {\n    ...circuitProuction,\n    evolverIdsByElementId: {\n      [elementId]: {\n        evolverId: null,\n        subElementIds: circuitProuction.evolverIdsByElementId,\n      },\n    },\n  };\n}\n","import { EvolverType } from \"@/evolvers\";\n\nexport interface ElementSimProduction {\n  type: \"element\";\n  evolverType: EvolverType;\n}\n\nexport interface CircuitSimProduction {\n  type: \"circuit\";\n  circuitId: string;\n}\n\nexport type SimProductionObject = ElementSimProduction | CircuitSimProduction;\n\nexport type SimProduction = EvolverType | SimProductionObject;\n\nexport function normalizeSimProduction(\n  simProduction: SimProduction\n): SimProductionObject {\n  if (typeof simProduction === \"string\") {\n    return {\n      type: \"element\",\n      evolverType: simProduction,\n    };\n  }\n\n  return simProduction;\n}\n","import { EvolverType } from \"@/evolvers\";\nimport { ElementDefinition } from \"@/elements/types\";\n\nimport { Connection } from \"../circuit-graph/types\";\n\nexport interface EvolverPin {\n  evolverId: string;\n  pinId: string;\n}\n\nexport interface SimulatorEvolver {\n  /**\n   * The type of this evolver.\n   */\n  evolverType: EvolverType;\n\n  /**\n   * Input source pins by input pin id.\n   *\n   * This is redundant with the opposing evolver's outputsByPin,\n   * to increase lookup speed.\n   */\n  inputsByPin: Record<string, EvolverPin>;\n\n  /**\n   * Output source pins by output pin id.\n   *\n   * This is redundant with the opposing evolver's inputsByPin,\n   * to increase lookup speed.\n   */\n  outputsByPin: Record<string, EvolverPin[]>;\n}\n\nexport interface EvolverIdMappingTreeItem {\n  evolverId: string | null;\n  subElementIds: EvolverIdToElementIdMap;\n}\n\nexport type EvolverIdToElementIdMap = Record<string, EvolverIdMappingTreeItem>;\n\nexport interface SimulatorGraphDependencies {\n  elementIdsByCircuitId: Record<string, string[]>;\n  elementTypesByElementId: Record<string, string>;\n  connectionsById: Record<string, Connection>;\n  elementDefsByElementType: Record<string, ElementDefinition>;\n}\n\nexport interface SimulatorGraph {\n  /**\n   * A map of all evolvers by their id.\n   */\n  evolversById: Record<string, SimulatorEvolver>;\n\n  /**\n   * A map of evolver ids by the element id that generated them.\n   */\n  evolverIdsByElementId: EvolverIdToElementIdMap;\n}\n\nexport const EmptySimulatorGraph: SimulatorGraph = Object.freeze({\n  evolversById: {},\n  evolverIdsByElementId: {},\n});\n","import { createSelector } from \"reselect\";\n\nimport { elementIdsByCircuitIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { elementTypesByElementIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { connectionsByIdSelector } from \"@/services/circuit-graph/selectors/connections\";\nimport { elementDefinitionsByTypeSelector } from \"@/services/element-types/selectors/element-types\";\nimport { ROOT_CIRCUIT_ID } from \"@/services/circuits/constants\";\n\nimport { produceCircuitGraph } from \"../graph-production\";\nimport { EmptySimulatorGraph } from \"../types\";\n\nexport const rootCircuitGraphSelector = createSelector(\n  elementIdsByCircuitIdSelector,\n  elementTypesByElementIdSelector,\n  connectionsByIdSelector,\n  elementDefinitionsByTypeSelector,\n  (\n    elementIdsByCircuitId,\n    elementTypesByElementId,\n    connectionsById,\n    elementDefsByElementType\n  ) => {\n    try {\n      return produceCircuitGraph(ROOT_CIRCUIT_ID, {\n        elementIdsByCircuitId,\n        elementTypesByElementId,\n        connectionsById,\n        elementDefsByElementType,\n      });\n    } catch (e) {\n      // FIXME: Display this error to the user.\n      console.error(e);\n      return EmptySimulatorGraph;\n    }\n  }\n);\n","import { AppState } from \"@/store\";\nimport { EvolverDefinitionsByType } from \"@/evolvers\";\n\nimport { getEvolverIdFromElementIdPath } from \"../utils\";\n\nimport { rootCircuitGraphSelector } from \"./graph\";\n\nexport const evolverIdsByElementIdSelector = (state: AppState) =>\n  rootCircuitGraphSelector(state).evolverIdsByElementId;\n\n/**\n * Gets the evolver id for a given element id.\n */\nexport const evolverIdFromElementIdSelector = (\n  state: AppState,\n  elementIdPath: string[]\n) => {\n  const { evolverIdsByElementId } = rootCircuitGraphSelector(state);\n  return getEvolverIdFromElementIdPath(evolverIdsByElementId, elementIdPath);\n};\n\n/**\n * Get all evolver ids.\n *\n * WARN: Not react safe.\n */\nexport const evolverIdsSelector = (state: AppState) => {\n  const { evolversById } = rootCircuitGraphSelector(state);\n  return Object.keys(evolversById);\n};\n\nexport const evolverTypeFromEvolverId = (\n  state: AppState,\n  evolverId: string\n) => {\n  const { evolversById } = rootCircuitGraphSelector(state);\n  const evolver = evolversById[evolverId];\n  if (!evolver) {\n    return null;\n  }\n\n  return evolver.evolverType;\n};\n\nexport const evolverDefFromEvolverId = (state: AppState, evolverId: string) => {\n  const type = evolverTypeFromEvolverId(state, evolverId);\n  if (!type) {\n    return null;\n  }\n\n  return EvolverDefinitionsByType[type] ?? null;\n};\n","import values from \"lodash/values\";\nimport flatMap from \"lodash/flatMap\";\n\nimport { AppState } from \"@/store\";\n\nimport { rootCircuitGraphSelector } from \"./graph\";\nimport { EvolverPin } from \"../types\";\n\nconst EmptyPinArray = Object.freeze([] as string[]);\nconst EmptyPinInputs = Object.freeze({} as Record<string, EvolverPin>);\n\n/**\n * Gets an array of evolver ids connected to the outputs of the given element id.\n * WARN: Not react safe.  For reducer use only.\n */\nexport const outputEvolverIdsFromEvolverIdSelector = (\n  state: AppState,\n  evolverId: string\n) => {\n  const { evolversById } = rootCircuitGraphSelector(state);\n\n  const evolver = evolversById[evolverId];\n  if (!evolver) {\n    return EmptyPinArray;\n  }\n\n  return flatMap(values(evolver.outputsByPin), (pins) =>\n    pins.map((x) => x.evolverId)\n  );\n};\n\n/**\n * Gets a map of element input pins to their output sources given an element id.\n */\nexport const inputPinsByPinIdFromEvolverIdSelector = (\n  state: AppState,\n  evolverId: string\n) => {\n  const { evolversById } = rootCircuitGraphSelector(state);\n  const evolver = evolversById[evolverId];\n  if (!evolver) {\n    return EmptyPinInputs;\n  }\n\n  return evolver.inputsByPin;\n};\n","import binarySearch from \"binary-search\";\nimport { v4 as uuidV4 } from \"uuid\";\nimport pick from \"lodash/pick\";\nimport difference from \"lodash/difference\";\n\nimport { fpSet } from \"@/utils\";\nimport { asArray, dropIndexFp } from \"@/arrays\";\nimport { AppState } from \"@/store\";\nimport { EvolutionResult, OutputTransition } from \"@/logic\";\n\nimport {\n  inputPinsByPinIdFromEvolverIdSelector,\n  outputEvolverIdsFromEvolverIdSelector,\n} from \"@/services/simulator-graph/selectors/connections\";\nimport {\n  evolverIdsSelector,\n  evolverDefFromEvolverId,\n} from \"@/services/simulator-graph/selectors/elements\";\n\nimport { SimulatorServiceState, defaultSimulatorServiceState } from \"../state\";\nimport { SimTransitionWindow, EvolverPinTransition } from \"../types\";\n\nexport function simInit(\n  state: Readonly<SimulatorServiceState>,\n  appState: Readonly<AppState>\n): SimulatorServiceState {\n  const elementIds = evolverIdsSelector(appState);\n\n  state = defaultSimulatorServiceState;\n\n  state = elementIds.reduce(\n    (state, elementId) => initNode(state, elementId, appState),\n    state\n  );\n\n  state = elementIds.reduce(\n    (state, elementId) => collectNodeTransitions(state, elementId, appState),\n    state\n  );\n\n  return Object.assign({}, state, { initialized: true });\n}\n\nfunction initNode(\n  state: Readonly<SimulatorServiceState>,\n  elementId: string,\n  appState: Readonly<AppState>\n): SimulatorServiceState {\n  const def = evolverDefFromEvolverId(appState, elementId);\n  if (!def) {\n    return state;\n  }\n\n  const outputValues: Record<string, boolean> = {};\n  def.outputPins.forEach((output) => {\n    outputValues[output] = false;\n  });\n\n  return fpSet(\n    state,\n    \"evolverOutputValuesByEvolverId\",\n    elementId,\n    outputValues\n  );\n}\n\nexport function simTick(\n  state: Readonly<SimulatorServiceState>,\n  tickCount: number,\n  appState: Readonly<AppState>\n): SimulatorServiceState {\n  const endTick = state.tick + tickCount;\n\n  // We cannot grab the windows ahead of time, as some windows might generate more windows\n  //  for future ticks.\n\n  // Pre-clone windows as we wil be repeatedly modifying it.\n  state = Object.assign({}, state, {\n    transitionWindows: state.transitionWindows.slice(),\n  });\n\n  let saftyCount = tickCount + 1;\n  while (\n    state.transitionWindows.length > 0 &&\n    state.transitionWindows[0].tick <= endTick\n  ) {\n    if (--saftyCount === 0) {\n      // If we have seen more windows than ticks, something is creating windows for past ticks.\n      throw new Error(\n        `Maximum ticks per sim evolution exceeded.  This is an indication that windows are being generated for past ticks.`\n      );\n    }\n\n    // We can safely mutate here, as even if the array is regenerated\n    //  from a tick it will still be a fresh copy that has not yet been\n    //  consumed by redux.\n    const window = state.transitionWindows.shift()!;\n    state = tickWindow(state, window, appState);\n  }\n\n  // If we did not encounter a window on our last tick, jump ahead to that tick.\n  if (state.tick != endTick) {\n    state = Object.assign({}, state, {\n      tick: endTick,\n    });\n  }\n\n  return state;\n}\n\nfunction tickWindow(\n  readonlyState: Readonly<SimulatorServiceState>,\n  window: SimTransitionWindow,\n  appState: Readonly<AppState>\n): SimulatorServiceState {\n  if (window.transitionIds.length === 0) {\n    return readonlyState;\n  }\n\n  // Update the current tick, as it is referenced\n  //  during transition collection.\n  let state = Object.assign({}, readonlyState, {\n    tick: window.tick,\n    // pre-clone outputs for mutation below\n    evolverOutputValuesByEvolverId: Object.assign(\n      {},\n      readonlyState.evolverOutputValuesByEvolverId\n    ),\n  }) as SimulatorServiceState;\n\n  // Could benefit from being changed to a Set, although elements usually arent hooked up to too many\n  //  outputs at a time.\n  const updatedEvolverIds = new Set<string>();\n  window.transitionIds.forEach((tid) => {\n    const { elementId, valuesByOutputPin } = state.transitionsById[tid];\n\n    if (\n      !isOutputsUpdated(\n        state.evolverOutputValuesByEvolverId[elementId],\n        valuesByOutputPin\n      )\n    ) {\n      // Values are unchanged from current, evolver will not update.\n      return;\n    }\n\n    // evolverOutputValuesByEvolverId is pre-cloned\n    state.evolverOutputValuesByEvolverId[elementId] = Object.assign(\n      {},\n      state.evolverOutputValuesByEvolverId[elementId],\n      valuesByOutputPin\n    );\n\n    // Add each evolver we output to, to the output list.\n    const outputEvolverIds = outputEvolverIdsFromEvolverIdSelector(\n      appState,\n      elementId\n    );\n    outputEvolverIds.forEach((evolverId) => updatedEvolverIds.add(evolverId));\n  });\n\n  // Remove all window transitions as they have been consumed.\n  // State is cloned above\n  state.transitionsById = pick(\n    state.transitionsById,\n    difference(Object.keys(state.transitionsById), window.transitionIds)\n  );\n\n  for (const elementId of updatedEvolverIds) {\n    state = collectNodeTransitions(state, elementId, appState);\n  }\n\n  return state;\n}\n\nfunction isOutputsUpdated(\n  outputs: Record<string, boolean>,\n  updates: Record<string, boolean>\n) {\n  return Object.keys(updates).some((key) => outputs[key] !== updates[key]);\n}\n\nexport function collectNodeTransitions(\n  state: Readonly<SimulatorServiceState>,\n  elementId: string,\n  appState: Readonly<AppState>\n): SimulatorServiceState {\n  const def = evolverDefFromEvolverId(appState, elementId);\n  if (!def || !def.evolve) {\n    return state;\n  }\n\n  // Build the current input state from the connected pins.\n  const inputs = collectNodeInputs(state, elementId, appState);\n  const result = def.evolve(\n    state.evolverStatesByEvolverId[elementId],\n    inputs,\n    state.tick\n  );\n\n  return applyEvolutionResult(state, elementId, result);\n}\n\nexport function applyEvolutionResult(\n  state: Readonly<SimulatorServiceState>,\n  elementId: string,\n  evolutionResult: EvolutionResult\n) {\n  const { state: evolverState, transitions } = evolutionResult;\n\n  if (evolverState) {\n    state = fpSet(state, \"evolverStatesByEvolverId\", elementId, evolverState);\n  }\n\n  if (transitions) {\n    const transitionsArray = asArray(transitions);\n    state = transitionsArray.reduce(\n      (state, transition, i) =>\n        applyOutputTransition(\n          state,\n          elementId,\n          transition,\n          i === 0 ? \"replace\" : \"append\"\n        ),\n      state\n    );\n  }\n\n  return state;\n}\n\nfunction collectNodeInputs(\n  state: Readonly<SimulatorServiceState>,\n  elementId: string,\n  appState: Readonly<AppState>\n): Record<string, boolean> {\n  // Build the current input state from the connected pins.\n  const inputs: Record<string, boolean> = {};\n  const inputSourcesByPin = inputPinsByPinIdFromEvolverIdSelector(\n    appState,\n    elementId\n  );\n\n  Object.keys(inputSourcesByPin).forEach((inputPin) => {\n    const inputConn = inputSourcesByPin[inputPin];\n    if (!inputConn) {\n      inputs[inputPin] = false;\n      return;\n    }\n\n    const { evolverId, pinId: sourcePinId } = inputConn;\n    inputs[inputPin] =\n      state.evolverOutputValuesByEvolverId[evolverId]?.[sourcePinId] || false;\n  });\n\n  return inputs;\n}\n\nfunction applyOutputTransition(\n  state: Readonly<SimulatorServiceState>,\n  elementId: string,\n  transition: OutputTransition,\n  defaultMerger: \"replace\" | \"append\" = \"replace\"\n): SimulatorServiceState {\n  const {\n    tickOffset,\n    valuesByPin,\n    transitionMerger = defaultMerger,\n  } = transition;\n\n  // Sanity check that we are not producing transitions for the past or current tick.\n  const transitionTick = state.tick + (tickOffset > 0 ? tickOffset : 1);\n\n  // We originally removed old transitions when scheduling new transitions.\n  //  Experimenting without this.\n  if (transitionMerger === \"replace\") {\n    state = removeTransitionsByEvolverId(state, elementId);\n  }\n\n  return addTransition(state, elementId, transitionTick, valuesByPin);\n}\n\nfunction addTransition(\n  state: Readonly<SimulatorServiceState>,\n  elementId: string,\n  tick: number,\n  valuesByOutputPin: Record<string, boolean>\n): SimulatorServiceState {\n  const transitionId = uuidV4();\n\n  const newTransition: EvolverPinTransition = {\n    elementId,\n    tick,\n    valuesByOutputPin,\n  };\n\n  // Prepare the new transition window.\n  const transitionWindows = state.transitionWindows.slice();\n\n  let index = binarySearch(transitionWindows, tick, (a, b) => a.tick - b);\n  if (index < 0) {\n    // Need to create a new window\n    index = -index - 1;\n    const newWindow: SimTransitionWindow = {\n      tick,\n      transitionIds: [],\n    };\n    transitionWindows.splice(index, 0, newWindow);\n  }\n\n  const transitionIds = transitionWindows[index].transitionIds.slice();\n  transitionIds.push(transitionId);\n\n  transitionWindows[index] = Object.assign({}, transitionWindows[index], {\n    transitionIds,\n  });\n\n  const transitionsById = Object.assign({}, state.transitionsById, {\n    [transitionId]: newTransition,\n  });\n\n  return Object.assign({}, state, {\n    // Add the new transition window to the id mapping.\n    transitionsById,\n    transitionWindows,\n  });\n}\n\nfunction removeTransitionsByEvolverId(\n  state: Readonly<SimulatorServiceState>,\n  elementId: string\n): SimulatorServiceState {\n  function isElementTransition(transition: EvolverPinTransition) {\n    return transition.elementId === elementId;\n  }\n\n  const transitionIds = Object.keys(state.transitionsById).filter((id) =>\n    isElementTransition(state.transitionsById[id])\n  );\n\n  return transitionIds.reduce(\n    (state, transitionId) => removeTransitionById(state, transitionId),\n    state\n  );\n}\n\nexport function removeTransitionById(\n  state: Readonly<SimulatorServiceState>,\n  transitionId: string\n): SimulatorServiceState {\n  const transition = state.transitionsById[transitionId];\n  if (!transition) {\n    return state;\n  }\n\n  const transitionsById = pick(\n    state.transitionsById,\n    Object.keys(state.transitionsById).filter((x) => x !== transitionId)\n  );\n  let transitionWindows = state.transitionWindows;\n\n  const transitionWindowIndex = binarySearch(\n    transitionWindows,\n    transition.tick,\n    (a, b) => a.tick - b\n  );\n  if (transitionWindowIndex >= 0) {\n    const transitionWindow = transitionWindows[transitionWindowIndex];\n    const { transitionIds } = transitionWindow;\n\n    const tickWindowTransitionIndex = transitionWindow.transitionIds.indexOf(\n      transitionId\n    );\n    if (tickWindowTransitionIndex !== -1) {\n      if (transitionWindow.transitionIds.length === 1) {\n        // Only one element left, remove the window.\n        transitionWindows = dropIndexFp(\n          transitionWindows,\n          transitionWindowIndex\n        );\n      } else {\n        // Remove the transition from the tick window.\n        transitionWindows = transitionWindows.slice();\n        transitionWindows[transitionWindowIndex] = Object.assign(\n          {},\n          transitionWindows[transitionWindowIndex],\n          {\n            transitionIds: dropIndexFp(\n              transitionIds,\n              tickWindowTransitionIndex\n            ),\n          }\n        );\n      }\n    }\n  }\n\n  return Object.assign({}, state, {\n    transitionsById,\n    transitionWindows,\n  });\n}\n","import { EvolverDefinitionsByType } from \"@/evolvers\";\n\nimport { isInteractElementAction } from \"@/actions/element-interact\";\nimport {\n  evolverIdFromElementIdSelector,\n  evolverTypeFromEvolverId,\n} from \"@/services/simulator-graph/selectors/elements\";\n\nimport { createSimulatorReducer } from \"../utils\";\n\nimport { applyEvolutionResult } from \"./utils\";\n\nexport default createSimulatorReducer((state, action, appState) => {\n  if (!isInteractElementAction(action)) {\n    return state;\n  }\n\n  const { elementIdPath, data } = action.payload;\n  const evolverId = evolverIdFromElementIdSelector(appState, elementIdPath);\n\n  if (!evolverId) {\n    return state;\n  }\n\n  const elementType = evolverTypeFromEvolverId(appState, evolverId);\n  if (!elementType) {\n    return state;\n  }\n\n  const def = EvolverDefinitionsByType[elementType];\n  if (!def || !def.interact) {\n    return state;\n  }\n\n  const evolverState = state.evolverStatesByEvolverId[evolverId];\n  const evolutionResult = def.interact(evolverState, data);\n\n  return applyEvolutionResult(state, evolverId, evolutionResult);\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SIM_START = \"@sim/start\" as const;\nexport const startSim = () => ({\n  type: ACTION_SIM_START,\n});\nexport type StartSimAction = ReturnType<typeof startSim>;\nexport function isStartSimAction(action: AnyAction): action is StartSimAction {\n  return action.type === ACTION_SIM_START;\n}\n","import { isStartSimAction } from \"@/actions/sim-start\";\n\nimport { createSimulatorReducer } from \"../utils\";\n\nimport { simInit } from \"./utils\";\n\nexport default createSimulatorReducer((state, action, appState) => {\n  if (!isStartSimAction(action)) {\n    return state;\n  }\n\n  return simInit(state, appState);\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SIM_STEP = \"@sim/step\" as const;\nexport const stepSim = () => ({\n  type: ACTION_SIM_STEP,\n});\nexport type StepSimAction = ReturnType<typeof stepSim>;\nexport function isStepSimAction(action: AnyAction): action is StepSimAction {\n  return action.type === ACTION_SIM_STEP;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SIM_TICK = \"@sim/tick\" as const;\nexport const tickSim = (tickCount: number) => ({\n  type: ACTION_SIM_TICK,\n  payload: { tickCount },\n});\nexport type TickSimAction = ReturnType<typeof tickSim>;\nexport function isTickSimAction(action: AnyAction): action is TickSimAction {\n  return action.type === ACTION_SIM_TICK;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SIM_STOP = \"@sim/stop\" as const;\nexport const stopSim = () => ({\n  type: ACTION_SIM_STOP,\n});\nexport type StartSimAction = ReturnType<typeof stopSim>;\nexport function isStopSimAction(action: AnyAction): action is StartSimAction {\n  return action.type === ACTION_SIM_STOP;\n}\n","import { isStopSimAction } from \"@/actions/sim-stop\";\n\nimport { defaultSimulatorServiceState } from \"../state\";\n\nimport { createSimulatorReducer } from \"../utils\";\n\nexport default createSimulatorReducer((state, action) => {\n  if (!isStopSimAction(action)) {\n    return state;\n  }\n\n  return defaultSimulatorServiceState;\n});\n","import { concatReducers } from \"@/store/utils\";\n\nimport circuitGraphInvalidatedReducer from \"./circuit-graph-invalidated\";\nimport elementInteractReducer from \"./element-interact\";\nimport simStartReducer from \"./sim-start\";\nimport simStepReducer from \"./sim-step\";\nimport simStopReducer from \"./sim-stop\";\nimport simTickReducer from \"./sim-tick\";\n\nconst simulatorReducer = concatReducers(\n  circuitGraphInvalidatedReducer,\n  elementInteractReducer,\n  simStartReducer,\n  simStepReducer,\n  simStopReducer,\n  simTickReducer\n);\n\nexport default simulatorReducer;\n","import { AnyAction } from \"redux\";\n\nimport { fpSet } from \"@/utils\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isStepSimAction } from \"@/actions/sim-step\";\nimport { tickSim } from \"@/actions/sim-tick\";\n\nimport { simInit } from \"./utils\";\n\nexport default function (\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isStepSimAction(action)) {\n    return state;\n  }\n\n  const { initialized } = state.services.simulator;\n  if (!initialized) {\n    state = fpSet(state, \"services\", \"simulator\", (simState) =>\n      simInit(simState, state)\n    );\n  }\n\n  // These may have changed as a result of the init process.\n  const { tick, transitionWindows } = state.services.simulator;\n  if (transitionWindows.length === 0) {\n    return state;\n  }\n\n  const windowTick = transitionWindows[0].tick;\n\n  return rootReducer(state, tickSim(windowTick - tick));\n}\n","import { isTickSimAction } from \"@/actions/sim-tick\";\n\nimport { createSimulatorReducer } from \"../utils\";\n\nimport { simTick } from \"./utils\";\n\nexport default createSimulatorReducer((state, action, appState) => {\n  if (!isTickSimAction(action)) {\n    return state;\n  }\n\n  const { tickCount } = action.payload;\n\n  const start = performance.now();\n\n  state = simTick(state, tickCount, appState);\n\n  const end = performance.now();\n\n  const updateTime = end - start;\n  state = {\n    ...state,\n    lastTickProcessingTimeMs: updateTime,\n  };\n\n  return state;\n});\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createSimulatorControlReducer = createServiceReducerCreator(\n  \"simulatorControl\"\n);\nexport const createSimulatorControlSelector = createServiceSelectorCreator(\n  \"simulatorControl\"\n);\n","import { isProjectMutationAction } from \"@/project-mutation-actions\";\n\nimport { createSimulatorControlReducer } from \"../utils\";\n\nexport default createSimulatorControlReducer((state, action) => {\n  if (!isProjectMutationAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    mode: \"edit\",\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_SIM_PAUSE = \"@sim/pause\" as const;\nexport const pauseSim = (mode: boolean | \"toggle\") => ({\n  type: ACTION_SIM_PAUSE,\n  payload: { mode },\n});\nexport type PauseSimAction = ReturnType<typeof pauseSim>;\nexport function isPauseSimAction(action: AnyAction): action is PauseSimAction {\n  return action.type === ACTION_SIM_PAUSE;\n}\n","import { createSimulatorControlSelector } from \"../utils\";\n\nexport const isSimActiveSelector = createSimulatorControlSelector(\n  (state) => state.mode !== \"edit\"\n);\n\nexport const isSimRunningSelector = createSimulatorControlSelector(\n  (state) => state.mode === \"run\"\n);\n\nexport const isSimPausedSelector = createSimulatorControlSelector(\n  (state) => state.mode === \"pause\"\n);\n\nexport const ticksPerSecondSelector = createSimulatorControlSelector(\n  (state) => state.ticksPerSecond\n);\n","import { concatReducers } from \"@/store/utils\";\n\nimport circuitGraphInvalidatedReducer from \"./circuit-graph-invalidated\";\nimport simPauseReducer from \"./sim-pause\";\nimport simStartReducer from \"./sim-start\";\nimport simStepReducer from \"./sim-step\";\nimport simStopReducer from \"./sim-stop\";\n\nconst simulatorReducer = concatReducers(\n  circuitGraphInvalidatedReducer,\n  simPauseReducer,\n  simStartReducer,\n  simStepReducer,\n  simStopReducer\n);\n\nexport default simulatorReducer;\n","import { isPauseSimAction } from \"@/actions/sim-pause\";\n\nimport { createSimulatorControlReducer } from \"../utils\";\nimport { isSimActiveSelector } from \"../selectors/run\";\n\nexport default createSimulatorControlReducer((state, action) => {\n  if (!isPauseSimAction(action)) {\n    return state;\n  }\n\n  const { mode } = action.payload;\n\n  if (!isSimActiveSelector.local(state)) {\n    return state;\n  }\n\n  let runMode = state.mode;\n\n  switch (mode) {\n    case true:\n      runMode = \"pause\";\n      break;\n    case false:\n      runMode = \"run\";\n      break;\n    case \"toggle\":\n      runMode = runMode == \"run\" ? \"pause\" : \"run\";\n  }\n\n  return {\n    ...state,\n    mode: runMode,\n  };\n});\n","import { isStartSimAction } from \"@/actions/sim-start\";\n\nimport { createSimulatorControlReducer } from \"../utils\";\n\nexport default createSimulatorControlReducer((state, action) => {\n  if (!isStartSimAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    mode: \"run\",\n  };\n});\n","import { isStepSimAction } from \"@/actions/sim-step\";\n\nimport { createSimulatorControlReducer } from \"../utils\";\n\nexport default createSimulatorControlReducer((state, action) => {\n  if (!isStepSimAction(action)) {\n    return state;\n  }\n\n  return {\n    ...state,\n    mode: \"pause\",\n  };\n});\n","import { isStopSimAction } from \"@/actions/sim-stop\";\n\nimport { createSimulatorControlReducer } from \"../utils\";\n\nimport { defaultSimulatorControlServiceState } from \"../state\";\n\nexport default createSimulatorControlReducer((state, action) => {\n  if (!isStopSimAction(action)) {\n    return state;\n  }\n\n  // Reset the simulator but keep the ticks per second choice.\n  return {\n    ...defaultSimulatorControlServiceState,\n    ticksPerSecond: state.ticksPerSecond,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nimport { MaybeArray } from \"@/arrays\";\nimport { AnnotatedElement } from \"@/services/tutorial/state\";\n\nexport const ACTION_TUTORIAL_ANNOTATE = \"@tutorial/annotate\" as const;\nexport const tutorialAnnotate = (\n  annotations: MaybeArray<AnnotatedElement>\n) => ({\n  type: ACTION_TUTORIAL_ANNOTATE,\n  payload: { annotations },\n});\nexport type TutorialAnnotateAction = ReturnType<typeof tutorialAnnotate>;\nexport function isTutorialAnnotateAction(\n  action: AnyAction\n): action is TutorialAnnotateAction {\n  return action.type === ACTION_TUTORIAL_ANNOTATE;\n}\n","import { asArray } from \"@/arrays\";\n\nimport { isTutorialAnnotateAction } from \"@/actions/tutorial-annotate\";\n\nimport { createTutorialReducer } from \"../utils\";\n\nexport default createTutorialReducer((state, action) => {\n  if (!isTutorialAnnotateAction(action)) {\n    return state;\n  }\n\n  const { annotations } = action.payload;\n\n  return {\n    ...state,\n    annotatedElements: asArray(annotations),\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_TUTORIAL_DISMISS = \"@tutorial/dismiss\" as const;\nexport const tutorialDismiss = () => ({\n  type: ACTION_TUTORIAL_DISMISS,\n});\nexport type TutorialDismissAction = ReturnType<typeof tutorialDismiss>;\nexport function isTutorialDismissAction(\n  action: AnyAction\n): action is TutorialDismissAction {\n  return action.type === ACTION_TUTORIAL_DISMISS;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_TUTORIAL_START = \"@tutorial/start\" as const;\nexport const tutorialStart = (tutorial: string) => ({\n  type: ACTION_TUTORIAL_START,\n  payload: { tutorial },\n});\nexport type TutorialStartAction = ReturnType<typeof tutorialStart>;\nexport function isTutorialStartAction(\n  action: AnyAction\n): action is TutorialStartAction {\n  return action.type === ACTION_TUTORIAL_START;\n}\n","import { concatReducers } from \"@/store/utils\";\n\nimport tutorialAnnotateReducer from \"./tutorial-annotate\";\nimport tutorialDismissReducer from \"./tutorial-dismiss\";\nimport tutorialStartReducer from \"./tutorial-start\";\n\nexport default concatReducers(\n  tutorialAnnotateReducer,\n  tutorialDismissReducer,\n  tutorialStartReducer\n);\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\n\nimport { isTutorialDismissAction } from \"@/actions/tutorial-dismiss\";\n\nexport default (state: AppState = defaultAppState, action: AnyAction) => {\n  if (!isTutorialDismissAction(action)) {\n    return state;\n  }\n\n  return state.services.tutorial.preTutorialState ?? defaultAppState;\n};\n","import { AnyAction } from \"redux\";\n\nimport { fpSet } from \"@/utils\";\nimport { AppState, defaultAppState } from \"@/store\";\n\nimport { isTutorialStartAction } from \"@/actions/tutorial-start\";\n\nexport default (state: AppState = defaultAppState, action: AnyAction) => {\n  if (!isTutorialStartAction(action)) {\n    return state;\n  }\n\n  const { tutorial } = action.payload;\n\n  let { preTutorialState } = state.services.tutorial;\n  if (!preTutorialState) {\n    preTutorialState = state;\n  }\n\n  state = defaultAppState;\n\n  state = fpSet(state, \"services\", \"project\", \"projectName\", \"Tutorial\");\n\n  state = fpSet(state, \"services\", \"tutorial\", {\n    activeTutorial: tutorial,\n    annotatedElements: [],\n    preTutorialState,\n  });\n\n  return state;\n};\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createUiLayoutReducer = createServiceReducerCreator(\"uiLayout\");\nexport const createUiLayoutSelector = createServiceSelectorCreator(\"uiLayout\");\n","import { priorityBefore, reducerPriority } from \"@/store/priorities\";\n\nimport { isDeleteCircuitAction } from \"@/actions/circuit-delete\";\n\nimport { filterTesselValues } from \"@/components/Tessel/utils\";\n\nimport { isCircuitEditorTesselWindow } from \"@/pages/ProjectEditorPage/windows/CircuitEditorWindow/tessel-window\";\n\nimport { editorIdsFromCircuitIdSelector } from \"@/services/circuit-editors/selectors/editor\";\nimport circuitEditorsCircuitDeleteReducer from \"@/services/circuit-editors/reducer/circuit-delete\";\n\nimport { createUiLayoutReducer } from \"../utils\";\n\nexport default reducerPriority(\n  priorityBefore(circuitEditorsCircuitDeleteReducer),\n  createUiLayoutReducer((state, action, appState) => {\n    if (!isDeleteCircuitAction(action)) {\n      return state;\n    }\n\n    if (!state.layout) {\n      return state;\n    }\n\n    const { circuitId } = action.payload;\n\n    const removedWindowIds = editorIdsFromCircuitIdSelector(\n      appState,\n      circuitId\n    );\n\n    const layout = filterTesselValues(state.layout, (value) => {\n      if (!isCircuitEditorTesselWindow(value)) {\n        return true;\n      }\n\n      if (removedWindowIds.indexOf(value.windowProps.editorId) !== -1) {\n        return false;\n      }\n\n      return true;\n    });\n\n    return {\n      ...state,\n      layout,\n    };\n  })\n);\n","import { AnyAction } from \"redux\";\n\nimport { TesselValue } from \"@/components/Tessel\";\n\nexport const ACTION_LAYOUT_REARRANGE = \"@layout/rearrange\" as const;\nexport const rearrangeLayout = (layout: TesselValue) => ({\n  type: ACTION_LAYOUT_REARRANGE,\n  payload: { layout },\n});\nexport type RearrangeLayoutActionType = ReturnType<typeof rearrangeLayout>;\nexport function isRearrangeLayoutAction(\n  action: AnyAction\n): action is RearrangeLayoutActionType {\n  return action.type === ACTION_LAYOUT_REARRANGE;\n}\n","import { isRearrangeLayoutAction } from \"@/actions/layout-rearrange\";\nimport { createUiLayoutReducer } from \"../utils\";\n\nexport default createUiLayoutReducer((state, action) => {\n  if (!isRearrangeLayoutAction(action)) {\n    return state;\n  }\n\n  const { layout } = action.payload;\n\n  return {\n    ...state,\n    layout,\n  };\n});\n","import { isViewCircuitAction } from \"@/actions/view-circuit\";\n\nimport { normalizeTesselItem, TesselValue } from \"@/components/Tessel\";\nimport { findAndReplaceTesselValue } from \"@/components/Tessel/utils\";\n\nimport {\n  circuitEditorTesselWindow,\n  isCircuitEditorTesselWindow,\n} from \"@/pages/ProjectEditorPage/windows/CircuitEditorWindow/tessel-window\";\nimport { activeCircuitEditorIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nimport { createUiLayoutReducer } from \"../utils\";\n\nexport default createUiLayoutReducer((state, action, appState) => {\n  if (!isViewCircuitAction(action)) {\n    return state;\n  }\n\n  const { newWindowId } = action.payload;\n\n  if (!newWindowId) {\n    return state;\n  }\n\n  const window = circuitEditorTesselWindow(newWindowId);\n  const activeEditorId = activeCircuitEditorIdSelector(appState);\n\n  let layout: TesselValue | null = state.layout;\n\n  if (layout == null) {\n    layout = window;\n  } else {\n    let inserted = false;\n\n    // Try inserting the window alongside the active editor.\n    layout = findAndReplaceTesselValue(layout, (value) => {\n      const normalized = normalizeTesselItem(value);\n      if (\n        isCircuitEditorTesselWindow(normalized) &&\n        normalized.windowProps.editorId === activeEditorId\n      ) {\n        inserted = true;\n        return {\n          direction: \"row\",\n          division: 50,\n          first: value,\n          second: window,\n        };\n      }\n\n      return null;\n    });\n\n    if (!inserted) {\n      layout = {\n        direction: \"row\",\n        division: 50,\n        first: layout,\n        second: window,\n      };\n    }\n  }\n\n  return {\n    ...state,\n    layout,\n  };\n});\n","import { AnyAction } from \"redux\";\n\nexport const VIEW_RESET = \"@view/reset\" as const;\nexport const resetView = () => ({\n  type: VIEW_RESET,\n});\nexport type ResetViewAction = ReturnType<typeof resetView>;\nexport function isResetViewAction(\n  action: AnyAction\n): action is ResetViewAction {\n  return action.type === VIEW_RESET;\n}\n","import { concatReducers } from \"@/store/utils\";\n\nimport circuitDeleteReducer from \"./circuit-delete\";\nimport layoutRearrangeReducer from \"./layout-rearrange\";\nimport viewCircuitReducer from \"./view-circuit\";\nimport viewResetReducer from \"./view-reset\";\n\nexport default concatReducers(\n  circuitDeleteReducer,\n  layoutRearrangeReducer,\n  viewCircuitReducer,\n  viewResetReducer\n);\n","import { isResetViewAction } from \"@/actions/view-reset\";\nimport { defaultUiLayoutServiceState } from \"../state\";\nimport { createUiLayoutReducer } from \"../utils\";\n\nexport default createUiLayoutReducer((state, action) => {\n  if (!isResetViewAction(action)) {\n    return state;\n  }\n\n  return defaultUiLayoutServiceState;\n});\n","import { AnyAction } from \"redux\";\n\nexport const VIEW_ELEMENT_NAMES = \"@view/element-names\" as const;\nexport const viewElementNames = (mode: \"all\" | \"named-only\" | \"none\") => ({\n  type: VIEW_ELEMENT_NAMES,\n  payload: { mode },\n});\nexport type ViewElementNamesAction = ReturnType<typeof viewElementNames>;\nexport function isViewElementNamesAction(\n  action: AnyAction\n): action is ViewElementNamesAction {\n  return action.type === VIEW_ELEMENT_NAMES;\n}\n","import {\n  createServiceReducerCreator,\n  createServiceSelectorCreator,\n} from \"../service-state-utils\";\n\nexport const createUiSettingsReducer = createServiceReducerCreator(\n  \"uiSettings\"\n);\nexport const createUiSettingsSelector = createServiceSelectorCreator(\n  \"uiSettings\"\n);\n","import { concatReducers } from \"@/store/utils\";\n\nimport viewElementNamesReducer from \"./view-element-names\";\n\nexport default concatReducers(viewElementNamesReducer);\n","import { isViewElementNamesAction } from \"@/actions/view-element-names\";\nimport { createUiSettingsReducer } from \"../utils\";\n\nexport default createUiSettingsReducer((state, action) => {\n  if (!isViewElementNamesAction(action)) {\n    return state;\n  }\n\n  const { mode } = action.payload;\n  return {\n    ...state,\n    elementNameMode: mode,\n  };\n});\n","import servicesReducer from \"@/services/reducer\";\n\nimport { finalizeReducerList } from \"./utils\";\n\nconst reducer = finalizeReducerList(servicesReducer);\n\nexport default reducer;\n","import { concatReducers } from \"@/store/utils\";\n\nimport circuitEditorUiDragReducer from \"./circuit-editor-drag/reducer\";\nimport circuitEditorsReducer from \"./circuit-editors/reducer\";\nimport clipboardReducer from \"./clipboard/reducer\";\nimport dialogReducer from \"./dialog/reducer\";\nimport circuitGraphReducer from \"./circuit-graph/reducer\";\nimport circuitLayoutReducer from \"./circuit-layout/reducer\";\nimport circuitPropertiesReducer from \"./circuit-properties/reducer\";\nimport circuitsReducer from \"./circuits/reducer\";\nimport projectReducer from \"./project/reducer\";\nimport selectionReducer from \"./selection/reducer\";\nimport simulatorReducer from \"./simulator/reducer\";\nimport simulatorControlReducer from \"./simulator-control/reducers\";\nimport tutorialReducer from \"./tutorial/reducer\";\nimport uiLayoutReducer from \"./ui-layout/reducer\";\nimport uiSettingsReducer from \"./ui-settings/reducer\";\n\nconst reducer = concatReducers(\n  circuitEditorUiDragReducer,\n  circuitEditorsReducer,\n  clipboardReducer,\n  dialogReducer,\n  circuitGraphReducer,\n  circuitLayoutReducer,\n  circuitPropertiesReducer,\n  circuitsReducer,\n  projectReducer,\n  selectionReducer,\n  simulatorReducer,\n  simulatorControlReducer,\n  tutorialReducer,\n  uiLayoutReducer,\n  uiSettingsReducer\n);\n\nexport default reducer;\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\n\nimport { isImportCircuitAction } from \"@/actions/circuit-import\";\nimport { importCircuitsFromSave } from \"@/services/savedata/api\";\n\nexport default function circuitImportReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isImportCircuitAction(action)) {\n    return state;\n  }\n\n  const { circuitIds, saveData } = action.payload;\n\n  return importCircuitsFromSave(state, circuitIds, saveData);\n}\n","import { AnyAction } from \"redux\";\n\nimport { AppState } from \"@/store\";\n\nimport { ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE } from \"@/actions/circuit-editor-drag-continue\";\nimport { ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE } from \"@/actions/circuit-editor-mouse-leave\";\nimport { ACTION_SIM_TICK } from \"@/actions/sim-tick\";\n\nexport const actionsBlacklist: string[] = [\n  ACTION_CIRCUIT_EDITOR_DRAG_CONTINUE,\n  ACTION_CIRCUIT_EDITOR_MOUSE_LEAVE,\n  ACTION_SIM_TICK,\n];\n\nexport function actionSanitizer(action: AnyAction): AnyAction {\n  return action;\n}\n\nexport function stateSanitizer(state: AppState): any {\n  return state;\n}\n","import { SagaIterator } from \"redux-saga\";\nimport { put, take } from \"redux-saga/effects\";\n\nimport { DialogData, DialogResult, DialogType } from \"@/dialogs/types\";\n\nimport { showDialog } from \"@/actions/dialog-show\";\n\nimport {\n  AcceptDialogAction,\n  ACTION_DIALOG_RESPONSE_ACCEPT,\n} from \"@/actions/dialog-response-accept\";\nimport {\n  CancelDialogAction,\n  ACTION_DIALOG_RESPONSE_CANCEL,\n} from \"@/actions/dialog-response-cancel\";\n\nexport function* displayDialogSaga<T extends DialogType>(\n  dialogType: T,\n  data: DialogData<T>\n): SagaIterator<DialogResult<T> | null> {\n  yield put(showDialog(dialogType, data));\n  const response: AcceptDialogAction | CancelDialogAction = yield take([\n    ACTION_DIALOG_RESPONSE_ACCEPT,\n    ACTION_DIALOG_RESPONSE_CANCEL,\n  ]);\n\n  if (response.type === ACTION_DIALOG_RESPONSE_ACCEPT) {\n    return response.payload.result;\n  }\n\n  return null;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_EXPORT_LINK = \"@project/export-link\" as const;\nexport const exportProjectLink = () => ({\n  type: ACTION_PROJECT_EXPORT_LINK,\n});\nexport type ExportProjectLinkAction = ReturnType<typeof exportProjectLink>;\nexport function isExportProjectLinkAction(\n  action: AnyAction\n): action is ExportProjectLinkAction {\n  return action.type === ACTION_PROJECT_EXPORT_LINK;\n}\n","import { call, select, takeEvery } from \"redux-saga/effects\";\nimport { Buffer } from \"buffer\";\nimport { deflate } from \"pako\";\n\nimport { rootUrl } from \"@/env\";\nimport history from \"@/history\";\n\nimport { AppState } from \"@/store\";\n\nimport { displayDialogSaga } from \"@/services/dialog/api\";\n\nimport { ACTION_PROJECT_EXPORT_LINK } from \"@/actions/project-export-link\";\n\nimport { createSave } from \"@/services/savedata/api\";\n\nexport default function* projectExportLinkSaga() {\n  yield takeEvery(ACTION_PROJECT_EXPORT_LINK, onExportLink);\n}\n\nfunction* onExportLink() {\n  const state: AppState = yield select();\n\n  try {\n    const save = createSave(state);\n    const saveText = JSON.stringify(save);\n    const encoded = deflate(saveText);\n\n    const encodedText = Buffer.from(encoded).toString(\"base64\");\n\n    const urlData = encodeURIComponent(encodedText);\n\n    const projectLink =\n      rootUrl +\n      history.createHref({\n        pathname: \"/import\",\n        search: `data=${urlData}`,\n      });\n\n    yield call(displayDialogSaga, \"export-project-link\", { projectLink });\n  } catch (e) {\n    // TODO: Warn user of failure\n    console.error(\"Failed to export project as link\", e);\n  }\n}\n","export const ACTION_PROJECT_IMPORT_CIRCUITS = \"@project/import-circuits\" as const;\nexport const importCircuitFromProject = () => ({\n  type: ACTION_PROJECT_IMPORT_CIRCUITS,\n});\n","import fileDialog from \"file-dialog\";\nimport { SagaIterator } from \"redux-saga\";\nimport { call, put, takeEvery } from \"redux-saga/effects\";\n\nimport { elementTypeToCircuitId } from \"@/elements/definitions/integrated-circuits/utils\";\n\nimport { ACTION_PROJECT_IMPORT_CIRCUITS } from \"@/actions/project-import-circuits\";\nimport { importCircuits } from \"@/actions/circuit-import\";\n\nimport { SaveData } from \"@/services/savedata/types\";\nimport { displayDialogSaga } from \"@/services/dialog/api\";\nimport { ROOT_CIRCUIT_ID } from \"@/services/circuits/constants\";\n\nexport default function* projectImportCircuitsSaga() {\n  yield takeEvery(ACTION_PROJECT_IMPORT_CIRCUITS, handleProjectImportCircuits);\n}\n\nfunction* handleProjectImportCircuits(): SagaIterator {\n  const [file]: File[] = yield call(fileDialog, {\n    accept: \"application/json\",\n  });\n  const contents = yield call(file.text.bind(file));\n  const saveData: SaveData = JSON.parse(contents);\n\n  const result: string[] | undefined = yield call(\n    displayDialogSaga,\n    \"import-project-circuits\",\n    {\n      circuits: saveData.circuits.filter(\n        (x) => x.circuitId !== ROOT_CIRCUIT_ID\n      ),\n    }\n  );\n\n  if (!Array.isArray(result)) {\n    return;\n  }\n\n  const scanCircuitIds = result;\n  const targetCircuitIds: string[] = [];\n  // Scan through the list of circuits and import dependencies.\n  let circuitId: string | undefined;\n  while ((circuitId = scanCircuitIds.pop())) {\n    targetCircuitIds.push(circuitId);\n    for (const element of saveData.elements) {\n      const { circuitId: elementCircuitId, elementType: elementType } = element;\n      if (circuitId !== elementCircuitId) {\n        continue;\n      }\n      const elementIcCircuitId = elementTypeToCircuitId(elementType);\n      if (elementIcCircuitId == null) {\n        continue;\n      }\n      scanCircuitIds.push(elementIcCircuitId);\n    }\n  }\n\n  yield put(importCircuits(targetCircuitIds, saveData));\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_IMPORT_LINK = \"@project/import-link\" as const;\nexport const importProjectLink = (data: string) => ({\n  type: ACTION_PROJECT_IMPORT_LINK,\n  payload: { data },\n});\nexport type ImportProjectLinkAction = ReturnType<typeof importProjectLink>;\nexport function isImportProjectLinkAction(\n  action: AnyAction\n): action is ImportProjectLinkAction {\n  return action.type === ACTION_PROJECT_IMPORT_LINK;\n}\n","import { put, takeEvery } from \"redux-saga/effects\";\nimport { Buffer } from \"buffer\";\n\nimport { inflate } from \"pako\";\n\nimport {\n  ACTION_PROJECT_IMPORT_LINK,\n  ImportProjectLinkAction,\n} from \"@/actions/project-import-link\";\n\nimport { receiveProject } from \"@/actions/project-receive\";\nimport history from \"@/history\";\n\nexport default function* projectImportLinkSaga() {\n  yield takeEvery(ACTION_PROJECT_IMPORT_LINK, onImportLink);\n}\n\nfunction* onImportLink(action: ImportProjectLinkAction) {\n  const { data } = action.payload;\n  try {\n    const dewrapped = decodeURIComponent(data);\n    const deflated = Buffer.from(dewrapped, \"base64\");\n    const saveText = inflate(deflated, { to: \"string\" });\n    const save = JSON.parse(saveText);\n\n    yield put(receiveProject(\"Linked Project\", save));\n\n    history.replace(\"/\");\n  } catch (e) {\n    console.error(\"Failed to import save from link\", e);\n  }\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_PROJECT_LOAD = \"@project/load\" as const;\nexport const loadProject = () => ({\n  type: ACTION_PROJECT_LOAD,\n});\nexport type LoadProjectAction = ReturnType<typeof loadProject>;\nexport function isLoadProjectAction(\n  action: AnyAction\n): action is LoadProjectAction {\n  return action.type === ACTION_PROJECT_LOAD;\n}\n","import { SagaIterator } from \"redux-saga\";\nimport { call, put, takeEvery } from \"redux-saga/effects\";\nimport fileDialog from \"file-dialog\";\n\nimport { ACTION_PROJECT_LOAD } from \"@/actions/project-load\";\nimport { receiveProject } from \"@/actions/project-receive\";\n\nimport { SaveData } from \"@/services/savedata/types\";\n\nexport default function* projectLoadSaga() {\n  yield takeEvery(ACTION_PROJECT_LOAD, loadProject);\n}\n\nfunction* loadProject(): SagaIterator {\n  try {\n    const [file]: File[] = yield call(fileDialog, {\n      accept: \"application/json\",\n    });\n    const contents = yield call(file.text.bind(file));\n    const saveData: SaveData = JSON.parse(contents);\n    let fileName = file.name;\n    if (fileName) {\n      fileName = fileName.substr(0, fileName.lastIndexOf(\".json\"));\n    } else {\n      fileName = \"Unnamed Project\";\n    }\n    yield put(receiveProject(fileName, saveData));\n  } catch (e) {\n    // TODO: Handle error\n    console.warn(\"Failed to load project:\", e);\n  }\n}\n","import { createProjectSelector } from \"../utils\";\n\nexport const projectNameSelector = createProjectSelector(\n  (state) => state.projectName\n);\n\nexport const projectModifiedSelector = createProjectSelector(\n  (state) => state.projectModified\n);\n","import { SagaIterator } from \"redux-saga\";\nimport { call, put, select, takeEvery } from \"redux-saga/effects\";\nimport { saveAs } from \"file-saver\";\n\nimport { AppState } from \"@/store\";\n\nimport {\n  ACTION_PROJECT_SAVE,\n  saveProjectSuccess,\n} from \"@/actions/project-save\";\nimport { renameProject } from \"@/actions/project-rename\";\n\nimport { createSave } from \"@/services/savedata/api\";\n\nimport { projectNameSelector } from \"../selectors/project\";\n\nexport default function* projectSaveSaga() {\n  yield takeEvery(ACTION_PROJECT_SAVE, saveProject);\n}\n\nfunction* saveProject() {\n  const state: AppState = yield select();\n\n  try {\n    if (window.showSaveFilePicker) {\n      yield call(saveNativeFileApi, state);\n    } else {\n      yield call(saveLegacy, state);\n    }\n    yield put(saveProjectSuccess());\n  } catch (e) {\n    // TODO: Report error\n    console.warn(\"Failed to save project\", e);\n  }\n}\n\nfunction* saveNativeFileApi(state: AppState): SagaIterator {\n  const projectName = yield select(projectNameSelector);\n\n  const fileHandle: FileHandle | null = yield call(window.showSaveFilePicker!, {\n    // This isn't official yet, even with the not-official showSaveFilePicker\n    // https://github.com/WICG/file-system-access/blob/main/SuggestedNameAndDir.md#specifying-suggested-file-name-to-save-as\n    // It's so new, chrome does not yet support it, but it will:\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=1145102\n    suggestedName: projectName,\n    types: [\n      {\n        description: \"Discrelog Project Files\",\n        accept: {\n          \"application/json\": [\".json\"],\n        },\n      },\n    ],\n  });\n\n  if (!fileHandle) {\n    return;\n  }\n\n  // Some confusion over how to get the name of the file...\n  // fileHandle.name appears in the debugger for chrome, but does not\n  // seem to be documented.\n  // getFile().name is documented by mozilla, but gives me undefined.\n  let name = fileHandle.name;\n  if (!name) {\n    name = fileHandle.getFile().name;\n  }\n  if (name) {\n    name = name.substr(0, name.lastIndexOf(\".json\"));\n    yield put(renameProject(name));\n  }\n\n  const save = createSave(state);\n\n  const writable: FileSystemWritableStream = yield call(\n    fileHandle.createWritable.bind(fileHandle)\n  );\n  yield call(writable.write.bind(writable), JSON.stringify(save, null, 2));\n  yield call(writable.close.bind(writable));\n}\n\nfunction* saveLegacy(state: AppState): SagaIterator {\n  const projectName = yield select(projectNameSelector);\n\n  const save = createSave(state);\n  const blob = new Blob([JSON.stringify(save, null, 2)], {\n    type: \"application/json;charset=utf-8\",\n  });\n\n  saveAs(blob, `${projectName}.json`);\n}\n","import { fork } from \"redux-saga/effects\";\n\nimport projectExportLink from \"./project-export-link\";\nimport projectImportCircuits from \"./project-import-circuits\";\nimport projectImportLink from \"./project-import-link\";\nimport projectLoadSaga from \"./project-load\";\nimport projectSaveSaga from \"./project-save\";\n\nexport default function* saveDataSaga() {\n  yield fork(projectExportLink);\n  yield fork(projectImportCircuits);\n  yield fork(projectImportLink);\n  yield fork(projectLoadSaga);\n  yield fork(projectSaveSaga);\n}\n","import { SagaIterator } from \"redux-saga\";\nimport { takeLeading, select, put, delay } from \"redux-saga/effects\";\n\nimport { ACTION_SIM_START } from \"@/actions/sim-start\";\nimport { ACTION_SIM_PAUSE, pauseSim } from \"@/actions/sim-pause\";\nimport { ACTION_SIM_STEP } from \"@/actions/sim-step\";\n\nimport { tickSim } from \"@/actions/sim-tick\";\n\nimport { isSimRunningSelector, ticksPerSecondSelector } from \"../selectors/run\";\n\nexport default function* runModeSaga() {\n  yield takeLeading(\n    [ACTION_SIM_START, ACTION_SIM_PAUSE, ACTION_SIM_STEP],\n    handleRunSim\n  );\n}\n\nfunction* handleRunSim(): SagaIterator {\n  while (true) {\n    const isRunning = yield select(isSimRunningSelector);\n    if (!isRunning) {\n      break;\n    }\n\n    try {\n      yield put(tickSim(1));\n    } catch (e) {\n      console.error(e);\n      yield put(pauseSim(true));\n      return;\n    }\n\n    const tps = yield select(ticksPerSecondSelector);\n    const timeToWait = Math.max(Math.ceil(1000 / tps), 1);\n    yield delay(timeToWait);\n  }\n}\n","import { fork } from \"redux-saga/effects\";\n\nimport runModeSaga from \"./mode-run\";\n\nexport default function* simulatorSaga() {\n  yield fork(runModeSaga);\n}\n","export function getCircuitEditorHtmlId(editorId: string) {\n  return `circuit-editor-${editorId}`;\n}\n\nexport function getElementHtmlId(editorId: string, elementId: string) {\n  return `editor-${editorId}--element-${elementId}`;\n}\n\nexport function getElementPinHtmlId(\n  editorId: string,\n  elementId: string,\n  pinId: string\n): string {\n  return `editor-${editorId}--element-${elementId}--pin-${pinId}`;\n}\n","import { AnyAction } from \"redux\";\n\nexport const ACTION_TUTORIAL_NEXT = \"@tutorial/next\" as const;\nexport const tutorialNext = () => ({\n  type: ACTION_TUTORIAL_NEXT,\n});\nexport type TutorialNextAction = ReturnType<typeof tutorialNext>;\nexport function isTutorialNextAction(\n  action: AnyAction\n): action is TutorialNextAction {\n  return action.type === ACTION_TUTORIAL_NEXT;\n}\n","import { AnyAction } from \"redux\";\nimport { SagaIterator } from \"redux-saga\";\nimport { call, put, select, take } from \"redux-saga/effects\";\nimport { Options } from \"@popperjs/core\";\n\nimport { ElementDefinition } from \"@/elements/types\";\n\nimport { activeCircuitEditorIdSelector } from \"@/services/circuit-editors/selectors/editor\";\nimport { elementDefinitionFromTypeSelector } from \"@/services/element-types/selectors/element-types\";\nimport {\n  Connection,\n  ElementPin,\n  elementPinEquals,\n} from \"@/services/circuit-graph/types\";\nimport { connectionsSelector } from \"@/services/circuit-graph/selectors/connections\";\n\nimport { ACTION_ELEMENT_ADD, AddElementAction } from \"@/actions/element-add\";\nimport { tutorialAnnotate } from \"@/actions/tutorial-annotate\";\nimport { ACTION_CIRCUIT_EDITOR_DRAG_END } from \"@/actions/circuit-editor-drag-end\";\nimport { ACTION_TUTORIAL_NEXT, tutorialNext } from \"@/actions/tutorial-next\";\nimport { getCircuitEditorHtmlId } from \"@/components/CircuitEditor/ids\";\n\nexport interface AddElementTutorialStepOptions {\n  trayMessage?: string;\n  fieldMessage?: string;\n}\nexport function* addElementTutorialStep(\n  elementType: string,\n  opts: AddElementTutorialStepOptions = {}\n): SagaIterator<string | null> {\n  const def: ElementDefinition = yield select((state) =>\n    elementDefinitionFromTypeSelector(state, elementType)\n  );\n  if (!def) {\n    return null;\n  }\n\n  const activeEditorId: string | null = yield select(\n    activeCircuitEditorIdSelector\n  );\n  if (!activeEditorId) {\n    return null;\n  }\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: `#element-tray--element-${elementType}`,\n        message: opts.trayMessage ?? `This is a ${def.displayName} element`,\n      },\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n        message:\n          opts.fieldMessage ??\n          `Drag the ${def.displayName} element onto the circuit field.`,\n        placement: \"top\",\n      },\n    ])\n  );\n\n  const addElementAction: AddElementAction = yield call(() =>\n    waitFilterAction(\n      ACTION_ELEMENT_ADD,\n      ({ payload: { elementType: addedElementType } }) =>\n        addedElementType === elementType\n    )\n  );\n\n  return addElementAction.payload.elementId;\n}\n\nexport function* waitNodeWired(outputPin: ElementPin, inputPin: ElementPin) {\n  while (true) {\n    const wired: boolean = yield call(isWired, outputPin, inputPin);\n    if (wired) {\n      return;\n    }\n    // TODO: We can only detect wiring through drag end.  Might want to make drag use real actions\n    //  and wait on wire action instead.\n    yield take(ACTION_CIRCUIT_EDITOR_DRAG_END);\n  }\n}\n\nfunction* isWired(\n  outputPin: ElementPin,\n  inputPin: ElementPin\n): SagaIterator<boolean> {\n  const connections: Connection[] = yield select(connectionsSelector);\n  return connections.some(\n    ({ inputPin: connInputPin, outputPin: connOutputPin }) =>\n      elementPinEquals(connInputPin, inputPin) &&\n      elementPinEquals(connOutputPin, outputPin)\n  );\n}\n\nexport function waitFilterAction(\n  actionType: string,\n  filter: (action: AnyAction) => boolean\n): SagaIterator<AnyAction>;\nexport function waitFilterAction<T extends AnyAction>(\n  actionType: string,\n  filter: (action: T) => boolean\n): SagaIterator<T>;\nexport function* waitFilterAction(\n  actionType: string,\n  filter: (action: any) => boolean\n): SagaIterator<any> {\n  let action: AnyAction;\n  while ((action = yield take(actionType))) {\n    if (!filter(action)) {\n      continue;\n    }\n    break;\n  }\n\n  return action;\n}\n\nexport interface TutorialNextMessageOptions {\n  placement?: Options[\"placement\"];\n  additionalSelectors?: string[];\n}\nexport function* tutorialNextMessage(\n  selector: string,\n  message: string,\n  opts: TutorialNextMessageOptions = {}\n) {\n  yield put(\n    tutorialAnnotate([\n      {\n        selector,\n        message,\n        placement: opts.placement,\n        action: {\n          name: \"Next\",\n          action: tutorialNext(),\n        },\n      },\n      ...(opts.additionalSelectors ?? []).map((selector) => ({ selector })),\n    ])\n  );\n\n  yield take(ACTION_TUTORIAL_NEXT);\n}\n","import { call, put, select, take } from \"redux-saga/effects\";\n\nimport { arrayEquals } from \"@/arrays\";\n\nimport {\n  ACTION_ELEMENT_INTERACT,\n  InteractElementAction,\n} from \"@/actions/element-interact\";\nimport { ACTION_SIM_START } from \"@/actions/sim-start\";\nimport { tutorialAnnotate } from \"@/actions/tutorial-annotate\";\nimport { tutorialDismiss } from \"@/actions/tutorial-dismiss\";\n\nimport { activeCircuitEditorIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nimport {\n  getCircuitEditorHtmlId,\n  getElementHtmlId,\n  getElementPinHtmlId,\n} from \"@/components/CircuitEditor/ids\";\n\nimport {\n  addElementTutorialStep,\n  tutorialNextMessage,\n  waitFilterAction,\n  waitNodeWired,\n} from \"./utils\";\n\nexport default function* runBasicsTutorial() {\n  yield call(\n    tutorialNextMessage,\n    \"#element-tray\",\n    \"This is where logic elements are stored.\"\n  );\n\n  const gateId: string | null = yield call(addElementTutorialStep, \"logic-not\");\n  if (!gateId) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  const switchId: string | null = yield call(\n    addElementTutorialStep,\n    \"interaction-momentary\"\n  );\n  if (!switchId) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  const ledId: string | null = yield call(addElementTutorialStep, \"output-led\");\n  if (!ledId) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  const activeEditorId: string | null = yield select(\n    activeCircuitEditorIdSelector\n  );\n  if (!activeEditorId) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, switchId, \"OUT\"),\n        message: \"This is the switch's output pin.\",\n        placement: \"top\",\n      },\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, gateId, \"IN\"),\n        message: \"This is the logic gate's input pin.\",\n        placement: \"bottom\",\n      },\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n        message: \"Click and drag from one pin to another to connect them.\",\n        placement: \"top\",\n      },\n    ])\n  );\n\n  yield call(\n    waitNodeWired,\n    { elementId: switchId, pinId: \"OUT\" },\n    { elementId: gateId, pinId: \"IN\" }\n  );\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, gateId, \"OUT\"),\n        message: \"This is the logic gate's output pin.\",\n        placement: \"top\",\n      },\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, ledId, \"IN\"),\n        message: \"This is the LED's input pin.\",\n        placement: \"bottom\",\n      },\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n        message: \"Click and drag from one pin to another to connect them.\",\n        placement: \"top\",\n      },\n    ])\n  );\n\n  yield call(\n    waitNodeWired,\n    { elementId: gateId, pinId: \"OUT\" },\n    { elementId: ledId, pinId: \"IN\" }\n  );\n\n  yield put(\n    tutorialAnnotate({\n      selector: \"#simctrl-run\",\n      message: \"Click here to run the simulation.\",\n    })\n  );\n\n  yield take(ACTION_SIM_START);\n\n  yield put(\n    tutorialAnnotate([\n      // Unfortunately, since we use absolute positioning, the z-index on the element will not function unless\n      // we also raise the field\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n      },\n      {\n        selector: \"#\" + getElementHtmlId(activeEditorId, switchId),\n        message:\n          \"Click the switch to activate it.  Momentary switches need to be held.\",\n      },\n    ])\n  );\n\n  yield call(() =>\n    waitFilterAction<InteractElementAction>(\n      ACTION_ELEMENT_INTERACT,\n      ({ payload: { elementIdPath, data } }) =>\n        data === true && arrayEquals(elementIdPath, [switchId])\n    )\n  );\n\n  yield put(\n    tutorialAnnotate({\n      selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n      placement: \"top\",\n      message: \"That's it!\",\n      action: {\n        name: \"End Tutorial\",\n        action: tutorialDismiss(),\n      },\n    })\n  );\n}\n","export function getCircuitListItemHtmlId(circuitId: string) {\n  return `circuit-list--circuit-${circuitId}`;\n}\n","import { call, put, select, take } from \"redux-saga/effects\";\n\nimport { arrayEquals } from \"@/arrays\";\n\nimport { circuitIdToElementType } from \"@/elements/definitions/integrated-circuits/utils\";\n\nimport { tutorialAnnotate } from \"@/actions/tutorial-annotate\";\nimport { tutorialDismiss } from \"@/actions/tutorial-dismiss\";\nimport { ACTION_CIRCUIT_ADD, AddCircuitAction } from \"@/actions/circuit-add\";\nimport { ACTION_CIRCUIT_RENAME } from \"@/actions/circuit-rename\";\nimport { ACTION_VIEW_CIRCUIT, ViewCircuitAction } from \"@/actions/view-circuit\";\nimport {\n  ACTION_ELEMENT_INTERACT,\n  InteractElementAction,\n} from \"@/actions/element-interact\";\nimport { ACTION_SIM_START } from \"@/actions/sim-start\";\nimport {\n  ACTION_ELEMENT_RENAME,\n  RenameElementAction,\n} from \"@/actions/element-rename\";\n\nimport { activeCircuitEditorIdSelector } from \"@/services/circuit-editors/selectors/editor\";\nimport { ROOT_CIRCUIT_ID } from \"@/services/circuits/constants\";\n\nimport { getCircuitListItemHtmlId } from \"@/pages/ProjectEditorPage/windows/CircuitsTreeWindow/ids\";\n\nimport {\n  getCircuitEditorHtmlId,\n  getElementHtmlId,\n  getElementPinHtmlId,\n} from \"@/components/CircuitEditor/ids\";\n\nimport {\n  addElementTutorialStep,\n  tutorialNextMessage,\n  waitFilterAction,\n  waitNodeWired,\n} from \"./utils\";\n\nexport default function* runCircuitsTutorial() {\n  yield call(\n    tutorialNextMessage,\n    \"#circuit-list-window\",\n    \"Circuits are collections of elements that can be reused as ICs.\"\n  );\n\n  yield put(\n    tutorialAnnotate({\n      selector: \"#circuit-list\",\n      message: \"Right click on the circuit list to create a new circuit.\",\n    })\n  );\n\n  const addCircuitAction: AddCircuitAction = yield take(ACTION_CIRCUIT_ADD);\n  const { circuitId } = addCircuitAction.payload;\n\n  yield put(\n    tutorialAnnotate({\n      selector: \"#\" + getCircuitListItemHtmlId(circuitId),\n      message: \"Here is your circuit.  Double click it to rename it.\",\n    })\n  );\n\n  yield take(ACTION_CIRCUIT_RENAME);\n\n  yield put(\n    tutorialAnnotate({\n      selector: \"#\" + getCircuitListItemHtmlId(circuitId),\n      message: \"Click the circuit to view it in the active editor window.\",\n    })\n  );\n\n  yield call(() =>\n    waitFilterAction<ViewCircuitAction>(\n      ACTION_VIEW_CIRCUIT,\n      (action) => action.payload.circuitId === circuitId\n    )\n  );\n\n  const activeEditorId: string | null = yield select(\n    activeCircuitEditorIdSelector\n  );\n  if (!activeEditorId) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  const inputPinId: string | null = yield call(\n    addElementTutorialStep,\n    \"pin-input\"\n  );\n  if (!inputPinId) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  yield call(\n    tutorialNextMessage,\n    \"#\" + getElementHtmlId(activeEditorId, inputPinId),\n    \"Input pins take a signal from outside for use in your circuit.\",\n    { additionalSelectors: [\"#\" + getCircuitEditorHtmlId(activeEditorId)] }\n  );\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n      },\n      {\n        selector: \"#\" + getElementHtmlId(activeEditorId, inputPinId),\n        message:\n          \"Rename the pin by right clicking it and clicking on the bolded text.  Choose any name you like\",\n      },\n    ])\n  );\n\n  yield call(() =>\n    waitFilterAction<RenameElementAction>(\n      ACTION_ELEMENT_RENAME,\n      (action) => action.payload.elementId === inputPinId\n    )\n  );\n\n  yield call(\n    tutorialNextMessage,\n    \"#\" + getElementHtmlId(activeEditorId, inputPinId),\n    \"Pin names will appear on the body of the IC when used in other circuits.  Be sure to name your pins!\"\n  );\n\n  const outputPinId1: string | null = yield call(\n    addElementTutorialStep,\n    \"pin-output\"\n  );\n  if (!outputPinId1) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  yield call(\n    tutorialNextMessage,\n    \"#\" + getElementHtmlId(activeEditorId, outputPinId1),\n    \"Output pins take a signal from your circuit and send it to the outside world.\"\n  );\n\n  const outputPinId2: string | null = yield call(\n    addElementTutorialStep,\n    \"pin-output\",\n    {\n      trayMessage: \"Let's take another output pin\",\n      fieldMessage:\n        \"When multiple pins are used, the pins will stack in their vertical orientation on the IC\",\n    }\n  );\n\n  if (!outputPinId2) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  yield call(\n    tutorialNextMessage,\n    \"#\" + getCircuitEditorHtmlId(activeEditorId),\n    \"Let's put together a simple circuit.\",\n    { placement: \"top\" }\n  );\n\n  const bufferId: string | null = yield call(\n    addElementTutorialStep,\n    \"logic-buffer\"\n  );\n  if (!bufferId) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  const notId: string | null = yield call(addElementTutorialStep, \"logic-not\");\n  if (!notId) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, inputPinId, \"OUT\"),\n        message: \"Connect the input signal pin...\",\n        placement: \"top\",\n      },\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, bufferId, \"IN\"),\n        message: \"...to the buffer's input.\",\n        placement: \"bottom\",\n      },\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n        message: \"Click and drag from one pin to another to connect them.\",\n        placement: \"top\",\n      },\n    ])\n  );\n\n  yield call(\n    waitNodeWired,\n    { elementId: inputPinId, pinId: \"OUT\" },\n    { elementId: bufferId, pinId: \"IN\" }\n  );\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, bufferId, \"OUT\"),\n        message: \"Connect the buffer's output pin...\",\n        placement: \"top\",\n      },\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, outputPinId1, \"IN\"),\n        message: \"...to the IC's first output.\",\n        placement: \"bottom\",\n      },\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n        message: \"Click and drag from one pin to another to connect them.\",\n        placement: \"top\",\n      },\n    ])\n  );\n\n  yield call(\n    waitNodeWired,\n    { elementId: bufferId, pinId: \"OUT\" },\n    { elementId: outputPinId1, pinId: \"IN\" }\n  );\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, inputPinId, \"OUT\"),\n        message: \"Connect the input signal pin...\",\n        placement: \"top\",\n      },\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, notId, \"IN\"),\n        message: \"...to the NOT's input.\",\n        placement: \"bottom\",\n      },\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n        message: \"Click and drag from one pin to another to connect them.\",\n        placement: \"top\",\n      },\n    ])\n  );\n\n  yield call(\n    waitNodeWired,\n    { elementId: inputPinId, pinId: \"OUT\" },\n    { elementId: notId, pinId: \"IN\" }\n  );\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, notId, \"OUT\"),\n        message: \"Connect the NOT's output...\",\n        placement: \"top\",\n      },\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, outputPinId2, \"IN\"),\n        message: \"...to the second IC output.\",\n        placement: \"bottom\",\n      },\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n        message: \"Click and drag from one pin to another to connect them.\",\n        placement: \"top\",\n      },\n    ])\n  );\n\n  yield call(\n    waitNodeWired,\n    { elementId: notId, pinId: \"OUT\" },\n    { elementId: outputPinId2, pinId: \"IN\" }\n  );\n\n  yield put(\n    tutorialAnnotate({\n      selector: \"#\" + getCircuitListItemHtmlId(ROOT_CIRCUIT_ID),\n      message:\n        \"We now have a functional IC.  Let's go to the root project and make use of it\",\n    })\n  );\n\n  yield call(() =>\n    waitFilterAction<ViewCircuitAction>(\n      ACTION_VIEW_CIRCUIT,\n      (action) => action.payload.circuitId === ROOT_CIRCUIT_ID\n    )\n  );\n\n  const icType = circuitIdToElementType(circuitId);\n\n  const icId: string | null = yield call(addElementTutorialStep, icType);\n  if (!icId) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  yield call(\n    tutorialNextMessage,\n    \"#\" + getCircuitEditorHtmlId(activeEditorId),\n    \"Let's wire it up to see it in action.\",\n    { placement: \"top\" }\n  );\n\n  const switchId: string | null = yield call(\n    addElementTutorialStep,\n    \"interaction-momentary\"\n  );\n  if (!switchId) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  const led1Id: string | null = yield call(\n    addElementTutorialStep,\n    \"output-led\",\n    { trayMessage: \"Make an LED to check the status of the first pin.\" }\n  );\n  if (!led1Id) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  const led2Id: string | null = yield call(\n    addElementTutorialStep,\n    \"output-led\",\n    { trayMessage: \"Make an LED to check the status of the second pin.\" }\n  );\n  if (!led2Id) {\n    yield put(tutorialDismiss());\n    return;\n  }\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, switchId, \"OUT\"),\n        message: \"Connect the switch output...\",\n        placement: \"top\",\n      },\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, icId, inputPinId),\n        message: \"...to the IC input.\",\n        placement: \"bottom\",\n      },\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n        message: \"Click and drag from one pin to another to connect them.\",\n        placement: \"top\",\n      },\n    ])\n  );\n\n  yield call(\n    waitNodeWired,\n    { elementId: switchId, pinId: \"OUT\" },\n    { elementId: icId, pinId: inputPinId }\n  );\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, icId, outputPinId1),\n        message: \"Connect the first IC output...\",\n        placement: \"top\",\n      },\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, led1Id, \"IN\"),\n        message: \"...to the first LED.\",\n        placement: \"bottom\",\n      },\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n        message: \"Click and drag from one pin to another to connect them.\",\n        placement: \"top\",\n      },\n    ])\n  );\n\n  yield call(\n    waitNodeWired,\n    { elementId: icId, pinId: outputPinId1 },\n    { elementId: led1Id, pinId: \"IN\" }\n  );\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, icId, outputPinId1),\n        message: \"Connect the first IC output...\",\n        placement: \"top\",\n      },\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, led1Id, \"IN\"),\n        message: \"...to the first LED.\",\n        placement: \"bottom\",\n      },\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n        message: \"Click and drag from one pin to another to connect them.\",\n        placement: \"top\",\n      },\n    ])\n  );\n\n  yield call(\n    waitNodeWired,\n    { elementId: icId, pinId: outputPinId1 },\n    { elementId: led1Id, pinId: \"IN\" }\n  );\n\n  yield put(\n    tutorialAnnotate([\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, icId, outputPinId2),\n        message: \"Connect the second IC output...\",\n        placement: \"top\",\n      },\n      {\n        selector: \"#\" + getElementPinHtmlId(activeEditorId, led2Id, \"IN\"),\n        message: \"...to the second LED.\",\n        placement: \"bottom\",\n      },\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n        message: \"Click and drag from one pin to another to connect them.\",\n        placement: \"top\",\n      },\n    ])\n  );\n\n  yield call(\n    waitNodeWired,\n    { elementId: icId, pinId: outputPinId2 },\n    { elementId: led2Id, pinId: \"IN\" }\n  );\n\n  yield put(\n    tutorialAnnotate({\n      selector: \"#simctrl-run\",\n      message: \"Click here to run the simulation.\",\n    })\n  );\n\n  yield take(ACTION_SIM_START);\n\n  yield put(\n    tutorialAnnotate([\n      // Unfortunately, since we use absolute positioning, the z-index on the element will not function unless\n      // we also raise the field\n      {\n        selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n      },\n      {\n        selector: \"#\" + getElementHtmlId(activeEditorId, switchId),\n        message:\n          \"Click the switch to activate it.  Momentary switches need to be held.\",\n      },\n    ])\n  );\n\n  yield call(() =>\n    waitFilterAction<InteractElementAction>(\n      ACTION_ELEMENT_INTERACT,\n      ({ payload: { elementIdPath, data } }) =>\n        data === true && arrayEquals(elementIdPath, [switchId])\n    )\n  );\n\n  yield put(\n    tutorialAnnotate({\n      selector: \"#\" + getCircuitEditorHtmlId(activeEditorId),\n      placement: \"top\",\n      message:\n        \"You can place as many copies of an IC as you want.  Circuits can also contain other ICs.\",\n      action: {\n        name: \"End Tutorial\",\n        action: tutorialDismiss(),\n      },\n    })\n  );\n}\n","import { call, takeEvery } from \"redux-saga/effects\";\n\nimport {\n  ACTION_TUTORIAL_START,\n  TutorialStartAction,\n} from \"@/actions/tutorial-start\";\n\nimport runBasicsTutorial from \"./tutorials/basic\";\nimport runCircuitsTutorial from \"./tutorials/circuits\";\n\nexport default function* startTutorial() {\n  yield takeEvery(ACTION_TUTORIAL_START, handleStartTutorial);\n}\n\nfunction* handleStartTutorial(action: TutorialStartAction) {\n  const { tutorial } = action.payload;\n  switch (tutorial) {\n    case \"basics\":\n      yield call(runBasicsTutorial);\n      return;\n    case \"circuits\":\n      yield call(runCircuitsTutorial);\n  }\n}\n","import { fork } from \"redux-saga/effects\";\n\nimport tutorialsSaga from \"./tutorials\";\n\nexport default function* tutorialSaga() {\n  yield fork(tutorialsSaga);\n}\n","import servicesSaga from \"@/services/saga\";\n\nexport default servicesSaga;\n","import {\n  createStore,\n  compose,\n  applyMiddleware,\n  AnyAction,\n  Middleware,\n} from \"redux\";\nimport freeze from \"redux-freeze\";\nimport createSagaMiddleware from \"redux-saga\";\n\nimport { isTruthy } from \"@/utils\";\nimport { isProd } from \"@/env\";\n\nimport { doInit } from \"@/actions/init\";\n\nimport undoReducer from \"@/undo/reducer\";\n\nimport {\n  actionSanitizer,\n  stateSanitizer,\n  actionsBlacklist,\n} from \"./devtool-sanitizer\";\n\nimport { AppState, defaultAppState } from \"./state\";\nimport saga from \"./saga\";\nimport rootReducer from \"./reducer\";\n\nfunction finalReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  state = undoReducer(state, action);\n  state = rootReducer(state, action);\n  return state;\n}\n\nconst composeEnhancers =\n  (window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ &&\n    window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({\n      actionSanitizer,\n      stateSanitizer,\n      actionsBlacklist,\n    })) ||\n  compose;\n\nconst sagaMiddleware = createSagaMiddleware();\n\nconst middleware: Middleware<any, any, any>[] = [\n  !isProd && freeze,\n  sagaMiddleware,\n].filter(isTruthy);\n\nexport const store = createStore(\n  finalReducer,\n  composeEnhancers(applyMiddleware(...middleware))\n);\n\nsagaMiddleware.run(saga);\nstore.dispatch(doInit());\n","import { AnyAction } from \"redux\";\n\nimport { AppState, defaultAppState } from \"@/store\";\n\nimport captureUndoStateReducer from \"./capture-undo-state\";\nimport redoReducer from \"./redo\";\nimport undoReducer from \"./undo\";\n\n// The undo reducer is special and returns a single reducer that is always ran outside of the primary reducer stack.\n// This is less for reducer priority and more to capture the effects of reentrant reducers like clipboard-paste.\n// FIXME: Moving this outside the services system means autosave cannot save undo/redo.  Either move autosave out\n//  as well or move undo into services.\nexport default function undoServiceReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  state = captureUndoStateReducer(state, action);\n  state = redoReducer(state, action);\n  state = undoReducer(state, action);\n  return state;\n}\n","import { AnyAction } from \"redux\";\nimport last from \"lodash/last\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isUndoAction } from \"@/actions/undo\";\nimport { viewCircuit } from \"@/actions/view-circuit\";\n\nimport { captureUndoState } from \"../utils\";\n\nexport default function undoReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isUndoAction(action)) {\n    return state;\n  }\n\n  const { undoStack, redoStack } = state.undo;\n\n  const stackItem = last(undoStack);\n  if (!stackItem) {\n    return state;\n  }\n\n  const { serviceStates, viewCircuitId } = stackItem;\n\n  state = {\n    ...state,\n    services: {\n      ...state.services,\n      ...serviceStates,\n    },\n    undo: {\n      ...state.undo,\n      undoStack: undoStack.slice(0, undoStack.length - 1),\n      redoStack: [...redoStack, captureUndoState(state)],\n    },\n  };\n\n  if (viewCircuitId) {\n    state = rootReducer(state, viewCircuit(viewCircuitId));\n  }\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\nimport last from \"lodash/last\";\n\nimport { AppState, defaultAppState } from \"@/store\";\nimport rootReducer from \"@/store/reducer\";\n\nimport { isRedoAction } from \"@/actions/redo\";\nimport { viewCircuit } from \"@/actions/view-circuit\";\n\nimport { captureUndoState } from \"../utils\";\n\nexport default function redoReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (!isRedoAction(action)) {\n    return state;\n  }\n\n  const { undoStack, redoStack } = state.undo;\n\n  const stackItem = last(redoStack);\n  if (!stackItem) {\n    return state;\n  }\n\n  const { serviceStates, viewCircuitId } = stackItem;\n\n  state = {\n    ...state,\n    services: {\n      ...state.services,\n      ...serviceStates,\n    },\n    undo: {\n      ...state.undo,\n      undoStack: [...undoStack, captureUndoState(state)],\n      redoStack: redoStack.slice(0, redoStack.length - 1),\n    },\n  };\n\n  if (viewCircuitId) {\n    state = rootReducer(state, viewCircuit(viewCircuitId));\n  }\n\n  return state;\n}\n","import { AnyAction } from \"redux\";\n\nimport { isProjectMutationAction } from \"@/project-mutation-actions\";\nimport { AppState, defaultAppState } from \"@/store\";\nimport { fpSet } from \"@/utils\";\n\nimport { isUndoAction } from \"@/actions/undo\";\nimport { isRedoAction } from \"@/actions/redo\";\n\nimport { captureUndoState } from \"../utils\";\n\n// If this was part of the normal reducer stack, we would want to give it a very low priority\n// so it occurs after all other reducers.\n// However, in order to capture reentrant reducers, our master undo reducer wraps\n// the root reducer especially and always occurs last.\nexport default function captureUndoStateReducer(\n  state: AppState = defaultAppState,\n  action: AnyAction\n): AppState {\n  if (\n    !isProjectMutationAction(action) ||\n    isUndoAction(action) ||\n    isRedoAction(action)\n  ) {\n    return state;\n  }\n\n  return fpSet(state, \"undo\", (undoState) => ({\n    ...undoState,\n    // Limiting undo to 25 entries, since we store the entire project every slice.\n    // TODO: Consider using a difference engine to store the minimal difference between the states.\n    //  This should let us store far more undo operations as the project gets larger.\n    // Could use https://www.npmjs.com/package/deep-diff\n    // Problem with this is it takes up time capturing the undo, which slows down all operations.\n    undoStack: [...undoState.undoStack.slice(0, 25), captureUndoState(state)],\n    redoStack: [],\n  }));\n}\n","import { useSelector as useSelectorRedux } from \"react-redux\";\n\nimport { AppState } from \"@/store\";\n\nexport default function useSelector<T>(selector: (s: AppState) => T) {\n  return useSelectorRedux<AppState, T>(selector);\n}\n","import * as React from \"react\";\n\nexport function useNativeEvent<\n  T extends GlobalEventHandlers,\n  K extends keyof GlobalEventHandlersEventMap\n>(\n  ref: React.RefObject<T | null>,\n  type: K,\n  listener: (\n    this: GlobalEventHandlers,\n    ev: GlobalEventHandlersEventMap[K]\n  ) => any,\n  options?: boolean | AddEventListenerOptions\n) {\n  React.useEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n\n    // De-reference the target so we remove from the right element.\n    const listenTarget = ref.current;\n\n    listenTarget.addEventListener(type, listener, options);\n    return () => {\n      listenTarget.removeEventListener(type, listener, options);\n    };\n  }, [type, listener, ref, options]);\n}\n","import { fork } from \"redux-saga/effects\";\n\nimport projectSaga from \"./project/saga\";\nimport simulatorControlSaga from \"./simulator-control/saga\";\nimport tutorialSaga from \"./tutorial/saga\";\n\nexport default function* appSaga() {\n  yield fork(projectSaga);\n  yield fork(simulatorControlSaga);\n  yield fork(tutorialSaga);\n}\n","import { createUiLayoutSelector } from \"../utils\";\n\nexport const layoutSelector = createUiLayoutSelector((s) => s.layout);\n","import TitleBar from \"./TitleBar\";\nexport default TitleBar;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./TitleBar.module.css\";\n\nexport interface TitleBarProps {\n  className?: string;\n  title?: string;\n}\nconst TitleBar: React.FC<TitleBarProps> = ({ className, title, children }) => {\n  return (\n    <div className={cls(styles.titlebar, className)}>\n      <span className={styles[\"titlebar-heading\"]}>Discrelog</span>\n      <div className={styles[\"titlebar-divider\"]} />\n      {title && <div className={styles[\"titlebar-title\"]}>{title}</div>}\n      {children}\n    </div>\n  );\n};\n\nexport default TitleBar;\n","// extracted by mini-css-extract-plugin\nexport default {\"titlebar\":\"titlebar--3-TCE\",\"titlebar-heading\":\"titlebar-heading--3RAl1\",\"titlebar-divider\":\"titlebar-divider--Wl_27\",\"titlebar-title\":\"titlebar-title--HXGig\"};","import * as React from \"react\";\n\nexport interface PopoverChildContext {\n  registerPopoverChild(element: HTMLElement): void;\n  unregisterPopoverChild(element: HTMLElement): void;\n}\n\nfunction noop() {\n  // no op.\n}\nconst noopPopoverChildContext: PopoverChildContext = {\n  registerPopoverChild: noop,\n  unregisterPopoverChild: noop,\n};\n\nexport const PopoverChildContext = React.createContext<PopoverChildContext | null>(\n  null\n);\n\nexport const usePopoverChildContext = () =>\n  React.useContext(PopoverChildContext);\n\nexport const PopoverChildContextProvider: React.FC<PopoverChildContext> = ({\n  registerPopoverChild: contextRegister,\n  unregisterPopoverChild: contextUnregister,\n  children,\n}) => {\n  const parent = usePopoverChildContext();\n  const parentRegister = parent?.registerPopoverChild;\n  const parentUnregister = parent?.unregisterPopoverChild;\n\n  const registerPopoverChild = React.useCallback(\n    (element: HTMLElement) => {\n      if (parentRegister) {\n        parentRegister(element);\n      }\n      contextRegister(element);\n    },\n    [contextRegister, parentRegister]\n  );\n\n  const unregisterPopoverChild = React.useCallback(\n    (element: HTMLElement) => {\n      contextUnregister(element);\n      if (parentUnregister) {\n        parentUnregister;\n      }\n    },\n    [contextUnregister, parentUnregister]\n  );\n\n  const providedContext = React.useMemo(\n    () => ({\n      registerPopoverChild,\n      unregisterPopoverChild,\n    }),\n    [registerPopoverChild, unregisterPopoverChild]\n  );\n\n  return (\n    <PopoverChildContext.Provider value={providedContext}>\n      {children}\n    </PopoverChildContext.Provider>\n  );\n};\n\nexport function usePopoverChild(element: HTMLElement | null) {\n  const popoverContext =\n    React.useContext(PopoverChildContext) ?? noopPopoverChildContext;\n\n  // We do not want to trigger the effect when\n  //  the context changes, as the context will change\n  //  as a result of calling register and unregister.\n  // As a result, we will not function right if somehow our\n  //  element transfers to a different popup chain without re-rendering.\n  const ctxRef = React.useRef(popoverContext);\n  React.useEffect(() => {\n    ctxRef.current = popoverContext;\n  });\n\n  React.useEffect(() => {\n    if (element) {\n      ctxRef.current.registerPopoverChild(element);\n      return () => ctxRef.current.unregisterPopoverChild(element);\n    }\n  }, [element]);\n}\n","import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport { Options, VirtualElement } from \"@popperjs/core\";\nimport { usePopper } from \"react-popper\";\n\nimport { useOutsideMouseEvent } from \"@/hooks/useOutsideMouseEvent\";\nimport { useArrayState } from \"@/hooks/useArrayState\";\n\nimport {\n  PopoverChildContextProvider,\n  usePopoverChild,\n} from \"./PopoverChildContext\";\n\nexport interface PopoverProps {\n  anchorEl: Element | VirtualElement | null;\n  placement?: Options[\"placement\"];\n  isOpen: boolean;\n  onRequestClose?(): void;\n}\n\nconst noop = () => {\n  /*no op*/\n};\n\nconst Popover: React.FC<PopoverProps> = ({\n  isOpen,\n  anchorEl,\n  placement = \"auto\",\n  onRequestClose = noop,\n  children,\n}) => {\n  const [popoverRef, setPopoverRef] = React.useState<HTMLDivElement | null>(\n    null\n  );\n  const { attributes, styles } = usePopper(\n    isOpen ? anchorEl : null,\n    popoverRef,\n    {\n      placement,\n    }\n  );\n\n  // Register us as a child of a parent popover, if any is present.\n  usePopoverChild(popoverRef);\n\n  const [\n    popoverChildren,\n    registerPopoverChild,\n    unregisterPopoverChild,\n  ] = useArrayState<HTMLElement>();\n\n  // Close when a click happens on the outside.\n  // We still want to handle this even if we are a child, as the user\n  // may have clicked on a parent popover which should close us.\n  const insideRefs = React.useMemo(() => [popoverRef, ...popoverChildren], [\n    popoverChildren,\n    popoverRef,\n  ]);\n  useOutsideMouseEvent(insideRefs, onRequestClose);\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return createPortal(\n    <PopoverChildContextProvider\n      registerPopoverChild={registerPopoverChild}\n      unregisterPopoverChild={unregisterPopoverChild}\n    >\n      <div\n        ref={setPopoverRef}\n        style={{ ...styles.popper, zIndex: 10 }}\n        {...attributes.popper}\n      >\n        {children}\n      </div>\n    </PopoverChildContextProvider>,\n    document.body\n  );\n};\n\nexport default Popover;\n","export * from \"./Popover\";\nimport Popover from \"./Popover\";\nexport default Popover;\n","import * as React from \"react\";\nimport difference from \"lodash/difference\";\n\nexport type UseArrayState<T> = [\n  items: T[],\n  addItem: (value: T) => void,\n  removeItem: (value: T) => void,\n  setItems: (items: T[]) => void\n];\n\nexport function useArrayState<T>(defaultValue: T[] = []): UseArrayState<T> {\n  const [items, setItems] = React.useState(defaultValue);\n  const addItem = React.useCallback(\n    (item: T) => {\n      setItems([...items, item]);\n    },\n    [items]\n  );\n  const removeItem = React.useCallback(\n    (item: T) => {\n      setItems(difference(items, [item]));\n    },\n    [items]\n  );\n\n  return [items, addItem, removeItem, setItems];\n}\n","import * as React from \"react\";\n\nimport { asArray, MaybeArray } from \"@/arrays\";\nimport { isTruthy } from \"@/utils\";\n\nexport function useOutsideMouseEvent(\n  element: MaybeArray<HTMLElement | null>,\n  onOutsideEvent: () => void,\n  when = true\n) {\n  const onEvent = React.useCallback(\n    (e: MouseEvent | TouchEvent) => {\n      const elements = asArray(element).filter(isTruthy);\n      if (!elements.length) {\n        return;\n      }\n\n      if (elements.every((element) => !element.contains(e.target as any))) {\n        onOutsideEvent();\n      }\n    },\n    [element, onOutsideEvent]\n  );\n\n  React.useEffect(() => {\n    if (!when) {\n      return;\n    }\n\n    document.addEventListener(\"mousedown\", onEvent);\n    document.addEventListener(\"touchstart\", onEvent);\n\n    return () => {\n      document.removeEventListener(\"mousedown\", onEvent);\n      document.removeEventListener(\"touchstart\", onEvent);\n    };\n  }, [onEvent, when]);\n}\n","import * as React from \"react\";\n\nfunction noop() {\n  /* Do nothing */\n}\n\nconst MenuCloseContext = React.createContext<() => void>(noop);\n\nexport function useMenuCloseContext() {\n  return React.useContext(MenuCloseContext);\n}\n\nexport const MenuCloseContextProvider = MenuCloseContext.Provider;\n","import * as React from \"react\";\nimport { Options } from \"@popperjs/core\";\n\nimport Popover from \"./Popover\";\nimport { MenuCloseContextProvider } from \"./Menus/MenuCloseContext\";\n\nexport interface AutoPopoverProps {\n  content: JSX.Element;\n  placement?: Options[\"placement\"];\n}\n\nconst AutoPopover: React.FC<AutoPopoverProps> = ({\n  content,\n  placement,\n  children,\n}) => {\n  const anchorEl = React.useRef<HTMLDivElement | null>(null);\n\n  const [open, setOpen] = React.useState(false);\n  const onClick = React.useCallback(() => {\n    setOpen(true);\n  }, []);\n  const onClose = React.useCallback(() => {\n    setOpen(false);\n  }, []);\n\n  return (\n    <MenuCloseContextProvider value={onClose}>\n      <div ref={anchorEl} onClick={onClick}>\n        {children}\n      </div>\n      <Popover\n        anchorEl={anchorEl.current}\n        isOpen={open}\n        placement={placement}\n        onRequestClose={onClose}\n      >\n        {open && content}\n      </Popover>\n    </MenuCloseContextProvider>\n  );\n};\n\nexport default AutoPopover;\n","// extracted by mini-css-extract-plugin\nexport default {\"button\":\"button--Ui3Hp\",\"button--size-small\":\"button--size-small--289kb\",\"button--variant-primary\":\"button--variant-primary--2qpAa\",\"button--variant-menu\":\"button--variant-menu--3lEZ1\"};","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nexport interface ButtonProps extends React.HTMLAttributes<HTMLButtonElement> {\n  variant?: \"primary\" | \"default\" | \"menu\";\n  size?: \"default\" | \"small\";\n}\n\nimport styles from \"./Button.module.css\";\n\nconst Button: React.FC<ButtonProps> = ({\n  variant = \"default\",\n  size = \"default\",\n  ...props\n}) => {\n  return (\n    <button\n      className={cls(\n        styles[\"button\"],\n        (styles as any)[`button--variant-${variant}`],\n        (styles as any)[`button--size-${size}`]\n      )}\n      type=\"button\"\n      {...props}\n    >\n      {props.children}\n    </button>\n  );\n};\n\nexport default Button;\n","import Button from \"./Button\";\nexport default Button;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { AnyAction } from \"redux\";\n\nexport function useAction(actionCreator: () => AnyAction): () => AnyAction;\nexport function useAction<Args>(\n  actionCreator: (...args: Args[]) => AnyAction\n): () => AnyAction;\nexport function useAction<A0, Args>(\n  actionCreator: (a0: A0, ...args: Args[]) => AnyAction,\n  a0: A0\n): () => AnyAction;\nexport function useAction(\n  actionCreator: (...args: any[]) => AnyAction,\n  ...preBind: any[]\n): () => AnyAction {\n  const dispatch = useDispatch();\n  return React.useCallback(\n    () => {\n      const action = actionCreator(...preBind);\n      if (action) {\n        dispatch(action);\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [dispatch, actionCreator, ...preBind]\n  ) as any;\n}\n\nexport function useClickAction(\n  actionCreator: (...args: any[]) => AnyAction,\n  ...preBind: any[]\n): (e: React.MouseEvent) => AnyAction {\n  const dispatch = useDispatch();\n  return React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n      const action = actionCreator(...preBind);\n      if (action) {\n        dispatch(action);\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [dispatch, actionCreator, ...preBind]\n  ) as any;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"menu\":\"menu--3E86w\",\"menu-item\":\"menu-item--2dcyN\",\"menu-item--disabled\":\"menu-item--disabled--RJJTK\",\"menu-item-content\":\"menu-item-content--3s1DG\",\"menu-item-text\":\"menu-item-text--1F41V\",\"menu-item-secondary\":\"menu-item-secondary--2PJLF\",\"menu-item-icon\":\"menu-item-icon--JTlha\",\"menu-divider\":\"menu-divider--1QPGp\"};","import * as React from \"react\";\n\nimport styles from \"./Menus.module.css\";\n\nconst Menu: React.FC = ({ children }) => {\n  return <ul className={styles[\"menu\"]}>{children}</ul>;\n};\n\nexport default Menu;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Menus.module.css\";\nimport { useMenuCloseContext } from \"./MenuCloseContext\";\n\nexport interface MenuItemProps {\n  disabled?: boolean;\n  secondary?: string;\n  onClick?(e: React.MouseEvent<HTMLElement>): void;\n}\nconst MenuItem: React.FC<MenuItemProps> = ({\n  disabled,\n  onClick,\n  secondary,\n  children,\n}) => {\n  const requestMenuClose = useMenuCloseContext();\n  const onItemClick = React.useCallback(\n    (e: React.MouseEvent<HTMLAnchorElement>) => {\n      if (onClick) {\n        onClick(e);\n      }\n      requestMenuClose();\n    },\n    [requestMenuClose, onClick]\n  );\n  return (\n    <li\n      className={cls(\n        styles[\"menu-item\"],\n        disabled && styles[\"menu-item--disabled\"]\n      )}\n    >\n      <a className={styles[\"menu-item-content\"]} onClick={onItemClick}>\n        <span className={styles[\"menu-item-text\"]}>{children}</span>\n        {secondary && (\n          <span className={styles[\"menu-item-secondary\"]}>{secondary}</span>\n        )}\n      </a>\n    </li>\n  );\n};\n\nexport default MenuItem;\n","import * as React from \"react\";\n\nimport styles from \"./Menus.module.css\";\n\nconst DividerMenuItem: React.FC = () => {\n  return <div className={styles[\"menu-divider\"]} />;\n};\n\nexport default DividerMenuItem;\n","import * as React from \"react\";\n\nimport { useAction } from \"@/hooks/useAction\";\nimport { newProject } from \"@/actions/project-new\";\nimport { saveProject } from \"@/actions/project-save\";\nimport { loadProject } from \"@/actions/project-load\";\nimport { exportProjectLink } from \"@/actions/project-export-link\";\nimport { importCircuitFromProject } from \"@/actions/project-import-circuits\";\n\nimport Menu from \"@/components/Menus/Menu\";\nimport MenuItem from \"@/components/Menus/MenuItem\";\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\n\nconst FileMenu: React.FC = () => {\n  const onNewProject = useAction(newProject);\n  const onSaveProject = useAction(saveProject);\n  const onLoadProject = useAction(loadProject);\n  const onImportProjectCircuits = useAction(importCircuitFromProject);\n  const onExportLink = useAction(exportProjectLink);\n\n  return (\n    <Menu>\n      <MenuItem onClick={onNewProject}>New</MenuItem>\n      <DividerMenuItem />\n      <MenuItem onClick={onLoadProject}>Load</MenuItem>\n      <MenuItem onClick={onSaveProject}>Save</MenuItem>\n      <DividerMenuItem />\n      <MenuItem onClick={onImportProjectCircuits}>Import Circuits</MenuItem>\n      <DividerMenuItem />\n      <MenuItem onClick={onExportLink}>Export Link</MenuItem>\n    </Menu>\n  );\n};\n\nexport default FileMenu;\n","import { os } from \"platform\";\n\nconst OS_MAC = /(Mac|iOS|OS\\ X)/;\n\nexport const keyboardIsMac = OS_MAC.test((os || \"undefined\").toString());\n\nexport const keyboardCommandModifier = keyboardIsMac ? \"command\" : \"ctrl\";\n","import { AppState } from \"@/store\";\n\nexport const canUndoSelector = (state: AppState) =>\n  state.undo.undoStack.length > 0;\nexport const canRedoSelector = (state: AppState) =>\n  state.undo.redoStack.length > 0;\n","import { createClipboardSelector } from \"../utils\";\n\nexport const canPasteSelector = createClipboardSelector(\n  (s) => s.clipboardElements.length > 0\n);\n","import * as React from \"react\";\n\nimport { keyboardCommandModifier } from \"@/runtime-env\";\n\nimport { useAction } from \"@/hooks/useAction\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { canRedoSelector, canUndoSelector } from \"@/undo/selectors\";\n\nimport { selectedElementIdsSelector } from \"@/services/selection/selectors/selection\";\nimport { canPasteSelector } from \"@/services/clipboard/selectors/clipboard\";\n\nimport { undo } from \"@/actions/undo\";\nimport { redo } from \"@/actions/redo\";\nimport { copySelection } from \"@/actions/selection-copy\";\nimport { paste } from \"@/actions/clipboard-paste\";\n\nimport Menu from \"@/components/Menus/Menu\";\nimport MenuItem from \"@/components/Menus/MenuItem\";\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\n\nconst EditMenu: React.FC = () => {\n  const canUndo = useSelector(canUndoSelector);\n  const onUndo = useAction(undo);\n  const canRedo = useSelector(canRedoSelector);\n  const onRedo = useAction(redo);\n\n  const canCopy = useSelector(selectedElementIdsSelector).length > 0;\n  const onCopy = useAction(copySelection);\n  const canPaste = useSelector(canPasteSelector);\n  const onPaste = useAction(paste);\n\n  return (\n    <Menu>\n      <MenuItem\n        disabled={!canUndo}\n        secondary={`${keyboardCommandModifier}+z`}\n        onClick={onUndo}\n      >\n        Undo\n      </MenuItem>\n      <MenuItem\n        disabled={!canRedo}\n        secondary={`${keyboardCommandModifier}+shift+z`}\n        onClick={onRedo}\n      >\n        Redo\n      </MenuItem>\n      <DividerMenuItem />\n      <MenuItem\n        disabled={!canCopy}\n        secondary={`${keyboardCommandModifier}+c`}\n        onClick={onCopy}\n      >\n        Copy\n      </MenuItem>\n      <MenuItem\n        disabled={!canPaste}\n        secondary={`${keyboardCommandModifier}+v`}\n        onClick={onPaste}\n      >\n        Paste\n      </MenuItem>\n    </Menu>\n  );\n};\n\nexport default EditMenu;\n","import { AppState } from \"@/store\";\n\nimport {\n  elementNameFromElementIdSelector,\n  elementNameOrDefaultFromElementIdSelector,\n} from \"@/services/circuit-graph/selectors/elements\";\nimport { createUiSettingsSelector } from \"../utils\";\n\nexport const elementNameModeSelector = createUiSettingsSelector(\n  (s) => s.elementNameMode\n);\n\nexport const elementFieldDisplayNameFromElementId = (\n  state: AppState,\n  elementId: string\n) => {\n  const mode = state.services.uiSettings.elementNameMode;\n  switch (mode) {\n    case \"all\":\n    default:\n      return elementNameOrDefaultFromElementIdSelector(state, elementId);\n    case \"named-only\":\n      return elementNameFromElementIdSelector(state, elementId);\n    case \"none\":\n      return null;\n  }\n};\n","export * from \"./Checkbox\";\nimport Checkbox from \"./Checkbox\";\nexport default Checkbox;\n","import * as React from \"react\";\n\nimport styles from \"./Checkbox.module.css\";\n\nexport interface CheckboxProps {\n  className?: string;\n  value: boolean;\n  onChange(e: React.ChangeEvent<HTMLInputElement>): void;\n}\n\nconst Checkbox: React.FC<CheckboxProps> = ({\n  className,\n  value,\n  onChange,\n  children,\n}) => {\n  return (\n    <label className={className}>\n      <span className={styles[\"checkbox-span\"]}>\n        <input type=\"checkbox\" checked={value} onChange={onChange} />\n      </span>\n      {children}\n    </label>\n  );\n};\n\nexport default Checkbox;\n","// extracted by mini-css-extract-plugin\nexport default {\"checkbox-span\":\"checkbox-span--1EWGs\"};","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport Checkbox from \"@/components/Checkbox\";\n\nimport styles from \"./Menus.module.css\";\n\nexport interface CheckboxMenuItemProps {\n  disabled?: boolean;\n  secondary?: string;\n  value: boolean;\n  onChange(e: React.ChangeEvent<HTMLInputElement>): void;\n}\nconst CheckboxMenuItem: React.FC<CheckboxMenuItemProps> = ({\n  disabled,\n  secondary,\n  value,\n  onChange,\n  children,\n}) => {\n  return (\n    <li\n      className={cls(\n        styles[\"menu-item\"],\n        disabled && styles[\"menu-item--disabled\"]\n      )}\n    >\n      <Checkbox\n        className={styles[\"menu-item-content\"]}\n        value={value}\n        onChange={onChange}\n      >\n        <span className={styles[\"menu-item-text\"]}>{children}</span>\n        {secondary && (\n          <span className={styles[\"menu-item-secondary\"]}>{secondary}</span>\n        )}\n      </Checkbox>\n    </li>\n  );\n};\n\nexport default CheckboxMenuItem;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport AutoPopover from \"@/components/AutoPopover\";\n\nimport styles from \"./Menus.module.css\";\n\nexport interface SubMenuItemProps {\n  disabled?: boolean;\n  secondary?: string;\n  content: JSX.Element;\n}\nconst SubMenuItem: React.FC<SubMenuItemProps> = ({\n  disabled,\n  secondary,\n  content,\n  children,\n}) => {\n  return (\n    <li\n      className={cls(\n        styles[\"menu-item\"],\n        disabled && styles[\"menu-item--disabled\"]\n      )}\n    >\n      <AutoPopover placement=\"right-start\" content={content}>\n        <a className={styles[\"menu-item-content\"]}>\n          <span className={styles[\"menu-item-text\"]}>{children}</span>\n          {secondary && (\n            <span className={styles[\"menu-item-secondary\"]}>{secondary}</span>\n          )}\n          <svg className={styles[\"menu-item-icon\"]} width={12} height={12}>\n            <path d=\"M0,0 l6,6 l-6,6 z\" fill=\"black\" strokeWidth={0} />\n          </svg>\n        </a>\n      </AutoPopover>\n    </li>\n  );\n};\n\nexport default SubMenuItem;\n","import * as React from \"react\";\n\nimport { useAction } from \"@/hooks/useAction\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { viewElementNames } from \"@/actions/view-element-names\";\nimport { resetView } from \"@/actions/view-reset\";\n\nimport { elementNameModeSelector } from \"@/services/ui-settings/selectors/element-name\";\n\nimport Menu from \"@/components/Menus/Menu\";\nimport CheckboxMenuItemItem from \"@/components/Menus/CheckboxMenuItem\";\nimport SubMenuItem from \"@/components/Menus/SubMenuItem\";\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\nimport MenuItem from \"@/components/Menus/MenuItem\";\n\nconst ViewMenu: React.FC = () => {\n  const onResetView = useAction(resetView);\n  return (\n    <Menu>\n      <SubMenuItem content={<ElementNamesMenu />}>Element Names</SubMenuItem>\n      <DividerMenuItem />\n      <MenuItem onClick={onResetView}>Reset View</MenuItem>\n    </Menu>\n  );\n};\n\nconst ElementNamesMenu: React.FC = () => {\n  const mode = useSelector(elementNameModeSelector);\n  const onAlwaysVisible = useAction(viewElementNames, \"all\");\n  const onNamedOnly = useAction(viewElementNames, \"named-only\");\n  const onHidden = useAction(viewElementNames, \"none\");\n\n  return (\n    <Menu>\n      <CheckboxMenuItemItem value={mode === \"all\"} onChange={onAlwaysVisible}>\n        Always visible\n      </CheckboxMenuItemItem>\n      <CheckboxMenuItemItem\n        value={mode === \"named-only\"}\n        onChange={onNamedOnly}\n      >\n        Named Items Only\n      </CheckboxMenuItemItem>\n      <CheckboxMenuItemItem value={mode === \"none\"} onChange={onHidden}>\n        Hidden\n      </CheckboxMenuItemItem>\n    </Menu>\n  );\n};\n\nexport default ViewMenu;\n","import * as React from \"react\";\n\nimport { useAction } from \"@/hooks/useAction\";\n\nimport { tutorialStart } from \"@/actions/tutorial-start\";\n\nimport Menu from \"@/components/Menus/Menu\";\nimport MenuItem from \"@/components/Menus/MenuItem\";\nimport SubMenuItem from \"@/components/Menus/SubMenuItem\";\n\nconst HelpMenu: React.FC = () => {\n  return (\n    <Menu>\n      <SubMenuItem content={<TutorialsMenu />}>Tutorials</SubMenuItem>\n    </Menu>\n  );\n};\n\nconst TutorialsMenu: React.FC = () => {\n  const onBasicsTutorial = useAction(tutorialStart, \"basics\");\n  const onCircuitsTutorial = useAction(tutorialStart, \"circuits\");\n  return (\n    <Menu>\n      <MenuItem onClick={onBasicsTutorial}>Basics</MenuItem>\n      <MenuItem onClick={onCircuitsTutorial}>Circuits</MenuItem>\n    </Menu>\n  );\n};\n\nexport default HelpMenu;\n","import { createSimulatorSelector } from \"../utils\";\n\nexport const averageMsecsPerTickSelector = createSimulatorSelector(\n  (state) => state.lastTickProcessingTimeMs\n);\n","// extracted by mini-css-extract-plugin\nexport default {\"icon\":\"icon--3Vly6\"};","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Icons.module.css\";\n\nconst PlayIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => {\n  return (\n    <svg\n      width={16}\n      height={16}\n      {...props}\n      className={cls(styles.icon, props.className)}\n    >\n      <path d=\"M3,0 L13,8 L3,16 z\" />\n    </svg>\n  );\n};\n\nexport default PlayIcon;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Icons.module.css\";\n\nconst StopIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => {\n  return (\n    <svg\n      width={16}\n      height={16}\n      {...props}\n      className={cls(styles.icon, props.className)}\n    >\n      <path d=\"M1,1 L15,1 L15,15 L1,15 z\" />\n    </svg>\n  );\n};\n\nexport default StopIcon;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Icons.module.css\";\n\nconst PauseIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => {\n  return (\n    <svg\n      width={16}\n      height={16}\n      {...props}\n      className={cls(styles.icon, props.className)}\n    >\n      <path d=\"M2.5,1 L6.5,1 L6.5,15 L2.5,15 z M9.5,1 L13.5,1 L13.5,15 L9.5,15 z\" />\n    </svg>\n  );\n};\n\nexport default PauseIcon;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Icons.module.css\";\n\nconst StepIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => {\n  return (\n    <svg\n      width={16}\n      height={16}\n      {...props}\n      className={cls(styles.icon, props.className)}\n    >\n      <path d=\"M3,0 L13,8 L3,16 z M11,1 l2,0 l0,14 l-2,0 z\" />\n    </svg>\n  );\n};\n\nexport default StepIcon;\n","// extracted by mini-css-extract-plugin\nexport default {\"button\":\"button--2N_ol\",\"button-play\":\"button-play--1vWfq\",\"button-stop\":\"button-stop--1dD4-\",\"button-pause\":\"button-pause--1UoHJ\",\"selected\":\"selected--Ev2q8\",\"button-step\":\"button-step--3Fat5\",\"button--disabled\":\"button--disabled--3caLv\",\"simrate\":\"simrate--NKBi_\"};","import SimControls from \"./SimControls\";\nexport default SimControls;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useClickAction } from \"@/hooks/useAction\";\n\nimport { startSim } from \"@/actions/sim-start\";\nimport { stopSim } from \"@/actions/sim-stop\";\nimport { pauseSim } from \"@/actions/sim-pause\";\nimport { stepSim } from \"@/actions/sim-step\";\n\nimport {\n  isSimActiveSelector,\n  isSimPausedSelector,\n} from \"@/services/simulator-control/selectors/run\";\nimport { averageMsecsPerTickSelector } from \"@/services/simulator/selectors/performance\";\n\nimport PlayIcon from \"@/components/Icons/Play\";\nimport StopIcon from \"@/components/Icons/Stop\";\nimport PauseIcon from \"@/components/Icons/Pause\";\nimport StepIcon from \"@/components/Icons/Step\";\n\nimport styles from \"./SimControls.module.css\";\n\nconst PlayPauseButton: React.FC = () => {\n  const isActive = useSelector(isSimActiveSelector);\n  const isPaused = useSelector(isSimPausedSelector);\n\n  const avgMsecsPerTick = useSelector(averageMsecsPerTickSelector);\n\n  const onPlayClick = useClickAction(startSim);\n  const onStopClick = useClickAction(stopSim);\n  const onPauseClick = useClickAction(pauseSim, \"toggle\");\n  const onStepClick = useClickAction(stepSim);\n\n  const onMuteMouseDown = React.useCallback((e: React.MouseEvent) => {\n    // Prevent rapid clicks from selecting nearby text.\n    e.preventDefault();\n  }, []);\n\n  return (\n    <span>\n      {isActive && (\n        <span className={styles[\"simrate\"]}>\n          {avgMsecsPerTick.toFixed(2)} ms\n        </span>\n      )}\n      {isActive ? (\n        <StopIcon\n          id=\"simctrl-stop\"\n          className={cls(styles[\"button\"], styles[\"button-stop\"])}\n          onClick={onStopClick}\n          onMouseDown={onMuteMouseDown}\n        />\n      ) : (\n        <PlayIcon\n          id=\"simctrl-run\"\n          className={cls(styles[\"button\"], styles[\"button-play\"])}\n          onClick={onPlayClick}\n          onMouseDown={onMuteMouseDown}\n        />\n      )}\n      <StepIcon\n        id=\"simctrl-step\"\n        className={cls(styles[\"button\"], styles[\"button-step\"])}\n        onClick={onStepClick}\n        onMouseDown={onMuteMouseDown}\n      />\n      <PauseIcon\n        id=\"simctrl-pause\"\n        className={cls(\n          styles[\"button\"],\n          styles[\"button-pause\"],\n          !isActive && styles[\"button--disabled\"],\n          isPaused && styles[\"selected\"]\n        )}\n        onClick={onPauseClick}\n        onMouseDown={onMuteMouseDown}\n      />\n    </span>\n  );\n};\n\nexport default PlayPauseButton;\n","import ProjectEditorTitleBar from \"./ProjectEditorTitleBar\";\nexport default ProjectEditorTitleBar;\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport {\n  projectModifiedSelector,\n  projectNameSelector,\n} from \"@/services/project/selectors/project\";\n\nimport TitleBar from \"@/components/TitleBar\";\nimport AutoPopover from \"@/components/AutoPopover\";\nimport Button from \"@/components/Button\";\n\nimport FileMenu from \"../FileMenu\";\nimport EditMenu from \"../EditMenu\";\nimport ViewMenu from \"../ViewMenu\";\nimport HelpMenu from \"../HelpMenu\";\nimport SimControls from \"../SimControls\";\n\nimport styles from \"./ProjectEditorTitleBar.module.css\";\n\nexport interface ProjectEditorTitleBarProps {\n  className?: string;\n}\nconst ProjectEditorTitleBar: React.FC<ProjectEditorTitleBarProps> = ({\n  className,\n}) => {\n  const projectName = useSelector(projectNameSelector);\n  const projectModified = useSelector(projectModifiedSelector);\n\n  const title = `${projectName}${projectModified ? \"*\" : \"\"}`;\n\n  return (\n    <TitleBar className={className} title={title}>\n      <AutoPopover content={<FileMenu />} placement=\"bottom-start\">\n        <Button variant=\"menu\">File</Button>\n      </AutoPopover>\n      <AutoPopover content={<EditMenu />} placement=\"bottom-start\">\n        <Button variant=\"menu\">Edit</Button>\n      </AutoPopover>\n      <AutoPopover content={<ViewMenu />} placement=\"bottom-start\">\n        <Button variant=\"menu\">View</Button>\n      </AutoPopover>\n      <AutoPopover content={<HelpMenu />} placement=\"bottom-start\">\n        <Button variant=\"menu\">Help</Button>\n      </AutoPopover>\n      <div className={styles[\"project-titlebar-controls\"]}>\n        <SimControls />\n      </div>\n    </TitleBar>\n  );\n};\n\nexport default ProjectEditorTitleBar;\n","// extracted by mini-css-extract-plugin\nexport default {\"project-titlebar-controls\":\"project-titlebar-controls--1c1Qn\"};","// extracted by mini-css-extract-plugin\nexport default {\"circuit-element-breadcrumb\":\"circuit-element-breadcrumb--1CYNC\"};","import * as React from \"react\";\nimport last from \"lodash/last\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { viewCircuit } from \"@/actions/view-circuit\";\n\nimport {\n  elementNameOrDefaultFromElementIdSelector,\n  elementTypeFromElementIdSelector,\n} from \"@/services/circuit-graph/selectors/elements\";\nimport { elementTypeToCircuitId } from \"@/elements/definitions/integrated-circuits/utils\";\nimport { circuitNameFromIdSelector } from \"@/services/circuit-properties/selectors/circuits\";\nimport { ROOT_CIRCUIT_ID } from \"@/services/circuits/constants\";\n\nimport Button from \"../Button\";\n\nimport styles from \"./CircuitNodeBreadcrumb.module.css\";\n\nexport interface CircuitNodeBreadcrumbProps {\n  circuitId: string;\n  elementIdPath: string[];\n}\nconst CircuitNodeBreadcrumb: React.FC<CircuitNodeBreadcrumbProps> = ({\n  circuitId,\n  elementIdPath,\n}) => {\n  const elements: JSX.Element[] = elementIdPath.map((elementId, index) => {\n    const elementPath = elementIdPath.slice(0, index + 1);\n    return (\n      <React.Fragment key={elementId}>\n        <span>&gt;</span>\n        <CircuitNodeBreadcrumbItem elementIdPath={elementPath} />\n      </React.Fragment>\n    );\n  });\n\n  return (\n    <div\n      className={cls(\n        \"circuit-element-breadcrumb\",\n        styles[\"circuit-element-breadcrumb\"]\n      )}\n    >\n      <CircuitNodeBreadcrumbRootItem\n        circuitId={circuitId}\n        elementIdPath={elementIdPath}\n      />\n      {elements}\n    </div>\n  );\n};\n\nexport default CircuitNodeBreadcrumb;\n\ninterface CircuitNodeBreadcrumbRootItemProps {\n  circuitId: string;\n  elementIdPath: string[];\n}\nconst CircuitNodeBreadcrumbRootItem: React.FC<CircuitNodeBreadcrumbRootItemProps> = ({\n  circuitId,\n  elementIdPath,\n}) => {\n  const dispatch = useDispatch();\n  const rootCircuitName = useSelector((state) =>\n    circuitNameFromIdSelector(state, ROOT_CIRCUIT_ID)\n  );\n  const circuitName = useSelector((state) =>\n    circuitNameFromIdSelector(state, circuitId)\n  );\n\n  const onClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      dispatch(viewCircuit(ROOT_CIRCUIT_ID, []));\n    },\n    [dispatch]\n  );\n\n  return (\n    <Button size=\"small\" onClick={onClick}>\n      {elementIdPath.length === 0 ? circuitName : rootCircuitName}\n    </Button>\n  );\n};\n\ninterface CircuitNodeBreadcrumbItemProps {\n  elementIdPath: string[];\n}\n\nconst CircuitNodeBreadcrumbItem: React.FC<CircuitNodeBreadcrumbItemProps> = ({\n  elementIdPath: elementIdPath,\n}) => {\n  const dispatch = useDispatch();\n  const elementId = last(elementIdPath)!;\n\n  const elementType = useSelector((state) =>\n    elementTypeFromElementIdSelector(state, elementId)\n  );\n  const elementName = useSelector((state) =>\n    elementNameOrDefaultFromElementIdSelector(state, elementId)\n  );\n\n  const circuitId = elementType ? elementTypeToCircuitId(elementType) : null;\n  const circuitName = useSelector((state) =>\n    circuitId ? circuitNameFromIdSelector(state, circuitId) : null\n  );\n\n  const onClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      if (!circuitId) {\n        return;\n      }\n      dispatch(viewCircuit(circuitId, elementIdPath));\n    },\n    [circuitId, elementIdPath, dispatch]\n  );\n\n  return (\n    <Button size=\"small\" onClick={onClick}>\n      {elementName} [{circuitName}]\n    </Button>\n  );\n};\n","import CircuitNodeBreadcrumb from \"./CircuitNodeBreadcrumb\";\nexport default CircuitNodeBreadcrumb;\n","import { createSelector } from \"reselect\";\nimport values from \"lodash/values\";\n\nimport { Rectangle, union } from \"@/geometry\";\n\nimport { elementRectsByIdSelector } from \"./element-bounds\";\nimport { wireJointPositionsByJointIdSelector } from \"./wires\";\n\nconst MinFieldRect: Readonly<Rectangle> = Object.freeze({\n  p1: {\n    x: -100,\n    y: -100,\n  },\n  p2: {\n    x: 100,\n    y: 100,\n  },\n});\n\nexport const fieldRectSelector = createSelector(\n  elementRectsByIdSelector,\n  wireJointPositionsByJointIdSelector,\n  (elementRectsById, wireJointsById) => {\n    const elementRects = values(elementRectsById);\n    const jointRects = values(wireJointsById).map((p) => ({ p1: p, p2: p }));\n\n    return [...elementRects, ...jointRects].reduce(union, MinFieldRect);\n  }\n);\n","import { DragObjectWithType } from \"react-dnd\";\n\nexport const NEW_ELEMENT_DRAG_OBJECT = \"@element/new\" as const;\nexport const newElementDragObject = (elementType: string) => ({\n  type: NEW_ELEMENT_DRAG_OBJECT,\n  payload: { elementType },\n});\nexport type NewElementDragObject = ReturnType<typeof newElementDragObject>;\nexport function isNewElementDragObject(\n  item: DragObjectWithType\n): item is NewElementDragObject {\n  return item.type === NEW_ELEMENT_DRAG_OBJECT;\n}\n","import * as React from \"react\";\n\nexport interface ViewportContext {\n  zoomFactor: number;\n  zoom(factor: number): void;\n}\n\nconst viewportContext = React.createContext<ViewportContext>({\n  zoomFactor: 1,\n  zoom: () => {\n    /* no op */\n  },\n});\n\nexport function useViewportContext(): ViewportContext {\n  return React.useContext(viewportContext);\n}\n\nconst SCALE_FACTOR = 1.03;\n\nexport const ViewportContextProvider: React.FC = ({ children }) => {\n  const [zoomFactor, setZoomFactor] = React.useState(1);\n  const zoom = React.useCallback((delta: number) => {\n    setZoomFactor((zoomFactor) =>\n      delta > 0\n        ? zoomFactor * delta * SCALE_FACTOR\n        : zoomFactor / (-delta * SCALE_FACTOR)\n    );\n  }, []);\n\n  const context = React.useMemo<ViewportContext>(\n    () => ({\n      zoomFactor,\n      zoom,\n    }),\n    [zoom, zoomFactor]\n  );\n  return (\n    <viewportContext.Provider value={context}>\n      {children}\n    </viewportContext.Provider>\n  );\n};\n","import * as React from \"react\";\n\nexport interface FieldSvgElementContext {\n  svgRef: React.RefObject<SVGSVGElement | null>;\n  scalerRef: React.RefObject<SVGGraphicsElement | null>;\n}\nconst nullRef = { current: null };\nexport const fieldSvgElementContext = React.createContext<\n  FieldSvgElementContext\n>({ svgRef: nullRef, scalerRef: nullRef });\n\nconst ContextProvider = fieldSvgElementContext.Provider;\n\nexport const FieldSvgElementProvider: React.FC<{\n  svgRef: React.RefObject<SVGSVGElement | null>;\n  scalerRef: React.RefObject<SVGGraphicsElement | null>;\n}> = ({ svgRef, scalerRef, children }) => {\n  const context = React.useMemo(\n    () => ({\n      svgRef,\n      scalerRef,\n    }),\n    [svgRef, scalerRef]\n  );\n  return <ContextProvider value={context}>{children}</ContextProvider>;\n};\n","import { AppState } from \"@/store\";\n\nimport { circuitIdToElementType } from \"@/elements/definitions/integrated-circuits/utils\";\n\nimport { CircuitGraphServiceState } from \"../state\";\nimport { createCircuitGraphSelector } from \"../utils\";\n\nconst circuitIdForElementIdSelector = createCircuitGraphSelector(\n  (state: CircuitGraphServiceState, elementId: string) => {\n    const { elementIdsByCircuitId } = state;\n    const circuitIds = Object.keys(elementIdsByCircuitId);\n    for (const circuitId of circuitIds) {\n      if (elementIdsByCircuitId[circuitId].indexOf(elementId) !== -1) {\n        return circuitId;\n      }\n    }\n    return null;\n  }\n);\n\nexport const circuitWouldRecurseSelector = (\n  state: AppState,\n  circuitId: string | null,\n  targetCircuitId: string\n): boolean => {\n  if (!circuitId) {\n    return false;\n  }\n  if (circuitId === targetCircuitId) {\n    return true;\n  }\n\n  const targetCircuitNodeType = circuitIdToElementType(targetCircuitId);\n  const { elementsById } = state.services.circuitGraph;\n  const targetCircuitElementIds = Object.keys(elementsById).filter(\n    (elementId) => elementsById[elementId].elementType === targetCircuitNodeType\n  );\n\n  return targetCircuitElementIds.some((elementId) => {\n    const targetContainingCircuitId = circuitIdForElementIdSelector(\n      state,\n      elementId\n    );\n    if (!targetContainingCircuitId) {\n      return false;\n    }\n    return circuitWouldRecurseSelector(\n      state,\n      circuitId,\n      targetContainingCircuitId\n    );\n  });\n};\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { circuitEditorStateFromIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nexport interface CircuitEditorContext {\n  editorId: string;\n  circuitId: string;\n  elementIdPath: string[];\n}\n\nconst circuitEditorContext = React.createContext<CircuitEditorContext>({\n  editorId: \"~none\",\n  circuitId: \"~none\",\n  elementIdPath: [],\n});\n\nexport function useCircuitEditor(): CircuitEditorContext {\n  return React.useContext(circuitEditorContext);\n}\n\nexport interface CircuitEditorProviderProps {\n  editorId: string;\n}\nexport const CircuitEditorProvider: React.FC<CircuitEditorProviderProps> = ({\n  editorId,\n  children,\n}) => {\n  const editorState = useSelector((state) =>\n    circuitEditorStateFromIdSelector(state, editorId)\n  );\n  const { circuitId, elementIdPath } = editorState ?? {\n    circuitId: \"~none\",\n    elementIdPath: [],\n  };\n\n  const context = React.useMemo<CircuitEditorContext>(\n    () => ({\n      editorId,\n      circuitId,\n      elementIdPath: elementIdPath,\n    }),\n    [circuitId, elementIdPath, editorId]\n  );\n\n  if (!editorState) {\n    return null;\n  }\n\n  return (\n    <circuitEditorContext.Provider value={context}>\n      {children}\n    </circuitEditorContext.Provider>\n  );\n};\n","import { Point } from \"@/geometry\";\n\nexport function getFieldCoord(\n  field: SVGSVGElement,\n  scaler: SVGGraphicsElement,\n  p: Point\n) {\n  const ctm = scaler.getScreenCTM();\n  if (!ctm) {\n    return p;\n  }\n\n  const pt = field.createSVGPoint();\n  pt.x = p.x;\n  pt.y = p.y;\n  const translated = pt.matrixTransform(ctm.inverse());\n  return { x: translated.x, y: translated.y };\n}\n","import * as React from \"react\";\n\nimport { Point, ZeroPoint } from \"@/geometry\";\n\nimport { fieldSvgElementContext } from \"../contexts/fieldSvgElement\";\nimport { getFieldCoord } from \"../../../utils\";\n\nexport function useMouseCoords(): (p: Point) => Point {\n  const { svgRef, scalerRef } = React.useContext(fieldSvgElementContext);\n  return React.useCallback(\n    (p: Point) => {\n      if (!svgRef.current || !scalerRef.current) {\n        return p;\n      }\n      return getFieldCoord(svgRef.current, scalerRef.current, p);\n    },\n    [svgRef, scalerRef]\n  );\n}\n\nexport function useEventMouseCoords(): (\n  e: MouseEvent | React.MouseEvent\n) => Point {\n  const { svgRef, scalerRef } = React.useContext(fieldSvgElementContext);\n  return React.useCallback(\n    (e: MouseEvent | React.MouseEvent) => {\n      if (!svgRef.current || !scalerRef.current) {\n        return ZeroPoint;\n      }\n      const p: Point = {\n        x: e.pageX,\n        y: e.pageY,\n      };\n      return getFieldCoord(svgRef.current, scalerRef.current, p);\n    },\n    [svgRef, scalerRef]\n  );\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"text-unselectable\":\"text-unselectable--2tvXe\"};","import { AppState } from \"@/store\";\n\nimport { getEvolverIdFromElementIdPath } from \"@/services/simulator-graph/utils\";\nimport { rootCircuitGraphSelector } from \"@/services/simulator-graph/selectors/graph\";\n\nexport const evolverStateFromCircuitElementIdSelector = (\n  state: AppState,\n  elementIdPath: string[]\n) => {\n  const { evolverIdsByElementId } = rootCircuitGraphSelector(state);\n  const evolverStatesByEvolverId =\n    state.services.simulator.evolverStatesByEvolverId;\n\n  const evolverId = getEvolverIdFromElementIdPath(\n    evolverIdsByElementId,\n    elementIdPath\n  );\n  if (!evolverId) {\n    return undefined;\n  }\n\n  return evolverStatesByEvolverId[evolverId];\n};\n\nexport const elementOutputsFromCircuitElementIdSelector = (\n  state: AppState,\n  elementIdPath: string[]\n) => {\n  const { evolverIdsByElementId } = rootCircuitGraphSelector(state);\n  const elementOutputsBySimulatorElementId =\n    state.services.simulator.evolverOutputValuesByEvolverId;\n\n  const evolverId = getEvolverIdFromElementIdPath(\n    evolverIdsByElementId,\n    elementIdPath\n  );\n  if (!evolverId) {\n    return undefined;\n  }\n\n  return elementOutputsBySimulatorElementId[evolverId];\n};\n","// extracted by mini-css-extract-plugin\nexport default {\"element-interaction-toggle\":\"element-interaction-toggle--1eeE2\",\"element-interaction-momentary\":\"element-interaction-momentary--12_iQ\"};","import * as React from \"react\";\n\nimport {\n  ElementComponentType,\n  ElementVisualDefinition,\n} from \"@/elements/types\";\n\nimport { IntegratedCircuitElementVisual } from \"./IntegratedCircuitElementVisual\";\nimport { MomentaryInteractionElementVisual } from \"./MomentaryInteractionElementVisual\";\nimport { ToggleInteractionElementVisual } from \"./ToggleInteractionElementVisual\";\n\nconst NamedElementComponents: Record<string, ElementComponentType> = {\n  \"integrated-circuit\": IntegratedCircuitElementVisual,\n  \"interaction-momentary\": MomentaryInteractionElementVisual,\n  \"interaction-toggle\": ToggleInteractionElementVisual,\n};\n\nconst ErrorComponent: React.FC<{ componentName: string }> = ({\n  componentName,\n}) => {\n  return (\n    <g>\n      <rect width={50} height={50} fill=\"red\" />\n      <text x={25} y={25} alignmentBaseline=\"middle\">\n        {componentName}\n      </text>\n    </g>\n  );\n};\n\nexport function getNodeVisualElement(\n  elementId: string | undefined,\n  elementPath: string[] | undefined,\n  evolverState: any,\n  visual: ElementVisualDefinition\n): JSX.Element {\n  const { component, componentProps } = visual;\n\n  const elementProps = {\n    elementId,\n    elementPath,\n    evolverState,\n    ...componentProps,\n  };\n\n  let Component: ElementComponentType;\n  if (typeof component === \"string\") {\n    Component = NamedElementComponents[component];\n    if (!Component) {\n      // Making a new component here each pass will invalidate the dom on every render,\n      //  but this only is for exceptional error cases anyway.\n      Component = () => <ErrorComponent componentName={component} />;\n    }\n  } else {\n    Component = component;\n  }\n\n  return <Component {...elementProps} />;\n}\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\n\nimport { viewCircuit } from \"@/actions/view-circuit\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport { circuitNameFromIdSelector } from \"@/services/circuit-properties/selectors/circuits\";\nimport { elementNamesByElementIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { ElementComponentProps } from \"@/elements/types\";\n\nimport { getICBorderPath } from \"@/elements/definitions/integrated-circuits/utils\";\n\nexport interface IntegratedCircuitElementVisualProps {\n  circuitId: string;\n  inputPinIds: string[];\n  outputPinIds: string[];\n}\n\nexport const IntegratedCircuitElementVisual: React.FC<\n  IntegratedCircuitElementVisualProps & ElementComponentProps\n> = ({ elementId, elementPath, circuitId, inputPinIds, outputPinIds }) => {\n  const dispatch = useDispatch();\n  // TODO: Now that we are relying on components being in a tessel path, we\n  // definitely should move element components into children of CircuitEditor\n  // and connect to them from element-types using ids.\n  // More practically: this should ignore tessel path and instead rely on ui-layout\n  // to open us up in the last interacted with view.\n  const circuitName = useSelector((state) =>\n    circuitNameFromIdSelector(state, circuitId)\n  );\n\n  const elementNamesById = useSelector(elementNamesByElementIdSelector);\n\n  const borderPath = getICBorderPath(inputPinIds.length, outputPinIds.length);\n\n  const onViewCircuit = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (!elementId) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n\n      dispatch(viewCircuit(circuitId, [...(elementPath || []), elementId]));\n    },\n    [elementId, dispatch, circuitId, elementPath]\n  );\n\n  const inputPins = inputPinIds.map((pinId, i) => {\n    const y = i * 50 + 25;\n    return (\n      <g key={pinId}>\n        <line\n          className=\"element-select-highlight--stroke\"\n          stroke=\"black\"\n          strokeWidth={2}\n          x1={4}\n          y1={y}\n          x2={10}\n          y2={y}\n        />\n        <text\n          className={interaction[\"text-unselectable\"]}\n          x={15}\n          y={y}\n          alignmentBaseline=\"middle\"\n          fontSize=\".7em\"\n        >\n          {elementNamesById[pinId]}\n        </text>\n      </g>\n    );\n  });\n\n  const outputPins = outputPinIds.map((pinId, i) => {\n    const y = i * 50 + 25;\n    return (\n      <g key={pinId}>\n        <line\n          key={i}\n          className=\"element-select-highlight--stroke\"\n          stroke=\"black\"\n          strokeWidth={2}\n          x1={90}\n          y1={y}\n          x2={100}\n          y2={y}\n        />\n        <text\n          className={interaction[\"text-unselectable\"]}\n          x={85}\n          y={y}\n          textAnchor=\"end\"\n          alignmentBaseline=\"middle\"\n          fontSize=\".7em\"\n        >\n          {elementNamesById[pinId]}\n        </text>\n      </g>\n    );\n  });\n\n  return (\n    <g>\n      <text\n        className={cls(\n          interaction[\"text-unselectable\"],\n          \"element-select-highlight--fill\"\n        )}\n        textAnchor=\"middle\"\n        x={50}\n        y={0}\n      >\n        {circuitName}\n      </text>\n      <path\n        className=\"element-select-highlight--stroke element-select-highlight--fill\"\n        stroke=\"black\"\n        fill=\"white\"\n        d={borderPath}\n        onDoubleClick={onViewCircuit}\n      />\n      {inputPins}\n      {outputPins}\n    </g>\n  );\n};\n","import React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { interactElement } from \"@/actions/element-interact\";\n\nimport { ElementComponentProps } from \"@/elements/types\";\nimport { elementOutputsFromCircuitElementIdSelector } from \"@/services/simulator/selectors/elements\";\nimport { isSimActiveSelector } from \"@/services/simulator-control/selectors/run\";\n\nimport styles from \"./element-visuals.module.css\";\n\nexport const MomentaryInteractionElementVisual: React.FC<ElementComponentProps> = ({\n  elementId,\n  elementPath,\n}) => {\n  const dispatch = useDispatch();\n  const isSimActive = useSelector(isSimActiveSelector);\n\n  const circuitIdPath = React.useMemo(\n    () => [...(elementPath || []), elementId ?? \"~~none\"],\n    [elementPath, elementId]\n  );\n\n  const outputs = useSelector((state) =>\n    elementOutputsFromCircuitElementIdSelector(state, circuitIdPath)\n  );\n\n  const onPress = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (!isSimActive) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n\n      dispatch(interactElement(circuitIdPath, true));\n    },\n    [circuitIdPath, dispatch, isSimActive]\n  );\n\n  const onRelease = React.useCallback(() => {\n    if (!isSimActive) {\n      return;\n    }\n\n    dispatch(interactElement(circuitIdPath, false));\n  }, [circuitIdPath, dispatch, isSimActive]);\n\n  let onColor = \"darkgreen\";\n  let onTextColor = \"lightgrey\";\n  if (outputs) {\n    if (outputs.OUT) {\n      onColor = \"lightgreen\";\n      onTextColor = \"black\";\n    }\n  }\n\n  return (\n    <g\n      onMouseDown={onPress}\n      onMouseUp={onRelease}\n      onMouseLeave={onRelease}\n      className={styles[\"element-interaction-toggle\"]}\n    >\n      <rect\n        className=\"element-select-highlight--stroke element-select-highlight--fill\"\n        x={5}\n        y={5}\n        width={40}\n        height={40}\n        stroke=\"black\"\n        fill=\"#AFAFAF\"\n        strokeWidth={1}\n      />\n\n      <line x1={45} y1={25} x2={50} y2={25} stroke=\"black\" strokeWidth={2} />\n\n      <circle cx={25} cy={25} r={17} fill={onColor} />\n\n      <text\n        className={interaction[\"text-unselectable\"]}\n        x={25}\n        y={25}\n        fontSize=\".8em\"\n        fill={onTextColor}\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        Push\n      </text>\n    </g>\n  );\n};\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport { interactElement } from \"@/actions/element-interact\";\n\nimport { ElementComponentProps } from \"@/elements/types\";\n\nimport { ToggleEvolverState } from \"@/evolvers/definitions/input-toggle\";\n\nimport styles from \"./element-visuals.module.css\";\n\nexport const ToggleInteractionElementVisual: React.FC<ElementComponentProps<\n  ToggleEvolverState\n>> = ({ elementId, elementPath, evolverState }) => {\n  const dispatch = useDispatch();\n\n  const onClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (!elementId) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      e.preventDefault();\n\n      dispatch(interactElement([...(elementPath || []), elementId]));\n    },\n    [elementId, dispatch, elementPath]\n  );\n\n  let onColor = \"darkgreen\";\n  let onTextColor = \"lightgrey\";\n  let offColor = \"darkred\";\n  if (evolverState) {\n    const { toggleState } = evolverState;\n    if (toggleState) {\n      onColor = \"lightgreen\";\n      onTextColor = \"black\";\n    } else {\n      offColor = \"red\";\n    }\n  }\n\n  return (\n    <g onClick={onClick} className={styles[\"element-interaction-toggle\"]}>\n      <rect\n        className=\"element-select-highlight--stroke element-select-highlight--fill\"\n        x={5}\n        y={5}\n        width={40}\n        height={40}\n        stroke=\"black\"\n        fill=\"#AFAFAF\"\n        strokeWidth={1}\n      />\n      <line x1={45} y1={25} x2={50} y2={25} stroke=\"black\" strokeWidth={2} />\n      <rect\n        x={10}\n        y={10}\n        width={30}\n        height={15}\n        strokeWidth={0}\n        fill={onColor}\n      />\n      <text\n        className={interaction[\"text-unselectable\"]}\n        x={25}\n        y={19}\n        fontSize=\".8em\"\n        fill={onTextColor}\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        On\n      </text>\n      <rect\n        x={10}\n        y={25}\n        width={30}\n        height={15}\n        strokeWidth={0}\n        fill={offColor}\n      />\n      <text\n        className={interaction[\"text-unselectable\"]}\n        x={25}\n        y={34}\n        fontSize=\".8em\"\n        fill=\"lightgrey\"\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        Off\n      </text>\n    </g>\n  );\n};\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { elementDefinitionFromTypeSelector } from \"@/services/element-types/selectors/element-types\";\nimport { getNodeVisualElement } from \"@/elements/visuals\";\n\nexport interface ElementVisualProps {\n  className?: string;\n  elementId?: string;\n  x?: number;\n  y?: number;\n  elementType: string;\n}\n\nconst EmptyState = Object.freeze({});\n\nconst ElementVisual: React.FC<ElementVisualProps> = React.memo(\n  function ElementVisual({ className, elementId, x = 0, y = 0, elementType }) {\n    const def = useSelector((state) =>\n      elementDefinitionFromTypeSelector(state, elementType)\n    );\n\n    let body: React.ReactNode;\n    if (!def) {\n      body = <rect x={x} y={y} width={50} height={50} fill=\"red\" />;\n    } else {\n      body = getNodeVisualElement(elementId, [], EmptyState, def.visual);\n    }\n\n    const transform = x != 0 || y != 0 ? `translate(${x}, ${y})` : undefined;\n    return (\n      <g className={cls(className, \"element-visual\")} transform={transform}>\n        {body}\n      </g>\n    );\n  }\n);\n\nexport default ElementVisual;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useDrop } from \"react-dnd\";\n\nimport { Point, snapPoint } from \"@/geometry\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { addElement } from \"@/actions/element-add\";\n\nimport { elementTypeToCircuitId } from \"@/elements/definitions/integrated-circuits/utils\";\n\nimport { gridElementSnapSelector } from \"@/services/circuit-editor-drag/selectors/snap\";\nimport { circuitWouldRecurseSelector } from \"@/services/circuit-graph/selectors/circuits\";\n\nimport {\n  isNewElementDragObject,\n  NEW_ELEMENT_DRAG_OBJECT,\n} from \"../../../drag-items/new-element\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\nimport { useViewportContext } from \"../../../contexts/viewport-context\";\n\nimport { useMouseCoords } from \"../hooks/useMouseCoords\";\n\nimport ElementVisual from \"./ElementVisual\";\n\nconst DragNewElementLayer: React.FC = React.memo(\n  function DragNewElementLayer() {\n    const dispatch = useDispatch();\n    const { circuitId } = useCircuitEditor();\n    const snap = useSelector(gridElementSnapSelector);\n    const getMouseCoords = useMouseCoords();\n    const { zoomFactor } = useViewportContext();\n\n    function counterScale(value: number) {\n      return value * (1 / zoomFactor);\n    }\n\n    const [dragType, setDragType] = React.useState<string | null>(null);\n    const [dragPos, setDragPos] = React.useState<Point | null>(null);\n\n    const dropTargetWouldRecurse = useSelector((state) =>\n      circuitWouldRecurseSelector(\n        state,\n        elementTypeToCircuitId(dragType),\n        circuitId\n      )\n    );\n\n    const [, dropRef] = useDrop(\n      {\n        accept: NEW_ELEMENT_DRAG_OBJECT,\n        collect: (monitor) => {\n          // We need to clear this out on mouse out\n          if (!monitor.isOver()) {\n            setDragPos(null);\n            setDragType(null);\n          }\n        },\n        hover: (item, monitor) => {\n          if (!isNewElementDragObject(item)) {\n            setDragPos(null);\n            setDragType(null);\n            return;\n          }\n\n          const pos = monitor.getClientOffset();\n          if (!pos) {\n            return;\n          }\n          const coords = getMouseCoords({ x: pos.x, y: pos.y });\n          setDragType(item.payload.elementType);\n          setDragPos(coords);\n        },\n        drop: (item, monitor) => {\n          if (!isNewElementDragObject(item)) {\n            return;\n          }\n\n          if (dropTargetWouldRecurse) {\n            return;\n          }\n\n          const pos = monitor.getClientOffset();\n          if (!pos) {\n            return;\n          }\n          const coords = getMouseCoords({ x: pos.x, y: pos.y });\n          dispatch(\n            addElement(\n              item.payload.elementType,\n              circuitId,\n              snapPoint(coords, snap)\n            )\n          );\n        },\n      },\n      [circuitId, getMouseCoords, snap, dropTargetWouldRecurse]\n    );\n\n    const snapDragPos = dragPos && snapPoint(dragPos, snap);\n\n    const counterScaledSize = `${counterScale(1) * 100}%`;\n\n    return (\n      <g id=\"drag-new-element-layer\">\n        {!dropTargetWouldRecurse && snapDragPos && dragType && (\n          <g opacity={0.5}>\n            <ElementVisual\n              x={snapDragPos.x}\n              y={snapDragPos.y}\n              elementType={dragType}\n            />\n          </g>\n        )}\n        {dropTargetWouldRecurse && (\n          <g transform={`scale(${counterScale(1)})`}>\n            <rect width=\"100%\" height=\"100%\" opacity={0.7} fill=\"black\" />\n            {/* FIXME: Should center this text in the screen viewport. */}\n            <text x=\"100\" y=\"25%\" fill=\"white\">\n              The current circuit is already inside the dragged IC.\n            </text>\n          </g>\n        )}\n        <rect\n          ref={dropRef}\n          width={counterScaledSize}\n          height={counterScaledSize}\n          fill=\"transparent\"\n        />\n      </g>\n    );\n  }\n);\n\nexport default DragNewElementLayer;\n","import { createSelector } from \"reselect\";\n\nimport { AppState } from \"@/store\";\n\nimport {\n  normalizeRectangle,\n  Point,\n  pointEquals,\n  pointSubtract,\n} from \"@/geometry\";\n\nimport { selectedElementIdsSelector } from \"@/services/selection/selectors/selection\";\nimport { elementPinFromPointSelector } from \"@/services/circuit-layout/selectors/element-pin-positions\";\nimport { circuitIdForEditorIdSelector } from \"@/services/circuit-editors/selectors/editor\";\n\nimport { createCircuitEditorDragSelector } from \"../utils\";\nimport { CircuitEditorDragServiceState } from \"../state\";\n\nimport { gridJointSnapSelector, gridElementSnapSelector } from \"./snap\";\n\nexport const dragModeSelector = createCircuitEditorDragSelector(\n  (s) => s.dragMode\n);\n\nexport const isEditorDraggingSelector = createCircuitEditorDragSelector(\n  (s: CircuitEditorDragServiceState, editorId: string) => {\n    if (s.dragMode == null) {\n      return false;\n    }\n\n    // TODO: Allow dragging in dragEndEditorId if dragMode is move.\n    if (s.dragStartEditorId !== s.dragEndEditorId) {\n      return false;\n    }\n\n    return s.dragStartEditorId === editorId;\n  }\n);\n\nexport const isDraggingSelector = createCircuitEditorDragSelector(\n  (s) => s.dragMode != null\n);\n\nexport const dragStartSelector = createCircuitEditorDragSelector((s) => {\n  if (!s.dragMode) {\n    return null;\n  }\n\n  return s.dragStart;\n});\n\nexport const dragEndSelector = createCircuitEditorDragSelector((s) => {\n  if (!s.dragMode) {\n    return null;\n  }\n\n  return s.dragEnd;\n});\n\nexport const selectionRectSelector = createCircuitEditorDragSelector(\n  createSelector(\n    dragModeSelector.local,\n    dragStartSelector.local,\n    dragEndSelector.local,\n    (dragMode, dragStart, dragEnd) =>\n      dragMode === \"select\" && dragStart && dragEnd\n        ? normalizeRectangle(dragStart, dragEnd)\n        : null\n  )\n);\n\nlet cachedDragMoveOffset: Point | null = null;\nexport const dragMoveOffsetSelector = (state: AppState) => {\n  const dragState = state.services.circuitEditorDrag;\n  if (dragState.dragMode !== \"move\") {\n    return null;\n  }\n\n  const selectedElementIds = selectedElementIdsSelector(state);\n\n  let gridSnap: number;\n  if (selectedElementIds.length > 0) {\n    gridSnap = gridElementSnapSelector(state);\n  } else {\n    gridSnap = gridJointSnapSelector(state);\n  }\n\n  const { dragStart, dragEnd, dragModifierKeys } = dragState;\n  if (!dragEnd) {\n    return null;\n  }\n\n  const offset = pointSubtract(dragEnd, dragStart);\n  if (!dragModifierKeys.ctrlMetaKey) {\n    offset.x = Math.round(offset.x / gridSnap) * gridSnap;\n    offset.y = Math.round(offset.y / gridSnap) * gridSnap;\n  }\n\n  if (!cachedDragMoveOffset || !pointEquals(offset, cachedDragMoveOffset)) {\n    cachedDragMoveOffset = offset;\n  }\n\n  return cachedDragMoveOffset;\n};\n\nexport const dragNewJointPositionSelector = createCircuitEditorDragSelector(\n  (state) => {\n    const gridSnap = gridJointSnapSelector.local(state);\n    if (state.dragMode !== \"new-joint\") {\n      return null;\n    }\n\n    const { dragEnd, dragModifierKeys } = state;\n    if (!dragEnd || !dragModifierKeys) {\n      return null;\n    }\n\n    const position = { ...dragEnd };\n    if (!dragModifierKeys.ctrlMetaKey) {\n      position.x = Math.round(position.x / gridSnap) * gridSnap;\n      position.y = Math.round(position.y / gridSnap) * gridSnap;\n    }\n\n    return position;\n  }\n);\n\nexport const dragDropTargetPinSelector = (state: AppState) => {\n  const dragState = state.services.circuitEditorDrag;\n  if (dragState.dragMode !== \"wire\") {\n    return null;\n  }\n\n  const { dragEnd, dragStartEditorId } = dragState;\n  if (!dragEnd) {\n    return null;\n  }\n\n  const circuitId = circuitIdForEditorIdSelector(state, dragStartEditorId);\n  if (!circuitId) {\n    return null;\n  }\n\n  return elementPinFromPointSelector(state, dragEnd, circuitId);\n};\n","import * as React from \"react\";\n\nimport pick from \"lodash/pick\";\nimport mapValues from \"lodash/mapValues\";\nimport values from \"lodash/values\";\n\nimport { createSelector } from \"reselect\";\n\nimport { elementTypesByElementIdSelector } from \"@/services/circuit-graph/selectors/elements\";\nimport { elementPositionsByElementIdSelector } from \"@/services/circuit-layout/selectors/element-positions\";\nimport { selectedElementIdsSelector } from \"@/services/selection/selectors/selection\";\nimport {\n  dragMoveOffsetSelector,\n  isEditorDraggingSelector,\n} from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport ElementVisual from \"./ElementVisual\";\n\nconst selectedElementPositionsByIdSelector = createSelector(\n  selectedElementIdsSelector,\n  elementPositionsByElementIdSelector,\n  (selectedElementIds, elementPositionsById) =>\n    pick(elementPositionsById, selectedElementIds)\n);\n\nconst selectedElementTypesByIdSelector = createSelector(\n  selectedElementIdsSelector,\n  elementTypesByElementIdSelector,\n  (selectedElementIds, elementTypesById) =>\n    pick(elementTypesById, selectedElementIds)\n);\n\nconst DragElementPreviewLayer: React.FC = React.memo(\n  function DragElementPreviewLayer() {\n    const { editorId } = useCircuitEditor();\n\n    const isDragging = useSelector((state) =>\n      isEditorDraggingSelector(state, editorId)\n    );\n\n    const selectedElementPositionsById = useSelector(\n      selectedElementPositionsByIdSelector\n    );\n    const selectedElementTypesById = useSelector(\n      selectedElementTypesByIdSelector\n    );\n    const dragMoveOffset = useSelector(dragMoveOffsetSelector);\n\n    if (!isDragging || !dragMoveOffset) {\n      return null;\n    }\n\n    let elements: React.ReactNode | null = null;\n    if (dragMoveOffset) {\n      elements = values(\n        mapValues(selectedElementPositionsById, (p, elementId) => (\n          <ElementVisual\n            key={elementId}\n            elementType={selectedElementTypesById[elementId]}\n            x={p.x + dragMoveOffset.x}\n            y={p.y + dragMoveOffset.y}\n          />\n        ))\n      );\n    }\n    return (\n      <g id=\"drag-element-preview-layer\" opacity={0.3}>\n        {elements}\n      </g>\n    );\n  }\n);\n\nexport default DragElementPreviewLayer;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./WireJointVisual.module.css\";\n\ninterface WireJointVisualProps extends React.SVGProps<SVGCircleElement> {\n  x: number;\n  y: number;\n  interactable?: boolean;\n  selected?: boolean;\n}\n\nconst WireJointVisual: React.FC<WireJointVisualProps> = ({\n  x,\n  y,\n  interactable = true,\n  selected = false,\n  ...props\n}) => {\n  const [mouseOver, setMouseOver] = React.useState(false);\n\n  const onMouseOver = React.useCallback(() => {\n    if (!interactable) {\n      return;\n    }\n    setMouseOver(true);\n  }, [interactable]);\n\n  const onMouseOut = React.useCallback(() => {\n    setMouseOver(false);\n  }, []);\n\n  return (\n    <circle\n      className={cls(styles[\"wire-joint\"], selected && styles[\"selected\"])}\n      cx={x}\n      cy={y}\n      r={(interactable && mouseOver) || selected ? 4 : 2}\n      onMouseOver={onMouseOver}\n      onMouseOut={onMouseOut}\n      {...props}\n    />\n  );\n};\n\nexport default WireJointVisual;\n","import WireJointVisual from \"./WireJointVisual\";\nexport default WireJointVisual;\n","// extracted by mini-css-extract-plugin\nexport default {\"wire-joint\":\"wire-joint--3o_SE\",\"selected\":\"selected--33Nsw\"};","import * as React from \"react\";\nimport { createSelector } from \"reselect\";\nimport pick from \"lodash/pick\";\nimport values from \"lodash/values\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport {\n  dragMoveOffsetSelector,\n  dragNewJointPositionSelector,\n  isEditorDraggingSelector,\n} from \"@/services/circuit-editor-drag/selectors/drag\";\nimport { selectedJointIdsSelector } from \"@/services/selection/selectors/selection\";\nimport { wireJointPositionsByJointIdSelector } from \"@/services/circuit-layout/selectors/wires\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport WireJointVisual from \"./WireJointVisual\";\n\nconst selectedJointPositionsByIdSelector = createSelector(\n  selectedJointIdsSelector,\n  wireJointPositionsByJointIdSelector,\n  (selectedJointIds, jointPositionsById) =>\n    pick(jointPositionsById, selectedJointIds)\n);\n\nconst DragJointPreviewLayer: React.FC = React.memo(\n  function DragJointPreviewLayer() {\n    const { editorId } = useCircuitEditor();\n\n    const isDragging = useSelector((state) =>\n      isEditorDraggingSelector(state, editorId)\n    );\n\n    const dragMoveOffset = useSelector(dragMoveOffsetSelector);\n    const selectedElementPositionsById = useSelector(\n      selectedJointPositionsByIdSelector\n    );\n\n    const newJointPosition = useSelector(dragNewJointPositionSelector);\n\n    if (!isDragging || (!dragMoveOffset && !newJointPosition)) {\n      return null;\n    }\n\n    let elements: React.ReactNode | null = null;\n    if (dragMoveOffset) {\n      elements = values(selectedElementPositionsById).map((p, index) => (\n        <WireJointVisual\n          key={index}\n          interactable={false}\n          x={p.x + dragMoveOffset.x}\n          y={p.y + dragMoveOffset.y}\n          opacity={0.5}\n        />\n      ));\n    }\n\n    let newJointElement: React.ReactNode | null = null;\n    if (newJointPosition) {\n      newJointElement = (\n        <WireJointVisual\n          interactable={false}\n          x={newJointPosition.x}\n          y={newJointPosition.y}\n          opacity={0.5}\n        />\n      );\n    }\n\n    // TODO: Draw transparent lines connecting the joint.\n\n    return (\n      <g id=\"drag-joint-preview-layer\" opacity={0.3}>\n        {elements}\n        {newJointElement}\n      </g>\n    );\n  }\n);\n\nexport default DragJointPreviewLayer;\n","import { Point } from \"@/geometry\";\nimport * as React from \"react\";\n\nexport interface UseMouseDragDetector {\n  startTracking(e: React.MouseEvent): void;\n}\n\nexport interface UseMouseDragDetectorOpts {\n  dragThreshold?: number;\n  onClick?(e: MouseEvent): void;\n  onDragStart?(e: MouseEvent, originalCoords: Point): void;\n}\nexport function useMouseDragDetector({\n  dragThreshold = 5,\n  onClick,\n  onDragStart,\n}: UseMouseDragDetectorOpts): UseMouseDragDetector {\n  // We need both state and ref for this.\n  //  State lets us trigger a rerender / useEffect.\n  //  Ref lets us check for cancellation when handling document events.\n  //  We seem to get a few rogue onMouseMove events after we try to stop tracking.\n  const [isTracking, setTracking] = React.useState(false);\n  const mouseDownRef = React.useRef<Point | null>(null);\n\n  const onMouseDown = React.useCallback((e: React.MouseEvent) => {\n    if (!e.preventDefault) {\n      return;\n    }\n\n    setTracking(true);\n    mouseDownRef.current = { x: e.pageX, y: e.pageY };\n  }, []);\n\n  const onMouseMove = React.useCallback(\n    (e: MouseEvent) => {\n      if (!mouseDownRef.current) {\n        return;\n      }\n\n      const d = mouseDownRef.current;\n      if (\n        Math.abs(d.x - e.pageX) >= dragThreshold ||\n        Math.abs(d.y - e.pageY) >= dragThreshold\n      ) {\n        if (onDragStart) {\n          onDragStart(e, mouseDownRef.current);\n        }\n        setTracking(false);\n        mouseDownRef.current = null;\n      }\n    },\n    [dragThreshold, onDragStart]\n  );\n\n  const onMouseUp = React.useCallback(\n    (e: MouseEvent) => {\n      if (!mouseDownRef.current) {\n        return;\n      }\n\n      if (onClick) {\n        onClick(e);\n      }\n\n      setTracking(false);\n      mouseDownRef.current = null;\n    },\n    [onClick]\n  );\n\n  React.useEffect(() => {\n    if (!isTracking) {\n      return;\n    }\n\n    document.addEventListener(\"mousemove\", onMouseMove);\n    document.addEventListener(\"mouseup\", onMouseUp);\n\n    return () => {\n      document.removeEventListener(\"mousemove\", onMouseMove);\n      document.removeEventListener(\"mouseup\", onMouseUp);\n    };\n  }, [isTracking, onMouseMove, onMouseUp]);\n\n  return {\n    startTracking: onMouseDown,\n  };\n}\n","import { keyboardIsMac } from \"./runtime-env\";\n\nexport const MODIFIER_KEYS_NONE = Object.freeze<ModifierKeys>({});\n\nexport interface ModifierKeys {\n  ctrlMetaKey?: boolean;\n  shiftKey?: boolean;\n  altKey?: boolean;\n}\n\nexport interface MouseEventModifierKeys {\n  ctrlKey: boolean;\n  altKey: boolean;\n  shiftKey: boolean;\n  metaKey: boolean;\n}\nexport function getModifiers(e: MouseEventModifierKeys): ModifierKeys {\n  const { ctrlKey, altKey, shiftKey, metaKey } = e;\n  return {\n    // Mac reserves ctrl for system use, apps use meta.\n    ctrlMetaKey: keyboardIsMac ? metaKey : ctrlKey,\n    altKey,\n    shiftKey,\n  };\n}\n","import * as React from \"react\";\nimport { VirtualElement } from \"@popperjs/core\";\n\nimport { Point } from \"@/geometry\";\n\nimport { MenuCloseContextProvider } from \"./Menus/MenuCloseContext\";\n\nimport Popover from \"./Popover\";\n\nexport interface ContextMenuProps {\n  x: number;\n  y: number;\n  open: boolean;\n  onRequestClose(): void;\n}\n\nconst ContextMenu: React.FC<ContextMenuProps> = ({\n  x,\n  y,\n  open,\n  onRequestClose,\n  children,\n}) => {\n  const anchorEl = React.useMemo<VirtualElement>(\n    () => ({\n      getBoundingClientRect: () => ({\n        left: x,\n        top: y,\n        right: x,\n        bottom: y,\n        width: 0,\n        height: 0,\n        x,\n        y,\n      }),\n    }),\n    [x, y]\n  );\n\n  return (\n    <MenuCloseContextProvider value={onRequestClose}>\n      <Popover\n        isOpen={open}\n        onRequestClose={onRequestClose}\n        anchorEl={anchorEl}\n        placement=\"bottom-start\"\n      >\n        {children}\n      </Popover>\n    </MenuCloseContextProvider>\n  );\n};\n\nexport default ContextMenu;\n\nexport interface ContextMenuRenderProps {\n  point: Point;\n}\nexport interface UseContextMenu {\n  renderContextMenu(\n    content:\n      | React.ReactNode\n      | ((renderProps: ContextMenuRenderProps) => React.ReactNode)\n  ): React.ReactNode;\n  openContextMenu(e: React.MouseEvent): void;\n}\nexport function useContextMenu(): UseContextMenu {\n  const [ctxPos, setCtxPos] = React.useState<Point | null>(null);\n\n  const openContextMenu = React.useCallback((e: React.MouseEvent) => {\n    setCtxPos({ x: e.pageX, y: e.pageY });\n  }, []);\n\n  const onCloseContextMenu = React.useCallback(() => {\n    setCtxPos(null);\n  }, []);\n\n  const renderContextMenu = React.useCallback(\n    (\n      content:\n        | React.ReactNode\n        | ((renderProps: ContextMenuRenderProps) => React.ReactNode)\n    ) => {\n      if (!ctxPos) {\n        return null;\n      }\n\n      if (typeof content === \"function\") {\n        content = content({ point: ctxPos });\n      }\n\n      return (\n        <ContextMenu\n          open\n          onRequestClose={onCloseContextMenu}\n          x={ctxPos.x}\n          y={ctxPos.y}\n        >\n          {content}\n        </ContextMenu>\n      );\n    },\n    [ctxPos, onCloseContextMenu]\n  );\n\n  return {\n    openContextMenu,\n    renderContextMenu,\n  };\n}\n","import * as React from \"react\";\n\nimport { keyboardCommandModifier } from \"@/runtime-env\";\nimport { Point } from \"@/geometry\";\n\nimport { useAction } from \"@/hooks/useAction\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { selectedElementIdsSelector } from \"@/services/selection/selectors/selection\";\nimport { canPasteSelector } from \"@/services/clipboard/selectors/clipboard\";\n\nimport { paste } from \"@/actions/clipboard-paste\";\nimport { selectionAlignToGrid } from \"@/actions/selection-align-to-grid\";\nimport { deleteSelection } from \"@/actions/selection-delete\";\nimport { copySelection } from \"@/actions/selection-copy\";\n\nimport MenuItem from \"@/components/Menus/MenuItem\";\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\n\nexport interface ContextMenuItemsProps {\n  fieldPosition: Point;\n}\nconst ContextMenuItems: React.FC<ContextMenuItemsProps> = ({\n  fieldPosition,\n}) => {\n  const onAlignToGrid = useAction(selectionAlignToGrid);\n\n  const canCopy = useSelector(selectedElementIdsSelector).length > 0;\n  const onCopy = useAction(copySelection);\n  const canPaste = useSelector(canPasteSelector);\n  const onPaste = useAction(paste, { pastePosition: fieldPosition });\n\n  const onDelete = useAction(deleteSelection);\n\n  return (\n    <>\n      <MenuItem onClick={onAlignToGrid}>Align Selection To Grid</MenuItem>\n      <DividerMenuItem />\n      <MenuItem\n        disabled={!canCopy}\n        secondary={`${keyboardCommandModifier}+c`}\n        onClick={onCopy}\n      >\n        Copy\n      </MenuItem>\n      <MenuItem\n        disabled={!canPaste}\n        secondary={`${keyboardCommandModifier}+v`}\n        onClick={onPaste}\n      >\n        Paste\n      </MenuItem>\n      <DividerMenuItem />\n      <MenuItem onClick={onDelete}>Delete Selected</MenuItem>\n    </>\n  );\n};\n\nexport default ContextMenuItems;\n","import * as React from \"react\";\n\nimport { Point } from \"@/geometry\";\n\nimport Menu from \"@/components/Menus/Menu\";\n\nimport ContextMenuItems from \"./ContextMenuItems\";\n\nexport interface FieldContextMenuProps {\n  fieldPosition: Point;\n}\nconst FieldContextMenu: React.FC<FieldContextMenuProps> = ({\n  fieldPosition,\n}) => {\n  return (\n    <Menu>\n      <ContextMenuItems fieldPosition={fieldPosition} />\n    </Menu>\n  );\n};\n\nexport default FieldContextMenu;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { Point } from \"@/geometry\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useMouseDragDetector } from \"@/hooks/useMouseDragDetector\";\n\nimport { getModifiers } from \"@/modifier-keys\";\n\nimport {\n  isEditorDraggingSelector,\n  selectionRectSelector,\n} from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport { useContextMenu } from \"@/components/ContextMenu\";\n\nimport { clearSelection } from \"@/actions/select-clear\";\nimport { circuitEditorDragStartSelect } from \"@/actions/circuit-editor-drag-start-select\";\n\nimport { useViewportContext } from \"../../../contexts/viewport-context\";\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport { useMouseCoords } from \"../hooks/useMouseCoords\";\n\nimport FieldContextMenu from \"./FieldContextMenu\";\n\nconst DragSelectLayer: React.FC = React.memo(function DragSelectLayer() {\n  const dispatch = useDispatch();\n  const { editorId } = useCircuitEditor();\n  const { zoomFactor } = useViewportContext();\n\n  const isDragging = useSelector((state) =>\n    isEditorDraggingSelector(state, editorId)\n  );\n\n  const selectionRect = useSelector(selectionRectSelector);\n\n  function counterScale(value: number) {\n    return value * (1 / zoomFactor);\n  }\n\n  const getCoords = useMouseCoords();\n\n  const { openContextMenu, renderContextMenu } = useContextMenu();\n\n  const onContextMenu = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n      openContextMenu(e);\n    },\n    [openContextMenu]\n  );\n\n  const onClick = React.useCallback(\n    (e: MouseEvent) => {\n      if (e.button !== 0) {\n        return;\n      }\n      const modifiers = getModifiers(e);\n      if (!modifiers.ctrlMetaKey && !modifiers.shiftKey) {\n        dispatch(clearSelection());\n      }\n    },\n    [dispatch]\n  );\n\n  const onDragStart = React.useCallback(\n    (e: MouseEvent, originalPoint: Point) => {\n      const p = getCoords(originalPoint);\n      const modifierKeys = getModifiers(e);\n      dispatch(circuitEditorDragStartSelect(p, modifierKeys, editorId));\n    },\n    [dispatch, editorId, getCoords]\n  );\n\n  const { startTracking: onMouseDown } = useMouseDragDetector({\n    onClick,\n    onDragStart,\n  });\n\n  return (\n    <g className=\"circuit-editor-mouse-layer\">\n      <rect\n        /*\n         Our width and height get scaled by the parent scaler.\n         We have to be inside the parent scaler to make our mouse coordinate values match up.\n         Scale us back out so we continue to cover the whole screen.\n         */\n        width={`${counterScale(1) * 100}%`}\n        height={`${counterScale(1) * 100}%`}\n        fill=\"transparent\"\n        onMouseDown={onMouseDown}\n        onContextMenu={onContextMenu}\n      />\n      {isDragging && selectionRect && (\n        <g\n          transform={`translate(${selectionRect.p1.x}, ${selectionRect.p1.y})`}\n        >\n          <rect\n            width={selectionRect.p2.x - selectionRect.p1.x}\n            height={selectionRect.p2.y - selectionRect.p1.y}\n            strokeWidth={counterScale(2)}\n            strokeDasharray={`${counterScale(5)} ${counterScale(3)}`}\n            stroke=\"skyblue\"\n            fill=\"transparent\"\n          />\n        </g>\n      )}\n      {renderContextMenu(({ point }) => (\n        <FieldContextMenu fieldPosition={getCoords(point)} />\n      ))}\n    </g>\n  );\n});\n\nexport default DragSelectLayer;\n","import * as React from \"react\";\nimport { v4 as uuidV4 } from \"uuid\";\n\nimport { useViewportContext } from \"../../../contexts/viewport-context\";\n\nconst GridBackground: React.FC = React.memo(function GridBackground() {\n  const [gridId] = React.useState(`grid-${uuidV4()}`);\n  const { zoomFactor } = useViewportContext();\n\n  const gridSize = 50 * zoomFactor;\n\n  return (\n    <svg width=\"100%\" height=\"100%\" xmlns=\"http://www.w3.org/2000/svg\">\n      <defs>\n        <pattern\n          id={gridId}\n          width={gridSize}\n          height={gridSize}\n          patternUnits=\"userSpaceOnUse\"\n        >\n          <path\n            d={`M ${gridSize} 0 L 0 0 0 ${gridSize}`}\n            fill=\"none\"\n            stroke=\"gray\"\n            strokeWidth={0.5}\n          />\n        </pattern>\n      </defs>\n\n      <rect width=\"100%\" height=\"100%\" fill={`url(#${gridId})`} />\n    </svg>\n  );\n});\n\nexport default GridBackground;\n","import * as React from \"react\";\n\nexport interface AtomicTextInputProps {\n  className?: string;\n  autoFocus?: boolean;\n  defaultValue?: string;\n  value?: string;\n  onChange?(e: React.ChangeEvent<HTMLInputElement>): void;\n  onBeginEdit?(): void;\n  onCommit?(value: string): void;\n  onCancel?(): void;\n  onKeyUp?(e: React.KeyboardEvent<HTMLInputElement>): void;\n  onBlur?(e: React.FocusEvent<HTMLInputElement>): void;\n}\n\nconst AtomicTextInput = React.forwardRef<\n  HTMLInputElement,\n  AtomicTextInputProps\n>(\n  (\n    {\n      className,\n      autoFocus,\n      defaultValue,\n      value,\n      onChange,\n      onBeginEdit,\n      onCommit,\n      onCancel,\n      onBlur,\n      onKeyUp,\n    },\n    ref\n  ) => {\n    const [editValue, setEditValue] = React.useState<string | null>(null);\n\n    const onInputChange = React.useCallback(\n      (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (editValue == null && onBeginEdit) {\n          onBeginEdit();\n        }\n\n        setEditValue(e.target.value);\n\n        if (onChange) {\n          onChange(e);\n        }\n      },\n      [editValue, onBeginEdit, onChange]\n    );\n\n    const onInputKeyUp = React.useCallback(\n      (e: React.KeyboardEvent<HTMLInputElement>) => {\n        if (onKeyUp) {\n          onKeyUp(e);\n        }\n        if (e.defaultPrevented) {\n          return;\n        }\n\n        if (editValue == null) {\n          return;\n        }\n\n        if (e.key === \"Escape\") {\n          e.preventDefault();\n          if (onCancel) {\n            onCancel();\n          }\n        } else if (e.key === \"Enter\") {\n          e.preventDefault();\n          if (onCommit) {\n            onCommit(editValue);\n          }\n        }\n      },\n      [onKeyUp, editValue, onCancel, onCommit]\n    );\n\n    const onInputBlur = React.useCallback(\n      (e: React.FocusEvent<HTMLInputElement>) => {\n        if (onBlur) {\n          onBlur(e);\n        }\n\n        if (editValue != null && onCommit) {\n          onCommit(editValue);\n        }\n      },\n      [onBlur, editValue, onCommit]\n    );\n\n    return (\n      <input\n        ref={ref}\n        className={className}\n        autoFocus={autoFocus}\n        defaultValue={defaultValue}\n        value={value}\n        type=\"text\"\n        onChange={onInputChange}\n        onKeyUp={onInputKeyUp}\n        onBlur={onInputBlur}\n      />\n    );\n  }\n);\n\nexport default AtomicTextInput;\n","import { cls } from \"@/utils\";\nimport * as React from \"react\";\nimport AtomicTextInput from \"./AtomicTextInput\";\n\nexport interface EditableTextProps {\n  className?: string;\n  textClassname?: string;\n  inputClassname?: string;\n  label?: JSX.Element;\n  defaultValue: string;\n  isEditing: boolean;\n  onRequestEdit?(): void;\n  onCommit(value: string): void;\n  onCancel(): void;\n}\n\nconst EditableText: React.FC<EditableTextProps> = ({\n  className,\n  textClassname,\n  inputClassname,\n  label,\n  defaultValue,\n  isEditing,\n  onRequestEdit,\n  onCommit,\n  onCancel,\n}) => {\n  const inputRef = React.useRef<HTMLInputElement | null>(null);\n\n  const onSpanDoubleClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (!onRequestEdit) {\n        return;\n      }\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n      onRequestEdit();\n    },\n    [onRequestEdit]\n  );\n\n  // AtomicTextInput enters editing mode when the user changes something.\n  // It will not call cancel on blur.\n  // We want to exit when blurred\n  const onKeyUp = React.useCallback(\n    (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === \"Escape\" && isEditing) {\n        onCancel();\n      }\n    },\n    [isEditing, onCancel]\n  );\n\n  const onBlur = React.useCallback(() => {\n    if (isEditing) {\n      onCancel();\n    }\n  }, [isEditing, onCancel]);\n\n  React.useEffect(() => {\n    if (isEditing && inputRef.current) {\n      inputRef.current.select();\n    }\n  }, [isEditing]);\n\n  if (!isEditing) {\n    return (\n      <span\n        className={cls(className, textClassname)}\n        onDoubleClick={onSpanDoubleClick}\n      >\n        {label ?? defaultValue}\n      </span>\n    );\n  }\n\n  return (\n    <AtomicTextInput\n      ref={inputRef}\n      className={cls(className, inputClassname)}\n      autoFocus\n      defaultValue={defaultValue}\n      onBlur={onBlur}\n      onKeyUp={onKeyUp}\n      onCommit={onCommit}\n      onCancel={onCancel}\n    />\n  );\n};\n\nexport default EditableText;\n","import * as React from \"react\";\n\nimport EditableText, { EditableTextProps } from \"../EditableText\";\n\nimport { useMenuCloseContext } from \"./MenuCloseContext\";\n\nimport styles from \"./Menus.module.css\";\n\nexport type EditableTextMenuItemProps = EditableTextProps;\nconst EditableTextMenuItem: React.FC<EditableTextMenuItemProps> = (props) => {\n  const { onRequestEdit, onCommit } = props;\n\n  const requestMenuClose = useMenuCloseContext();\n\n  const onClick = React.useCallback(() => {\n    if (onRequestEdit) {\n      onRequestEdit();\n    }\n  }, [onRequestEdit]);\n\n  const onEditableCommit = React.useCallback(\n    (value: string) => {\n      onCommit(value);\n      requestMenuClose();\n    },\n    [onCommit, requestMenuClose]\n  );\n\n  return (\n    <li className={styles[\"menu-item\"]} onClick={onClick}>\n      <EditableText {...props} onCommit={onEditableCommit} />\n    </li>\n  );\n};\n\nexport default EditableTextMenuItem;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { Point } from \"@/geometry\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { elementTypeToCircuitId } from \"@/elements/definitions/integrated-circuits/utils\";\n\nimport { renameElement } from \"@/actions/element-rename\";\nimport { viewCircuit } from \"@/actions/view-circuit\";\n\nimport {\n  elementNameOrDefaultFromElementIdSelector,\n  elementTypeFromElementIdSelector,\n} from \"@/services/circuit-graph/selectors/elements\";\n\nimport Menu from \"@/components/Menus/Menu\";\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\nimport EditableTextMenuItem from \"@/components/Menus/EditableTextMenuItem\";\nimport MenuItem from \"@/components/Menus/MenuItem\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport ContextMenuItems from \"./ContextMenuItems\";\n\nexport interface NodeContextMenuProps {\n  fieldPosition: Point;\n  elementId: string;\n}\n\nconst ElementContextMenu: React.FC<NodeContextMenuProps> = ({\n  elementId,\n  fieldPosition,\n}) => {\n  const dispatch = useDispatch();\n\n  const { elementIdPath } = useCircuitEditor();\n\n  const elementName = useSelector((state) =>\n    elementNameOrDefaultFromElementIdSelector(state, elementId)\n  );\n  const elementType = useSelector((state) =>\n    elementTypeFromElementIdSelector(state, elementId)\n  );\n  const elementCircuitId = elementType\n    ? elementTypeToCircuitId(elementType)\n    : null;\n\n  const [isRenaming, setIsRenaming] = React.useState(false);\n  const onRename = React.useCallback(() => {\n    setIsRenaming(true);\n  }, []);\n  const onRenameCancel = React.useCallback(() => {\n    setIsRenaming(false);\n  }, []);\n  const onRenameCommit = React.useCallback(\n    (value: string) => {\n      setIsRenaming(false);\n      dispatch(renameElement(elementId, value));\n    },\n    [dispatch, elementId]\n  );\n\n  const onOpenCircuitInNewWindow = React.useCallback(() => {\n    if (!elementCircuitId) {\n      return;\n    }\n    dispatch(\n      viewCircuit(elementCircuitId, [...elementIdPath, elementId], {\n        newWindow: true,\n      })\n    );\n  }, [elementIdPath, dispatch, elementCircuitId, elementId]);\n\n  return (\n    <Menu>\n      <EditableTextMenuItem\n        defaultValue={elementName ?? \"<unknown>\"}\n        label={<span style={{ fontWeight: \"bold\" }}>{elementName}</span>}\n        isEditing={isRenaming}\n        onRequestEdit={onRename}\n        onCommit={onRenameCommit}\n        onCancel={onRenameCancel}\n      />\n      <DividerMenuItem />\n      {elementCircuitId && (\n        <>\n          <MenuItem onClick={onOpenCircuitInNewWindow}>\n            Open in New Window\n          </MenuItem>\n          <DividerMenuItem />\n        </>\n      )}\n      <ContextMenuItems fieldPosition={fieldPosition} />\n    </Menu>\n  );\n};\n\nexport default ElementContextMenu;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\nimport { Point, Rectangle, ZeroPoint } from \"@/geometry\";\nimport { getModifiers } from \"@/modifier-keys\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport { getNodeVisualElement } from \"@/elements/visuals\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useMouseDragDetector } from \"@/hooks/useMouseDragDetector\";\n\nimport { evolverStateFromCircuitElementIdSelector } from \"@/services/simulator/selectors/elements\";\nimport { isElementSelectedFromElementIdSelector } from \"@/services/selection/selectors/selection\";\nimport { elementPositionFromElementIdSelector } from \"@/services/circuit-layout/selectors/element-positions\";\nimport { isSimActiveSelector } from \"@/services/simulator-control/selectors/run\";\nimport { elementDefinitionFromElementIdSelector } from \"@/services/circuit-graph/selectors/element-def\";\nimport { elementFieldDisplayNameFromElementId } from \"@/services/ui-settings/selectors/element-name\";\n\nimport { circuitEditorDragStartElement } from \"@/actions/circuit-editor-drag-start-element\";\nimport { selectElements } from \"@/actions/select-elements\";\n\nimport { useContextMenu } from \"@/components/ContextMenu\";\n\nimport { useCircuitEditor } from \"../../../../contexts/circuit-editor-context\";\nimport { useViewportContext } from \"../../../../contexts/viewport-context\";\nimport { getElementHtmlId } from \"../../../../ids\";\n\nimport { useMouseCoords } from \"../../hooks/useMouseCoords\";\n\nimport ElementContextMenu from \"../ElementContextMenu\";\n\nimport \"./Element.module.css\";\n\nexport interface NodeProps {\n  elementId: string;\n}\n\nconst Element: React.FC<NodeProps> = React.memo(function Node({ elementId }) {\n  const dispatch = useDispatch();\n  const { editorId, elementIdPath } = useCircuitEditor();\n  const isSimActive = useSelector(isSimActiveSelector);\n\n  const { openContextMenu, renderContextMenu } = useContextMenu();\n\n  const def = useSelector((state) =>\n    elementDefinitionFromElementIdSelector(state, elementId)\n  );\n  const { x, y } = useSelector((s) =>\n    elementPositionFromElementIdSelector(s, elementId)\n  );\n  const evolverState = useSelector((s) =>\n    evolverStateFromCircuitElementIdSelector(s, [...elementIdPath, elementId])\n  );\n  const isSelected = useSelector((s) =>\n    isElementSelectedFromElementIdSelector(s, elementId)\n  );\n\n  const getCoords = useMouseCoords();\n\n  const onClick = React.useCallback(\n    (e: MouseEvent) => {\n      if (isSimActive) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      if (e.button !== 0) {\n        return;\n      }\n\n      e.preventDefault();\n\n      const modifiers = getModifiers(e);\n      const selectionMode = getSelectMode(modifiers);\n      dispatch(selectElements(elementId, selectionMode));\n    },\n    [dispatch, isSimActive, elementId]\n  );\n\n  const onContextMenu = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n\n      const modifiers = getModifiers(e);\n      const selectionMode = getSelectMode(modifiers, \"set-if-unselected\");\n      dispatch(selectElements(elementId, selectionMode));\n      openContextMenu(e);\n    },\n    [dispatch, elementId, openContextMenu]\n  );\n\n  const onDragStart = React.useCallback(\n    (e: MouseEvent, originalPoint: Point) => {\n      const p = getCoords(originalPoint);\n      const modifiers = getModifiers(e);\n      dispatch(\n        circuitEditorDragStartElement(elementId, p, modifiers, editorId)\n      );\n    },\n    [getCoords, dispatch, elementId, editorId]\n  );\n\n  const { startTracking } = useMouseDragDetector({\n    onClick,\n    onDragStart,\n  });\n\n  const onMouseDown = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n      // Handle this regardless, to stop mosue clicks\n      // selecting nearby text.\n      e.preventDefault();\n\n      if (isSimActive) {\n        return;\n      }\n\n      if (e.button !== 0) {\n        return;\n      }\n\n      startTracking(e);\n    },\n    [isSimActive, startTracking]\n  );\n\n  let body: React.ReactNode;\n  let rect: Rectangle;\n  if (!def) {\n    body = (\n      <rect\n        x={x}\n        y={y}\n        width={50}\n        height={50}\n        fill={isSelected ? \"goldenrod\" : \"red\"}\n      />\n    );\n    rect = { p1: ZeroPoint, p2: { x: 50, y: 50 } };\n  } else {\n    const { hitRect } = def.visual;\n    body = getNodeVisualElement(\n      elementId,\n      elementIdPath,\n      evolverState,\n      def.visual\n    );\n    rect = hitRect;\n  }\n\n  const transform = x != 0 || y != 0 ? `translate(${x}, ${y})` : undefined;\n  return (\n    <g transform={transform}>\n      <g\n        id={getElementHtmlId(editorId, elementId)}\n        className={cls(\n          \"circuit-field-element\",\n          isSelected && \"element-selected\"\n        )}\n        onMouseDown={onMouseDown}\n        onContextMenu={onContextMenu}\n      >\n        {body}\n      </g>\n      <NodeName elementId={elementId} hitRect={rect} />\n      {renderContextMenu(({ point }) => (\n        <ElementContextMenu\n          elementId={elementId}\n          fieldPosition={getCoords(point)}\n        />\n      ))}\n    </g>\n  );\n});\n\ninterface NodeNameProps extends NodeProps {\n  hitRect: Rectangle;\n}\nconst NodeName: React.FC<NodeNameProps> = React.memo(function NodeName({\n  elementId,\n  hitRect,\n}) {\n  const { zoomFactor } = useViewportContext();\n  const elementName = useSelector((s) =>\n    elementFieldDisplayNameFromElementId(s, elementId)\n  );\n\n  // FIXME: This is really rough, especially the y offset.\n  // There is a noticable jump in position between >1 and >1 scale.\n  const textScale = Math.max(0.7, zoomFactor);\n  let textYOffset = 15;\n  if (textScale > 1) {\n    textYOffset -= textScale * 2;\n  } else {\n    textYOffset += (1 / textScale) * 7;\n  }\n\n  if (!elementName) {\n    return null;\n  }\n\n  return (\n    <text\n      fontSize={`${1.2 / textScale}em`}\n      className={interaction[\"text-unselectable\"]}\n      textAnchor=\"middle\"\n      x={hitRect.p1.x + (hitRect.p2.x - hitRect.p1.x) / 2}\n      y={hitRect.p2.y + textYOffset}\n    >\n      {elementName}\n    </text>\n  );\n});\n\nexport default Element;\n","import Element from \"./Element\";\nexport * from \"./Element\";\nexport default Element;\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { elementIdsFromCircuitIdSelector } from \"@/services/circuit-graph/selectors/elements\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport Element from \"./Element\";\n\nconst ElementsLayer: React.FC = React.memo(function ElementsLayer() {\n  const { circuitId } = useCircuitEditor();\n  const elementIds = useSelector((state) =>\n    elementIdsFromCircuitIdSelector(state, circuitId)\n  );\n\n  const elements = elementIds.map((elementId) => {\n    return <Element key={elementId} elementId={elementId} />;\n  });\n\n  return <g>{elements}</g>;\n});\nexport default ElementsLayer;\n","import { AppState } from \"@/store\";\n\nimport {\n  connectionFromConnectionIdSelector,\n  connectionIdFromInputPinSelector,\n} from \"@/services/circuit-graph/selectors/connections\";\nimport { elementTypeFromElementIdSelector } from \"@/services/circuit-graph/selectors/elements\";\n\nimport { elementOutputsFromCircuitElementIdSelector } from \"./elements\";\nimport { ElementPin } from \"@/services/circuit-graph/types\";\n\n// Doesn't need caching for react since it returns primitives, but\n// the additional complexity of tracing IC pins might make it a bit heavy.\nexport const wireValueFromConnectionIdSelector = (\n  state: AppState,\n  icElementPath: string[],\n  connectionId: string\n): boolean => {\n  const connection = connectionFromConnectionIdSelector(state, connectionId);\n  if (!connection) {\n    return false;\n  }\n\n  const {\n    outputPin: { elementId, pinId },\n  } = connection;\n\n  const elementType = elementTypeFromElementIdSelector(state, elementId);\n  if (elementType === \"pin-input\") {\n    // TODO: The ultimate connection id from the input pin is a good candidate\n    // for caching in its own selector, as the ultimate source connection\n    // id of a pin is something that only changes with the simulator graph.\n\n    // The element id of the ic is the ic-element we are contained in.\n    const nextIcElementPath = icElementPath.slice(0, icElementPath.length - 1);\n    const nextPin: ElementPin = {\n      elementId: icElementPath[icElementPath.length - 1], // target element is our parent.\n      pinId: elementId, // target pin is the same as the element id for the input element.\n    };\n\n    const nextConnectionId = connectionIdFromInputPinSelector(state, nextPin);\n    if (!nextConnectionId) {\n      return false;\n    }\n\n    return wireValueFromConnectionIdSelector(\n      state,\n      nextIcElementPath,\n      nextConnectionId\n    );\n  } else if (elementType?.startsWith(\"ic-\")) {\n    // Target the ic our output comes from\n    const nextIcElementPath = [...icElementPath, elementId];\n    const nextPin: ElementPin = {\n      elementId: pinId, // output element id is the same as the target pin id\n      pinId: \"IN\",\n    };\n\n    const nextConnectionId = connectionIdFromInputPinSelector(state, nextPin);\n    if (!nextConnectionId) {\n      return false;\n    }\n\n    return wireValueFromConnectionIdSelector(\n      state,\n      nextIcElementPath,\n      nextConnectionId\n    );\n  } else {\n    const outputs = elementOutputsFromCircuitElementIdSelector(state, [\n      ...icElementPath,\n      elementId,\n    ]);\n    if (!outputs) {\n      return false;\n    }\n    return outputs[pinId] || false;\n  }\n};\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport {\n  Point,\n  normalize,\n  pointSubtract,\n  dotProduct,\n  pointAdd,\n  scale,\n} from \"@/geometry\";\nimport { getModifiers } from \"@/modifier-keys\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useMouseDragDetector } from \"@/hooks/useMouseDragDetector\";\n\nimport { circuitEditorDragStartNewJoint } from \"@/actions/circuit-editor-drag-start-newjoint\";\nimport { selectWires } from \"@/actions/select-wires\";\n\nimport {\n  wireJointPositionFromJointIdSelector,\n  wireStartPositionFromConnectionIdSelector,\n  wireEndPositionFromConnectionIdSelector,\n} from \"@/services/circuit-layout/selectors/wires\";\nimport { isSimActiveSelector } from \"@/services/simulator-control/selectors/run\";\nimport { isDraggingSelector } from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport { useMouseCoords } from \"../hooks/useMouseCoords\";\n\nexport interface WireSegmentProps {\n  connectionId: string;\n  startJointId: string | null;\n  endJointId: string | null;\n}\nconst WireSegment: React.FC<WireSegmentProps> = React.memo(\n  function WireSegment({ connectionId, startJointId, endJointId }) {\n    const { editorId } = useCircuitEditor();\n    const dispatch = useDispatch();\n    const getMouseCoords = useMouseCoords();\n    const isSimActive = useSelector(isSimActiveSelector);\n    const isDragging = useSelector(isDraggingSelector);\n\n    const start = useSelector((state) => {\n      if (startJointId == null) {\n        return wireStartPositionFromConnectionIdSelector(state, connectionId);\n      }\n      return wireJointPositionFromJointIdSelector(state, startJointId);\n    });\n\n    const end = useSelector((state) => {\n      if (endJointId == null) {\n        return wireEndPositionFromConnectionIdSelector(state, connectionId);\n      }\n      return wireJointPositionFromJointIdSelector(state, endJointId);\n    });\n\n    const [mousePos, setMousePos] = React.useState<Point | null>(null);\n\n    const onMouseMove = React.useCallback(\n      (e: React.MouseEvent) => {\n        const p = getMouseCoords({ x: e.pageX, y: e.pageY });\n        setMousePos(p);\n      },\n      [getMouseCoords]\n    );\n\n    const onMouseLeave = React.useCallback(() => {\n      setMousePos(null);\n    }, []);\n\n    const onDragStart = React.useCallback(\n      (e: MouseEvent, origionalPoint: Point) => {\n        const p = getMouseCoords(origionalPoint);\n        const modifiers = getModifiers(e);\n        dispatch(\n          circuitEditorDragStartNewJoint(\n            connectionId,\n            startJointId,\n            p,\n            modifiers,\n            editorId\n          )\n        );\n      },\n      [getMouseCoords, dispatch, connectionId, startJointId, editorId]\n    );\n\n    const onClick = React.useCallback(\n      (e: MouseEvent) => {\n        const modifiers = getModifiers(e);\n        const mode = getSelectMode(modifiers);\n        dispatch(selectWires(connectionId, mode));\n      },\n      [connectionId, dispatch]\n    );\n\n    const { startTracking } = useMouseDragDetector({ onClick, onDragStart });\n\n    const onJointInsertMouseDown = React.useCallback(\n      (e: React.MouseEvent) => {\n        e.preventDefault();\n        if (isSimActive) {\n          return;\n        }\n\n        startTracking(e);\n      },\n      [isSimActive, startTracking]\n    );\n\n    let insertJointPos: Point | undefined;\n    if (!isDragging && !isSimActive && mousePos) {\n      const lineDir = normalize(pointSubtract(end, start));\n      const v = pointSubtract(mousePos, start);\n      const d = dotProduct(v, lineDir);\n      insertJointPos = pointAdd(start, scale(lineDir, d));\n    }\n\n    return (\n      <g onMouseMove={onMouseMove} onMouseLeave={onMouseLeave}>\n        <line x1={start.x} y1={start.y} x2={end.x} y2={end.y} strokeWidth={2} />\n        {endJointId == null && <circle cx={end.x} cy={end.y} r={1.5} />}\n        {insertJointPos && (\n          <circle\n            cx={insertJointPos.x}\n            cy={insertJointPos.y}\n            r={3}\n            stroke=\"none\"\n            fill=\"red\"\n            onMouseDown={onJointInsertMouseDown}\n          />\n        )}\n      </g>\n    );\n  }\n);\n\nexport default WireSegment;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { Point } from \"@/geometry\";\nimport { getModifiers } from \"@/modifier-keys\";\nimport { getSelectMode } from \"@/selection-mode\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useMouseDragDetector } from \"@/hooks/useMouseDragDetector\";\n\nimport { wireJointPositionFromJointIdSelector } from \"@/services/circuit-layout/selectors/wires\";\nimport { isJointSelectedFromJointIdSelector } from \"@/services/selection/selectors/selection\";\nimport { isSimActiveSelector } from \"@/services/simulator-control/selectors/run\";\n\nimport { selectWireJoints } from \"@/actions/select-wire-joints\";\nimport { circuitEditorDragStartJoint } from \"@/actions/circuit-editor-drag-start-joint\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport { useMouseCoords } from \"../hooks/useMouseCoords\";\n\nimport WireJointVisual from \"./WireJointVisual\";\n\ninterface WireJointProps {\n  jointId: string;\n}\n\nconst WireJoint: React.FC<WireJointProps> = React.memo(function WireJoint({\n  jointId,\n}) {\n  const { editorId } = useCircuitEditor();\n  const getMouseCoords = useMouseCoords();\n  const dispatch = useDispatch();\n  const isSimActive = useSelector(isSimActiveSelector);\n\n  const isSelected = useSelector((state) =>\n    isJointSelectedFromJointIdSelector(state, jointId)\n  );\n\n  const position = useSelector((state) =>\n    wireJointPositionFromJointIdSelector(state, jointId)\n  );\n  const onDragStart = React.useCallback(\n    (e: MouseEvent, originalPoint: Point) => {\n      const p = getMouseCoords(originalPoint);\n      const modifiers = getModifiers(e);\n      dispatch(circuitEditorDragStartJoint(jointId, p, modifiers, editorId));\n    },\n    [dispatch, editorId, getMouseCoords, jointId]\n  );\n\n  const onClick = React.useCallback(\n    (e: MouseEvent) => {\n      const modifiers = getModifiers(e);\n      const mode = getSelectMode(modifiers);\n      dispatch(selectWireJoints(jointId, mode));\n    },\n    [dispatch, jointId]\n  );\n\n  const { startTracking } = useMouseDragDetector({\n    onClick,\n    onDragStart,\n  });\n\n  const onJointMouseDown = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (isSimActive) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n\n      startTracking(e);\n    },\n    [isSimActive, startTracking]\n  );\n\n  return (\n    <WireJointVisual\n      interactable={!isSimActive}\n      selected={isSelected}\n      x={position.x}\n      y={position.y}\n      onMouseDown={onJointMouseDown}\n    />\n  );\n});\n\nexport default WireJoint;\n","import Wire from \"./Wire\";\nexport default Wire;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { wireJointIdsFromConnectionIdSelector } from \"@/services/circuit-layout/selectors/wires\";\nimport { isWireSelectedFromConnectionIdSelector } from \"@/services/selection/selectors/selection\";\nimport { wireValueFromConnectionIdSelector } from \"@/services/simulator/selectors/wires\";\n\nimport { useCircuitEditor } from \"../../../../contexts/circuit-editor-context\";\n\nimport WireSegment from \"../WireSegment\";\nimport WireJoint from \"../WireJoint\";\n\nimport styles from \"./Wire.module.css\";\n\nexport interface WireProps {\n  connectionId: string;\n}\n\nconst Wire: React.FC<WireProps> = React.memo(function Wire({ connectionId }) {\n  const { elementIdPath } = useCircuitEditor();\n\n  const jointIds = useSelector((state) =>\n    wireJointIdsFromConnectionIdSelector(state, connectionId)\n  );\n  const isPowered = useSelector((state) =>\n    wireValueFromConnectionIdSelector(state, elementIdPath, connectionId)\n  );\n  const isSelected = useSelector((state) =>\n    isWireSelectedFromConnectionIdSelector(state, connectionId)\n  );\n\n  // We need one extra array entry for starting on the last jointId and ending at null (end of wire)\n  const segmentElements = [...jointIds, null].map((endJointId, index) => {\n    const startJointId = index > 0 ? jointIds[index - 1] : null;\n    return (\n      <WireSegment\n        key={index}\n        connectionId={connectionId}\n        startJointId={startJointId}\n        endJointId={endJointId}\n      />\n    );\n  });\n\n  const jointElements = jointIds.map((jointId) => (\n    <WireJoint key={jointId} jointId={jointId} />\n  ));\n\n  return (\n    <g\n      className={cls(\n        styles[\"wire\"],\n        isPowered && styles[\"powered\"],\n        isSelected && styles[\"selected\"]\n      )}\n    >\n      {segmentElements}\n      {jointElements}\n    </g>\n  );\n});\n\nexport default Wire;\n","// extracted by mini-css-extract-plugin\nexport default {\"wire\":\"wire--2lJT9\",\"powered\":\"powered--3tsJ_\",\"selected\":\"selected--Dkrv_\"};","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { connectionIdsForCircuitIdSelector } from \"@/services/circuit-graph/selectors/connections\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport Wire from \"./Wire\";\n\nconst WiresLayer: React.FC = React.memo(function WiresLayer() {\n  const { circuitId } = useCircuitEditor();\n  const connectionIds = useSelector((state) =>\n    connectionIdsForCircuitIdSelector(state, circuitId)\n  );\n  const connectorElements = connectionIds.map((connectionId) => (\n    <Wire key={connectionId} connectionId={connectionId} />\n  ));\n\n  return <g>{connectorElements}</g>;\n});\nexport default WiresLayer;\n","// extracted by mini-css-extract-plugin\nexport default {\"element-pin-output\":\"element-pin-output--1jFy-\",\"highlight\":\"highlight--Q2iLD\",\"is-drag-target\":\"is-drag-target--1NYuw\",\"element-pin-input\":\"element-pin-input--1urBY\"};","import ElementPin from \"./ElementPin\";\nexport default ElementPin;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\nimport { describeArc } from \"@/svg\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useMouseDragDetector } from \"@/hooks/useMouseDragDetector\";\n\nimport { elementPinPositionFromElementPinSelector } from \"@/services/circuit-layout/selectors/element-pin-positions\";\nimport { pinDirectionFromElementPinSelector } from \"@/services/circuit-graph/selectors/pins\";\nimport { dragDropTargetPinSelector } from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport { circuitEditorDragStartWire } from \"@/actions/circuit-editor-drag-start-wire\";\n\nimport { useCircuitEditor } from \"../../../../contexts/circuit-editor-context\";\nimport { getElementPinHtmlId } from \"../../../../ids\";\n\nimport { useMouseCoords } from \"../../hooks/useMouseCoords\";\n\nimport styles from \"./ElementPin.module.css\";\n\nexport interface ElementPinProps {\n  elementId: string;\n  pinId: string;\n}\n\nconst ElementPin: React.FC<ElementPinProps> = React.memo(function ElementPin({\n  elementId,\n  pinId,\n}) {\n  const { editorId } = useCircuitEditor();\n  const getMouseCoords = useMouseCoords();\n  const [highlight, setHighlight] = React.useState(false);\n  const dispatch = useDispatch();\n\n  const position = useSelector((s) =>\n    elementPinPositionFromElementPinSelector(s, elementId, pinId)\n  );\n  const direction = useSelector((s) =>\n    pinDirectionFromElementPinSelector(s, elementId, pinId)\n  );\n\n  const dragTargetPin = useSelector(dragDropTargetPinSelector);\n\n  const onDragStart = React.useCallback(\n    (e, originalPoint) => {\n      const p = getMouseCoords(originalPoint);\n      dispatch(circuitEditorDragStartWire(p, { elementId, pinId }, editorId));\n    },\n    [dispatch, editorId, getMouseCoords, elementId, pinId]\n  );\n\n  const { startTracking } = useMouseDragDetector({\n    onDragStart,\n  });\n\n  const onMouseDown = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.button !== 0) {\n        return;\n      }\n\n      if (e.defaultPrevented) {\n        return;\n      }\n      e.preventDefault();\n\n      e.stopPropagation();\n\n      startTracking(e);\n    },\n    [startTracking]\n  );\n\n  const onMouseEnter = React.useCallback(() => {\n    setHighlight(true);\n  }, []);\n  const onMouseLeave = React.useCallback(() => {\n    setHighlight(false);\n  }, []);\n\n  if (!position) {\n    return null;\n  }\n\n  const isDragTarget =\n    dragTargetPin != null &&\n    dragTargetPin.elementId === elementId &&\n    dragTargetPin.pinId === pinId;\n\n  const { x, y } = position;\n\n  let pinVisual: JSX.Element;\n\n  if (direction === \"input\") {\n    pinVisual = (\n      <path\n        d={describeArc(x, y, 4, -45, 225)}\n        strokeWidth={2}\n        className={cls(\n          styles[\"element-pin-input\"],\n          isDragTarget && styles[\"is-drag-target\"],\n          highlight && styles.highlight\n        )}\n      />\n    );\n  } else {\n    pinVisual = (\n      <circle\n        className={cls(\n          styles[\"element-pin-output\"],\n          isDragTarget && styles[\"is-drag-target\"],\n          highlight && styles.highlight\n        )}\n        cx={x}\n        cy={y}\n        r={3}\n      />\n    );\n  }\n\n  return (\n    <g\n      id={getElementPinHtmlId(editorId, elementId, pinId)}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n    >\n      {pinVisual}\n      <circle\n        stroke=\"none\"\n        fill=\"transparent\"\n        cx={x}\n        cy={y}\n        r={5}\n        onMouseDown={onMouseDown}\n      />\n    </g>\n  );\n});\n\nexport default ElementPin;\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { elementDefinitionFromElementIdSelector } from \"@/services/circuit-graph/selectors/element-def\";\n\nimport ElementPin from \"./ElementPin\";\n\nexport interface NodePinsProps {\n  elementId: string;\n}\n\nconst ElementPins: React.FC<NodePinsProps> = React.memo(function ElementPins({\n  elementId,\n}) {\n  const def = useSelector((state) =>\n    elementDefinitionFromElementIdSelector(state, elementId)\n  );\n\n  const pins = def?.pins ?? {};\n\n  const elements = Object.keys(pins).map((pinId) => (\n    <ElementPin key={pinId} elementId={elementId} pinId={pinId} />\n  ));\n\n  return <>{elements}</>;\n});\n\nexport default ElementPins;\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { elementIdsFromCircuitIdSelector } from \"@/services/circuit-graph/selectors/elements\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nimport ElementPins from \"./ElementPins\";\n\nconst ElementPinsLayer: React.FC = React.memo(function ElementPinsLayer() {\n  const { circuitId } = useCircuitEditor();\n  const elementIds = useSelector((state) =>\n    elementIdsFromCircuitIdSelector(state, circuitId)\n  );\n\n  const elements = elementIds.map((elementId) => (\n    <ElementPins key={elementId} elementId={elementId} />\n  ));\n\n  return <g>{elements}</g>;\n});\n\nexport default ElementPinsLayer;\n","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport {\n  dragEndSelector,\n  dragModeSelector,\n  dragStartSelector,\n  isEditorDraggingSelector,\n} from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\n\nconst DragAttachWirePreviewLayer: React.FC = React.memo(\n  function DragAttachWirePreviewLayer() {\n    const { editorId } = useCircuitEditor();\n\n    const isEditorDragging = useSelector((state) =>\n      isEditorDraggingSelector(state, editorId)\n    );\n\n    const dragMode = useSelector(dragModeSelector);\n    const dragStart = useSelector(dragStartSelector);\n    const dragEnd = useSelector(dragEndSelector);\n\n    if (!isEditorDragging || dragMode != \"wire\" || !dragStart || !dragEnd) {\n      return null;\n    }\n\n    return (\n      <line\n        x1={dragStart.x}\n        y1={dragStart.y}\n        x2={dragEnd.x}\n        y2={dragEnd.y}\n        stroke=\"black\"\n        strokeWidth={1}\n      />\n    );\n  }\n);\n\nexport default DragAttachWirePreviewLayer;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { getModifiers } from \"@/modifier-keys\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { isDraggingSelector } from \"@/services/circuit-editor-drag/selectors/drag\";\n\nimport { circuitEditorDragContinue } from \"@/actions/circuit-editor-drag-continue\";\nimport { circuitEditorDragEnd } from \"@/actions/circuit-editor-drag-end\";\nimport { circuitEditorDragAbort } from \"@/actions/circuit-editor-drag-abort\";\n\nimport { useCircuitEditor } from \"../../../contexts/circuit-editor-context\";\nimport { useViewportContext } from \"../../../contexts/viewport-context\";\n\nimport { useEventMouseCoords } from \"../hooks/useMouseCoords\";\n\nconst EditorDragReceiver: React.FC = () => {\n  const dispatch = useDispatch();\n  const { editorId } = useCircuitEditor();\n  const { zoomFactor } = useViewportContext();\n\n  const isDragging = useSelector(isDraggingSelector);\n\n  function counterScale(value: number) {\n    return value * (1 / zoomFactor);\n  }\n\n  const getCoords = useEventMouseCoords();\n\n  const onMouseMove = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.buttons === 0) {\n        // It would be nice if we could take a mouse capture and get notified\n        // of the mouse up elsewhere, but we need to allow other circuit editors\n        // to receive the mouse events so the drag can transfer.\n        // As a second best, detect mouse up when it comes back into us and cancel.\n        dispatch(circuitEditorDragAbort());\n        return;\n      }\n\n      const coords = getCoords(e);\n      const modifierKeys = getModifiers(e);\n      dispatch(circuitEditorDragContinue(coords, modifierKeys, editorId));\n    },\n    [dispatch, editorId, getCoords]\n  );\n\n  const onMouseUp = React.useCallback(\n    (e: React.MouseEvent) => {\n      const coords = getCoords(e);\n      const modifierKeys = getModifiers(e);\n      dispatch(circuitEditorDragEnd(coords, modifierKeys, editorId));\n    },\n    [dispatch, editorId, getCoords]\n  );\n\n  if (!isDragging) {\n    return null;\n  }\n\n  return (\n    <rect\n      width={`${counterScale(1) * 100}%`}\n      height={`${counterScale(1) * 100}%`}\n      fill=\"transparent\"\n      onMouseMove={onMouseMove}\n      onMouseUp={onMouseUp}\n    />\n  );\n};\n\nexport default EditorDragReceiver;\n","import CircuitFieldSurface from \"./CircuitFieldSurface\";\nexport default CircuitFieldSurface;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useDrop } from \"react-dnd\";\n\nimport { circuitEditorMouseLeave } from \"@/actions/circuit-editor-mouse-leave\";\n\nimport { NEW_ELEMENT_DRAG_OBJECT } from \"../../drag-items/new-element\";\nimport { useViewportContext } from \"../../contexts/viewport-context\";\n\nimport { FieldSvgElementProvider } from \"./contexts/fieldSvgElement\";\n\nimport DragNewElementLayer from \"./components/DragNewElementLayer\";\nimport DragElementPreviewLayer from \"./components/DragElementPreviewLayer\";\nimport DragJointPreviewLayer from \"./components/DragJointPreviewLayer\";\nimport FieldMouseLayer from \"./components/FieldMouseLayer\";\nimport GridBackground from \"./components/GridBackground\";\nimport ElementsLayer from \"./components/ElementsLayer\";\nimport WiresLayer from \"./components/WiresLayer\";\nimport ElementPinsLayer from \"./components/ElementPinsLayer\";\nimport DragAttachWirePreviewLayer from \"./components/DragAttachWirePreviewLayer\";\nimport EditorDragReceiver from \"./components/EditorDragReceiver\";\n\nimport styles from \"./CircuitFieldSurface.module.css\";\n\nexport interface CircuitFieldSurfaceProps {\n  width: number;\n  height: number;\n}\nconst CircuitFieldSurface: React.FC<CircuitFieldSurfaceProps> = ({\n  width,\n  height,\n}) => {\n  const dispatch = useDispatch();\n  const { zoomFactor } = useViewportContext();\n\n  const svgRef = React.useRef<SVGSVGElement | null>(null);\n  const scalerRef = React.useRef<SVGGElement | null>(null);\n\n  const onMouseDown = React.useCallback(() => {\n    svgRef.current?.focus();\n  }, []);\n\n  const onMouseLeave = React.useCallback(() => {\n    dispatch(circuitEditorMouseLeave());\n  }, [dispatch]);\n\n  // We need to capture the drag event at a deeper parent,\n  // because mouse events cannot pass through DragNewElementLayer's\n  // drag capture rect to the underlying DragSelectLayer and other elements.\n  // In contrast, we cannot handle the drag here as\n  // we do not know the coordinate system from our scaler.\n  // Instead, just capture whether or not we are being dragged into,\n  // and enable the new element drag layer only when we are dragging.\n  const [{ isDraggingNewElement }, dragRef] = useDrop({\n    accept: NEW_ELEMENT_DRAG_OBJECT,\n    collect: (monitor) => {\n      return {\n        isDraggingNewElement: monitor.isOver(),\n      };\n    },\n  });\n\n  return (\n    <svg\n      tabIndex={-1}\n      ref={(ref) => {\n        svgRef.current = ref;\n        dragRef(ref);\n      }}\n      width={width}\n      height={height}\n      onMouseDown={onMouseDown}\n      onMouseLeave={onMouseLeave}\n      className={styles[\"circuit-field-svg\"]}\n    >\n      <GridBackground />\n      <g\n        ref={scalerRef}\n        transform-origin=\"0 0\"\n        transform={`scale(${zoomFactor})`}\n      >\n        <FieldSvgElementProvider svgRef={svgRef} scalerRef={scalerRef}>\n          <FieldMouseLayer />\n          <ElementsLayer />\n          <WiresLayer />\n          <ElementPinsLayer />\n          <DragAttachWirePreviewLayer />\n          <DragElementPreviewLayer />\n          <DragJointPreviewLayer />\n          {isDraggingNewElement && <DragNewElementLayer />}\n          <EditorDragReceiver />\n        </FieldSvgElementProvider>\n      </g>\n    </svg>\n  );\n};\n\nexport default CircuitFieldSurface;\n","// extracted by mini-css-extract-plugin\nexport default {\"circuit-field-svg\":\"circuit-field-svg--o7YIn\"};","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\nimport { calcSize } from \"@/geometry\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useNativeEvent } from \"@/hooks/useNativeEvent\";\nimport { useComponentBounds } from \"@/hooks/useComponentBounds\";\n\nimport { fieldRectSelector } from \"@/services/circuit-layout/selectors/field\";\nimport { isSimActiveSelector } from \"@/services/simulator-control/selectors/run\";\n\nimport CircuitFieldSurface from \"./components/CircuitFieldSurface\";\n\nimport { CircuitEditorProvider } from \"./contexts/circuit-editor-context\";\nimport {\n  useViewportContext,\n  ViewportContextProvider,\n} from \"./contexts/viewport-context\";\n\nimport styles from \"./CircuitEditor.module.css\";\n\nimport { getCircuitEditorHtmlId } from \"./ids\";\n\nexport interface CircuitEditorProps {\n  className?: string;\n  editorId: string;\n}\n\nconst CircuitEditor: React.FC<CircuitEditorProps> = ({\n  className,\n  editorId,\n}) => {\n  const isSimActive = useSelector(isSimActiveSelector);\n\n  // svg seems to have an implicit bottom margin against its parent div\n  // Wrapping it in a div of the same size fixes it.\n  return (\n    <CircuitEditorProvider editorId={editorId}>\n      <div\n        id={getCircuitEditorHtmlId(editorId)}\n        className={cls(\n          \"circuit-editor\",\n          styles[\"circuit-editor\"],\n          isSimActive && \"simulator-active\",\n          className\n        )}\n      >\n        <div className={styles[\"circuit-editor-scrollarea\"]}>\n          <ViewportContextProvider>\n            <ZoomingCircuitFieldSurface />\n          </ViewportContextProvider>\n        </div>\n      </div>\n    </CircuitEditorProvider>\n  );\n};\n\nexport default CircuitEditor;\n\nconst ZoomingCircuitFieldSurface: React.FC = ({}) => {\n  const sizeRef = React.useRef<HTMLDivElement | null>(null);\n  const { width: componentWidth, height: componentHeight } = useComponentBounds(\n    sizeRef\n  );\n\n  const { zoomFactor, zoom } = useViewportContext();\n\n  const fieldRect = useSelector(fieldRectSelector);\n  const { width: fieldWidth, height: fieldHeight } = calcSize(fieldRect);\n\n  const width = Math.max(componentWidth, fieldWidth * zoomFactor);\n  const height = Math.max(componentHeight, fieldHeight * zoomFactor);\n\n  const onWheel = React.useCallback(\n    (e: WheelEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      if (e.ctrlKey) {\n        zoom(e.deltaY > 0 ? -1 : 1);\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    },\n    [zoom]\n  );\n\n  // React listens to the root listener for all events,\n  //  and chrome assumes the root event listener for mouse events\n  //  never wants to preventDefault.\n  // We need to take a local event listener and mark it as not passive.\n  // https://github.com/facebook/react/issues/14856\n  useNativeEvent(sizeRef, \"wheel\", onWheel, { passive: false });\n\n  return (\n    <div ref={sizeRef} style={{ width: \"100%\", height: \"100%\" }}>\n      <CircuitFieldSurface width={width} height={height} />\n    </div>\n  );\n};\n","import CircuitEditor from \"./CircuitEditor\";\nexport default CircuitEditor;\n","// extracted by mini-css-extract-plugin\nexport default {\"circuit-editor\":\"circuit-editor--2jFUa\",\"circuit-editor-scrollarea\":\"circuit-editor-scrollarea--12k0x\"};","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport styles from \"./Icons.module.css\";\n\nconst CloseIcon: React.FC<React.SVGProps<SVGSVGElement>> = (props) => {\n  return (\n    <svg\n      width={16}\n      height={16}\n      {...props}\n      className={cls(styles.icon, props.className)}\n    >\n      <path d=\"M4,4 L12,12 M4,12 L12,4\" />\n    </svg>\n  );\n};\n\nexport default CloseIcon;\n","import * as React from \"react\";\n\nimport { useDrag } from \"react-dnd\";\n\nimport { cls } from \"@/utils\";\n\nimport { tesselWindowDragObject } from \"./drag-items/tessel-window\";\n\nimport { useTesselInteraction, useTesselPath } from \"./TesselContext\";\nimport TesselDropCapture from \"./TesselDropCapture\";\n\nimport styles from \"./Tessel.module.css\";\nimport CloseIcon from \"../Icons/Close\";\n\nexport interface TesselWindowProps {\n  className?: string;\n  id?: string;\n  title: string;\n}\nconst TesselWindow: React.FC<TesselWindowProps> = ({\n  className,\n  id,\n  title,\n  children,\n}) => {\n  const path = useTesselPath();\n\n  const { closeWindow } = useTesselInteraction();\n  const onCloseWindow = React.useCallback(() => {\n    closeWindow(path);\n  }, [closeWindow, path]);\n\n  const [, dragSourceRef] = useDrag({\n    item: tesselWindowDragObject(path),\n  });\n\n  return (\n    <TesselDropCapture id={id} className={styles[\"tessel-window\"]}>\n      <div ref={dragSourceRef} className={styles[\"tessel-window-titlebar\"]}>\n        <div className={styles[\"tessel-window-title\"]}>{title}</div>\n        <div className={styles[\"tessel-window-controls\"]}>\n          <CloseIcon\n            className={styles[\"tessel-window-controls-close\"]}\n            onClick={onCloseWindow}\n          />\n        </div>\n      </div>\n      <div className={cls(styles[\"tessel-window-content\"], className)}>\n        {children}\n      </div>\n    </TesselDropCapture>\n  );\n};\n\nexport default TesselWindow;\n","import { keyboardCommandModifier } from \"@/runtime-env\";\n\nexport const KEYMAP_SIM_STEP = \"keymap:CircuitEditor/SimStep\" as const;\nexport const KEYMAP_SELECT_ALL = \"keymap:CircuitEditor/SelectAll\" as const;\nexport const KEYMAP_COPY = \"keymap:CircuitEditor/Copy\" as const;\nexport const KEYMAP_PASTE = \"keymap:CircuitEditor/Paste\" as const;\nexport const KEYMAP_DELETE = \"keymap:CircuitEditor/Delete\" as const;\nexport const KEYMAP_UNDO = \"keymap:CircuitEditor/Undo\" as const;\nexport const KEYMAP_REDO = \"keymap:CircuitEditor/Redo\" as const;\n\nconst keymap = {\n  [KEYMAP_SIM_STEP]: \"space\",\n  [KEYMAP_SELECT_ALL]: `${keyboardCommandModifier}+a`,\n  [KEYMAP_COPY]: `${keyboardCommandModifier}+c`,\n  [KEYMAP_PASTE]: `${keyboardCommandModifier}+v`,\n  [KEYMAP_DELETE]: [\"backspace\", \"del\"],\n  [KEYMAP_UNDO]: `${keyboardCommandModifier}+z`,\n  [KEYMAP_REDO]: [\n    `${keyboardCommandModifier}+y`,\n    `${keyboardCommandModifier}+shift+z`,\n  ],\n};\nexport default keymap;\n\nexport type KeymapKeys = keyof typeof keymap;\nexport type KeymapHandler = Record<KeymapKeys, HotkeyHandler>;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { HotKeys } from \"react-hotkeys\";\nimport { AnyAction } from \"redux\";\n\nimport { cls } from \"@/utils\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport sizing from \"@/styles/sizing.module.css\";\nimport flex from \"@/styles/flex.module.css\";\n\nimport { circuitEditorStateFromIdSelector } from \"@/services/circuit-editors/selectors/editor\";\nimport { circuitNameFromIdSelector } from \"@/services/circuit-properties/selectors/circuits\";\n\nimport { paste } from \"@/actions/clipboard-paste\";\nimport { copySelection } from \"@/actions/selection-copy\";\nimport { deleteSelection } from \"@/actions/selection-delete\";\nimport { selectAll } from \"@/actions/select-all\";\nimport { undo } from \"@/actions/undo\";\nimport { redo } from \"@/actions/redo\";\nimport { circuitEditorReceiveFocus } from \"@/actions/circuit-editor-receive-focus\";\nimport { stepSim } from \"@/actions/sim-step\";\n\nimport CircuitNodeBreadcrumb from \"@/components/CircuitNodeBreadcrumb\";\nimport CircuitField from \"@/components/CircuitEditor\";\nimport TesselWindow from \"@/components/Tessel/TesselWindow\";\n\nimport keymap, {\n  KeymapHandler,\n  KEYMAP_SIM_STEP,\n  KEYMAP_COPY,\n  KEYMAP_PASTE,\n  KEYMAP_DELETE,\n  KEYMAP_SELECT_ALL,\n  KEYMAP_UNDO,\n  KEYMAP_REDO,\n} from \"./keymap\";\n\nexport interface CircuitEditorWindowProps {\n  editorId: string;\n}\nconst CircuitEditorWindow: React.FC<CircuitEditorWindowProps> = ({\n  editorId,\n}) => {\n  const dispatch = useDispatch();\n  const { circuitId, elementIdPath } = useSelector((state) =>\n    circuitEditorStateFromIdSelector(state, editorId)\n  ) ?? { circuitId: null, elementIdPath: [] };\n\n  const circuitName =\n    useSelector((state) => circuitNameFromIdSelector(state, circuitId)) ??\n    \"<Circuit Missing>\";\n\n  // FIXME: Move key handling into CircuitEditor\n  const keyHandlers = React.useMemo(() => {\n    function createEventDispatcher(action: AnyAction): HotkeyHandler {\n      return (e?: KeyboardEvent) => {\n        if (e) {\n          if (e.defaultPrevented) {\n            return;\n          }\n          e.preventDefault();\n        }\n        dispatch(action);\n      };\n    }\n    const keyHandlers: KeymapHandler = {\n      [KEYMAP_SIM_STEP]: createEventDispatcher(stepSim()),\n      [KEYMAP_SELECT_ALL]: createEventDispatcher(selectAll()),\n      [KEYMAP_COPY]: createEventDispatcher(copySelection()),\n      [KEYMAP_PASTE]: createEventDispatcher(paste()),\n      [KEYMAP_DELETE]: createEventDispatcher(deleteSelection()),\n      [KEYMAP_UNDO]: createEventDispatcher(undo()),\n      [KEYMAP_REDO]: createEventDispatcher(redo()),\n    };\n    return keyHandlers;\n  }, [dispatch]);\n\n  const onViewActivated = React.useCallback(() => {\n    dispatch(circuitEditorReceiveFocus(editorId));\n  }, [dispatch, editorId]);\n\n  return (\n    <TesselWindow title={`${circuitName} [Circuit]`}>\n      <HotKeys keyMap={keymap} handlers={keyHandlers} component={FillParent}>\n        <div\n          onFocus={onViewActivated}\n          className={cls(\n            \"circuit-field-view\",\n            sizing[\"fill-parent\"],\n            flex[\"flex-column\"]\n          )}\n        >\n          <CircuitNodeBreadcrumb\n            circuitId={circuitId}\n            elementIdPath={elementIdPath}\n          />\n          <CircuitField\n            className={cls(sizing[\"fill-parent\"], flex[\"flexitem-shrink\"])}\n            editorId={editorId}\n          />\n        </div>\n      </HotKeys>\n    </TesselWindow>\n  );\n};\n\nconst FillParent: React.FC = ({ children, ...props }) => {\n  return (\n    <div {...props} className={sizing[\"fill-parent\"]}>\n      {children}\n    </div>\n  );\n};\n\nexport default CircuitEditorWindow;\n","import * as React from \"react\";\n\nimport { cls } from \"@/utils\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport styles from \"./SelectionList.module.css\";\n\nexport interface SelectionListItem {\n  id?: string;\n  value: string;\n  label: React.ReactNode;\n  isSelected?: boolean;\n}\n\nexport interface SelectionListProps {\n  className?: string;\n  id?: string;\n  items: SelectionListItem[];\n  onItemSelected(value: string): void;\n}\n\nconst SelectionList: React.FC<SelectionListProps> = ({\n  className,\n  id,\n  items,\n  onItemSelected,\n}) => {\n  return (\n    <ul\n      id={id}\n      className={cls(\"selection-list\", styles[\"selection-list\"], className)}\n    >\n      {items.map((item) => (\n        <SelectionListItem\n          key={item.value}\n          {...item}\n          onItemSelected={onItemSelected}\n        />\n      ))}\n    </ul>\n  );\n};\n\nexport default SelectionList;\n\ninterface SelectionListItemProps extends SelectionListItem {\n  onItemSelected(value: string): void;\n}\n\nconst SelectionListItem: React.FC<SelectionListItemProps> = ({\n  id,\n  value,\n  label,\n  isSelected,\n  onItemSelected,\n}) => {\n  const onClick = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      e.preventDefault();\n      onItemSelected(value);\n    },\n    [onItemSelected, value]\n  );\n\n  return (\n    <li\n      id={id}\n      className={cls(\n        \"selection-list-item\",\n        styles[\"selection-list-item\"],\n        isSelected && styles[\"selection-list-item--selected\"]\n      )}\n      onClick={onClick}\n    >\n      <div\n        className={cls(\n          styles[\"selection-list-item-content\"],\n          interaction[\"text-unselectable\"]\n        )}\n      >\n        {label}\n      </div>\n    </li>\n  );\n};\n","// extracted by mini-css-extract-plugin\nexport default {\"selection-list\":\"selection-list--3yujH\",\"selection-list-item\":\"selection-list-item--errDr\",\"selection-list-item--selected\":\"selection-list-item--selected--3MkqB\",\"selection-list-item-content\":\"selection-list-item-content--321YU\"};","import SelectionList from \"./SelectionList\";\nexport * from \"./SelectionList\";\nexport default SelectionList;\n","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\n\nimport sizing from \"@/styles/sizing.module.css\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { deleteCircuit } from \"@/actions/circuit-delete\";\nimport { viewCircuit } from \"@/actions/view-circuit\";\nimport { addCircuit } from \"@/actions/circuit-add\";\nimport { renameCircuit } from \"@/actions/circuit-rename\";\n\nimport {\n  circuitNameFromIdSelector,\n  circuitNamesByIdSelector,\n} from \"@/services/circuit-properties/selectors/circuits\";\nimport { ROOT_CIRCUIT_ID } from \"@/services/circuits/constants\";\n\nimport { useContextMenu } from \"@/components/ContextMenu\";\nimport Menu from \"@/components/Menus/Menu\";\nimport MenuItem from \"@/components/Menus/MenuItem\";\nimport DividerMenuItem from \"@/components/Menus/DividerMenuItem\";\nimport SelectionList, { SelectionListItem } from \"@/components/SelectionList\";\nimport EditableText from \"@/components/EditableText\";\nimport TesselWindow from \"@/components/Tessel/TesselWindow\";\n\nimport { getCircuitListItemHtmlId } from \"./ids\";\n\nimport styles from \"./CircuitsTreeWindow.module.css\";\n\nconst CircuitsTreeWindow: React.FC = () => {\n  const dispatch = useDispatch();\n\n  const circuitNamesById = useSelector(circuitNamesByIdSelector);\n\n  const { openContextMenu, renderContextMenu } = useContextMenu();\n\n  const onCircuitSelected = React.useCallback(\n    (circuitId: string) => {\n      dispatch(viewCircuit(circuitId));\n    },\n    [dispatch]\n  );\n\n  const onContextMenu = React.useCallback(\n    (e: React.MouseEvent<HTMLDivElement>) => {\n      e.preventDefault();\n      openContextMenu(e);\n    },\n    [openContextMenu]\n  );\n\n  const listItems: SelectionListItem[] = React.useMemo(\n    () =>\n      Object.keys(circuitNamesById).map((circuitId) => {\n        return {\n          id: getCircuitListItemHtmlId(circuitId),\n          value: circuitId,\n          label: <CircuitTreeNodeCircuitLabel circuitId={circuitId} />,\n        };\n      }),\n    [circuitNamesById]\n  );\n\n  return (\n    <TesselWindow\n      id=\"circuit-list-window\"\n      title=\"Circuits\"\n      className={cls(styles.circuitstree)}\n    >\n      <div className={sizing[\"fill-parent\"]} onContextMenu={onContextMenu}>\n        <SelectionList\n          className={sizing[\"fill-parent\"]}\n          id=\"circuit-list\"\n          items={listItems}\n          onItemSelected={onCircuitSelected}\n        />\n      </div>\n      {renderContextMenu(<CircuitTreeContextMenu />)}\n    </TesselWindow>\n  );\n};\n\nexport default CircuitsTreeWindow;\n\ninterface CircuitTreeNodeLabelProps {\n  circuitId: string;\n}\n\nconst CircuitTreeNodeCircuitLabel: React.FC<CircuitTreeNodeLabelProps> = ({\n  circuitId,\n}) => {\n  const dispatch = useDispatch();\n  const circuitName = useSelector((state) =>\n    circuitNameFromIdSelector(state, circuitId)\n  );\n  const [isRenaming, setIsRenaming] = React.useState(false);\n\n  const { openContextMenu, renderContextMenu } = useContextMenu();\n\n  const onRequestRename = React.useCallback(() => {\n    if (circuitId === ROOT_CIRCUIT_ID) {\n      return;\n    }\n    setIsRenaming(true);\n  }, [circuitId]);\n\n  const onCancelRename = React.useCallback(() => {\n    setIsRenaming(false);\n  }, []);\n\n  const onRename = React.useCallback(\n    (newName) => {\n      dispatch(renameCircuit(circuitId, newName));\n      setIsRenaming(false);\n    },\n    [circuitId, dispatch]\n  );\n\n  const onOpenNewWindow = React.useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      dispatch(viewCircuit(circuitId, null, { newWindow: true }));\n    },\n    [circuitId, dispatch]\n  );\n\n  const onDelete = React.useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      dispatch(deleteCircuit(circuitId));\n    },\n    [dispatch, circuitId]\n  );\n\n  const onContextMenu = React.useCallback(\n    (e: React.MouseEvent<HTMLElement>) => {\n      e.preventDefault();\n      e.stopPropagation();\n      openContextMenu(e);\n    },\n    [openContextMenu]\n  );\n\n  return (\n    <div\n      className={styles[\"circuitstree-item\"]}\n      onContextMenu={onContextMenu}\n      onDoubleClick={onRequestRename}\n    >\n      <EditableText\n        defaultValue={circuitName}\n        isEditing={isRenaming}\n        onRequestEdit={onRequestRename}\n        onCommit={onRename}\n        onCancel={onCancelRename}\n      />\n      {renderContextMenu(\n        <Menu>\n          {circuitId !== ROOT_CIRCUIT_ID && (\n            <>\n              <MenuItem onClick={onRequestRename}>Rename Circuit</MenuItem>\n              <DividerMenuItem />\n            </>\n          )}\n          <MenuItem onClick={onOpenNewWindow}>Open in New Window</MenuItem>\n          {circuitId !== ROOT_CIRCUIT_ID && (\n            <>\n              <DividerMenuItem />\n              <MenuItem onClick={onDelete}>Delete Circuit</MenuItem>\n            </>\n          )}\n        </Menu>\n      )}\n    </div>\n  );\n};\n\nconst CircuitTreeContextMenu: React.FC = () => {\n  const dispatch = useDispatch();\n  const onNewCircuit = React.useCallback(() => {\n    dispatch(addCircuit());\n  }, [dispatch]);\n\n  return (\n    <Menu>\n      <MenuItem onClick={onNewCircuit}>New Circuit</MenuItem>\n    </Menu>\n  );\n};\n","// extracted by mini-css-extract-plugin\nexport default {\"circuitstree\":\"circuitstree--QeaI9\",\"circuitstree-item\":\"circuitstree-item--22dzG\"};","import Tooltip from \"./Tooltip\";\nexport default Tooltip;\n","import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport { Options, VirtualElement } from \"@popperjs/core\";\nimport { usePopper } from \"react-popper\";\n\nimport { cls } from \"@/utils\";\n\nexport interface PopoverProps {\n  className?: string;\n  anchorEl: Element | VirtualElement | null;\n  placement?: Options[\"placement\"];\n  isOpen: boolean;\n}\n\nimport styles from \"./Tooltip.module.css\";\n\nconst Tooltip: React.FC<PopoverProps> = ({\n  className,\n  isOpen,\n  anchorEl,\n  placement = \"auto\",\n  children,\n}) => {\n  const [popoverRef, setPopoverRef] = React.useState<HTMLDivElement | null>(\n    null\n  );\n  const [arrowRef, setArrowRef] = React.useState<HTMLDivElement | null>(null);\n\n  const { attributes, styles: popperStyles } = usePopper(\n    isOpen ? anchorEl : null,\n    popoverRef,\n    {\n      placement,\n      modifiers: [\n        {\n          name: \"arrow\",\n          options: {\n            element: arrowRef,\n          },\n        },\n        {\n          name: \"offset\",\n          options: {\n            offset: [0, 8],\n          },\n        },\n      ],\n    }\n  );\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return createPortal(\n    <div\n      ref={setPopoverRef}\n      className={cls(styles[\"tooltip\"], className)}\n      style={popperStyles.popper}\n      role=\"tooltip\"\n      {...attributes.popper}\n    >\n      {children}\n      <div\n        ref={setArrowRef}\n        data-popper-arrow\n        className={styles[\"tooltip-arrow\"]}\n        style={popperStyles.arrow}\n        {...attributes.arrow}\n      />\n    </div>,\n    document.body\n  );\n};\n\nexport default Tooltip;\n","// extracted by mini-css-extract-plugin\nexport default {\"tooltip\":\"tooltip--2yxRI\",\"tooltip-arrow\":\"tooltip-arrow--2mJMo\"};","import * as React from \"react\";\nimport uniq from \"lodash/uniq\";\nimport { useDrag } from \"react-dnd\";\n\nimport interaction from \"@/styles/interaction.module.css\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { ElementDefinition } from \"@/elements/types\";\nimport { getNodeVisualElement } from \"@/elements/visuals\";\n\nimport {\n  elementDefinitionFromTypeSelector,\n  elementDefinitionsSelector,\n} from \"@/services/element-types/selectors/element-types\";\n\nimport { newElementDragObject } from \"@/components/CircuitEditor/drag-items/new-element\";\nimport TesselWindow from \"@/components/Tessel/TesselWindow\";\nimport Tooltip from \"@/components/Tooltip\";\n\nimport styles from \"./ElementTrayWindow.module.css\";\n\nconst CategoryNames: Record<ElementDefinition[\"category\"], string> = {\n  \"input-output\": \"I/O\",\n  \"integrated-circuit\": \"Integrated Circuits\",\n  logic: \"Logic\",\n};\n\nconst ElementTrayWindow: React.FC = () => {\n  const elementDefinitions = useSelector(elementDefinitionsSelector);\n  const categories = uniq(elementDefinitions.map((x) => x.category));\n  const [search, setSearch] = React.useState(\"\");\n  const onSearchChanged = React.useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setSearch(e.target.value.toLowerCase());\n    },\n    []\n  );\n\n  return (\n    <TesselWindow\n      id=\"element-tray\"\n      title=\"Elements\"\n      className={styles[\"element-tray\"]}\n    >\n      <div>\n        <input\n          className={styles[\"element-tray-search\"]}\n          type=\"text\"\n          value={search}\n          onChange={onSearchChanged}\n          placeholder=\"Search\"\n        />\n      </div>\n      <div className={styles[\"element-tray-element-container\"]}>\n        <ul className={styles[\"element-tray-element-list\"]}>\n          {categories.map((category) => (\n            <TrayCategory key={category} category={category} search={search} />\n          ))}\n        </ul>\n      </div>\n    </TesselWindow>\n  );\n};\nexport default ElementTrayWindow;\n\ninterface TrayCategoryProps {\n  category: ElementDefinition[\"category\"];\n  search: string;\n}\n\nconst TrayCategory: React.FC<TrayCategoryProps> = ({ category, search }) => {\n  const elementDefinitions = useSelector(elementDefinitionsSelector);\n  const defInCategory = elementDefinitions.filter(\n    (def) => def.category === category\n  );\n\n  function shouldShowElement(def: ElementDefinition) {\n    if (def.category !== category) {\n      return false;\n    }\n\n    if (\n      search !== null &&\n      def.displayName.toLowerCase().indexOf(search) === -1\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  const elements = defInCategory.filter(shouldShowElement).map((def) => {\n    return <TrayElement key={def.type} elementType={def.type} />;\n  });\n\n  if (elements.length === 0) {\n    return null;\n  }\n\n  return (\n    <>\n      <li className={styles[\"element-tray-category\"]}>\n        {CategoryNames[category]}\n      </li>\n      {elements}\n    </>\n  );\n};\n\ninterface TrayElementProps {\n  elementType: string;\n}\nconst TrayElement: React.FC<TrayElementProps> = ({ elementType }) => {\n  const [liRef, setLiRef] = React.useState<HTMLElement | null>(null);\n  const def = useSelector((state) =>\n    elementDefinitionFromTypeSelector(state, elementType)\n  );\n\n  const [showTooltip, setShowTooltip] = React.useState(false);\n  const onShowTooltip = React.useCallback((e: React.MouseEvent) => {\n    e.preventDefault();\n    setShowTooltip(true);\n  }, []);\n  const onHideTooltip = React.useCallback(\n    (e: React.MouseEvent) => {\n      if (e.target !== liRef) {\n        return;\n      }\n      setShowTooltip(false);\n    },\n    [liRef]\n  );\n\n  const [, dragRef] = useDrag({\n    item: newElementDragObject(elementType),\n  });\n\n  let elementTrayVisual: JSX.Element;\n  let displayName = elementType;\n  let viewBox = \"0 0 50 50\";\n  if (def) {\n    const { trayComponent, hitRect } = def.visual;\n    if (trayComponent) {\n      const TrayComponent = trayComponent;\n      elementTrayVisual = <TrayComponent />;\n    } else {\n      elementTrayVisual = getNodeVisualElement(\n        undefined,\n        [],\n        undefined,\n        def.visual\n      );\n      viewBox = `${hitRect.p1.x} ${hitRect.p1.y} ${hitRect.p2.x} ${hitRect.p2.y}`;\n    }\n    displayName = def.displayName;\n  } else {\n    elementTrayVisual = <NodeTrayErrorComponent />;\n  }\n\n  return (\n    <li\n      id={`element-tray--element-${elementType}`}\n      ref={(ref) => {\n        setLiRef(ref);\n        dragRef(ref);\n      }}\n      className={styles[\"element-tray-item\"]}\n      onClick={onShowTooltip}\n      onMouseOut={onHideTooltip}\n    >\n      <Tooltip placement=\"top\" isOpen={showTooltip} anchorEl={liRef}>\n        Click and drag to create a new circuit element.\n      </Tooltip>\n      <span className={styles[\"element-tray-item-preview\"]}>\n        <svg width={30} height={30} viewBox={viewBox}>\n          {elementTrayVisual}\n        </svg>\n      </span>\n      <span className={interaction[\"text-unselectable\"]}>{displayName}</span>\n    </li>\n  );\n};\n\nconst NodeTrayErrorComponent = () => (\n  <rect fill=\"red\" x1={0} y1={0} x2={50} y2={50} />\n);\n","// extracted by mini-css-extract-plugin\nexport default {\"element-tray\":\"element-tray--2OmR6\",\"element-tray-search\":\"element-tray-search--2PYcp\",\"element-tray-element-container\":\"element-tray-element-container--1jqen\",\"element-tray-element-list\":\"element-tray-element-list--3RXLA\",\"element-tray-category\":\"element-tray-category--3K8sv\",\"element-tray-item\":\"element-tray-item--32gev\",\"element-tray-item-preview\":\"element-tray-item-preview--12k1m\"};","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { cls } from \"@/utils\";\n\nimport sizing from \"@/styles/sizing.module.css\";\nimport flex from \"@/styles/flex.module.css\";\n\nimport { rearrangeLayout } from \"@/actions/layout-rearrange\";\nimport { circuitEditorDragAbort } from \"@/actions/circuit-editor-drag-abort\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useNativeEvent } from \"@/hooks/useNativeEvent\";\n\nimport Tessel, { TesselValue, TesselWindowItem } from \"@/components/Tessel\";\n\nimport { layoutSelector } from \"@/services/ui-layout/selectors/layout\";\n\nimport ProjectEditorTitleBar from \"./components/ProjectEditorTitleBar\";\n\nimport CircuitFieldWindow from \"./windows/CircuitEditorWindow\";\nimport CircuitsTreeWindow from \"./windows/CircuitsTreeWindow\";\nimport ElementTrayWindow from \"./windows/ElementTrayWindow\";\n\nconst WindowsById: Record<string, React.ComponentType<any>> = {\n  \"element-tray\": ElementTrayWindow,\n  \"circuit-field\": CircuitFieldWindow,\n  \"circuits-list\": CircuitsTreeWindow,\n};\n\nfunction renderWindow(window: TesselWindowItem): React.ReactElement | null {\n  const Component = WindowsById[window.windowId];\n  if (!Component) {\n    return null;\n  }\n  return <Component {...window.windowProps} />;\n}\n\nconst ProjectEditorPage: React.FC = () => {\n  const dispatch = useDispatch();\n  const layout = useSelector(layoutSelector);\n  const onLayoutChange = React.useCallback(\n    (layout: TesselValue) => {\n      dispatch(rearrangeLayout(layout));\n    },\n    [dispatch]\n  );\n\n  // A bit hacky, but we need some singleton component to install a global check\n  // to look for drag cancellations when we mouse up outside of any circuit editor.\n  const onMouseUp = React.useCallback(\n    (e: MouseEvent) => {\n      let element: Element | null = e.target as Element;\n      while (element != null) {\n        if (element.classList.contains(\"circuit-editor\")) {\n          return;\n        }\n        element = element.parentElement;\n      }\n      dispatch(circuitEditorDragAbort());\n    },\n    [dispatch]\n  );\n\n  useNativeEvent({ current: document.body }, \"mouseup\", onMouseUp);\n\n  return (\n    <div className={cls(sizing[\"fill-parent\"], flex[\"flex-column\"])}>\n      <ProjectEditorTitleBar className={flex[\"flexitem-fix\"]} />\n      <div className={cls(sizing[\"fill-parent\"], flex[\"flexitem-shrink\"])}>\n        <Tessel\n          className={cls(\"project-editor\", sizing[\"fill-parent\"])}\n          rootItem={layout}\n          onLayoutChange={onLayoutChange}\n          renderWindow={renderWindow}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default ProjectEditorPage;\n","import ProjectEditorPage from \"./ProjectEditorPage\";\nexport default ProjectEditorPage;\n","import ProjectImporterPage from \"./ProjectImporterPage\";\nexport default ProjectImporterPage;\n","import { importProjectLink } from \"@/actions/project-import-link\";\nimport * as React from \"react\";\n\nimport { useDispatch } from \"react-redux\";\nimport { RouteChildrenProps } from \"react-router-dom\";\n\nconst ProjectImporterPage: React.FC<RouteChildrenProps> = ({ location }) => {\n  const dispatch = useDispatch();\n  const [importError, setImportError] = React.useState(false);\n\n  React.useEffect(() => {\n    let searchParams: URLSearchParams;\n    try {\n      searchParams = new URLSearchParams(location.search);\n    } catch (e) {\n      setImportError(true);\n      return;\n    }\n\n    const data = searchParams.get(\"data\");\n    if (!data) {\n      setImportError(true);\n      return;\n    }\n\n    dispatch(importProjectLink(data));\n\n    // This is an effect, these are not dependencies.  Stop warning me about this.\n    // We only want to run on page load.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // TODO: better styling.\n\n  if (importError) {\n    // TODO: Better error message\n    return <div>Failed to import project</div>;\n  }\n\n  return <div>Importing Project...</div>;\n};\n\nexport default ProjectImporterPage;\n","import * as React from \"react\";\n\nimport { Switch, Route } from \"react-router-dom\";\n\nimport ProjectEditorPage from \"@/pages/ProjectEditorPage\";\nimport ProjectImporterPage from \"@/pages/ProjectImporterPage\";\n\nconst Routes: React.FC = () => {\n  return (\n    <Switch>\n      <Route exact path=\"/\" component={ProjectEditorPage} />\n      <Route exact path=\"/import\" component={ProjectImporterPage} />\n    </Switch>\n  );\n};\n\nexport default Routes;\n","import { createDialogSelector } from \"../utils\";\n\nexport const dialogTypeSelector = createDialogSelector((s) => s.dialogType);\nexport const dialogDataSelector = createDialogSelector((s) => s.data);\n","// extracted by mini-css-extract-plugin\nexport default {\"modal\":\"modal--25LBN\",\"modal-content\":\"modal-content--1H0T_\"};","export * from \"./Modal\";\nimport Modal from \"./Modal\";\nexport default Modal;\n","import { cls } from \"@/utils\";\nimport * as React from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { FocusOn, AutoFocusInside } from \"react-focus-on\";\n\nimport sizing from \"@/styles/sizing.module.css\";\n\nimport styles from \"./Modal.module.css\";\n\nexport interface ModalProps {\n  className?: string;\n  isOpen: boolean;\n  onRequestClose?(): void;\n}\n\nconst Modal: React.FC<ModalProps> = ({\n  className,\n  isOpen,\n  onRequestClose,\n  children,\n}) => {\n  if (!isOpen) {\n    return null;\n  }\n\n  return createPortal(\n    <div className={cls(\"modal\", styles[\"modal\"])}>\n      <FocusOn onClickOutside={onRequestClose} onEscapeKey={onRequestClose}>\n        <div className={cls(styles[\"modal-content\"], className)}>\n          <AutoFocusInside className={sizing[\"fill-parent\"]}>\n            {children}\n          </AutoFocusInside>\n        </div>\n      </FocusOn>\n    </div>,\n    document.body\n  );\n};\n\nexport default Modal;\n","export * from \"./Dialog\";\nimport Dialog from \"./Dialog\";\nexport default Dialog;\n","import * as React from \"react\";\n\nimport Button from \"@/components/Button\";\nimport Modal from \"@/components/Modal\";\n\nimport styles from \"./Dialog.module.css\";\n\nexport interface DialogProps {\n  isOpen: boolean;\n  title: string;\n  acceptText?: string;\n  cancelText?: string;\n  footer?: React.ReactNode;\n  onAccept?(): void;\n  onCancel?(): void;\n}\n\nconst Dialog: React.FC<DialogProps> = ({\n  isOpen,\n  title,\n  acceptText,\n  cancelText,\n  onAccept,\n  onCancel,\n  footer,\n  children,\n}) => {\n  return (\n    <Modal\n      className={styles[\"dialog\"]}\n      isOpen={isOpen}\n      onRequestClose={onCancel}\n    >\n      <div className={styles[\"dialog-title\"]}>{title}</div>\n      <div>{children}</div>\n      <div className={styles[\"dialog-footer\"]}>\n        {footer}\n        {onCancel && (\n          <Button onClick={onCancel}>{cancelText ?? \"Cancel\"}</Button>\n        )}\n        {onAccept && (\n          <Button variant=\"primary\" onClick={onAccept}>\n            {acceptText ?? \"Accept\"}\n          </Button>\n        )}\n      </div>\n    </Modal>\n  );\n};\n\nexport default Dialog;\n","// extracted by mini-css-extract-plugin\nexport default {\"dialog\":\"dialog--1eQi6\",\"dialog-title\":\"dialog-title--1DWsL\",\"dialog-footer\":\"dialog-footer--2hYdr\"};","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useAction } from \"@/hooks/useAction\";\n\nimport { acceptDialog } from \"@/actions/dialog-response-accept\";\n\nimport { dialogDataSelector } from \"@/services/dialog/selectors/dialog\";\n\nimport Button from \"@/components/Button\";\nimport Dialog from \"@/components/Dialog\";\n\nimport styles from \"./ExportProjectLinkDialog.module.css\";\n\nimport { ExportProjectLinkDialogData } from \"./types\";\n\nconst ExportProjectLinkDialog: React.FC = () => {\n  const onCloseDialog = useAction(acceptDialog);\n  const dialogData: ExportProjectLinkDialogData | null = useSelector(\n    dialogDataSelector\n  ) as any;\n\n  const projectLink = dialogData?.projectLink;\n\n  const onCopy = React.useCallback(() => {\n    if (!projectLink) {\n      return;\n    }\n    // TODO: Show link in dialog on failure\n    navigator.clipboard.writeText(projectLink).catch(() => {\n      /* do nothing */\n    });\n  }, [projectLink]);\n\n  if (!projectLink) {\n    return null;\n  }\n\n  const dialogFooter = <Button onClick={onCopy}>Copy to Clipboard</Button>;\n\n  return (\n    <Dialog\n      isOpen={true}\n      title=\"Export Project Link\"\n      cancelText=\"Close\"\n      onCancel={onCloseDialog}\n      footer={dialogFooter}\n    >\n      <div className={styles[\"export-link-dialog-link-container\"]}>\n        <code className={styles[\"export-link-dialog-link\"]}>{projectLink}</code>\n      </div>\n    </Dialog>\n  );\n};\n\nexport default ExportProjectLinkDialog;\n","// extracted by mini-css-extract-plugin\nexport default {\"export-link-dialog-link-container\":\"export-link-dialog-link-container--phwUA\",\"export-link-dialog-link\":\"export-link-dialog-link--1dOdK\"};","import * as React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport uniq from \"lodash/uniq\";\n\nimport { useAction } from \"@/hooks/useAction\";\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { acceptDialog } from \"@/actions/dialog-response-accept\";\nimport { cancelDialog } from \"@/actions/dialog-response-cancel\";\n\nimport { dialogDataSelector } from \"@/services/dialog/selectors/dialog\";\n\nimport Dialog from \"@/components/Dialog\";\nimport Checkbox from \"@/components/Checkbox\";\n\nimport styles from \"./ImportProjectCircuitsDialog.module.css\";\nimport { ImportProjectCircuitsDialogData } from \"./types\";\n\nconst ImportProjectCircuitsDialog: React.FC = () => {\n  const dispatch = useDispatch();\n  const dialogData: ImportProjectCircuitsDialogData | null = useSelector(\n    dialogDataSelector\n  ) as any;\n\n  const [selectedIds, setSelectedIds] = React.useState<string[]>([]);\n\n  const onCloseDialog = useAction(cancelDialog);\n  const onAcceptDialog = React.useCallback(() => {\n    dispatch(acceptDialog(selectedIds));\n  }, [dispatch, selectedIds]);\n\n  if (!dialogData) {\n    return null;\n  }\n\n  const { circuits } = dialogData;\n\n  return (\n    <Dialog\n      isOpen={true}\n      title=\"Import Circuits\"\n      onAccept={onAcceptDialog}\n      onCancel={onCloseDialog}\n      acceptText=\"Import Circuits\"\n    >\n      <div>\n        <p>Choose the circuits to import.</p>\n        <p>\n          Any chosen circuits that depend on other circuits will import their\n          dependencies automatically.\n        </p>\n        <p>\n          If any circuits already exist in your project, they will not be\n          re-imported.\n        </p>\n      </div>\n      <ul className={styles[\"import-project-circuits-list\"]}>\n        {circuits.map(({ circuitId, circuitName }) => (\n          <li key={circuitId}>\n            <ImportCircuitCheckbox\n              circuitId={circuitId}\n              circuitName={circuitName}\n              selectedIds={selectedIds}\n              onSetSelectedIds={setSelectedIds}\n            />\n          </li>\n        ))}\n      </ul>\n    </Dialog>\n  );\n};\n\ninterface ImportCircuitCheckboxProps {\n  circuitId: string;\n  circuitName: string;\n  selectedIds: string[];\n  onSetSelectedIds(selectedIds: string[]): void;\n}\nconst ImportCircuitCheckbox: React.FC<ImportCircuitCheckboxProps> = ({\n  circuitId,\n  circuitName,\n  selectedIds,\n  onSetSelectedIds,\n}) => {\n  const onChange = React.useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      if (e.target.checked) {\n        onSetSelectedIds(uniq([...selectedIds, circuitId]));\n      }\n    },\n    [circuitId, onSetSelectedIds, selectedIds]\n  );\n\n  return (\n    <Checkbox onChange={onChange} value={selectedIds.indexOf(circuitId) !== -1}>\n      {circuitName}\n    </Checkbox>\n  );\n};\n\nexport default ImportProjectCircuitsDialog;\n","// extracted by mini-css-extract-plugin\nexport default {\"import-project-circuits-list\":\"import-project-circuits-list--2ODCz\"};","import * as React from \"react\";\n\nimport useSelector from \"@/hooks/useSelector\";\n\nimport { dialogTypeSelector } from \"@/services/dialog/selectors/dialog\";\n\nimport { getDialogComponent } from \"@/dialogs/renderer\";\n\nconst DialogManager: React.FC = () => {\n  const dialogType = useSelector(dialogTypeSelector);\n\n  if (!dialogType) {\n    return null;\n  }\n\n  const DialogComponent = getDialogComponent(dialogType);\n  return <DialogComponent />;\n};\n\nexport default DialogManager;\n","import DialogManager from \"./DialogManager\";\nexport default DialogManager;\n","import React from \"react\";\nimport { DialogType } from \"./types\";\n\nimport { ExportProjectLinkDialog } from \"./dialog-types/export-project-link\";\nimport { ImportProjectCircuitsDialog } from \"./dialog-types/import-project-circuits\";\n\nexport function getDialogComponent(type: DialogType): React.ComponentType {\n  switch (type) {\n    case \"export-project-link\":\n      return ExportProjectLinkDialog;\n    case \"import-project-circuits\":\n      return ImportProjectCircuitsDialog;\n    default:\n      return unknownDialog(type);\n  }\n}\n\nfunction unknownDialog(dialogType: never): never {\n  throw new Error(`Unknown dialog type ${dialogType}`);\n}\n","import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { useDispatch } from \"react-redux\";\n\nimport { asArray } from \"@/arrays\";\n\nimport useSelector from \"@/hooks/useSelector\";\nimport { useQuerySelector } from \"@/hooks/useQuerySelector\";\n\nimport {\n  isTutorialActiveSelector,\n  tutorialAnnotationsSelector,\n} from \"@/services/tutorial/selectors/tutorial\";\nimport { AnnotatedElement } from \"@/services/tutorial/state\";\n\nimport Button from \"../Button\";\nimport Tooltip from \"../Tooltip\";\n\nimport styles from \"./Tutorial.module.css\";\n\nconst Tutorial: React.FC = () => {\n  const isTutorialActive = useSelector(isTutorialActiveSelector);\n  const tutorialAnnotations = useSelector(tutorialAnnotationsSelector);\n\n  if (!isTutorialActive) {\n    return null;\n  }\n\n  const annotations = tutorialAnnotations.map((annotation) => (\n    <Annotation key={annotation.selector} {...annotation} />\n  ));\n\n  const css = tutorialAnnotations\n    .map(\n      ({ selector }) => `\n    ${selector} {\n      position: relative;\n      z-index: 10;\n    }\n  `\n    )\n    .join(\"\\n\");\n\n  return createPortal(\n    <div className={styles[\"tutorial\"]}>\n      <div className={styles[\"tutorial-backdrop\"]} />\n      <style>{css}</style>\n      {annotations}\n    </div>,\n    document.body\n  );\n};\n\nexport default Tutorial;\n\nconst Annotation: React.FC<AnnotatedElement> = ({\n  selector,\n  message,\n  placement,\n  action = [],\n}) => {\n  const dispatch = useDispatch();\n\n  const element = useQuerySelector(selector);\n\n  React.useEffect(() => {\n    if (element) {\n      element.scrollIntoView();\n    }\n  }, [element]);\n\n  const actions = asArray(action);\n\n  if (!element || (!message && !actions.length)) {\n    return null;\n  }\n\n  const actionElements = actions.map(({ name, action }) => {\n    return (\n      <Button key={name} size=\"small\" onClick={() => dispatch(action)}>\n        {name}\n      </Button>\n    );\n  });\n\n  return (\n    <Tooltip\n      className={styles[\"tutorial-tooltip\"]}\n      anchorEl={element}\n      placement={placement}\n      isOpen={true}\n    >\n      {message}\n      {actionElements && (\n        <div className={styles[\"tutorial-tooltip-actions\"]}>\n          {actionElements}\n        </div>\n      )}\n    </Tooltip>\n  );\n};\n","import * as React from \"react\";\n\nexport function useQuerySelector(selector: string): Element | null {\n  const [element, setElement] = React.useState<Element | null>(null);\n  React.useEffect(() => {\n    const observer = new MutationObserver(() => {\n      setElement(document.querySelector(selector));\n    });\n\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true,\n    });\n\n    setElement(document.querySelector(selector));\n\n    return () => {\n      observer.disconnect();\n    };\n  }, [selector]);\n\n  return element;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"tutorial\":\"tutorial--jscuw\",\"tutorial-tooltip\":\"tutorial-tooltip--3gwli\",\"tutorial-tooltip-actions\":\"tutorial-tooltip-actions--ENkg1\",\"tutorial-backdrop\":\"tutorial-backdrop--3I0WR\"};","import Tutorial from \"./Tutorial\";\nexport default Tutorial;\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport \"resize-observer-polyfill\";\n\nimport { Provider } from \"react-redux\";\nimport { Router } from \"react-router-dom\";\n\nimport { DndProvider } from \"react-dnd\";\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\n\nimport history from \"./history\";\nimport \"./styles\";\n\nimport { store } from \"./store\";\n\nimport App from \"./components/App\";\n\nconst rootEl = document.getElementById(\"root\");\n\nReactDOM.render(\n  <DndProvider backend={HTML5Backend}>\n    <Router history={history}>\n      <Provider store={store}>\n        <App />\n      </Provider>\n    </Router>\n  </DndProvider>,\n  rootEl\n);\n","import * as React from \"react\";\n\nimport Routes from \"@/router\";\n\nimport DialogManager from \"../DialogManager\";\nimport Tutorial from \"../Tutorial\";\n\nconst App: React.FC = () => {\n  return (\n    <>\n      <Routes />\n      <DialogManager />\n      <Tutorial />\n    </>\n  );\n};\n\nexport default App;\n","import { Point } from \"./geometry\";\n\n// Arc code from https://stackoverflow.com/questions/5736398/how-to-calculate-the-svg-path-for-an-arc-of-a-circle\nexport function describeArc(\n  x: number,\n  y: number,\n  radius: number,\n  startAngle: number,\n  endAngle: number\n): string {\n  const start = polarToCartesian(x, y, radius, endAngle);\n  const end = polarToCartesian(x, y, radius, startAngle);\n\n  const largeArcFlag = endAngle - startAngle <= 180 ? \"0\" : \"1\";\n\n  const d = [\n    \"M\",\n    start.x,\n    start.y,\n    \"A\",\n    radius,\n    radius,\n    0,\n    largeArcFlag,\n    0,\n    end.x,\n    end.y,\n  ].join(\" \");\n\n  return d;\n}\n\nfunction polarToCartesian(\n  centerX: number,\n  centerY: number,\n  radius: number,\n  angleInDegrees: number\n): Point {\n  const angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180.0;\n\n  return {\n    x: centerX + radius * Math.cos(angleInRadians),\n    y: centerY + radius * Math.sin(angleInRadians),\n  };\n}\n"],"sourceRoot":""}