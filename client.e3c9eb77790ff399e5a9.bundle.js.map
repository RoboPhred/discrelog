{"version":3,"sources":["webpack:///./src/services/simulator/node-types/index.ts","webpack:///./src/env.ts","webpack:///./src/components/App.tsx","webpack:///./src/geometry.ts","webpack:///./src/services/simulator/state.ts","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/state.ts","webpack:///./src/pages/CircuitEditor/state.ts","webpack:///./src/store/state.ts","webpack:///./src/services/simulator/reducer/add-node.ts","webpack:///./src/services/simulator/reducer/collect-transitions.ts","webpack:///./src/services/simulator/reducer/wire-node.ts","webpack:///./src/services/simulator/reducer/unwire-node.ts","webpack:///./src/services/simulator/reducer/interact-node.ts","webpack:///./src/services/simulator/reducer/evolve-sim.ts","webpack:///./src/services/simulator/reducer/index.ts","webpack:///./src/pages/CircuitEditor/reducer/add-node.ts","webpack:///./src/pages/CircuitEditor/reducer/hover-node.ts","webpack:///./src/pages/CircuitEditor/reducer/move-selected-nodes.ts","webpack:///./src/pages/CircuitEditor/reducer/copy-selected-nodes.ts","webpack:///./src/pages/CircuitEditor/reducer/utils.ts","webpack:///./src/pages/CircuitEditor/reducer/select-nodes.ts","webpack:///./src/pages/CircuitEditor/reducer/clear-selection.ts","webpack:///./src/pages/CircuitEditor/reducer/index.ts","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/reducer.ts","webpack:///./src/pages/CircuitEditor/reducer/select-region.ts","webpack:///./src/store/store.ts","webpack:///./src/store/reducer.ts","webpack:///./src/services/simulator/helpers.ts","webpack:///./src/services/simulator/reducer/fast-forward-sim.ts","webpack:///./src/index.tsx","webpack:///./src/pages/CircuitEditor/selectors.ts","webpack:///./src/services/simulator/selectors.ts","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/actions.ts","webpack:///./src/services/simulator/node-types/node-seg7.ts","webpack:///./src/services/simulator/node-types/node-toggle.ts","webpack:///./src/services/simulator/node-types/node-led.ts","webpack:///./src/services/simulator/node-types/node-buffer.ts","webpack:///./src/services/simulator/node-types/node-not.ts","webpack:///./src/services/simulator/node-types/node-nor.ts","webpack:///./src/services/simulator/node-types/node-or.ts","webpack:///./src/services/simulator/node-types/node-and.ts","webpack:///./src/css/body.css","webpack:///./src/css/body.css?e03d","webpack:///./src/utils.ts","webpack:///./src/services/simulator/actions.ts","webpack:///./src/services/simulator/node-types/utils.ts","webpack:///./src/pages/CircuitEditor/actions.ts","webpack:///./src/pages/Intro/Intro.tsx","webpack:///./src/pages/Intro/index.ts","webpack:///./src/components/EditorLayout/components/LayoutContainer.tsx","webpack:///./src/components/EditorLayout/components/SidebarPanel.tsx","webpack:///./src/components/EditorLayout/components/ContentPanel.tsx","webpack:///./src/components/EditorLayout/components/ResizeHandle.tsx","webpack:///./src/components/EditorLayout/ToolWindow.tsx","webpack:///./src/components/EditorLayout/index.ts","webpack:///./src/components/EditorLayout/EditorLayout.tsx","webpack:///./src/pages/CircuitEditor/components/NodeVisual.tsx","webpack:///./src/pages/CircuitEditor/ToolWindows/CircuitTray.tsx","webpack:///./src/pages/CircuitEditor/ToolWindows/TimingControls.tsx","webpack:///./src/pages/CircuitEditor/ToolWindows/NodeInfo.tsx","webpack:///./src/pages/CircuitEditor/ToolWindows/PendingTransitions.tsx","webpack:///./src/runtime-env.ts","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/keymap.ts","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/components/FieldContainer.tsx","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/selectors.ts","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/components/DragPreviewLayer.tsx","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/components/DragSelectLayer.tsx","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/components/WiresLayer.tsx","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/components/NodePin.tsx","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/components/CircuitNode.tsx","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/components/NodesLayer.tsx","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/events.ts","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/CircuitField.tsx","webpack:///./src/pages/CircuitEditor/ContentViews/CircuitField/index.ts","webpack:///./src/pages/CircuitEditor/CircuitEditor.tsx","webpack:///./src/pages/CircuitEditor/index.ts","webpack:///./README.md"],"names":["NodeTypes","and","__webpack_require__","default","or","nor","not","buffer","led","toggle","seg7","isDev","105","e","t","n","o","r","i","s","c","__webpack_exports__","a","Object","react_hot_loader__WEBPACK_IMPORTED_MODULE_1__","hot","module","react__WEBPACK_IMPORTED_MODULE_0__","Component","[object Object]","props","super","this","state","introShown","_env__WEBPACK_IMPORTED_MODULE_2__","_onIntroDismiss","bind","createElement","_pages_CircuitEditor__WEBPACK_IMPORTED_MODULE_3__","_pages_Intro__WEBPACK_IMPORTED_MODULE_4__","dismiss","setState","call","12","normalizeRectangle","args","p1","p2","length","x","Math","min","y","max","pointSubtract","intersects","r1","r2","defaultSimulatorState","tick","nodesById","nodeStatesByNodeId","nodeOutputValuesByNodeId","nodeOutputTransitionsByNodeId","transitionsById","transitionWindows","defaultCircuitFieldState","dragMode","dragStart","dragEnd","defaultCircuitEditorState","clipboardContent","nodePositions","mouseOverNodeId","selectedNodeIds","circuitField","defaultAppState","services","simulator","ui","circuitEditor","add_node","immer_module","action","nodeId","id","nodeType","type","payload","def","node_types","inputConnectionsByPin","mapValues","inputs","outputConnectionsByPin","outputs","result","evolve","transitions","value","b","g","v","O","collectNodeTransitionsMutator","node","inputPin","keys","inputConn","sourceNodeId","pin","sourcePin","nodeOutputs","outputId","tickOffset","transitionTick","removeTransitionMutator","addTransitionMutator","transitionId","v4_default","nodeTransitions","windows","index","binary_search_default","insertAt","transitionIds","splice","push","pinTransitions","transition","transitionWindowIndex","findIndex","transitionWindow","tickWindowTransitionIndex","indexOf","wire_node","targetNodeId","targetPin","sourceNode","targetNode","unwire_node","targetConn","outConns","sourceConnIndex","interact_node","interact","newState","evolve_sim","tickCount","endTick","iterator","items","predicate","shift","window","saftyCutoff","updateNodes","Set","tid","outConn","add","console","error","reducer_add_node","hover_node","move_selected_nodes","offsetX","offsetY","assign","pick","p","copyNodes","combineSelection","selectedIds","chosenIds","mode","union","difference","concat","select_nodes","nodeIds","clear_selection","circuitEditorReducer","appState","newCircuitFieldState","CircuitField_actions","actions","d","CircuitEditor_actions","copyIds","zipObject","map","rootPosition","offset","geometry","conns","filter","copySelectedMutator","f","region","rects","selectors","forOwn","rect","storeComposer","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","redux","store","output","input","inputNode","conn","nextWindowTick","simulatorReducer","redux_thunk_es","J","rootEl","document","getElementById","react_dom","render","react","es","App","nodePositionsById","nodeBoundsById","reselect__WEBPACK_IMPORTED_MODULE_0__","createSelector","_services_simulator_selectors__WEBPACK_IMPORTED_MODULE_5__","nodeDefsById","nodeStateById","lodash_es__WEBPACK_IMPORTED_MODULE_2__","visual","hitPath","svg_path_bounds__WEBPACK_IMPORTED_MODULE_1___default","shapePaths","_services_simulator_node_types_utils__WEBPACK_IMPORTED_MODULE_6__","shapePath","path","nodeRectsById","positionsById","boundsById","bounds","_geometry__WEBPACK_IMPORTED_MODULE_4__","lodash_es__WEBPACK_IMPORTED_MODULE_3__","nodeTypesById","lodash_es__WEBPACK_IMPORTED_MODULE_0__","_node_types__WEBPACK_IMPORTED_MODULE_1__","nodeStatesById","ACTION_DRAG_START","startDrag","ACTION_DRAG_CONTINUE","continueDrag","ACTION_DRAG_END","endDrag","SCALE","OFFSET","createSeg","name","points","start","slice","fill","seg7NodeDefinition","A","B","C","D","E","F","G","236","defaultToggleState","toggleState","toggleSwitchNodeDefinition","OUT","237","genCirclePath","cx","cy","ledNodeDefinition","IN","238","239","240","241","242","248","exports","249","content","hmr","transform","insertInto","locals","typedKeys","obj","bindFuncMap","target","ACTION_EVOLVE","evolveSim","ACTION_FASTFORWARD","fastForwardSim","ACTION_NODE_ADD","addNode","uuid_v4__WEBPACK_IMPORTED_MODULE_0___default","ACTION_INTERACT","interactNode","ACTION_WIRE","wireNode","ACTION_UNWIRE","ACTION_TOGGLEWIRE","toggleWireNode","normalizeVisuals","Array","isArray","stroke","strokeWidth","ACTION_NODE_HOVER","hoverNode","ACTION_MOVE_SELECTED","moveSelected","ACTION_COPY_SELECTED","copySelected","paste","dispatch","getState","clipboardNodes","pasteIds","lodash_es__WEBPACK_IMPORTED_MODULE_1__","_services_simulator_actions__WEBPACK_IMPORTED_MODULE_5__","h","sourceId","outputPin","_utils__WEBPACK_IMPORTED_MODULE_4__","targetCopyId","targetId","m","selectNodes","ACTION_SELECT_NODES","ACTION_SELECT_REGION","selectRegion","ACTION_SELECT_CLEAR","clearSelection","IntroContainer","styled_components_browser_es","div","IntroContent","HeaderContainer","MarkdownContainer","DismissButton","button","href","react_markdown_default","source","README_default","onClick","92","_e","Ne","Be","Te","Le","De","ze","He","Ue","Re","We","components_LayoutContainer","components_SidebarPanel","width","height","components_ContentPanel","components_ResizeHandle","_onDrag","react_draggable","DraggableCore","onDrag","DragHandleDiv","onResize","deltaX","EditorLayout_ToolWindow","ToolWindowDiv","children","components_EditorLayout","leftSidebarSize","defaultLeftSidebarWidth","rightSidebarSize","defaultRightSidebarWidth","_leftSidebarResize","_rightSidebarResize","leftSidebar","rightSidebar","className","Fragment","delta","components_NodeVisual","_a","nodeState","renderPin","konvaProps","__rest","lib","Rect","visualOnClick","pathElements","node_types_utils","Path","key","data","inputPins","outputPins","element","direction","cloneElement","Group","mapDispatchToProps","ToolWindows_CircuitTray","elements","utils","Stage","Layer","CircuitTrayContainer","mapStateToProps","reselect_lib","createStructuredSelector","TimingControls_mapDispatchToProps","ToolWindows_TimingControls","mouseOverNode","mouseOverNodeInputsSelector","outputsByNodeId","k","mouseOverNodeOutputsSelector","NodeInfo_mapStateToProps","nodeInputValues","nodeOutputValues","ToolWindows_NodeInfo","JSON","stringify","PendingTransitions_mapStateToProps","ToolWindows_PendingTransitions","H","U","R","W","keyboardIsMac","test","platform","os","toString","keyboardCommandModifier","KEYMAP_SIM_STEP","KEYMAP_SIM_FASTFORWARD","KEYMAP_NODE_COPY","KEYMAP_NODE_PASTE","CircuitField_keymap","components_FieldContainer","circuitFieldState","selectionRect","selectors_dragMoveOffset","DragPreviewLayer_selectedNodePositionsById","CircuitEditor_selectors","DragPreviewLayer_selectedNodeTypesById","DragPreviewLayer_selectedNodeStatesById","DragPreviewLayer_mapStateToProps","selectedNodePositionsById","selectedNodeTypesById","selectedNodeStatesById","dragMoveOffset","components_DragPreviewLayer","values","components_DragSelectLayer","FastLayer","NO_POS","freeze","nodesSelector","edgeSelector","nodes","reduce","outputConn","nodeTypesSelector","connectionSelector","edges","nodeTypes","outputValues","edge","sid","spin","tpin","sp","st","spp","tp","tt","tpp","WiresLayer_mapStateToProps","connections","components_WiresLayer","connectorElements","Line","end","abs","NodePin","groupProps","NodePin_rest","Circle","radius","components_CircuitNode","isSelected","_renderPin","onPinClick","CircuitNode_rest","CircuitNode_CircuitNodePin","_onClick","NodesLayer_mapStateToProps","NodesLayer_mapDispatchToProps","l","components_NodesLayer","_onPinClick","onNodeMouseDown","onNodeMouseUp","onNodeMouseOver","onNodeMouseLeave","nodeElements","NodesLayer_BoundCicrcuitNode","onMouseDown","onMouseUp","onMouseOver","onMouseLeave","evt","preventDefault","wireSourceNode","wireSourcePin","_onMouseDown","_onMouseUp","_onMouseOver","_onMouseLeave","otherProps","NodesLayer_rest","onNodeClicked","modifiers","altKey","getSelectMode","onFieldClicked","onNodeDragStart","onFieldDragStart","onDragMove","onDragEnd","fieldState","moveBy","j","onNodeHover","onHotkeyStep","onHotkeyFastForward","onHotkeyCopy","onHotkeyPaste","shiftKey","ctrlMetaKey","CircuitField_mapDispatchToProps","events_namespaceObject","ContentViews_CircuitField","react_sizeme_default","monitorWidth","monitorHeight","noPlaceholder","_isDragging","_mouseDownNodeId","_startMousePos","_lastMousePos","_hotkeysRef","createRef","_keyHandlers","_onNodeMouseDown","_onNodeMouseOver","_onNodeMouseLeave","_onMouseMove","size","index_es","HotKeys","keyMap","handlers","tabIndex","ref","onMouseMove","defaultPrevented","current","focus","layerX","layerY","sx","sy","ctrlKey","metaKey","_resetMouseTracking","FillParentEditorLayout","FillParentCircuitField","93"],"mappings":"yHASO,MAAMA,GACXC,IAAKC,EAAQ,KAAcC,QAC3BC,GAAIF,EAAQ,KAAaC,QACzBE,IAAKH,EAAQ,KAAcC,QAC3BG,IAAKJ,EAAQ,KAAcC,QAC3BI,OAAQL,EAAQ,KAAiBC,QACjCK,IAAKN,EAAQ,KAAcC,QAC3BM,OAAQP,EAAQ,KAAiBC,QACjCO,KAAMR,EAAQ,KAAeC,2ECjBxB,MACMQ,MAAQC,IAAA,SAAAC,EAAAC,EAAAC,GAAA,uBAAAF,GAAA,IAAAG,EAAAD,EAAA,GAAAE,EAAAF,EAAA,KAAAG,EAAAH,EAAA,KAAAI,EAAAJ,EAAA,IAAAK,EAAAL,EAAA,ICqCrBM,EAAAC,EAAeC,OAAAC,EAAAC,IAAAF,CAAIG,EAAJH,eAzBGI,EAAAC,UAChBC,YAAYC,GACVC,MAAMD,GAENE,KAAKC,OACHC,WAAYC,EAAAb,GAGdU,KAAKI,gBAAkBJ,KAAKI,gBAAgBC,KAAKL,MAGnDH,SACE,OAAKG,KAAKC,MAAMC,WAGTP,EAAAW,cAACC,EAAAjB,EAAa,MAFZK,EAAAW,cAACE,EAAAlB,GAAMmB,QAAST,KAAKI,kBAKxBP,kBACNG,KAAKU,UACHR,qBAAYS,KAAAX,KAAAjB,EAAA,GAAAA,CAAAF,KAAA+B,GAAA,SAAA/B,EAAAC,EAAAC,GAAA,aC7BZ,SAAA8B,KAAgCC,GACpC,IAAIC,EACAC,EACJ,GAAoB,IAAhBF,EAAKG,OAAc,CACrB,MAAMhC,EAAI6B,EAAK,GACdC,EAAK9B,EAAE8B,GAAMC,EAAK/B,EAAE+B,QAErBD,EAAKD,EAAK,GACVE,EAAKF,EAAK,GAEZ,OACEC,IACEG,EAAGC,KAAKC,IAAIL,EAAGG,EAAGF,EAAGE,GACrBG,EAAGF,KAAKC,IAAIL,EAAGM,EAAGL,EAAGK,IAEvBL,IACEE,EAAGC,KAAKG,IAAIP,EAAGG,EAAGF,EAAGE,GACrBG,EAAGF,KAAKG,IAAIP,EAAGM,EAAGL,EAAGK,KAKrB,SAAAE,EAAwBR,EAAWC,GACvC,OACEE,EAAGH,EAAGG,EAAIF,EAAGE,EACbG,EAAGN,EAAGM,EAAIL,EAAGK,GAYX,SAAAG,EAAqBC,EAAeC,GAKxC,OAJAD,EAAKZ,EAAmBY,GACxBC,EAAKb,EAAmBa,KAGpBD,EAAGV,GAAGG,EAAIQ,EAAGV,GAAGE,GAAKO,EAAGT,GAAGE,EAAIQ,EAAGX,GAAGG,GAKrCO,EAAGV,GAAGM,EAAIK,EAAGV,GAAGK,GAAKI,EAAGT,GAAGK,EAAIK,EAAGX,GAAGM,6KCDpC,MAAMM,GACXC,KAAM,EACNC,aACAC,sBACAC,4BACAC,iCACAC,mBACAC,sBCjDWC,GACXC,SAAU,KACVC,UAAW,KACXC,QAAS,MCMEC,GACXC,oBACAC,iBACAC,gBAAiB,KACjBC,mBACAC,aAAcT,GCDHU,GACXC,UACEC,UAAWpB,GAEbqB,IACEC,cAAeV,sDCQnBW,EAAe3D,OAAA4D,EAAA7D,EAAAC,CA3BT,SAAyBU,EAAuBmD,GACpD,MAAQC,OAAQC,EAAIC,SAAUC,GAASJ,EAAOK,QAExCC,EAAMC,EAAArE,EAAUkE,GACtB,IAAKE,EACH,OAGF,MAAM7B,UAAEA,EAAFC,mBAAaA,EAAbC,yBAAiCA,GAA6B9B,EAEpE4B,EAAUyB,IACRA,KACAE,OACAI,sBAAuBrE,OAAAsE,EAAAvE,EAAAC,CAAUmE,EAAII,OAAQ,IAAM,MACnDC,uBAAwBxE,OAAAsE,EAAAvE,EAAAC,CAAUmE,EAAIM,QAAS,SAGjD,MAAMC,EAASP,EAAIQ,OACfR,EAAIQ,cAAkB3E,OAAAsE,EAAAvE,EAAAC,CAAUmE,EAAII,OAAQ,QAAc7D,EAAM2B,SAGpEE,EAAmBwB,GAAMW,EAAOhE,UAChC8B,EAAyBuB,GAAMW,EAAOE,YAClC5E,OAAAsE,EAAAvE,EAAAC,CAAU0E,EAAOE,YAAajD,GAAKA,EAAEkD,OACrC7E,OAAAsE,EAAAvE,EAAAC,CAAUmE,EAAIM,QAAS,UAAMK,EAAAtF,EAAA,KAAAuF,EAAAvF,IAAAsF,GAAAE,EAAAxF,EAAA,IAAAyF,EAAAzF,IAAAwF,GCrB7B,SAAAE,EACJxE,EACAoD,GAEA,MAAMzB,KACJA,EADIE,mBAEJA,EAFIC,yBAGJA,EAHIG,kBAIJA,GACEjC,EAEEyE,EAAOzE,EAAM4B,UAAUwB,GAC7B,IAAKqB,EACH,OAIF,MAAMlB,EAAOG,EAAArE,EAAUoF,EAAKlB,MAC5B,IAAKA,IAASA,EAAKU,OACjB,OAIF,MAAMJ,KACN,IAAK,MAAMa,KAAYpF,OAAOqF,KAAKF,EAAKd,uBAAwB,CAC9D,MAAMiB,EAAYH,EAAKd,sBAAsBe,GAC7C,IAAKE,EAAW,CACdf,EAAOa,MACP,SAEF,MAAQtB,OAAQyB,EAAcC,IAAKC,GAAcH,EAEjDf,EAAOa,GAAY5C,EAAyB+C,GAAcE,GAK5D,MAAMf,EAAST,EAAKU,OAAOpC,EAAmB4C,EAAKpB,IAAKQ,EAAQlC,GAMhE,GAJIqC,EAAOhE,QACT6B,EAAmB4C,EAAKpB,IAAMW,EAAOhE,OAGnCgE,EAAOE,YAAa,CACtB,MAAMc,EAAclD,EAAyB2C,EAAKpB,QAClD,IAAK,MAAM4B,KAAY3F,OAAOqF,KAAKX,EAAOE,aAAc,CACtD,MAAMgB,WAAEA,EAAFf,MAAcA,GAAUH,EAAOE,YAAYe,GAG3CE,EAAiBxD,GAAQuD,EAAa,EAAIA,EAAa,GAE7DE,EAAwBpF,EAAOyE,EAAKpB,GAAI4B,GAEpCD,EAAYC,KAAcd,GAC5BkB,EAAqBrF,EAAOyE,EAAKpB,GAAI4B,EAAUE,EAAgBhB,KAMvE,SAAAkB,EACErF,EACAoD,EACA6B,EACAtD,EACAwC,GAEA,MAAMpC,8BACJA,EADIC,gBAEJA,EAFIC,kBAGJA,GACEjC,EAEEsF,EAAeC,MAErBvD,EAAgBsD,IACdjC,GAAIiC,EACJlC,SACA6B,WACAtD,OACAwC,SAGF,IAAIqB,EAAkBzD,EAA8BqB,GAC/CoC,IACHA,KACAzD,EAA8BqB,GAAUoC,GAG1CA,EAAgBP,GAAYK,EA6D9B,SACEG,EACA9D,GAEA,MAAM+D,EAAQC,IAAaF,EAAS9D,EAAM,CAACtC,EAAG+E,IAAM/E,EAAEsC,KAAOyC,GAC7D,GAAIsB,GAAS,EACX,OAAOD,EAAQC,GAGjB,MAAME,GAAYF,EAAQ,EACpB1B,GACJrC,OACAkE,kBAGF,OADAJ,EAAQK,OAAOF,EAAU,EAAG5B,GACrBA,EAfT,CA3DqC/B,EAAmBN,GACrCkE,cAAcE,KAAKT,GAGtC,SAAAF,EACEpF,EACAoD,EACA6B,GAEA,MAAMlD,8BACJA,EADIC,gBAEJA,EAFIC,kBAGJA,GACEjC,EAEEgG,EAAiBjE,EAA8BqB,GACrD,IAAK4C,EACH,OAGF,MAAMV,EAAeU,EAAef,GACpC,IAAKK,EACH,cAIKU,EAAef,GAEtB,MAAMgB,EAAajE,EAAgBsD,GACnC,IAAKW,EACH,cAIKjE,EAAgBsD,GAEvB,MAAMY,EAAwBjE,EAAkBkE,UAC9ClF,GAAKA,EAAEU,OAASsE,EAAWtE,MAE7B,IAA+B,IAA3BuE,EACF,OAEF,MAAME,EAAmBnE,EAAkBiE,GAErCG,EAA4BD,EAAiBP,cAAcS,QAC/DhB,IAEiC,IAA/Be,IAG0C,IAA1CD,EAAiBP,cAAc7E,OAEjCiB,EAAkB6D,OAAOI,EAAuB,GAGhDE,EAAiBP,cAAcC,OAAOO,EAA2B,ICvHrE,IAAAE,EAAejH,OAAA4D,EAAA7D,EAAAC,CA9BT,SAA0BU,EAAuBmD,GACrD,MAAM0B,aAAEA,EAAFE,UAAgBA,EAAhByB,aAA2BA,EAA3BC,UAAyCA,GAActD,EAAOK,QAE9DkD,EAAa1G,EAAM4B,UAAUiD,GAC7B8B,EAAa3G,EAAM4B,UAAU4E,GAE9BE,GAAeC,IAKhBA,EAAWhD,sBAAsB8C,KAKrCE,EAAWhD,sBAAsB8C,IAC/BrD,OAAQyB,EACRC,IAAKC,GAIP2B,EAAW5C,uBAAuBiB,GAAWgB,MAC3C3C,OAAQoD,EACR1B,IAAK2B,IAGPjC,EAA8BxE,EAAOwG,OCYvCI,EAAetH,OAAA4D,EAAA7D,EAAAC,CAvCT,SACJU,EACAmD,GAEA,MAAM0B,aAAEA,EAAFE,UAAgBA,EAAhByB,aAA2BA,EAA3BC,UAAyCA,GAActD,EAAOK,QAE9DkD,EAAa1G,EAAM4B,UAAUiD,GAC7B8B,EAAa3G,EAAM4B,UAAU4E,GAEnC,IAAKE,IAAeC,EAClB,OAGF,MAAME,EAAaF,EAAWhD,sBAAsB8C,GACpD,IAAKI,EACH,OAGF,GAAIA,EAAWzD,SAAWyB,GAAgBgC,EAAW/B,MAAQC,EAC3D,OAEF4B,EAAWhD,sBAAsB8C,GAAa,KAE9C,MAAMK,EAAWJ,EAAW5C,uBAAuBiB,GACnD,IAAK+B,EACH,OAGF,MAAMC,EAAkBD,EAASX,UAC/BhH,GAAKA,EAAEiE,SAAWoD,GAAgBrH,EAAE2F,MAAQ2B,IAErB,IAArBM,IAGJD,EAAShB,OAAOiB,EAAiB,GAEjCvC,EAA8BxE,EAAOwG,MCfvCQ,EAAe1H,OAAA4D,EAAA7D,EAAAC,CApBT,SACJU,EACAmD,GAEA,MAAMC,OAAEA,GAAWD,EAAOK,SACpB5B,UAAEA,EAAFC,mBAAaA,GAAuB7B,EAEpCyE,EAAO7C,EAAUwB,GACjBG,EAAOG,EAAArE,EAAUoF,EAAKlB,MAC5B,IAAKA,IAASA,EAAK0D,SACjB,OAGgBpF,EAAmBuB,GAArC,MACM8D,EAAW3D,EAAK0D,SAASpF,EAAmBuB,IAClDvB,EAAmBuB,GAAU8D,EAE7B1C,EAA8BxE,EAAOoD,KCqDvC+D,EAAe7H,OAAA4D,EAAA7D,EAAAC,CAvET,SACJU,EACAmD,GAEA,MAAMiE,UAAEA,GAAcjE,EAAOK,SACvB7B,KACJA,EADIC,UAEJA,EAFIG,8BAGJA,EAHID,yBAIJA,EAJIE,gBAKJA,EALIC,kBAMJA,GACEjC,EAEEqH,EAAU1F,EAAOyF,EAGjBE,EAwDR,UACEC,EACAC,GAEA,KAAOD,EAAMvG,OAAS,GAAG,CAEvB,IAAKwG,EADQD,EAAM,IAEjB,YAEeA,EAAME,SAT3B,CAvDIxF,EACAyF,GAAUA,EAAO/F,MAAQ0F,GAG3B,IAAIM,EAA0B,EAAZP,EAElB,IAAK,MAAMM,KAAUJ,EAAU,CAG7BtH,EAAM2B,KAAO+F,EAAO/F,KAEpB,MAAMiG,EAAc,IAAIC,IAExB,IAAK,MAAMC,KAAOJ,EAAO7B,cAAe,CACtC,MAAMzC,OAAEA,EAAF6B,SAAUA,EAAVd,MAAoBA,GAAUnC,EAAgB8F,GAE9CrD,EAAO7C,EAAUwB,GACvB,GAAKqB,EAAL,QAKOzC,EAAgB8F,UAIhB/F,EAA8BqB,GAAQ6B,GAE7CnD,EAAyBsB,GAAQ6B,GAAYd,EAE7C,IAAK,MAAM4D,KAAWtD,EAAKX,uBAAuBmB,GAChD2C,EAAYI,IAAID,EAAQ3E,SAI5B,IAAK,MAAMA,KAAUwE,EACnBpD,EAA8BxE,EAAOoD,GAGvC,KAAMuE,GAAe,EAAG,CACtBM,QAAQC,MACN,+IAEF,OAOJlI,EAAM2B,KAAO0F,ICXNrH,mBCjDTmI,EATuB7I,OAAA4D,EAAA7D,EAAAC,CACrB,CAACU,EAA2BmD,KAC1B,MAAQC,OAAQC,EAAVpC,EAAcA,EAAI,EAAlBG,EAAqBA,EAAI,GAAM+B,EAAOK,QAC5CxD,EAAMwC,cAAca,IAClBpC,IACAG,OCDNgH,EALyB9I,OAAA4D,EAAA7D,EAAAC,CACvB,CAACU,EAA2BmD,KAC1BnD,EAAMyC,gBAAkBU,EAAOK,QAAQJ,iBCY3CiF,EAbiC/I,OAAA4D,EAAA7D,EAAAC,CAC/B,CAACU,EAA2BmD,KAC1B,MAAMmF,QAAEA,EAAFC,QAAWA,GAAYpF,EAAOK,SAC9BhB,cAAEA,EAAFE,gBAAiBA,GAAoB1C,EAC3CA,EAAMwC,cAAalD,OAAAkJ,UACdhG,EACAlD,OAAAsE,EAAAvE,EAAAC,CAAUA,OAAAmJ,EAAApJ,EAAAC,CAAKkD,EAAeE,GAAkBgG,KACjDzH,EAAGyH,EAAEzH,EAAIqH,EACTlH,EAAGsH,EAAEtH,EAAImH,kCCuCUI,qBCjDrB,SAAAC,EACJC,EACAC,EACAC,GAEA,OAAQA,GACN,IAAK,MACH,OAAOD,EACT,IAAK,SACH,OAAOxJ,OAAA0J,EAAA3J,EAAAC,CAAMuJ,EAAaC,GAC5B,IAAK,SACH,OAAOxJ,OAAA2J,EAAA5J,EAAAC,CAAWuJ,EAAaC,GACjC,IAAK,SACH,OAAOxJ,OAAA2J,EAAA5J,EAAAC,CAAWuJ,EAAaC,GAAWI,OACxC5J,OAAA2J,EAAA5J,EAAAC,CAAWwJ,EAAWD,IAK5B,OAAOC,ECNT,IAAAK,EAV2B7J,OAAA4D,EAAA7D,EAAAC,CACzB,CAACU,EAA2BmD,KAC1B,MAAMiG,QAAEA,EAAFL,KAAWA,GAAS5F,EAAOK,QACjCxD,EAAM0C,gBAAkBkG,EACtB5I,EAAM0C,gBACN0G,EACAL,sBCHNM,EAL8B/J,OAAA4D,EAAA7D,EAAAC,CAC5B,CAACU,EAA2BmD,KAC1BnD,EAAM0C,qBCqBI,SAAA4G,EACZtJ,EAA4BsC,EAC5Ba,EACAoG,GAEA,MAAMC,ECzBM,SACZxJ,EAA2BkC,EAC3BiB,GAEA,OAAQA,EAAOI,MACb,KAAKkG,EAAAtK,EAAmB,CACtB,MAAMgD,SAAEA,EAAFlB,EAAYA,EAAZG,EAAeA,GAAM+B,EAAOK,QAClC,OAAAlE,OAAAkJ,UACKxI,GACHmC,WACAC,WACEnB,IACAG,OAIN,KAAKqI,EAAApK,EAAsB,CACzB,MAAM4B,EAAEA,EAAFG,EAAKA,GAAM+B,EAAOK,QACxB,OAAAlE,OAAAkJ,UACKxI,GACHqC,SACEpB,IACAG,OAIN,KAAKqI,EAAArF,EACH,OAAA9E,OAAAkJ,UACKxI,GACHmC,SAAU,KACVC,UAAW,KACXC,QAAS,OAIf,OAAOrC,EAnCK,CD0BVA,EAAM2C,aACNQ,GASF,OAPIqG,GAAwBxJ,EAAM2C,eAChC3C,EAAKV,OAAAkJ,UACAxI,GACH2C,aAAc6G,KAIVrG,EAAOI,MACb,KAAKmG,EAAAC,EACH,OAAOxB,EAAenI,EAAOmD,GAC/B,KAAKyG,EAAAzK,EACH,OAAOiJ,EAAqBpI,EAAOmD,GACrC,KAAKyG,EAAAxF,EACH,OAAOiE,EAAyBrI,EAAOmD,GACzC,KAAKyG,EAAAvK,EACH,OJIQ,SACZW,EAA4BsC,EAC5Ba,EACAoG,GAEA,OAAOjK,OAAA4D,EAAA7D,EAAAC,CAAQU,EAAOd,IA9CxB,SACEc,EAA4BsC,EAC5Ba,EACAoG,GAEA,MAAM7G,gBAAEA,EAAFF,cAAmBA,GAAkBxC,GACrC4B,UAAEA,GAAc2H,EAAS1G,SAASC,UAExC,GAA+B,IAA3BJ,EAAgB1B,OAClB,OAGF,MAAM6I,EAAUvK,OAAAwK,EAAAzK,EAAAC,CACdoD,EACApD,OAAAyK,EAAA1K,EAAAC,CAAIoD,EAAiB,IAAM6C,QAOvByE,EAAexH,EAAcE,EAAgB,IAE7CiG,EAA6BjG,EAAgBqH,IAAI1G,IACrD,MAAMoB,EAAO7C,EAAUyB,GAWvB,OATEA,GAAIwG,EAAQxG,GACZE,KAAMkB,EAAKlB,KACX0G,OAAQ3K,OAAA4K,EAAA/K,EAAAG,CAAckD,EAAca,GAAK2G,GACzCjG,QAASzE,OAAAsE,EAAAvE,EAAAC,CAAUmF,EAAKX,uBAAwBqG,GAC9CA,EACGC,OAAOnJ,aAdQoC,GACtB,OAAqD,IAA9CX,EAAgByD,UAAUlF,GAAKA,IAAMoC,MAcrC0G,IAAI5K,KAAQiE,OAAQyG,EAAQ1K,EAAEiE,QAAS0B,IAAK3F,EAAE2F,WAMvD9E,EAAMuC,iBAAmBoG,GAQE0B,CAAoBnL,EAAGiE,EAAQoG,IAL9C,CIJwBvJ,EAAOmD,EAAQoG,GACjD,KAAKK,EAAAhL,EACH,OAAOuK,EAAmBnJ,EAAOmD,GACnC,KAAKyG,EAAAU,EACH,OEzCQ,SACZtK,EACAmD,EACAoG,GAEA,MAAMgB,OAAEA,EAAFxB,KAAUA,GAAS5F,EAAOK,QAE1BgH,EAAQlL,OAAAmL,EAAArG,EAAA9E,CAAciK,GACtBT,KAUN,OATAxJ,OAAAoL,EAAArL,EAAAC,CAAOkL,EAAO,CAACG,EAAMtH,KACf/D,OAAA4K,EAAA7K,EAAAC,CAAWqL,EAAMJ,IACnBzB,EAAU/C,KAAK1C,KAOZ/D,OAAA4D,EAAA7D,EAAAC,CAAQU,EAAOA,IACpBA,EAAM0C,gBAAkBkG,EACtB5I,EAAM0C,gBACNoG,EACAC,KAtBQ,CFyCmB/I,EAAOmD,EAAQoG,GAC5C,KAAKK,EAAAD,EACH,OAAON,EAAsBrJ,EAAOmD,GAExC,OAAOnD,EGvDT,MAAM4K,EAAgBlD,OAAOmD,sCAAwCC,EAAA3L,EACxD4L,EAAQzL,OAAAwL,EAAAnB,EAAArK,CCEP,SACZU,EAAkB4C,EAGlBO,GAEA,OACEN,UACEC,UZMQ,SACZ9C,EAAwB0B,EACxByB,GAEA,OAAQA,EAAOI,MACb,KAAKmG,EAAAC,EACH,OAAO1G,EAAejD,EAAOmD,GAC/B,KAAKuG,EAAArF,EACH,OAAOkC,EAAgBvG,EAAOmD,GAChC,KAAKuG,EAAAY,EACH,OAAO1D,EAAkB5G,EAAOmD,GAClC,KAAKuG,EAAA9K,EACH,MAAMiG,aACJA,EADIE,UAEJA,EAFIyB,aAGJA,EAHIC,UAIJA,GACEtD,EAAOK,QACX,OalCA,SACJ5B,EACAoJ,EACAC,GAEA,MAAMC,EAAYtJ,EAAUqJ,EAAM7H,QAElC,IAAK8H,EACH,SAGF,MAAMC,EAAOD,EAAUvH,sBAAsBsH,EAAMnG,KACnD,QAAKqG,GAIEA,EAAK/H,SAAW4H,EAAO5H,QAAU+H,EAAKrG,MAAQkG,EAAOlG,IAhBxD,CboCI9E,EAAM4B,WACJwB,OAAQyB,EAAcC,IAAKC,IAC3B3B,OAAQoD,EAAc1B,IAAK2B,IAGxBG,EAAkB5G,GACvBuD,KAAMmG,EAAAY,EACN9G,QAASL,EAAOK,UAGX+C,EAAgBvG,GACrBuD,KAAMmG,EAAArF,EACNb,QAASL,EAAOK,UAGtB,KAAKkG,EAAAvK,EACH,OAAO6H,EAAoBhH,EAAOmD,GACpC,KAAKuG,EAAArK,EACH,OAAO8H,EAAiBnH,EAAOmD,GACjC,KAAKuG,EAAAtF,EACH,OctDQ,SACZpE,EAAwB0B,EACxByB,GAEA,MAAMxB,KAAEA,EAAFM,kBAAQA,GAAsBjC,EAEpC,GAAiC,IAA7BiC,EAAkBjB,OACpB,OAAOhB,EAGT,MAAMoL,EAAiBnJ,EAAkB,GAAGN,KAAOA,EACnD,OAAOwF,EAAiBnH,EAAOV,OAAAoK,EAAAzK,EAAAK,CAAU8L,IAX7B,CdsDkBpL,GAE9B,OAAOA,EYhDQqL,CAAiBrL,EAAM6C,SAASC,UAAWK,IAExDJ,IACEC,cAAesG,EAAqBtJ,EAAM+C,GAAGC,cAAeG,EAAQnD,MDXxE4K,EAActL,OAAAwL,EAAAzL,EAAAC,CAAgBgM,EAAAjM,KAAA,IAAAkM,EAAAzM,EAAA,KIEhC,MAAM0M,EAASC,SAASC,eAAe,QAEvCC,EAAAC,OACEC,EAAAxL,cAACyL,EAAAzM,GAAS0L,MAAOA,GACfc,EAAAxL,cAAC0L,EAAA1M,EAAG,OAENmM,uMCCK,MAAMQ,EAAqB9M,GAChCA,EAAE6D,GAAGC,cAAcR,cAERyJ,EAAiB3M,OAAA4M,EAAAC,eAAA7M,CAC5B8M,EAAA/M,EACA+M,EAAAhI,EACA,CAACiI,EAAcC,IACbhN,OAAAiN,EAAAlN,EAAAC,CAAU+M,EAAc,CAACpL,EAAGoC,KAC1B,GAAIpC,EAAEuL,OAAOC,QACX,OAAOC,IAAUzL,EAAEuL,OAAOC,SAE5B,MAAME,EAAarN,OAAAsN,EAAAvN,EAAAC,CACjB2B,EAAEuL,OAAOK,UACTP,EAAcjJ,IAEhB,OAAIsJ,EAAW3L,OAAS,EACf0L,IAAUC,EAAW,GAAGG,OAEzB,EAAG,EAAG,EAAG,MAIVC,EAAgBzN,OAAA4M,EAAAC,eAAA7M,CAC3B0M,EACAC,EACA,CAACe,EAAeC,IACd3N,OAAAiN,EAAAlN,EAAAC,CAAU0N,EAAe,CAAClM,EAAIuC,KAC5B,MAAM6J,EAASD,EAAW5J,KAAQ,EAAG,EAAG,EAAG,GAC3C,OAAO/D,OAAA6N,EAAA/I,EAAA9E,EAEH2B,EAAGH,EAAGG,EAAIiM,EAAO,GACjB9L,EAAGN,EAAGM,EAAI8L,EAAO,KAGjBjM,EAAGH,EAAGG,EAAIiM,EAAO,GACjB9L,EAAGN,EAAGM,EAAI8L,EAAO,QAMdxK,EAAmBxD,GAC9BA,EAAE6D,GAAGC,cAAcN,gBAEYpD,OAAA4M,EAAAC,eAAA7M,CAC/B8M,EAAAzC,EACAjH,EACA,CAACd,EAAWc,IAAoBpD,OAAA8N,EAAA/N,EAAAC,CAAKsC,EAAWc,wLCxD3C,MAAMd,EAAa1C,GAAgBA,EAAE2D,SAASC,UAAUlB,UAElDyL,EAAiBnO,GAC5BI,OAAAgO,EAAAjO,EAAAC,CAAUsC,EAAU1C,GAAIJ,GAAKA,EAAEyE,MAEpB8I,EAAgBnN,GAC3BI,OAAAgO,EAAAjO,EAAAC,CAAU+N,EAAcnO,GAAIqE,GAAQgK,EAAAlO,EAAUkE,IAAS,MAE5CiK,EAAkBtO,GAC7BA,EAAE2D,SAASC,UAAUjB,oPCfhB,MAAM4L,EAAoB,2BACpBC,EAAY,CAAChF,EAAUvG,MAClCoB,KAAMkK,EACNjK,QAAOlE,OAAAkJ,UACFE,GACHvG,eAKSwL,EAAuB,8BACvBC,EAAgBlF,KAC3BnF,KAAMoK,EACNnK,QAASkF,IAIEmF,EAAkB,yBAClBC,EAAU,MACrBvK,KAAMsK,sCCjBR5P,EAAAe,EAAAI,GAAA,MAAM2O,EAAQ,EACRC,GAAU,GAAI,GAQpB,SAAAC,EACEC,EACAC,GAEA,MAAMC,EAAQD,EAAO,GACrB,IAAIrB,MAAWsB,EAAM,GAAKL,EAAQC,EAAO,MAAMI,EAAM,GAAKL,EAAQC,EAAO,KACzE,IAAK,IAAItF,KAAKyF,EAAOE,MAAM,GAAI,CAC7B,MAAOpN,EAAGG,GAAKsH,EACfoE,OAAY7L,EAAI8M,EAAQC,EAAO,MAAM5M,EAAI2M,EAAQC,EAAO,KAG1D,OACElB,KAFFA,GAAQ,IAGNwB,KAAMtO,GAAUA,EAAMkO,GAAQ,MAAQ,QAI1C,MAAMK,GACJhL,KAAM,OACNiJ,QACEC,QAAS,eAETI,WACEoB,EAAU,MAAO,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,KAC5DA,EAAU,MAAO,EAAG,IAAK,GAAI,IAAK,GAAI,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,KAC9DA,EAAU,MAAO,EAAG,IAAK,GAAI,KAAM,GAAI,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,MAClEA,EAAU,MAAO,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,MACjEA,EAAU,MAAO,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,IAAK,EAAG,KAAM,EAAG,MAChEA,EAAU,MAAO,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,KAC5DA,EAAU,MAAO,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,IAAK,EAAG,KAAM,EAAG,QAGjEpK,QACE2K,GACEN,KAAM,IACNjN,EAAG,EACHG,EAAG,GAELqN,GACEP,KAAM,IACNjN,EAAG,EACHG,EAAG,IAELsN,GACER,KAAM,IACNjN,EAAG,EACHG,EAAG,IAELuN,GACET,KAAM,IACNjN,EAAG,EACHG,EAAG,IAELwN,GACEV,KAAM,IACNjN,EAAG,EACHG,EAAG,IAELyN,GACEX,KAAM,IACNjN,EAAG,EACHG,EAAG,IAEL0N,GACEZ,KAAM,IACNjN,EAAG,EACHG,EAAG,KAGP2C,WACAE,OAAA,CAAOjE,EAAO6D,EAAQlC,MAElB3B,MAAKV,OAAAkJ,UAAO3E,MAIlBzE,EAAAlB,QAAAgB,GAAA6P,IAAA,SAAAnQ,EAAAC,EAAAC,GAAA,aCpFAb,EAAAe,EAAAI,GAAA,MAAM4P,GACJC,gBAGIC,GACJ3L,KAAM,SACNiJ,QACEK,WACEC,KAAM,4BACNwB,KAAOtO,GAAwBA,EAAMiP,YAAc,QAAU,QAGjEpL,UACAE,SACEoL,KACEjB,KAAM,MACNjN,EAAG,GACHG,EAAG,KAGP6F,SAAA,CAASjH,EAAqBgP,IAC5B1P,OAAAkJ,UACKxI,GACHiP,aAAcjP,EAAMiP,cAGxBhL,OAAA,CAAOjE,EAAQgP,EAAoBnL,EAAQlC,MAEvCuC,aACEiL,KACEjK,WAAY,EACZf,MAAOnE,EAAMiP,iBAMvB7P,EAAAlB,QAAAc,GAAAoQ,IAAA,SAAAxQ,EAAAC,EAAAC,GAAA,aCxCA,SAAAuQ,EAAuBC,EAAYC,EAAYvQ,GAC7C,WAAYsQ,EAAKtQ,MAAMuQ,YACjBvQ,KAAKA,WAAe,EAAJA,cAChBA,KAAKA,YAAiB,EAAJA,MAH1Bf,EAAAe,EAAAI,GAMA,MAAMoQ,GACJjM,KAAM,MACNiJ,QACEK,WACEwC,EAAc,GAAI,GAAI,KAEpBvC,KAAMuC,EAAc,GAAI,GAAI,IAC5Bf,KAAMtO,GAAUA,EAAMmE,MAAQ,aAAe,eAInDN,QACE4L,IACEvB,KAAM,KACNjN,EAAG,EACHG,EAAG,KAGP2C,WACAE,OAAA,CAAOjE,EAAO6D,EAAQlC,MAElB3B,OACEmE,MAAON,EAAO4L,OAKtBrQ,EAAAlB,QAAAc,GAAA0Q,IAAA,SAAA9Q,EAAAC,EAAAC,GAAA,aCjCAb,EAAAe,EAAAI,GAsCAA,EAAAlB,SArCEqF,KAAM,SACNiJ,QACEC,QAAS,wLAITI,UAAW,wUAMbhJ,QACE4L,IACEvB,KAAM,KACNjN,EAAG,EACHG,EAAG,KAGP2C,SACEoL,KACEjB,KAAM,MACNjN,EAAG,IACHG,EAAG,KAGP6C,OAAA,CAAOjE,EAAO6D,EAAQlC,MAElBuC,aACEiL,KACEjK,WAAY,EACZf,MAAON,EAAO4L,SAMxBE,IAAA,SAAA/Q,EAAAC,EAAAC,GAAA,aCtCAb,EAAAe,EAAAI,GAwCAA,EAAAlB,SAvCEqF,KAAM,MACNiJ,QACEC,QAAS,wGAITI,UAAW,6PAQbhJ,QACE4L,IACEvB,KAAM,KACNjN,EAAG,EACHG,EAAG,KAGP2C,SACEoL,KACEjB,KAAM,MACNjN,EAAG,IACHG,EAAG,KAGP6C,OAAA,CAAOjE,EAAO6D,EAAQlC,MAElBuC,aACEiL,KACEjK,WAAY,EACZf,OAAQN,EAAO4L,SAMzBG,IAAA,SAAAhR,EAAAC,EAAAC,GAAA,aCxCAb,EAAAe,EAAAI,GA6CAA,EAAAlB,SA5CEqF,KAAM,MACNiJ,QACEC,QAAS,qQAITI,UAAW,mlBAQbhJ,QACE2K,GACEN,KAAM,IACNjN,EAAG,EACHG,EAAG,MAELqN,GACEP,KAAM,IACNjN,EAAG,EACHG,EAAG,KAGP2C,SACEoL,KACEjB,KAAM,MACNjN,EAAG,IACHG,EAAG,KAGP6C,OAAA,CAAOjE,EAAO6D,EAAQlC,MAElBuC,aACEiL,KACEjK,WAAY,EACZf,QAASN,EAAO2K,GAAK3K,EAAO4K,SAMtCoB,IAAA,SAAAjR,EAAAC,EAAAC,GAAA,aC7CAb,EAAAe,EAAAI,GA6CAA,EAAAlB,SA5CEqF,KAAM,KACNiJ,QACEC,QAAS,qQAITI,UAAW,gjBAQbhJ,QACE2K,GACEN,KAAM,IACNjN,EAAG,EACHG,EAAG,MAELqN,GACEP,KAAM,IACNjN,EAAG,EACHG,EAAG,KAGP2C,SACEoL,KACEjB,KAAM,MACNjN,EAAG,IACHG,EAAG,KAGP6C,OAAA,CAAOjE,EAAO6D,EAAQlC,MAElBuC,aACEiL,KACEjK,WAAY,EACZf,MAAON,EAAO2K,GAAK3K,EAAO4K,QAMpCqB,IAAA,SAAAlR,EAAAC,EAAAC,GAAA,aC7CAb,EAAAe,EAAAI,GA6CAA,EAAAlB,SA5CEqF,KAAM,MACNiJ,QACEC,QAAS,uFAITI,UAAW,oSAQbhJ,QACE2K,GACEN,KAAM,IACNjN,EAAG,EACHG,EAAG,MAELqN,GACEP,KAAM,IACNjN,EAAG,EACHG,EAAG,KAGP2C,SACEoL,KACEjB,KAAM,MACNjN,EAAG,IACHG,EAAG,KAGP6C,OAAA,CAAOjE,EAAO6D,EAAQlC,MAElBuC,aACEiL,KACEjK,WAAY,EACZf,MAAON,EAAO2K,GAAK3K,EAAO4K,QAMpCsB,IAAA,SAAAnR,EAAAC,EAAAC,IC/CAW,EAAAuQ,QAAA/R,EAAA,IAAAA,MAKA8H,MAAAtG,EAAAR,EAAA,iGAAwH,MAAAgR,IAAA,SAAArR,EAAAC,EAAAC,GCJxH,IAAAoR,EAAAjS,EAAA,KAEA,iBAAAiS,QAAAzQ,EAAAR,EAAAiR,EAAA,MAYAjS,EAAA,IAAAA,CAAAiS,GALeC,OAEfC,iBACAC,oBAIAH,EAAAI,SAAA7Q,EAAAuQ,QAAAE,EAAAI,0JCfM,SAAAC,EAAuBC,GAC3B,OAAOlR,OAAOqF,KAAK6L,GAMf,SAAAC,EACJD,EACAE,GAEA,OAAOpR,OAAAgO,EAAAjO,EAAAC,CAAUkR,EAAKlM,GAAKA,EAAElE,KAAKsQ,0dCP7B,MAAMC,EAAgB,cAChBC,EAAaxJ,KACxB7D,KAAMoN,EACNnN,SAAW4D,eAIAyJ,EAAqB,mBACrBC,EAAiB,MAC5BvN,KAAMsN,IAIKE,EAAkB,gBAGlBC,EAAU,CACrB1N,EACArC,EACAG,EACAgC,MAEAG,KAAMwN,EACNvN,SAAWJ,OAAQA,GAAU6N,MAAU3N,WAAUrC,IAAGG,OAIzC8P,EAAkB,gBAClBC,EAAgB/N,KAC3BG,KAAM2N,EACN1N,SAAWJ,YAIAgO,EAAc,gBACdC,EAAW,CACtBxM,EACAE,EACAyB,EACAC,MAEAlD,KAAM6N,EACN5N,SACEqB,eACAE,YACAyB,eACAC,eAKS6K,EAAgB,mBAiBhBC,EAAoB,mBACpBC,EAAiB,CAC5B3M,EACAE,EACAyB,EACAC,MAEAlD,KAAMgO,EACN/N,SACEqB,eACAE,YACAyB,eACAC,gDCpFE,SAAAgL,EACJnN,EACAtE,GAIA,OAFgB0R,MAAMC,QAAQrN,GAAKA,GAAKA,IAEzByF,IAAI9I,IACjB,GAAiB,iBAANA,EACT,OACE6L,KAAM7L,EACNqN,KAAM,QACNsD,OAAQ,QACRC,YAAa,GAGjB,MAAMvD,EAAyB,mBAAXrN,EAAEqN,KAAsBrN,EAAEqN,KAAKtO,OAAeiB,EAAEqN,KAC9DsD,EACgB,mBAAb3Q,EAAE2Q,OAAwB3Q,EAAE2Q,OAAO5R,OAAeiB,EAAE2Q,OACvDC,EACqB,mBAAlB5Q,EAAE4Q,YACL5Q,EAAE4Q,YAAY7R,OACdiB,EAAE4Q,YACR,OACE/E,KAAM7L,EAAE6L,KACRwB,OACAsD,SACAC,gjBCXC,MAAMC,EAAoB,qBACpBC,EAAa3O,KACxBG,KAAMuO,EACNtO,SAAWJ,YAIA4O,EAAuB,wBACvBC,EAAe,CAAC3J,EAAiBC,MAC5ChF,KAAMyO,EACNxO,SAAW8E,UAASC,aAIT2J,EAAuB,wBACvBC,EAAe,MAC1B5O,KAAM2O,IAKKE,EAAQ,IAAM,CAACC,EAAoBC,KAG9C,MACMC,EADQD,IACevP,GAAGC,cAAcT,iBAExCiQ,EAAWlT,OAAAmT,EAAApT,EAAAC,CACfiT,EAAexI,IAAI9I,GAAKA,EAAEoC,IAC1B/D,OAAAiN,EAAAlN,EAAAC,CAAIiT,EAAgB,IAAMtB,QAM5B,IAAK,IAAIxM,KAAQ8N,EAAgB,CAC/B,MAAMlP,GACJA,EADIE,KAEJA,EACA0G,QAAQhJ,EAAEA,EAAFG,EAAKA,IACXqD,EACJ4N,EAAS/S,OAAAoT,EAAAC,EAAArT,CAAQiE,EAAMtC,EAAGG,EAAGoR,EAASnP,KAIxC,IAAK,IAAIoB,KAAQ8N,EAAgB,CAC/B,MAAMlP,GAAEA,EAAFU,QAAMA,GAAYU,EAClBmO,EAAWJ,EAASnP,GAC1B,IAAK,IAAIwP,KAAavT,OAAAwT,EAAA1O,EAAA9E,CAAUyE,GAC9B,IAAK,IAAIiH,KAAUjH,EAAQ8O,GAAY,CACrC,MAAQzP,OAAQ2P,EAAcjO,IAAK2B,GAAcuE,EAC3CgI,EAAWR,EAASO,GAC1BV,EAAS/S,OAAAoT,EAAAO,EAAA3T,CAASsT,EAAUC,EAAWG,EAAUvM,IAKrD4L,EAASa,EAAY5T,OAAA8N,EAAA/N,EAAAC,CAAOkT,OAInBW,EAAsB,uBACtBD,EAAc,CACzB9P,EACA2F,EAAsB,UAEtBxF,KAAM4P,EACN3P,SACE4F,QAASsI,MAAMC,QAAQvO,GAAUA,GAAUA,GAC3C2F,UAKSqK,EAAuB,wBACvBC,EAAe,CAC1B9I,EACAxB,EAAsB,UAEtBxF,KAAM6P,EACN5P,SACE+G,SACAxB,UAKSuK,EAAsB,uBACtBC,EAAiB,MAC5BhQ,KAAM+P,yFChER,MAAME,EAAiBC,EAAA,KAAOC;;;;;;;;;EAWxBC,EAAeF,EAAA,KAAOC;;;;;;;;EAUtBE,EAAkBH,EAAA,KAAOC;;EAIzBG,EAAoBJ,EAAA,KAAOC;;;;;;EAQ3BI,EAAgBL,EAAA,KAAOM;;EC1E7B3U,EAAAC,gBDWuCwM,EAAAlM,UACrCC,SACE,MAAMY,QACJA,GACET,KAAKF,MACT,OACEgM,EAAAxL,cAACmT,EAAc,KACb3H,EAAAxL,cAACsT,EAAY,KACX9H,EAAAxL,cAACuT,EAAe,KACd/H,EAAAxL,cAAA,UACEwL,EAAAxL,cAAA,+BACAwL,EAAAxL,cAAA,4MAKAwL,EAAAxL,cAAA,uFACAwL,EAAAxL,cAAA,uCAA8BwL,EAAAxL,cAAA,KAAG2T,KAAK,0CAAwC,6CAGlFnI,EAAAxL,cAACwT,EAAiB,KAChBhI,EAAAxL,cAAC4T,EAAA5U,GAAc6U,OAAQC,EAAA9U,KAEzBwM,EAAAxL,cAACyT,GAAcM,QAAS5T,GAAO,4BAAA6T,GAAA,SAAAzV,EAAAC,EAAAC,GAAA,iBAAAC,KAAAD,EAAA6K,EAAA5K,EAAA,kCAAAuV,KAAAxV,EAAA6K,EAAA5K,EAAA,mCAAAwV,KAAAzV,EAAA6K,EAAA5K,EAAA,oCAAAyV,KAAA1V,EAAA6K,EAAA5K,EAAA,qCAAA0V,KAAA3V,EAAA6K,EAAA5K,EAAA,+BAAA2V,KAAA5V,EAAA6K,EAAA5K,EAAA,8BAAA4V,KAAA7V,EAAA6K,EAAA5K,EAAA,gCAAA6V,KAAA9V,EAAA6K,EAAA5K,EAAA,iCAAA8V,KAAA/V,EAAA6K,EAAA5K,EAAA,wCAAA+V,KAAAhW,EAAA6K,EAAA5K,EAAA,iCAAAgW,KAAAjW,EAAA6K,EAAA5K,EAAA,kCAAAiW,KAAA,IAAAhW,EAAAF,EAAA,GAAAG,EAAAH,EAAA,GE5BzCmW,EALwBxB,EAAA,KAAOC;;;;ECc/BwB,EAVqB5V,OAAAmU,EAAA,KAAAnU,CAA+B;;;;;;;WAOzCO,GAAyB,MAAfA,EAAMsV,SAAmBtV,EAAMsV;YACxCtV,GAA0B,MAAhBA,EAAMuV,UAAoBvV,EAAMuV;ECPtDC,EALqB5B,EAAA,KAAOC;;;;WC6B5B4B,gBApB2BzJ,EAAAlM,UACzBC,YAAYC,GACVC,MAAMD,GAENE,KAAKwV,QAAUxV,KAAKwV,QAAQnV,KAAKL,MAGnCH,SACE,OACEiM,EAAAxL,cAACmV,EAAAC,eAAcC,OAAQ3V,KAAKwV,SAC1B1J,EAAAxL,cAACsV,EAAa,OAKZ/V,QAAQhB,EAAe+K,GAC7B,MAAMiM,SAAEA,GAAa7V,KAAKF,MAC1B+V,EAASjM,EAAEkM,UAKf,MAAMF,EAAgBlC,EAAA,KAAOC;;;;;;ECxB7B,IAAAoC,gBALyBjK,EAAAlM,UACvBC,SACE,OAAOiM,EAAAxL,cAAC0V,EAAa,KAAEhW,KAAKF,MAAMmW,YAKtC,MAAMD,EAAgBtC,EAAA,KAAOC;;;;;;;ECV7B,IAAAuC,gBCmB2BpK,EAAAlM,UACzBC,YAAYC,GACVC,MAAMD,GAENE,KAAKC,OACHkW,gBAAiBrW,EAAMsW,yBAA2B,IAClDC,iBAAkBvW,EAAMwW,0BAA4B,KAGtDtW,KAAKuW,mBAAqBvW,KAAKuW,mBAAmBlW,KAAKL,MACvDA,KAAKwW,oBAAsBxW,KAAKwW,oBAAoBnW,KAAKL,MAG3DH,SACE,MAAM4W,YAAEA,EAAFC,aAAeA,EAAfT,SAA6BA,GAAajW,KAAKF,OAC/CqW,gBAAEA,EAAFE,iBAAmBA,GAAqBrW,KAAKC,MAEnD,OACE6L,EAAAxL,cAAC4U,GAAgByB,UAAW3W,KAAKF,MAAM6W,WACpCF,GACC3K,EAAAxL,cAACwL,EAAA8K,SAAc,KACb9K,EAAAxL,cAAC6U,GAAaC,MAAOe,GAAkBM,GACvC3K,EAAAxL,cAACiV,GAAaM,SAAU7V,KAAKuW,sBAGjCzK,EAAAxL,cAACgV,EAAY,KAAEW,GACdS,GACC5K,EAAAxL,cAACwL,EAAA8K,SAAc,KACb9K,EAAAxL,cAACiV,GAAaM,SAAU7V,KAAKwW,sBAC7B1K,EAAAxL,cAAC6U,GAAaC,MAAOiB,GAAmBK,KAO1C7W,mBAAmBgX,GACzB7W,KAAKU,SAASvB,KACZgX,gBAAiBhX,EAAEgX,gBAAkBU,KAIjChX,oBAAoBgX,GAC1B7W,KAAKU,SAASvB,KACZkX,iBAAkBlX,EAAEkX,iBAAmBQ,oDCuC7CC,gBArEyBhL,EAAAlM,UACvBC,SACE,MAAMkX,EAAA/W,KAAAF,OAAAyD,SACJA,EADIyT,UAEJA,EAFIC,UAGJA,EAHI5C,QAIJA,GAAO0C,EACPG,EDuBuCL,qRCvBvCM,CAAAJ,GAAA,+CAGIrT,EAAMC,EAAArE,EAAUiE,GACtB,IAAKG,EACH,OAAOoI,EAAAxL,cAAC8W,EAAAC,MAAKjC,MAAO,GAAIC,OAAQ,GAAI9G,KAAK,QAE3C,MAAM7B,QAAEA,EAAFI,UAAWA,GAAcpJ,EAAI+I,OAE7B6K,EAAgB5K,SAAsB2H,EAEtCkD,EADUhY,OAAAiY,EAAAlY,EAAAC,CAAiBuN,EAAWkK,GACfhN,IAAI,CAACzF,EAAGrF,IACnC4M,EAAAxL,cAAC8W,EAAAK,MACCC,IAAKxY,EACLyY,KAAMpT,EAAEwI,KACRwB,KAAMhK,EAAEgK,KACRsD,OAAQtN,EAAEsN,OACVC,YAAavN,EAAEuN,YACfuC,QAASiD,KAIPxT,EAASJ,EAAII,WACbE,EAAUN,EAAIM,YAEpB,IAAI4T,EAA6B,KAC7BC,EAA8B,KAwBlC,OAtBIZ,IACFW,EAAYrY,OAAOqF,KAAKd,GAAQkG,IAAI0N,IAClC,MAAMxM,EAAQpH,EAAO4T,GACrB,IAAII,EAAUb,EAAS1X,OAAAkJ,QACrBsP,UAAW,QACXzU,GAAIoU,GACDxM,IAEL,OAAOY,EAAAkM,aAAmBF,GAAWJ,aAAcA,QAGrDG,EAAatY,OAAOqF,KAAKZ,GAASgG,IAAI0N,IACpC,MAAMzM,EAASjH,EAAQ0T,GACvB,IAAII,EAAUb,EAAS1X,OAAAkJ,QACrBsP,UAAW,SACXzU,GAAIoU,GACDzM,IAEL,OAAOa,EAAAkM,aAAmBF,GAAWJ,cAAeA,SAKtD5L,EAAAxL,cAAC8W,EAAAa,MAAK1Y,OAAAkJ,UAAKyO,GACRxK,GACCZ,EAAAxL,cAAC8W,EAAAK,MAAKE,KAAMjL,EAAS6B,KAAK,cAAc8F,QAASA,IAElDkD,EACAK,EACAC,KCnFT,MAAMK,GACJjH,QAAAtH,EAAAiJ,GAwBF,IAAAuF,EAAe5Y,OAAAwM,EAAA1H,EAAA9E,CAAQ,KAAM2Y,EAAd3Y,eAnBWuM,EAAAlM,UACxBC,SACE,MAAMoR,QAAEA,GAAYjR,KAAKF,MAEnBsY,EAAW7Y,OAAA8Y,EAAAhU,EAAA9E,CAAUoE,EAAArE,GAAW0K,IAAIxG,GAEtCsI,EAAAxL,cAAA,OAAKoX,IAAKlU,EAAM6Q,QAAS,IAAMpD,EAAQzN,IACrCsI,EAAAxL,cAAC8W,EAAAkB,OAAMlD,MAAO,IAAKC,OAAQ,KACzBvJ,EAAAxL,cAAC8W,EAAAmB,MAAK,KACJzM,EAAAxL,cAACwW,GAAWvT,SAAUC,EAAMwT,mBAOtC,OAAOlL,EAAAxL,cAACkY,EAAoB,KAAEJ,MAKlC,MAAMI,EAAuB9E,EAAA,KAAOC;;;;;aC7BpC,MAAM8E,EAAkBlZ,OAAAmZ,EAAAC,yBAAApZ,EACtBqC,KAAMzC,GAAKA,EAAE2D,SAASC,UAAUnB,OAG5BgX,GACJ/H,UAAAlH,EAAAzK,GAgBF,IAAA2Z,EAAetZ,OAAAwM,EAAA1H,EAAA9E,CAAQkZ,EAAiBG,EAAzBrZ,eAXcuM,EAAAlM,UAC3BC,SACE,MAAM+B,KAAEA,EAAFiP,UAAQA,GAAc7Q,KAAKF,MAEjC,OACEgM,EAAAxL,cAAA,qBACUsB,MAAMkK,EAAAxL,cAAA,UAAQ+T,QAASxD,EAAUxQ,KAAK,KAAM,IAAE,YAAAsO,EAAA5P,EAAA,GCpB9D,MAAM+Z,EAAgBvZ,OAAAmZ,EAAAtM,eAAA7M,CACnBJ,GAAgBA,EAAE6D,GAAGC,cAAcP,gBACnCvD,GAAgBA,EAAE2D,SAASC,UAAUlB,UACtC,CAACyB,EAAIzB,IAAeyB,EAAKzB,EAAUyB,GAAM,MAGrCyV,EAA8BxZ,OAAAmZ,EAAAtM,eAAA7M,CAClCuZ,EACC3Z,GAAgBA,EAAE2D,SAASC,UAAUhB,yBACtC,CAAC2C,EAAMsU,IACLtU,EACInF,OAAAsE,EAAAvE,EAAAC,CAAUmF,EAAKd,sBAAuB,CAACW,EAAG0U,IACnC1U,EAGEyU,EAAgBzU,EAAElB,QAAQkB,EAAEQ,KAF1B,UAObmU,EAA+B3Z,OAAAmZ,EAAAtM,eAAA7M,CAClCJ,GAAgBA,EAAE2D,SAASC,UAAUhB,yBACrC5C,GAAgBA,EAAE6D,GAAGC,cAAcP,gBACpC,CAACsB,EAASX,IAAsB,MAAVA,EAAiBW,EAAQX,OAQ3C8V,EAAkB5Z,OAAAmZ,EAAAC,yBAAApZ,EACtB6Z,gBAAiBL,EACjBM,iBAAkBH,IAqBpB,IAAAI,EAAe/Z,OAAAwM,EAAA1H,EAAA9E,CAAQ4Z,EAAR5Z,eAjBQuM,EAAAlM,UACrBC,SACE,MAAMuZ,gBAAEA,EAAFC,iBAAmBA,GAAqBrZ,KAAKF,MACnD,OACEgM,EAAAxL,cAAA,WACEwL,EAAAxL,cAAA,0BACAwL,EAAAxL,cAAA,WACEwL,EAAAxL,cAAA,YAAOiZ,KAAKC,UAAUJ,KAExBtN,EAAAxL,cAAA,2BACAwL,EAAAxL,cAAA,WACEwL,EAAAxL,cAAA,YAAOiZ,KAAKC,UAAUH,EAAkB,KAAM,SClDxD,MAOMI,EAAkBla,OAAAmZ,EAAAC,yBAAApZ,EACtB2C,kBARiC/C,GACjCA,EAAE2D,SAASC,UAAUb,oBAyBvB,IAAAwX,EAAena,OAAAwM,EAAA1H,EAAA9E,CAAQka,EAARla,eAdkBuM,EAAAlM,UAC/BC,SACE,MAAMqC,kBAAEA,GAAsBlC,KAAKF,MAEnC,OACEgM,EAAAxL,cAAA,WACEwL,EAAAxL,cAAA,kCACAwL,EAAAxL,cAAA,WACEwL,EAAAxL,cAAA,YAAOiZ,KAAKC,UAAUtX,EAAmB,KAAM,SAAAyX,EAAA5a,EAAA,IAAA6a,EAAA7a,IAAA4a,GAAAE,EAAA9a,EAAA,IAAA+a,EAAA/a,EAAA,ICzBzD,MAEagb,EAFE,kBAEqBC,MAAMC,EAAAC,IAAM,aAAaC,YAEhDC,EAA0BL,EAAgB,UAAY,OCJtDM,EAAkB,+BAClBC,EAAyB,sCACzBC,EAAmB,4BACnBC,EAAoB,6BAQjC,IAAAC,GALE5a,CAACwa,GAAkB,QACnBxa,CAACya,GAAyB,cAC1Bza,CAAC0a,MAAsBH,MACvBva,CAAC2a,MAAuBJ,OCL1BM,EAJuBhH,EAAA,KAAOC;;2CCKvB,MAAMgH,GAAqB1a,GAChCA,EAAM+C,GAAGC,cAAcL,aAEZgY,GAAgBrb,OAAAmZ,EAAAtM,eAAA7M,CAC3Bob,GACCxb,GACgB,WAAfA,EAAEiD,UAAyBjD,EAAEkD,WAAalD,EAAEmD,QACxC/C,OAAA4K,EAAA9F,EAAA9E,CAAmBJ,EAAEkD,UAAWlD,EAAEmD,SAClC,MAGKuY,GAAiBtb,OAAAmZ,EAAAtM,eAAA7M,CAC5Bob,GACCxb,GACgB,SAAfA,EAAEiD,UAAuBjD,EAAEkD,WAAalD,EAAEmD,QACtC/C,OAAA4K,EAAA/K,EAAAG,CAAcJ,EAAEmD,QAASnD,EAAEkD,WAC3B,MCCFyY,GAA4Bvb,OAAAmZ,EAAAtM,eAAA7M,CAChCwb,EAAA3b,EACA2b,EAAAzb,EACA,CAACqD,EAAiBsJ,IAChB1M,OAAAmJ,EAAApJ,EAAAC,CAAK0M,EAAmBtJ,IAGtBqY,GAAwBzb,OAAAmZ,EAAAtM,eAAA7M,CAC5Bwb,EAAA3b,EACAsL,EAAAtL,EACA,CAACuD,EAAiB2K,IAAkB/N,OAAAmJ,EAAApJ,EAAAC,CAAK+N,EAAe3K,IAGpDsY,GAAyB1b,OAAAmZ,EAAAtM,eAAA7M,CAC7Bwb,EAAA3b,EACAsL,EAAArG,EACA,CAAC1B,EAAiB8K,IAAmBlO,OAAAmJ,EAAApJ,EAAAC,CAAKkO,EAAgB9K,IAKtDuY,GAAkB3b,OAAAmZ,EAAAC,yBAAApZ,EACtB4b,0BADqEL,GAErEM,sBAFqEJ,GAGrEK,uBAHqEJ,GAIrEK,eAAAT,KAoCF,IAAAU,GAAehc,OAAAwM,EAAA1H,EAAA9E,CAAQ2b,GAAR3b,eA1BgBuM,EAAAlM,UAC7BC,SACE,MAAMsb,0BACJA,EADIC,sBAEJA,EAFIC,uBAGJA,EAHIC,eAIJA,GACEtb,KAAKF,MAET,IAAIsY,EAAmC,KAcvC,OAbIkD,IACFlD,EAAW7Y,OAAAic,EAAAlc,EAAAC,CACTA,OAAAsE,EAAAvE,EAAAC,CAAU4b,EAA2B,CAACxS,EAAGtF,IACvCyI,EAAAxL,cAACwW,GACCY,IAAKrU,EACLE,SAAU6X,EAAsB/X,GAChC2T,UAAWqE,EAAuBhY,GAClCnC,EAAGyH,EAAEzH,EAAIoa,EAAepa,EACxBG,EAAGsH,EAAEtH,EAAIia,EAAeja,OAKzByK,EAAAxL,cAAC8W,EAAAmB,MAAK,KAAEH,MC/CnBqD,GAAelc,OAAAwM,EAAA1H,EAAA9E,CA1Bf,SAAyBU,GACvB,OACE2a,cAAeA,GAAc3a,KAwBlBV,eAlBeuM,EAAAlM,UAC5BC,SACE,MAAQ+a,cAAehQ,GAAS5K,KAAKF,MACrC,OACEgM,EAAAxL,cAAC8W,EAAAsE,UAAS,KACP9Q,GACCkB,EAAAxL,cAAC8W,EAAAC,MACCnW,EAAG0J,EAAK7J,GAAGG,EACXG,EAAGuJ,EAAK7J,GAAGM,EACX+T,MAAOxK,EAAK5J,GAAGE,EAAI0J,EAAK7J,GAAGG,EAC3BmU,OAAQzK,EAAK5J,GAAGK,EAAIuJ,EAAK7J,GAAGM,EAC5BkN,KAAK,aCCjB,MAAMoN,GAASpc,OAAOqc,QAAS1a,EAAG,EAAGG,EAAG,IAElCwa,GAAiB1c,GAAgBA,EAAE2D,SAASC,UAAUlB,UACtDia,GAAevc,OAAAmZ,EAAAtM,eAAA7M,CAAesc,GAAeE,IA0EzBA,EAzEPxc,OAAOqF,KAAKmX,GAAO/R,IAAIiP,GAAK8C,EAAM9C,IA0E5C8C,EAAMC,OAAe,CAAC1c,EAAGoF,KAC9B,IAAK,MAAMoO,KAAavT,OAAOqF,KAAKF,EAAKX,wBACvC,IAAK,MAAMkY,KAAcvX,EAAKX,uBAAuB+O,GACnDxT,EAAE0G,MACAmO,QACE9Q,OAAQqB,EAAKpB,GACbyB,IAAK+N,GAEPnC,OAAQsL,IAId,OAAO3c,SApFX,MAAM4c,GAAoB3c,OAAAmZ,EAAAtM,eAAA7M,CAAesc,GAAeE,GACtDxc,OAAAsE,EAAAvE,EAAAC,CAAUwc,EAAOxX,GAAKZ,EAAArE,EAAUiF,EAAEf,QAE9B2Y,GAAqB5c,OAAAmZ,EAAAtM,eAAA7M,CACzBuc,GACC3c,GAAgBA,EAAE6D,GAAGC,cAAcR,cACpCyZ,GACC/c,GAAgBA,EAAE2D,SAASC,UAAUhB,yBACtC,CAACqa,EAAO3Z,EAAe4Z,EAAWC,IACzBF,EAAMpS,IAAgBuS,IAC3B,MACEpI,QAAU9Q,OAAQmZ,EAAKzX,IAAK0X,GAC5B9L,QAAUtN,OAAQ0E,EAAKhD,IAAK2X,IAC1BH,EAEEI,EAAKla,EAAc+Z,IAAQb,GAC3BiB,EAAKP,EAAUG,GACfK,EAAOD,GAAMA,EAAG5Y,QAAQyY,IAAUd,GAElCmB,EAAKra,EAAcsF,IAAQ4T,GAC3BoB,EAAKV,EAAUtU,GACfiV,EAAOD,GAAMA,EAAGjZ,OAAO4Y,IAAUf,GAEjCH,EAASc,EAAaE,GACtBpY,IAAQoX,GAASA,EAAOiB,GAE9B,OACE/E,OAAQ8E,KAAOC,KAAQ1U,KAAO2U,IAC9BvI,QACEjT,EAAGyb,EAAGzb,EAAI2b,EAAI3b,EACdG,EAAGsb,EAAGtb,EAAIwb,EAAIxb,GAEhBsP,QACEzP,EAAG4b,EAAG5b,EAAI8b,EAAI9b,EACdG,EAAGyb,EAAGzb,EAAI2b,EAAI3b,GAEhB+C,YASF6Y,GAAkB1d,OAAAmZ,EAAAC,yBAAApZ,EACtB2d,YAAaf,KAmBf,IAAAgB,GAAe5d,OAAAwM,EAAA1H,EAAA9E,CAAQ0d,GAAR1d,eAfUuM,EAAAlM,UACvBC,SACE,MAAMqd,YAAEA,GAAgBld,KAAKF,MAEvBsd,EAAoBF,EAAYlT,IAAI5K,GACxC0M,EAAAxL,cAAC8W,EAAAiG,MACC3F,IAAKtY,EAAEsY,IACPtJ,QA+BeC,EA/BOjP,EAAE+U,OA+BKmJ,EA/BGle,EAAEuR,OAgCpCxP,KAAKoc,IAAIlP,EAAMnN,EAAIoc,EAAIpc,GAAKC,KAAKoc,IAAIlP,EAAMhN,EAAIic,EAAIjc,IAEnDgN,EAAMnN,EACNmN,EAAMhN,EAENgN,EAAMnN,GAAKoc,EAAIpc,EAAImN,EAAMnN,GAAK,EAC9BmN,EAAMhN,EAENgN,EAAMnN,GAAKoc,EAAIpc,EAAImN,EAAMnN,GAAK,EAC9Boc,EAAIjc,EAEJic,EAAIpc,EACJoc,EAAIjc,IAIJgN,EAAMnN,EACNmN,EAAMhN,EAENgN,EAAMnN,EACNmN,EAAMhN,GAAKic,EAAIjc,EAAIgN,EAAMhN,GAAK,EAE9Bic,EAAIpc,EACJmN,EAAMhN,GAAKic,EAAIjc,EAAIgN,EAAMhN,GAAK,EAE9Bic,EAAIpc,EACJoc,EAAIjc,IAzDFwQ,OAAQzS,EAAEgF,MAAQ,QAAU,WA8BpC,IAAuBiK,EAAciP,EA1BjC,OAAOxR,EAAAxL,cAAC8W,EAAAmB,MAAK,KAAE6E,MCrEnB,IAAAI,iBAhBkB1R,EAAAlM,UAChBC,SACE,MAAMkX,EAAA/W,KAAAF,OAAAuU,QAAEA,GAAO0C,EAAE0G,EDmFFL,qRCnFEM,CAAA3G,GAAA,YACjB,OACEjL,EAAAxL,cAAC8W,EAAAa,MAAK1Y,OAAAkJ,UAAKgV,GACT3R,EAAAxL,cAAC8W,EAAAuG,QACCzc,EAAG,EACHG,EAAG,EACHuc,OAXgB,EAYhBrP,KAAK,QACL8F,QAASA,OC+DnBwJ,GAAete,OAAAwM,EAAA1H,EAAA9E,CAlDf,SAAyBU,EAAiBH,GACxC,OACEyD,SAAUhE,OAAAmL,EAAAtL,EAAAG,CAAcU,GAAOH,EAAMuD,QACrC2T,UAAWzX,OAAAmL,EAAArG,EAAA9E,CAAeU,GAAOH,EAAMuD,QACvCya,YAA8D,IAAlDve,OAAAwb,EAAA3b,EAAAG,CAAgBU,GAAOsG,QAAQzG,EAAMuD,UA8CtC9D,eAzCWuM,EAAAlM,UACxBC,YAAYC,GACVC,MAAMD,GAENE,KAAK+d,WAAa/d,KAAK+d,WAAW1d,KAAKL,MAGzCH,SACE,MAAMkX,EAAA/W,KAAAF,OAAAuD,OACJA,EADIE,SAEJA,EAFIyT,UAGJA,EAHI8G,WAIJA,EAJIzJ,QAKJA,EALI2J,WAMJA,GAAUjH,EACV0G,EDrCapJ,qRCqCb4J,CAAAlH,GAAA,sEAGF,OACEjL,EAAAxL,cAAC8W,EAAAa,MAAK1Y,OAAAkJ,UAAKgV,GACT3R,EAAAxL,cAACwW,GACCvT,SAAUA,EACVyT,UAAWA,EACX3C,QAASA,EACT4C,UAAWjX,KAAK+d,aAEjBD,GAAchS,EAAAxL,cAAC8W,EAAAC,MAAKjC,MAAO,GAAIC,OAAQ,GAAI9G,KAAK,YAK/C1O,WAAWC,GACjB,OACEgM,EAAAxL,cAAC4d,GAAc3e,OAAAkJ,QACbiP,IAAK5X,EAAMwD,GACX0a,WAAYhe,KAAKF,MAAMke,YACnBle,aAcZoe,WAA6BpS,EAAAlM,UAC3BC,YAAYC,GACVC,MAAMD,GAENE,KAAKme,SAAWne,KAAKme,SAAS9d,KAAKL,MAGrCH,SACE,MAAMqB,EAAEA,EAAFG,EAAKA,GAAMrB,KAAKF,MACtB,OAAOgM,EAAAxL,cAACkd,IAAQtc,EAAGA,EAAGG,EAAGA,EAAGgT,QAASrU,KAAKme,WAGpCte,SAAShB,GACf,MAAMkZ,UAAEA,EAAFzU,GAAaA,EAAb0a,WAAiBA,GAAehe,KAAKF,MACvCke,GACFA,EAAWjG,EAAWzU,EAAIzE,iSCjFhC,MAAMuf,GAAkB7e,OAAAmZ,EAAAC,yBAAApZ,EACtB0M,kBAAA8O,EAAAzb,IAGI+e,IACJ5M,eAAA9H,EAAA2U,GA2EF,IAAAC,GAAehf,OAAAwM,EAAA1H,EAAA9E,CAAQ6e,GAAiBC,GAAzB9e,eAjEUuM,EAAAlM,UACvBC,YAAYC,GACVC,MAAMD,GAENE,KAAKwe,YAAcxe,KAAKwe,YAAYne,KAAKL,MAG3CH,SACE,MAAMoM,kBACJA,EADIwS,gBAEJA,EAFIC,cAGJA,EAHIC,gBAIJA,EAJIC,iBAKJA,GACE5e,KAAKF,MAEH+e,EAAetf,OAAOqF,KAAKqH,GAAmBjC,IAAI0N,IACtD,MAAMxW,EAAEA,EAAFG,EAAKA,GAAM4K,EAAkByL,GACnC,OACE5L,EAAAxL,cAACwe,IACCpH,IAAKA,EACLrU,OAAQqU,EACRxW,EAAGA,EACHG,EAAGA,EACH0d,YAAaN,EACbO,UAAWN,EACXO,YAAaN,EACbO,aAAcN,EACdZ,WAAYhe,KAAKwe,gBAKvB,OAAO1S,EAAAxL,cAAC8W,EAAAmB,MAAK,KAAEsG,GAGThf,YACNwD,EACA0U,EACAhT,EACAlG,GAIA,GAFAA,EAAEsgB,IAAIC,iBAEY,WAAdrH,EAKF,YAJA/X,KAAKU,UACH2e,eAAgBhc,EAChBic,cAAeva,IAKnB,MAAMsa,eAAEA,EAAFC,cAAkBA,GAAkBtf,KAAKC,MAC1Cof,GAAmBC,IAIxBtf,KAAKF,MAAM2R,eAAe4N,EAAgBC,EAAejc,EAAQ0B,GAEjE/E,KAAKU,UACH2e,eAAgB,KAChBC,cAAe,iBAmBrBR,WAAgChT,EAAAlM,UAC9BC,YAAYC,GACVC,MAAMD,GAENE,KAAKuf,aAAevf,KAAKuf,aAAalf,KAAKL,MAC3CA,KAAKwf,WAAaxf,KAAKwf,WAAWnf,KAAKL,MACvCA,KAAKyf,aAAezf,KAAKyf,aAAapf,KAAKL,MAC3CA,KAAK0f,cAAgB1f,KAAK0f,cAAcrf,KAAKL,MAC7CA,KAAKwe,YAAcxe,KAAKwe,YAAYne,KAAKL,MAE3CH,SACE,MAAMkX,EAAA/W,KAAAF,OAAAif,YACJA,EADIC,UAEJA,EAFIC,YAGJA,EAHIC,aAIJA,EAJIlB,WAKJA,GAAUjH,EACV4I,EAAAC,GAAA7I,GAAA,sEAEF,OACEjL,EAAAxL,cAACud,GAAWte,OAAAkJ,UACNkX,GACJZ,YAAa/e,KAAKuf,aAClBP,UAAWhf,KAAKwf,WAChBP,YAAajf,KAAKyf,aAClBP,aAAclf,KAAK0f,cACnB1B,WAAYhe,KAAKwe,eAKf3e,aAAahB,GACnB,MAAMwE,OAAEA,EAAF0b,YAAUA,GAAgB/e,KAAKF,MACjCif,GACFA,EAAY1b,EAAQxE,GAIhBgB,WAAWhB,GACjB,MAAMwE,OAAEA,EAAF2b,UAAUA,GAAchf,KAAKF,MAC/Bkf,GACFA,EAAU3b,EAAQxE,GAIdgB,aAAahB,GACnB,MAAMwE,OAAEA,EAAF4b,YAAUA,GAAgBjf,KAAKF,MACjCmf,GACFA,EAAY5b,EAAQxE,GAIhBgB,cAAchB,GACpB,MAAMwE,OAAEA,EAAF6b,aAAUA,GAAiBlf,KAAKF,MAClCof,GACFA,EAAa7b,EAAQxE,GAIjBgB,YACNkY,EACAhT,EACAlG,GAEA,MAAMwE,OAAEA,EAAF2a,WAAUA,GAAehe,KAAKF,MAChCke,GACFA,EAAW3a,EAAQ0U,EAAWhT,EAAKlG,yBC5JnC,SAAAghB,GAAwBxc,EAAgByc,GAC5C,GAAIA,EAAUC,OACZ,OAAOxgB,OAAAoK,EAAAsP,EAAA1Z,CAAa8D,GAGtB,MAAM2F,EAAOgX,GAAcF,GAC3B,OAAOvgB,OAAAsK,GAAAyU,EAAA/e,CAAY8D,EAAQ2F,GAGvB,SAAAiX,GAAyBH,GAC7B,OAAOvgB,OAAAsK,GAAAvF,EAAA/E,GAGH,SAAA2gB,GACJ7c,EACAsF,EACAmX,GAEA,MAAO,CAACxN,EAAoBC,KAK1B,IAD8D,IAFhDA,IAENvP,GAAGC,cAAcN,gBAAgB4D,QAAQlD,GAC5B,CACnB,MAAM2F,EAAOgX,GAAcF,GAC3BxN,EAAS/S,OAAAsK,GAAAyU,EAAA/e,CAAY8D,EAAQ2F,IAE/BsJ,EAAS/S,OAAAmK,GAAAa,EAAAhL,CAAUoJ,EAAG,UAIpB,SAAAwX,GAA2BxX,GAC/B,OAAOpJ,OAAAmK,GAAAa,EAAAhL,CAAUoJ,EAAG,UAGhB,SAAAyX,GAAqBzX,GACzB,OAAOpJ,OAAAmK,GAAAE,EAAArK,CAAaoJ,GAGhB,SAAA0X,GAAoB1X,EAAUmX,GAClC,MAAO,CAACxN,EAAoBC,KAC1B,MAAM+N,EAAa3F,GAAkBpI,MAC/BnQ,SAAEA,EAAFC,UAAYA,EAAZC,QAAuBA,GAAYge,EACzC,GAAIje,GAAaC,EACf,OAAQF,GACN,IAAK,SAAU,CACb,MAAMwI,EAAOrL,OAAA4K,EAAA9F,EAAA9E,CAAmB8C,EAAWC,GACrC0G,EAAOgX,GAAcF,GAC3BxN,EAAS/S,OAAAsK,GAAAqJ,EAAA3T,CAAaqL,EAAM5B,IAC5B,MAEF,IAAK,OAAQ,CACX,MAAMuX,EAAShhB,OAAA4K,EAAA/K,EAAAG,CAAc+C,EAASD,GACtCiQ,EAAS/S,OAAAsK,GAAA2W,EAAAjhB,CAAaghB,EAAOrf,EAAGqf,EAAOlf,IACvC,OAINiR,EAAS/S,OAAAmK,GAAA7K,EAAAU,KAIP,SAAAkhB,GAAsBpd,GAC1B,OAAO9D,OAAAsK,GAAA3K,EAAAK,CAAU8D,GAGb,SAAAqd,KACJ,OAAOnhB,OAAAoK,EAAAzK,EAAAK,CAAU,GAGb,SAAAohB,KACJ,OAAOphB,OAAAoK,EAAA6W,EAAAjhB,GAGH,SAAAqhB,KACJ,OAAOrhB,OAAAsK,GAAA+I,EAAArT,GAGH,SAAAshB,KACJ,OAAOthB,OAAAsK,GAAAoP,EAAA1Z,GAGT,SAAAygB,GAAuBF,GACrB,OAAIA,EAAUgB,UAAYhB,EAAUiB,YAC3B,SAELjB,EAAUgB,SACL,SAELhB,EAAUiB,YACL,SAEF,MC7FT,MAAMC,GAAqBC,EA4K3B,IC3MAC,GD2MeC,KACbC,gBACAC,iBACAC,kBAHaH,CAIZ5hB,OAAAwM,EAAA1H,EAAA9E,CAAQ,KAAMyhB,GAAdzhB,eA1KwBuM,EAAAlM,UASzBC,YAAYC,GACVC,MAAMD,GARAE,KAAAuhB,eACAvhB,KAAAwhB,iBAAkC,KAClCxhB,KAAAyhB,eAA+B,KAC/BzhB,KAAA0hB,cAA8B,KAE9B1hB,KAAA2hB,YAAc7V,EAAA8V,YAgDd5hB,KAAA6hB,cACNhiB,CAACwa,GAAkB,IAAMra,KAAKF,MAAM4gB,eACpC7gB,CAACya,GAAyB,IAAMta,KAAKF,MAAM6gB,sBAC3C9gB,CAAC0a,GAAmB,IAAMva,KAAKF,MAAM8gB,eACrC/gB,CAAC2a,GAAoB,IAAMxa,KAAKF,MAAM+gB,iBA/CtC7gB,KAAK8hB,iBAAmB9hB,KAAK8hB,iBAAiBzhB,KAAKL,MACnDA,KAAK+hB,iBAAmB/hB,KAAK+hB,iBAAiB1hB,KAAKL,MACnDA,KAAKgiB,kBAAoBhiB,KAAKgiB,kBAAkB3hB,KAAKL,MAErDA,KAAKuf,aAAevf,KAAKuf,aAAalf,KAAKL,MAC3CA,KAAKiiB,aAAejiB,KAAKiiB,aAAa5hB,KAAKL,MAC3CA,KAAKwf,WAAaxf,KAAKwf,WAAWnf,KAAKL,MAEvCA,KAAK6hB,aAAetiB,OAAA8Y,EAAA/Y,EAAAC,CAAYS,KAAK6hB,aAAc7hB,MAGrDH,SACE,MAAM8W,UACJA,EACAuL,MAAM9M,MAAEA,EAAFC,OAASA,IACbrV,KAAKF,MAET,OACEgM,EAAAxL,cAACoa,GAAe/D,UAAWA,GACzB7K,EAAAxL,cAAC6hB,EAAAC,SAAQC,OAAQ5H,EAAQ6H,SAAUtiB,KAAK6hB,cACtC/V,EAAAxL,cAAA,OAAKiiB,UAAW,EAAGC,IAAKxiB,KAAK2hB,aAC3B7V,EAAAxL,cAAC8W,EAAAkB,OACClD,MAAOA,EACPC,OAAQA,EACR0J,YAAa/e,KAAKuf,aAClBkD,YAAaziB,KAAKiiB,aAClBjD,UAAWhf,KAAKwf,YAEhB1T,EAAAxL,cAACmb,GAAe,MAChB3P,EAAAxL,cAACib,GAAgB,MACjBzP,EAAAxL,cAAC6c,GAAU,MACXrR,EAAAxL,cAACie,IACCE,gBAAiBze,KAAK8hB,iBACtBnD,gBAAiB3e,KAAK+hB,iBACtBnD,iBAAkB5e,KAAKgiB,wBAgB7BniB,iBAAiBwD,EAAgBxE,GACnCA,EAAEsgB,IAAIuD,kBAIV1iB,KAAKF,MAAM2gB,YAAYpd,GAGjBxD,kBAAkBwD,EAAgBxE,GACxCmB,KAAKF,MAAM2gB,YAAY,MAGjB5gB,iBAAiBwD,EAAgBxE,GACnCA,EAAEsgB,IAAIuD,mBAIV1iB,KAAKwhB,iBAAmBne,GAGlBxD,aAAahB,GACfA,EAAEsgB,IAAIuD,mBAIN1iB,KAAK2hB,YAAYgB,SACnB3iB,KAAK2hB,YAAYgB,QAAQC,QAG3B5iB,KAAKyhB,gBACHvgB,EAAGrC,EAAEsgB,IAAI0D,OACTxhB,EAAGxC,EAAEsgB,IAAI2D,SAILjjB,aAAahB,GACnB,GAAIA,EAAEsgB,IAAIuD,iBACR,OAGF,IAAK1iB,KAAKyhB,eACR,OAGF,MAAQvgB,EAAG6hB,EAAI1hB,EAAG2hB,GAAOhjB,KAAKyhB,gBAEtBoB,OAAQ3hB,EAAG4hB,OAAQzhB,EAArB4hB,QAAwBA,EAAxBlD,OAAiCA,EAAjCe,SAAyCA,EAAzCoC,QAAmDA,GAAYrkB,EAAEsgB,IACjEW,GACJiB,YAAahH,EAAgBmJ,EAAUD,EACvClD,OAAQA,EACRe,YAGF,GAAK9gB,KAAKuhB,YAeRvhB,KAAKF,MAAMsgB,YAAalf,IAAGG,UAfN,CACrB,GACEF,KAAKoc,IAAIrc,EAAI6hB,GAxHE,GAyHf5hB,KAAKoc,IAAIlc,EAAI2hB,GAzHE,EA2Hf,OAGFhjB,KAAKuhB,eACDvhB,KAAKwhB,iBACPxhB,KAAKF,MAAMogB,gBAAgBlgB,KAAKwhB,kBAAoBtgB,IAAGG,KAAKye,GAE5D9f,KAAKF,MAAMqgB,kBAAmBjf,IAAGG,OAO/BxB,WAAWhB,GACjB,GAAIA,EAAEsgB,IAAIuD,iBAER,YADA1iB,KAAKmjB,sBAIP,MAAQN,OAAQ3hB,EAAG4hB,OAAQzhB,EAArB4hB,QAAwBA,EAAxBlD,OAAiCA,EAAjCmD,QAAyCA,EAAzCpC,SAAkDA,GAAajiB,EAAEsgB,IACjEW,GACJiB,YAAahH,EAAgBmJ,EAAUD,EACvClD,OAAQA,EACRe,YAGE9gB,KAAKuhB,YACPvhB,KAAKF,MAAMugB,WAAYnf,IAAGG,KAAKye,GACtB9f,KAAKwhB,iBACdxhB,KAAKF,MAAM+f,cAAc7f,KAAKwhB,iBAAkB1B,GAEhD9f,KAAKF,MAAMmgB,eAAeH,GAG5B9f,KAAKmjB,sBAGCtjB,sBACNG,KAAKuhB,eACLvhB,KAAKwhB,iBAAmB,KACxBxhB,KAAKyhB,eAAiB,KACtBzhB,KAAK0hB,cAAgB,SE3JzB,MAAM0B,GAAyB7jB,OAAAmU,EAAA,KAAAnU,CAAO2W;;;EAKhCmN,GAAyB9jB,OAAAmU,EAAA,KAAAnU,CAAO2hB;;;ECjDtC7hB,EAAAC,gBDa2CwM,EAAAlM,UACzCC,SACE,OACEiM,EAAAxL,cAAC8iB,IACC3M,YACE3K,EAAAxL,cAACyV,EAAU,KACTjK,EAAAxL,cAAC6X,EAAW,OAGhB/B,wBAAyB,IACzBM,aACE5K,EAAAxL,cAACwL,EAAA8K,SAAc,KACb9K,EAAAxL,cAACyV,EAAU,KACTjK,EAAAxL,cAACuY,EAAc,OAEjB/M,EAAAxL,cAACyV,EAAU,KACTjK,EAAAxL,cAACgZ,EAAQ,OAEXxN,EAAAxL,cAACyV,EAAU,KACTjK,EAAAxL,cAACoZ,EAAkB,QAIzBpD,yBAA0B,KAE1BxK,EAAAxL,cAAC+iB,GAAsB,UAAAC,GAAA,SAAAzkB,EAAAC,GEvC/BY,EAAAuQ,QAAA","file":"client.e3c9eb77790ff399e5a9.bundle.js","sourcesContent":["import { NodeDefinition } from \"./types\";\r\n\r\nexport * from \"./types\";\r\n\r\n// Many of these art assets used in these files are public domain and sourced from\r\n//  https://commons.wikimedia.org/wiki/Logic_gates_unified_symbols\r\n// Some assets have been modified for formatting or added functionality.\r\n// Assets that have been pulled from external sources are marked as such.\r\n\r\nexport const NodeTypes = {\r\n  and: require(\"./node-and\").default as NodeDefinition,\r\n  or: require(\"./node-or\").default as NodeDefinition,\r\n  nor: require(\"./node-nor\").default as NodeDefinition,\r\n  not: require(\"./node-not\").default as NodeDefinition,\r\n  buffer: require(\"./node-buffer\").default as NodeDefinition,\r\n  led: require(\"./node-led\").default as NodeDefinition,\r\n  toggle: require(\"./node-toggle\").default as NodeDefinition,\r\n  seg7: require(\"./node-seg7\").default as NodeDefinition\r\n};\r\nexport type NodeType = keyof typeof NodeTypes;\r\n","export const isProd = process.env.NODE_ENV === \"production\";\r\nexport const isDev = process.env.NODE_ENV === \"development\";\r\n","import * as React from \"react\";\r\n\r\nimport { hot } from \"react-hot-loader\";\r\n\r\nimport { isDev } from \"@/env\";\r\n\r\nimport CircuitEditor from \"@/pages/CircuitEditor\";\r\nimport Intro from \"@/pages/Intro\";\r\n\r\ntype Props = {};\r\ninterface State {\r\n  introShown: boolean;\r\n}\r\nclass App extends React.Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      introShown: isDev\r\n    };\r\n\r\n    this._onIntroDismiss = this._onIntroDismiss.bind(this);\r\n  }\r\n\r\n  render() {\r\n    if (!this.state.introShown) {\r\n      return <Intro dismiss={this._onIntroDismiss} />;\r\n    }\r\n    return <CircuitEditor />;\r\n  }\r\n\r\n  private _onIntroDismiss() {\r\n    this.setState({\r\n      introShown: true\r\n    });\r\n  }\r\n}\r\n\r\nexport default hot(module)(App);\r\n","import { Point, Size, Rectangle } from \"@/types\";\r\n\r\nexport function normalizeRectangle(p1: Point, p2: Point): Rectangle;\r\nexport function normalizeRectangle(r: Rectangle): Rectangle;\r\nexport function normalizeRectangle(...args: any[]): Rectangle {\r\n  let p1: Point;\r\n  let p2: Point;\r\n  if (args.length === 1) {\r\n    const r = args[0] as Rectangle;\r\n    (p1 = r.p1), (p2 = r.p2);\r\n  } else {\r\n    p1 = args[0] as Point;\r\n    p2 = args[1] as Point;\r\n  }\r\n  return {\r\n    p1: {\r\n      x: Math.min(p1.x, p2.x),\r\n      y: Math.min(p1.y, p2.y)\r\n    },\r\n    p2: {\r\n      x: Math.max(p1.x, p2.x),\r\n      y: Math.max(p1.y, p2.y)\r\n    }\r\n  };\r\n}\r\n\r\nexport function pointSubtract(p1: Point, p2: Point): Point {\r\n  return {\r\n    x: p1.x - p2.x,\r\n    y: p1.y - p2.y\r\n  };\r\n}\r\n\r\nexport function calcSize(r: Rectangle): Size {\r\n  r = normalizeRectangle(r);\r\n  return {\r\n    width: r.p2.x - r.p1.x,\r\n    height: r.p2.y - r.p1.y\r\n  };\r\n}\r\n\r\nexport function intersects(r1: Rectangle, r2: Rectangle) {\r\n  r1 = normalizeRectangle(r1);\r\n  r2 = normalizeRectangle(r2);\r\n\r\n  // r1 starts after p2's extent, or does not reach r2's start.\r\n  if (r1.p1.x > r2.p2.x || r1.p2.x < r2.p1.x) {\r\n    return false;\r\n  }\r\n\r\n  // r1 starts after p2's extent, or does not reach r2's start.\r\n  if (r1.p1.y > r2.p2.y || r1.p2.y < r2.p1.y) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n","import { IDMap } from \"@/types\";\r\n\r\nimport { Node, NodesById, NodePinTransition, TransitionWindow } from \"./types\";\r\n\r\nimport { NodeType } from \"./node-types\";\r\n\r\nexport interface SimulatorState {\r\n  /**\r\n   * The current tick the simulator is on.\r\n   */\r\n  tick: number;\r\n\r\n  /**\r\n   * A map of nodes by node id.\r\n   */\r\n  nodesById: NodesById;\r\n\r\n  /**\r\n   * A map of node states by node id.\r\n   */\r\n  nodeStatesByNodeId: IDMap<any>;\r\n\r\n  /**\r\n   * A map of output-to-value maps by node id.\r\n   */\r\n  nodeOutputValuesByNodeId: IDMap<IDMap<boolean>>;\r\n\r\n  /**\r\n   * A map of the the ids of the pending transitions for a node by node id.\r\n   */\r\n  nodeOutputTransitionsByNodeId: IDMap<IDMap<string>>;\r\n\r\n  // Not entirely happy having this on the state, since it is\r\n  //  highly transient and has a lot of churn.\r\n  // However, this greatly simplifies the one-transition-per-pin logic.\r\n  //  Without this, either the logic to add or logic to apply transitions would have\r\n  //  to do a deep scan of the other's state data.\r\n  // Note: turns out one-transition-per-pin is \"intertial\" delay,\r\n  //  while some elements have a \"buffer\" delay.\r\n  /**\r\n   * A map of pending transitions by id.\r\n   */\r\n  transitionsById: IDMap<NodePinTransition>;\r\n\r\n  /**\r\n   * Transition windows in ascending order of tick.\r\n   */\r\n  transitionWindows: TransitionWindow[];\r\n}\r\n\r\nexport const defaultSimulatorState: SimulatorState = {\r\n  tick: 0,\r\n  nodesById: {},\r\n  nodeStatesByNodeId: {},\r\n  nodeOutputValuesByNodeId: {},\r\n  nodeOutputTransitionsByNodeId: {},\r\n  transitionsById: {},\r\n  transitionWindows: []\r\n};\r\n","import { Point, IDMap } from \"@/types\";\r\n\r\nexport interface CircuitFieldState {\r\n  dragMode: null | \"move\" | \"select\";\r\n  dragStart: Point | null;\r\n  dragEnd: Point | null;\r\n}\r\n\r\nexport const defaultCircuitFieldState: CircuitFieldState = {\r\n  dragMode: null,\r\n  dragStart: null,\r\n  dragEnd: null\r\n};\r\n","import { Point, Size, IDMap } from \"@/types\";\r\n\r\nimport {\r\n  CircuitFieldState,\r\n  defaultCircuitFieldState\r\n} from \"./ContentViews/CircuitField/state\";\r\n\r\nimport { ClipboardNode } from \"./types\";\r\n\r\nexport interface CircuitEditorState {\r\n  clipboardContent: ClipboardNode[];\r\n  nodePositions: IDMap<Point>;\r\n  mouseOverNodeId: string | null;\r\n  selectedNodeIds: string[];\r\n  circuitField: CircuitFieldState;\r\n}\r\n\r\nexport const defaultCircuitEditorState: CircuitEditorState = {\r\n  clipboardContent: [],\r\n  nodePositions: {},\r\n  mouseOverNodeId: null,\r\n  selectedNodeIds: [],\r\n  circuitField: defaultCircuitFieldState\r\n};\r\n","import {\r\n  SimulatorState,\r\n  defaultSimulatorState\r\n} from \"@/services/simulator/state\";\r\n\r\nimport {\r\n  CircuitEditorState,\r\n  defaultCircuitEditorState\r\n} from \"@/pages/CircuitEditor/state\";\r\n\r\nexport type GetState = () => AppState;\r\n\r\nexport interface AppState {\r\n  services: {\r\n    simulator: SimulatorState;\r\n  };\r\n  ui: {\r\n    circuitEditor: CircuitEditorState;\r\n  };\r\n}\r\n\r\nexport const defaultAppState: AppState = {\r\n  services: {\r\n    simulator: defaultSimulatorState\r\n  },\r\n  ui: {\r\n    circuitEditor: defaultCircuitEditorState\r\n  }\r\n};\r\n","import { mapValues } from \"lodash-es\";\r\nimport produce from \"immer\";\r\n\r\nimport { AddNodeAction } from \"../actions\";\r\nimport { NodeTypes } from \"../node-types\";\r\nimport { SimulatorState } from \"../state\";\r\n\r\nexport function addNodeMutator(state: SimulatorState, action: AddNodeAction) {\r\n  const { nodeId: id, nodeType: type } = action.payload;\r\n\r\n  const def = NodeTypes[type];\r\n  if (!def) {\r\n    return;\r\n  }\r\n\r\n  const { nodesById, nodeStatesByNodeId, nodeOutputValuesByNodeId } = state;\r\n\r\n  nodesById[id] = {\r\n    id,\r\n    type,\r\n    inputConnectionsByPin: mapValues(def.inputs, () => null),\r\n    outputConnectionsByPin: mapValues(def.outputs, () => [])\r\n  };\r\n\r\n  const result = def.evolve\r\n    ? def.evolve(undefined, mapValues(def.inputs, () => false), state.tick)\r\n    : {};\r\n\r\n  nodeStatesByNodeId[id] = result.state || {};\r\n  nodeOutputValuesByNodeId[id] = result.transitions\r\n    ? mapValues(result.transitions, x => x.value)\r\n    : mapValues(def.outputs, () => false);\r\n}\r\n\r\nexport default produce(addNodeMutator);\r\n","import binarySearch from \"binary-search\";\r\nimport uuidV4 from \"uuid/v4\";\r\n\r\nimport { IDMap } from \"@/types\";\r\n\r\nimport { SimulatorState } from \"../state\";\r\n\r\nimport { Node, TransitionWindow } from \"../types\";\r\nimport { NodeTypes, EvolutionResult } from \"../node-types\";\r\n\r\nexport function collectNodeTransitionsMutator(\r\n  state: SimulatorState,\r\n  nodeId: string\r\n) {\r\n  const {\r\n    tick,\r\n    nodeStatesByNodeId,\r\n    nodeOutputValuesByNodeId,\r\n    transitionWindows\r\n  } = state;\r\n\r\n  const node = state.nodesById[nodeId];\r\n  if (!node) {\r\n    return;\r\n  }\r\n\r\n  // Evolve with the new inputs.\r\n  const type = NodeTypes[node.type];\r\n  if (!type || !type.evolve) {\r\n    return;\r\n  }\r\n\r\n  // Build the current input state from the connected pins.\r\n  const inputs: IDMap<boolean> = {};\r\n  for (const inputPin of Object.keys(node.inputConnectionsByPin)) {\r\n    const inputConn = node.inputConnectionsByPin[inputPin];\r\n    if (!inputConn) {\r\n      inputs[inputPin] = false;\r\n      continue;\r\n    }\r\n    const { nodeId: sourceNodeId, pin: sourcePin } = inputConn;\r\n\r\n    inputs[inputPin] = nodeOutputValuesByNodeId[sourceNodeId][sourcePin];\r\n  }\r\n\r\n  // TODO: Provide frozen state.  The state passed to this is currently\r\n  //  the immer mutable record.\r\n  const result = type.evolve(nodeStatesByNodeId[node.id], inputs, tick);\r\n\r\n  if (result.state) {\r\n    nodeStatesByNodeId[node.id] = result.state;\r\n  }\r\n\r\n  if (result.transitions) {\r\n    const nodeOutputs = nodeOutputValuesByNodeId[node.id] || {};\r\n    for (const outputId of Object.keys(result.transitions)) {\r\n      const { tickOffset, value } = result.transitions[outputId];\r\n\r\n      // Sanity check that we are not producing transitions for the past or current tick.\r\n      const transitionTick = tick + (tickOffset > 0 ? tickOffset : 1);\r\n\r\n      removeTransitionMutator(state, node.id, outputId);\r\n\r\n      if (nodeOutputs[outputId] !== value) {\r\n        addTransitionMutator(state, node.id, outputId, transitionTick, value);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction addTransitionMutator(\r\n  state: SimulatorState,\r\n  nodeId: string,\r\n  outputId: string,\r\n  tick: number,\r\n  value: boolean\r\n) {\r\n  const {\r\n    nodeOutputTransitionsByNodeId,\r\n    transitionsById,\r\n    transitionWindows\r\n  } = state;\r\n\r\n  const transitionId = uuidV4();\r\n\r\n  transitionsById[transitionId] = {\r\n    id: transitionId,\r\n    nodeId,\r\n    outputId,\r\n    tick,\r\n    value\r\n  };\r\n\r\n  let nodeTransitions = nodeOutputTransitionsByNodeId[nodeId];\r\n  if (!nodeTransitions) {\r\n    nodeTransitions = {};\r\n    nodeOutputTransitionsByNodeId[nodeId] = nodeTransitions;\r\n  }\r\n\r\n  nodeTransitions[outputId] = transitionId;\r\n\r\n  const transitionWindow = getWindow(transitionWindows, tick);\r\n  transitionWindow.transitionIds.push(transitionId);\r\n}\r\n\r\nfunction removeTransitionMutator(\r\n  state: SimulatorState,\r\n  nodeId: string,\r\n  outputId: string\r\n) {\r\n  const {\r\n    nodeOutputTransitionsByNodeId,\r\n    transitionsById,\r\n    transitionWindows\r\n  } = state;\r\n\r\n  const pinTransitions = nodeOutputTransitionsByNodeId[nodeId];\r\n  if (!pinTransitions) {\r\n    return;\r\n  }\r\n\r\n  const transitionId = pinTransitions[outputId];\r\n  if (!transitionId) {\r\n    return;\r\n  }\r\n\r\n  // Remove the transition from the node output transitions\r\n  delete pinTransitions[outputId];\r\n\r\n  const transition = transitionsById[transitionId];\r\n  if (!transition) {\r\n    return;\r\n  }\r\n\r\n  // Remove the transition from the transitions map.\r\n  delete transitionsById[transitionId];\r\n\r\n  const transitionWindowIndex = transitionWindows.findIndex(\r\n    x => x.tick === transition.tick\r\n  );\r\n  if (transitionWindowIndex === -1) {\r\n    return;\r\n  }\r\n  const transitionWindow = transitionWindows[transitionWindowIndex];\r\n\r\n  const tickWindowTransitionIndex = transitionWindow.transitionIds.indexOf(\r\n    transitionId\r\n  );\r\n  if (tickWindowTransitionIndex === -1) {\r\n    return;\r\n  }\r\n  if (transitionWindow.transitionIds.length === 1) {\r\n    // Only one element left, remove the window.\r\n    transitionWindows.splice(transitionWindowIndex, 1);\r\n  } else {\r\n    // Remove the transition from the tick window.\r\n    transitionWindow.transitionIds.splice(tickWindowTransitionIndex, 1);\r\n  }\r\n}\r\n\r\nfunction getWindow(\r\n  windows: TransitionWindow[],\r\n  tick: number\r\n): TransitionWindow {\r\n  const index = binarySearch(windows, tick, (a, b) => a.tick - b);\r\n  if (index >= 0) {\r\n    return windows[index];\r\n  }\r\n\r\n  const insertAt = -index - 1;\r\n  const result: TransitionWindow = {\r\n    tick,\r\n    transitionIds: []\r\n  };\r\n  windows.splice(insertAt, 0, result);\r\n  return result;\r\n}\r\n","import produce from \"immer\";\r\n\r\nimport { SimulatorState } from \"../state\";\r\nimport { WireNodeAction } from \"../actions\";\r\n\r\nimport { collectNodeTransitionsMutator } from \"./collect-transitions\";\r\n\r\nexport function wireNodeMutator(state: SimulatorState, action: WireNodeAction) {\r\n  const { sourceNodeId, sourcePin, targetNodeId, targetPin } = action.payload;\r\n\r\n  const sourceNode = state.nodesById[sourceNodeId];\r\n  const targetNode = state.nodesById[targetNodeId];\r\n\r\n  if (!sourceNode || !targetNode) {\r\n    return;\r\n  }\r\n\r\n  // Only one source per input.\r\n  if (targetNode.inputConnectionsByPin[targetPin]) {\r\n    return;\r\n  }\r\n\r\n  // Tell the target about the source.\r\n  targetNode.inputConnectionsByPin[targetPin] = {\r\n    nodeId: sourceNodeId,\r\n    pin: sourcePin\r\n  };\r\n\r\n  // Tell the source about the target.\r\n  sourceNode.outputConnectionsByPin[sourcePin].push({\r\n    nodeId: targetNodeId,\r\n    pin: targetPin\r\n  });\r\n\r\n  collectNodeTransitionsMutator(state, targetNodeId);\r\n}\r\n\r\nexport default produce(wireNodeMutator);\r\n","import produce from \"immer\";\r\n\r\nimport { SimulatorState } from \"../state\";\r\nimport { UnwireNodeAction } from \"../actions\";\r\n\r\nimport { collectNodeTransitionsMutator } from \"./collect-transitions\";\r\n\r\nexport function unwireNodeMutator(\r\n  state: SimulatorState,\r\n  action: UnwireNodeAction\r\n) {\r\n  const { sourceNodeId, sourcePin, targetNodeId, targetPin } = action.payload;\r\n\r\n  const sourceNode = state.nodesById[sourceNodeId];\r\n  const targetNode = state.nodesById[targetNodeId];\r\n\r\n  if (!sourceNode || !targetNode) {\r\n    return;\r\n  }\r\n\r\n  const targetConn = targetNode.inputConnectionsByPin[targetPin];\r\n  if (!targetConn) {\r\n    return;\r\n  }\r\n\r\n  if (targetConn.nodeId !== sourceNodeId || targetConn.pin !== sourcePin) {\r\n    return;\r\n  }\r\n  targetNode.inputConnectionsByPin[targetPin] = null;\r\n\r\n  const outConns = sourceNode.outputConnectionsByPin[sourcePin];\r\n  if (!outConns) {\r\n    return;\r\n  }\r\n\r\n  const sourceConnIndex = outConns.findIndex(\r\n    c => c.nodeId === targetNodeId && c.pin === targetPin\r\n  );\r\n  if (sourceConnIndex === -1) {\r\n    return;\r\n  }\r\n  outConns.splice(sourceConnIndex, 1);\r\n\r\n  collectNodeTransitionsMutator(state, targetNodeId);\r\n}\r\n\r\nexport default produce(unwireNodeMutator);\r\n","import produce from \"immer\";\r\n\r\nimport { SimulatorState } from \"../state\";\r\nimport { InteractNodeAction } from \"../actions\";\r\nimport { NodeTypes } from \"../node-types\";\r\n\r\nimport { collectNodeTransitionsMutator } from \"./collect-transitions\";\r\n\r\nexport function interactNodeMutator(\r\n  state: SimulatorState,\r\n  action: InteractNodeAction\r\n) {\r\n  const { nodeId } = action.payload;\r\n  const { nodesById, nodeStatesByNodeId } = state;\r\n\r\n  const node = nodesById[nodeId];\r\n  const type = NodeTypes[node.type];\r\n  if (!type || !type.interact) {\r\n    return;\r\n  }\r\n\r\n  const nodeState = nodeStatesByNodeId[nodeId];\r\n  const newState = type.interact(nodeStatesByNodeId[nodeId]);\r\n  nodeStatesByNodeId[nodeId] = newState;\r\n\r\n  collectNodeTransitionsMutator(state, nodeId);\r\n}\r\n\r\nexport default produce(interactNodeMutator);\r\n","import produce from \"immer\";\r\n\r\nimport { EvolveSimAction } from \"../actions\";\r\nimport { SimulatorState } from \"../state\";\r\n\r\nimport { collectNodeTransitionsMutator } from \"./collect-transitions\";\r\n\r\nexport function evolveSimMutator(\r\n  state: SimulatorState,\r\n  action: EvolveSimAction\r\n) {\r\n  const { tickCount } = action.payload;\r\n  const {\r\n    tick,\r\n    nodesById,\r\n    nodeOutputTransitionsByNodeId,\r\n    nodeOutputValuesByNodeId,\r\n    transitionsById,\r\n    transitionWindows\r\n  } = state;\r\n\r\n  const endTick = tick + tickCount;\r\n\r\n  // For each window within our update range...\r\n  const iterator = takeWhile(\r\n    transitionWindows,\r\n    window => window.tick <= endTick\r\n  );\r\n\r\n  let saftyCutoff = tickCount * 4;\r\n\r\n  for (const window of iterator) {\r\n    // Update the current tick, as it is referenced\r\n    //  during transition collection.\r\n    state.tick = window.tick;\r\n\r\n    const updateNodes = new Set<string>();\r\n\r\n    for (const tid of window.transitionIds) {\r\n      const { nodeId, outputId, value } = transitionsById[tid];\r\n\r\n      const node = nodesById[nodeId];\r\n      if (!node) {\r\n        continue;\r\n      }\r\n\r\n      // Transition is now applied and no longer tracked, remove it from the list.\r\n      delete transitionsById[tid];\r\n\r\n      // This should be safe if everything stays in sync.\r\n      //  We only allow one transition per id, and this to be it.\r\n      delete nodeOutputTransitionsByNodeId[nodeId][outputId];\r\n\r\n      nodeOutputValuesByNodeId[nodeId][outputId] = value;\r\n\r\n      for (const outConn of node.outputConnectionsByPin[outputId]) {\r\n        updateNodes.add(outConn.nodeId);\r\n      }\r\n    }\r\n\r\n    for (const nodeId of updateNodes) {\r\n      collectNodeTransitionsMutator(state, nodeId);\r\n    }\r\n\r\n    if (--saftyCutoff <= 0) {\r\n      console.error(\r\n        \"Safty threshold exceeded for sim tick window consumption.  This indicates new windows are being created under the currently-executing tick.\"\r\n      );\r\n      break;\r\n    }\r\n  }\r\n\r\n  // Zip the tick to the last tick we ran for.\r\n  //  This may not be the last tick we performed, if there were no transitions\r\n  //  between our last tick and desired end tick.\r\n  state.tick = endTick;\r\n}\r\n\r\nexport default produce(evolveSimMutator);\r\n\r\nfunction* takeWhile<T>(\r\n  items: T[],\r\n  predicate: (item: T) => boolean\r\n): IterableIterator<T> {\r\n  while (items.length > 0) {\r\n    const item = items[0];\r\n    if (!predicate(item)) {\r\n      break;\r\n    }\r\n    const nextItem = items.shift()!;\r\n    yield nextItem;\r\n  }\r\n}\r\n\r\nfunction popWhile<T>(items: T[], pickWhile: (item: T) => boolean): T[] {\r\n  const result = [];\r\n  for (const item of items) {\r\n    if (!pickWhile(item)) {\r\n      break;\r\n    }\r\n    result.push(item);\r\n  }\r\n\r\n  items.splice(0, result.length);\r\n\r\n  return result;\r\n}\r\n","import { SimulatorState, defaultSimulatorState } from \"../state\";\r\n\r\nimport {\r\n  SimulatorAction,\r\n  ACTION_WIRE,\r\n  ACTION_UNWIRE,\r\n  ACTION_TOGGLEWIRE,\r\n  ACTION_EVOLVE,\r\n  ACTION_FASTFORWARD,\r\n  ACTION_INTERACT,\r\n  ACTION_NODE_ADD\r\n} from \"../actions\";\r\n\r\nimport { isWired } from \"../helpers\";\r\n\r\nimport addNodeReducer from \"./add-node\";\r\nimport wireNodeReducer from \"./wire-node\";\r\nimport unwireNodeReducer from \"./unwire-node\";\r\nimport interactNodeReducer from \"./interact-node\";\r\nimport evolveSimReducer from \"./evolve-sim\";\r\nimport fastForwardReducer from \"./fast-forward-sim\";\r\n\r\nexport default function simulatorReducer(\r\n  state: SimulatorState = defaultSimulatorState,\r\n  action: SimulatorAction\r\n): SimulatorState {\r\n  switch (action.type) {\r\n    case ACTION_NODE_ADD:\r\n      return addNodeReducer(state, action);\r\n    case ACTION_WIRE:\r\n      return wireNodeReducer(state, action);\r\n    case ACTION_UNWIRE:\r\n      return unwireNodeReducer(state, action);\r\n    case ACTION_TOGGLEWIRE:\r\n      const {\r\n        sourceNodeId,\r\n        sourcePin,\r\n        targetNodeId,\r\n        targetPin\r\n      } = action.payload;\r\n      if (\r\n        isWired(\r\n          state.nodesById,\r\n          { nodeId: sourceNodeId, pin: sourcePin },\r\n          { nodeId: targetNodeId, pin: targetPin }\r\n        )\r\n      ) {\r\n        return unwireNodeReducer(state, {\r\n          type: ACTION_UNWIRE,\r\n          payload: action.payload\r\n        });\r\n      } else {\r\n        return wireNodeReducer(state, {\r\n          type: ACTION_WIRE,\r\n          payload: action.payload\r\n        });\r\n      }\r\n    case ACTION_INTERACT:\r\n      return interactNodeReducer(state, action);\r\n    case ACTION_EVOLVE:\r\n      return evolveSimReducer(state, action);\r\n    case ACTION_FASTFORWARD:\r\n      return fastForwardReducer(state, action);\r\n  }\r\n  return state;\r\n}\r\n","import produce from \"immer\";\r\n\r\nimport { AddNodeAction } from \"@/services/simulator/actions\";\r\n\r\nimport { CircuitEditorState } from \"../state\";\r\n\r\nconst addNodeReducer = produce(\r\n  (state: CircuitEditorState, action: AddNodeAction) => {\r\n    const { nodeId: id, x = 0, y = 0 } = action.payload;\r\n    state.nodePositions[id] = {\r\n      x,\r\n      y\r\n    };\r\n  }\r\n);\r\nexport default addNodeReducer;\r\n","import produce from \"immer\";\r\n\r\nimport { HoverNodeAction } from \"../actions\";\r\nimport { CircuitEditorState } from \"../state\";\r\n\r\nconst hoverNodeReducer = produce(\r\n  (state: CircuitEditorState, action: HoverNodeAction) => {\r\n    state.mouseOverNodeId = action.payload.nodeId;\r\n  }\r\n);\r\nexport default hoverNodeReducer;\r\n","import produce from \"immer\";\r\nimport { mapValues, pick } from \"lodash-es\";\r\n\r\nimport { MoveNodeAction } from \"../actions\";\r\nimport { CircuitEditorState } from \"../state\";\r\n\r\nconst moveSelectedNodesReducer = produce(\r\n  (state: CircuitEditorState, action: MoveNodeAction) => {\r\n    const { offsetX, offsetY } = action.payload;\r\n    const { nodePositions, selectedNodeIds } = state;\r\n    state.nodePositions = {\r\n      ...nodePositions,\r\n      ...mapValues(pick(nodePositions, selectedNodeIds), p => ({\r\n        x: p.x + offsetX,\r\n        y: p.y + offsetY\r\n      }))\r\n    };\r\n  }\r\n);\r\nexport default moveSelectedNodesReducer;\r\n","import produce from \"immer\";\r\n\r\nimport { map, mapValues, zipObject } from \"lodash-es\";\r\nimport uuidV4 from \"uuid/v4\";\r\n\r\nimport { AppState } from \"@/store\";\r\nimport { pointSubtract } from \"@/geometry\";\r\nimport { typedKeys } from \"@/utils\";\r\nimport { Point } from \"@/types\";\r\n\r\nimport { CircuitEditorState, defaultCircuitEditorState } from \"../state\";\r\nimport { CopySelectedAction } from \"../actions\";\r\nimport { selectedNodesById as selectedNodesByIdSelector } from \"../selectors\";\r\nimport { ClipboardNode } from \"../types\";\r\n\r\nfunction copySelectedMutator(\r\n  state: CircuitEditorState = defaultCircuitEditorState,\r\n  action: CopySelectedAction,\r\n  appState: AppState\r\n) {\r\n  const { selectedNodeIds, nodePositions } = state;\r\n  const { nodesById } = appState.services.simulator;\r\n\r\n  if (selectedNodeIds.length === 0) {\r\n    return;\r\n  }\r\n\r\n  const copyIds = zipObject(\r\n    selectedNodeIds,\r\n    map(selectedNodeIds, () => uuidV4())\r\n  );\r\n\r\n  function nodeIsSelected(id: string): boolean {\r\n    return selectedNodeIds.findIndex(x => x === id) !== -1;\r\n  }\r\n\r\n  const rootPosition = nodePositions[selectedNodeIds[0]];\r\n\r\n  const copyNodes: ClipboardNode[] = selectedNodeIds.map(id => {\r\n    const node = nodesById[id];\r\n    const copyNode: ClipboardNode = {\r\n      id: copyIds[id],\r\n      type: node.type,\r\n      offset: pointSubtract(nodePositions[id], rootPosition),\r\n      outputs: mapValues(node.outputConnectionsByPin, conns =>\r\n        conns\r\n          .filter(x => nodeIsSelected)\r\n          .map(c => ({ nodeId: copyIds[c.nodeId], pin: c.pin }))\r\n      )\r\n    };\r\n    return copyNode;\r\n  });\r\n\r\n  state.clipboardContent = copyNodes;\r\n}\r\n\r\nexport default function copySelectedReduxcer(\r\n  state: CircuitEditorState = defaultCircuitEditorState,\r\n  action: CopySelectedAction,\r\n  appState: AppState\r\n) {\r\n  return produce(state, s => copySelectedMutator(s, action, appState));\r\n}\r\n","import { union, difference } from \"lodash-es\";\r\n\r\nimport { SelectionMode } from \"../actions\";\r\n\r\nexport function combineSelection(\r\n  selectedIds: string[],\r\n  chosenIds: string[],\r\n  mode: SelectionMode\r\n) {\r\n  switch (mode) {\r\n    case \"set\":\r\n      return chosenIds;\r\n    case \"append\":\r\n      return union(selectedIds, chosenIds);\r\n    case \"remove\":\r\n      return difference(selectedIds, chosenIds);\r\n    case \"toggle\": {\r\n      return difference(selectedIds, chosenIds).concat(\r\n        difference(chosenIds, selectedIds)\r\n      );\r\n    }\r\n  }\r\n\r\n  return chosenIds;\r\n}\r\n","import produce from \"immer\";\r\n\r\nimport { SelectNodesAction } from \"../actions\";\r\nimport { CircuitEditorState } from \"../state\";\r\n\r\nimport { combineSelection } from \"./utils\";\r\n\r\nconst selectNodesReducer = produce(\r\n  (state: CircuitEditorState, action: SelectNodesAction) => {\r\n    const { nodeIds, mode } = action.payload;\r\n    state.selectedNodeIds = combineSelection(\r\n      state.selectedNodeIds,\r\n      nodeIds,\r\n      mode\r\n    );\r\n  }\r\n);\r\nexport default selectNodesReducer;\r\n","import produce from \"immer\";\r\n\r\nimport { ClearSelectionAction } from \"../actions\";\r\nimport { CircuitEditorState } from \"../state\";\r\n\r\nconst clearSelectionReducer = produce(\r\n  (state: CircuitEditorState, action: ClearSelectionAction) => {\r\n    state.selectedNodeIds = [];\r\n  }\r\n);\r\nexport default clearSelectionReducer;\r\n","import produce from \"immer\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nimport { SimulatorAction, ACTION_NODE_ADD } from \"@/services/simulator/actions\";\r\n\r\nimport {\r\n  CircuitEditorAction,\r\n  ACTION_NODE_HOVER,\r\n  ACTION_MOVE_SELECTED,\r\n  ACTION_COPY_SELECTED,\r\n  ACTION_SELECT_REGION,\r\n  ACTION_SELECT_CLEAR,\r\n  ACTION_SELECT_NODES\r\n} from \"../actions\";\r\nimport { CircuitEditorState, defaultCircuitEditorState } from \"../state\";\r\n\r\nimport circuitFieldReducer from \"../ContentViews/CircuitField/reducer\";\r\n\r\nimport addNodeReducer from \"./add-node\";\r\nimport mouseOverNodeReducer from \"./hover-node\";\r\nimport moveSelectedNodesReducer from \"./move-selected-nodes\";\r\nimport copySelectedNodesReducer from \"./copy-selected-nodes\";\r\nimport selectNodesReducer from \"./select-nodes\";\r\nimport selectRegionReducer from \"./select-region\";\r\nimport clearSelectionReducer from \"./clear-selection\";\r\nimport { AnyAction } from \"redux\";\r\n\r\nexport default function circuitEditorReducer(\r\n  state: CircuitEditorState = defaultCircuitEditorState,\r\n  action: CircuitEditorAction | SimulatorAction,\r\n  appState: AppState\r\n): CircuitEditorState {\r\n  const newCircuitFieldState = circuitFieldReducer(\r\n    state.circuitField,\r\n    action as AnyAction\r\n  );\r\n  if (newCircuitFieldState != state.circuitField) {\r\n    state = {\r\n      ...state,\r\n      circuitField: newCircuitFieldState\r\n    };\r\n  }\r\n\r\n  switch (action.type) {\r\n    case ACTION_NODE_ADD:\r\n      return addNodeReducer(state, action);\r\n    case ACTION_NODE_HOVER:\r\n      return mouseOverNodeReducer(state, action);\r\n    case ACTION_MOVE_SELECTED:\r\n      return moveSelectedNodesReducer(state, action);\r\n    case ACTION_COPY_SELECTED:\r\n      return copySelectedNodesReducer(state, action, appState);\r\n    case ACTION_SELECT_NODES:\r\n      return selectNodesReducer(state, action);\r\n    case ACTION_SELECT_REGION:\r\n      return selectRegionReducer(state, action, appState);\r\n    case ACTION_SELECT_CLEAR:\r\n      return clearSelectionReducer(state, action);\r\n  }\r\n  return state;\r\n}\r\n","import {\r\n  CircuitFieldAction,\r\n  ACTION_DRAG_START,\r\n  ACTION_DRAG_CONTINUE,\r\n  ACTION_DRAG_END\r\n} from \"./actions\";\r\nimport { CircuitFieldState, defaultCircuitFieldState } from \"./state\";\r\n\r\nexport default function circuitFieldReducer(\r\n  state: CircuitFieldState = defaultCircuitFieldState,\r\n  action: CircuitFieldAction\r\n): CircuitFieldState {\r\n  switch (action.type) {\r\n    case ACTION_DRAG_START: {\r\n      const { dragMode, x, y } = action.payload;\r\n      return {\r\n        ...state,\r\n        dragMode,\r\n        dragStart: {\r\n          x,\r\n          y\r\n        }\r\n      };\r\n    }\r\n    case ACTION_DRAG_CONTINUE: {\r\n      const { x, y } = action.payload;\r\n      return {\r\n        ...state,\r\n        dragEnd: {\r\n          x,\r\n          y\r\n        }\r\n      };\r\n    }\r\n    case ACTION_DRAG_END: {\r\n      return {\r\n        ...state,\r\n        dragMode: null,\r\n        dragStart: null,\r\n        dragEnd: null\r\n      };\r\n    }\r\n  }\r\n  return state;\r\n}\r\n","import produce from \"immer\";\r\n\r\nimport { forOwn } from \"lodash-es\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nimport { intersects } from \"@/geometry\";\r\n\r\nimport { nodeRectsById } from \"../selectors\";\r\n\r\nimport { SelectRegionAction } from \"../actions\";\r\nimport { CircuitEditorState } from \"../state\";\r\n\r\nimport { combineSelection } from \"./utils\";\r\n\r\nexport default function selectRegionReducer(\r\n  state: CircuitEditorState,\r\n  action: SelectRegionAction,\r\n  appState: AppState\r\n) {\r\n  const { region, mode } = action.payload;\r\n\r\n  const rects = nodeRectsById(appState);\r\n  const chosenIds: string[] = [];\r\n  forOwn(rects, (rect, id) => {\r\n    if (intersects(rect, region)) {\r\n      chosenIds.push(id);\r\n    }\r\n  });\r\n\r\n  // State is simple enough that we could\r\n  //  spread-clone here,\r\n  //  but using immer for the freeze/seal behavior.\r\n  return produce(state, state => {\r\n    state.selectedNodeIds = combineSelection(\r\n      state.selectedNodeIds,\r\n      chosenIds,\r\n      mode\r\n    );\r\n  });\r\n}\r\n","import { createStore, compose, applyMiddleware } from \"redux\";\r\nimport thunk from \"redux-thunk\";\r\n\r\nimport reducer from \"./reducer\";\r\n\r\nconst storeComposer = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\nexport const store = createStore(\r\n  reducer,\r\n  storeComposer(applyMiddleware(thunk))\r\n);\r\n","import { Action, combineReducers, AnyAction } from \"redux\";\r\n\r\nimport simulatorReducer from \"@/services/simulator/reducer\";\r\n\r\nimport circuitEditorReducer from \"@/pages/CircuitEditor/reducer\";\r\n\r\nimport { AppState, defaultAppState } from \"./state\";\r\n\r\nexport default function appStateReducer(\r\n  state: AppState = defaultAppState,\r\n  // AnyAction does not work here, as typescript is being far too strict.\r\n  //  AnyAction is defined as {[key: string]: any}, which it claims cannot be converted to {payload: any}\r\n  action: any\r\n) {\r\n  return {\r\n    services: {\r\n      simulator: simulatorReducer(state.services.simulator, action)\r\n    },\r\n    ui: {\r\n      circuitEditor: circuitEditorReducer(state.ui.circuitEditor, action, state)\r\n    }\r\n  };\r\n}\r\n","import { IDMap } from \"@/types\";\r\n\r\nimport { Node, NodePin, NodesById } from \"./types\";\r\nimport { NodeTypes, EvolutionResult } from \"./node-types\";\r\nimport { SimulatorState } from \"./state\";\r\n\r\nexport function isWired(\r\n  nodesById: NodesById,\r\n  output: NodePin,\r\n  input: NodePin\r\n): boolean {\r\n  const inputNode = nodesById[input.nodeId];\r\n\r\n  if (!inputNode) {\r\n    return false;\r\n  }\r\n\r\n  const conn = inputNode.inputConnectionsByPin[input.pin];\r\n  if (!conn) {\r\n    return false;\r\n  }\r\n\r\n  return conn.nodeId === output.nodeId && conn.pin === output.pin;\r\n}\r\n","import {\r\n  SimulatorState,\r\n  defaultSimulatorState\r\n} from \"@/services/simulator/state\";\r\nimport { FastForwardSimAction, evolveSim } from \"@/services/simulator/actions\";\r\n\r\nimport evolveSimReducer from \"./evolve-sim\";\r\n\r\nexport default function fastForwardSimReducer(\r\n  state: SimulatorState = defaultSimulatorState,\r\n  action: FastForwardSimAction\r\n): SimulatorState {\r\n  const { tick, transitionWindows } = state;\r\n\r\n  if (transitionWindows.length === 0) {\r\n    return state;\r\n  }\r\n\r\n  const nextWindowTick = transitionWindows[0].tick - tick;\r\n  return evolveSimReducer(state, evolveSim(nextWindowTick));\r\n}\r\n","import * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\n\r\nimport { Provider } from \"react-redux\";\r\n\r\nimport \"./css\";\r\n\r\nimport { store } from \"./store\";\r\nimport App from \"./components/App\";\r\n\r\nconst rootEl = document.getElementById(\"root\");\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <App />\r\n  </Provider>,\r\n  rootEl\r\n);\r\n","import { createSelector } from \"reselect\";\r\n\r\nimport getBounds from \"svg-path-bounds\";\r\n\r\nimport { mapValues, pick } from \"lodash-es\";\r\n\r\nimport { normalizeRectangle } from \"@/geometry\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nimport {\r\n  nodeDefsById,\r\n  nodeStatesById,\r\n  nodesById\r\n} from \"@/services/simulator/selectors\";\r\nimport { normalizeVisuals } from \"@/services/simulator/node-types/utils\";\r\n\r\nexport const nodePositionsById = (s: AppState) =>\r\n  s.ui.circuitEditor.nodePositions;\r\n\r\nexport const nodeBoundsById = createSelector(\r\n  nodeDefsById,\r\n  nodeStatesById,\r\n  (nodeDefsById, nodeStateById) =>\r\n    mapValues(nodeDefsById, (x, id) => {\r\n      if (x.visual.hitPath) {\r\n        return getBounds(x.visual.hitPath);\r\n      }\r\n      const shapePaths = normalizeVisuals(\r\n        x.visual.shapePath,\r\n        nodeStateById[id]\r\n      );\r\n      if (shapePaths.length > 0) {\r\n        return getBounds(shapePaths[0].path);\r\n      }\r\n      return [0, 0, 0, 0];\r\n    })\r\n);\r\n\r\nexport const nodeRectsById = createSelector(\r\n  nodePositionsById,\r\n  nodeBoundsById,\r\n  (positionsById, boundsById) =>\r\n    mapValues(positionsById, (p1, id) => {\r\n      const bounds = boundsById[id] || [0, 0, 0, 0];\r\n      return normalizeRectangle(\r\n        {\r\n          x: p1.x + bounds[0],\r\n          y: p1.y + bounds[1]\r\n        },\r\n        {\r\n          x: p1.x + bounds[2],\r\n          y: p1.y + bounds[3]\r\n        }\r\n      );\r\n    })\r\n);\r\n\r\nexport const selectedNodeIds = (s: AppState) =>\r\n  s.ui.circuitEditor.selectedNodeIds;\r\n\r\nexport const selectedNodesById = createSelector(\r\n  nodesById,\r\n  selectedNodeIds,\r\n  (nodesById, selectedNodeIds) => pick(nodesById, selectedNodeIds)\r\n);\r\n","import { createSelector } from \"reselect\";\r\n\r\nimport { mapValues, mapKeys } from \"lodash-es\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nimport { NodeTypes } from \"./node-types\";\r\n\r\nexport const nodesById = (s: AppState) => s.services.simulator.nodesById;\r\n\r\nexport const nodeTypesById = (s: AppState) =>\r\n  mapValues(nodesById(s), n => n.type);\r\n\r\nexport const nodeDefsById = (s: AppState) =>\r\n  mapValues(nodeTypesById(s), type => NodeTypes[type] || null);\r\n\r\nexport const nodeStatesById = (s: AppState) =>\r\n  s.services.simulator.nodeStatesByNodeId;\r\n","import { Point } from \"@/types\";\r\n\r\nexport const ACTION_DRAG_START = \"@editor/field/drag/start\" as \"@editor/field/drag/start\";\r\nexport const startDrag = (p: Point, dragMode: \"select\" | \"move\") => ({\r\n  type: ACTION_DRAG_START,\r\n  payload: {\r\n    ...p,\r\n    dragMode\r\n  }\r\n});\r\nexport type StartDragAction = ReturnType<typeof startDrag>;\r\n\r\nexport const ACTION_DRAG_CONTINUE = \"@editor/field/drag/continue\" as \"@editor/field/drag/continue\";\r\nexport const continueDrag = (p: Point) => ({\r\n  type: ACTION_DRAG_CONTINUE,\r\n  payload: p\r\n});\r\nexport type ContinueDragAction = ReturnType<typeof continueDrag>;\r\n\r\nexport const ACTION_DRAG_END = \"@editor/field/drag/end\" as \"@editor/field/drag/end\";\r\nexport const endDrag = () => ({\r\n  type: ACTION_DRAG_END\r\n});\r\nexport type EndDragAction = ReturnType<typeof endDrag>;\r\n\r\nexport type CircuitFieldAction =\r\n  | StartDragAction\r\n  | ContinueDragAction\r\n  | EndDragAction;\r\n","import { typedKeys } from \"@/utils\";\r\n\r\nimport { NodeDefinition, NodeVisualPathDefinition } from \"./types\";\r\n\r\nconst SCALE = 3;\r\nconst OFFSET = [15, 0];\r\n\r\n/**\r\n * Produce a visual path definition of a segment given a series of polygon points.\r\n * The path definition will color itself based on the state key specified by 'name'\r\n * @param name The state key to select color based on.  The key should represent a boolean value.\r\n * @param points An array of [x,y] pairs that make up the polygon.\r\n */\r\nfunction createSeg(\r\n  name: string,\r\n  points: [number, number][]\r\n): NodeVisualPathDefinition {\r\n  const start = points[0];\r\n  let path = `M${start[0] * SCALE + OFFSET[0]},${start[1] * SCALE + OFFSET[1]}`;\r\n  for (let p of points.slice(1)) {\r\n    const [x, y] = p;\r\n    path += `L${x * SCALE + OFFSET[0]},${y * SCALE + OFFSET[1]}`;\r\n  }\r\n  path += \"z\";\r\n  return {\r\n    path,\r\n    fill: state => (state[name] ? \"red\" : \"blue\")\r\n  };\r\n}\r\n\r\nconst seg7NodeDefinition: NodeDefinition = {\r\n  type: \"seg7\",\r\n  visual: {\r\n    hitPath: `V63 H45 V0 z`,\r\n    // https://commons.wikimedia.org/wiki/File:7-segment_abcdefg.svg\r\n    shapePath: [\r\n      createSeg(\"A\", [[1, 1], [2, 0], [8, 0], [9, 1], [8, 2], [2, 2]]),\r\n      createSeg(\"B\", [[9, 1], [10, 2], [10, 8], [9, 9], [8, 8], [8, 2]]),\r\n      createSeg(\"C\", [[9, 9], [10, 10], [10, 16], [9, 17], [8, 16], [8, 10]]),\r\n      createSeg(\"D\", [[9, 17], [8, 18], [2, 18], [1, 17], [2, 16], [8, 16]]),\r\n      createSeg(\"E\", [[1, 17], [0, 16], [0, 10], [1, 9], [2, 10], [2, 16]]),\r\n      createSeg(\"F\", [[1, 9], [0, 8], [0, 2], [1, 1], [2, 2], [2, 8]]),\r\n      createSeg(\"G\", [[1, 9], [2, 8], [8, 8], [9, 9], [8, 10], [2, 10]])\r\n    ]\r\n  },\r\n  inputs: {\r\n    A: {\r\n      name: \"A\",\r\n      x: 0,\r\n      y: 5\r\n    },\r\n    B: {\r\n      name: \"B\",\r\n      x: 0,\r\n      y: 15\r\n    },\r\n    C: {\r\n      name: \"C\",\r\n      x: 0,\r\n      y: 25\r\n    },\r\n    D: {\r\n      name: \"D\",\r\n      x: 0,\r\n      y: 35\r\n    },\r\n    E: {\r\n      name: \"E\",\r\n      x: 0,\r\n      y: 45\r\n    },\r\n    F: {\r\n      name: \"F\",\r\n      x: 0,\r\n      y: 55\r\n    },\r\n    G: {\r\n      name: \"G\",\r\n      x: 0,\r\n      y: 65\r\n    }\r\n  },\r\n  outputs: {},\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      state: { ...inputs }\r\n    };\r\n  }\r\n};\r\nexport default seg7NodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\ninterface ToggleState {\r\n  toggleState: boolean;\r\n}\r\nconst defaultToggleState: ToggleState = {\r\n  toggleState: false\r\n};\r\n\r\nconst toggleSwitchNodeDefinition: NodeDefinition = {\r\n  type: \"toggle\",\r\n  visual: {\r\n    shapePath: {\r\n      path: `M0,0 L0,50 L25,50 L25,0 z`,\r\n      fill: (state: ToggleState) => (state.toggleState ? \"green\" : \"red\")\r\n    }\r\n  },\r\n  inputs: {},\r\n  outputs: {\r\n    OUT: {\r\n      name: \"OUT\",\r\n      x: 25,\r\n      y: 25\r\n    }\r\n  },\r\n  interact(state: ToggleState = defaultToggleState) {\r\n    return {\r\n      ...state,\r\n      toggleState: !state.toggleState\r\n    };\r\n  },\r\n  evolve(state = defaultToggleState, inputs, tick) {\r\n    return {\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 1,\r\n          value: state.toggleState\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default toggleSwitchNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nfunction genCirclePath(cx: number, cy: number, r: number): string {\r\n  return `M ${cx - r}, ${cy}\r\n    a ${r},${r} 0 1,0 ${r * 2},0\r\n    a ${r},${r} 0 1,0 ${-(r * 2)},0`;\r\n}\r\n\r\nconst ledNodeDefinition: NodeDefinition = {\r\n  type: \"led\",\r\n  visual: {\r\n    shapePath: [\r\n      genCirclePath(25, 25, 25),\r\n      {\r\n        path: genCirclePath(25, 25, 20),\r\n        fill: state => (state.value ? \"lightgreen\" : \"darkgreen\")\r\n      }\r\n    ]\r\n  },\r\n  inputs: {\r\n    IN: {\r\n      name: \"IN\",\r\n      x: 0,\r\n      y: 25\r\n    }\r\n  },\r\n  outputs: {},\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      state: {\r\n        value: inputs.IN\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default ledNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nconst bufferNodeDefinition: NodeDefinition = {\r\n  type: \"buffer\",\r\n  visual: {\r\n    hitPath: `\r\n    M 28.96875,2.59375 L 28.96875,5 L 28.96875,45 L 28.96875,47.40625 L 31.125,46.34375 L 72.15625,26.34375 L 75,25 L 72.15625,23.65625 L 31.125,3.65625 L 28.96875,2.59375 z\r\n    `,\r\n    // https://commons.wikimedia.org/wiki/File:Buffer_ANSI.svg\r\n    shapePath: `\r\n      M 72,25 L 95.085706,25\r\n      M 29.043478,25 L 5.0434781,25\r\n      M 28.96875,2.59375 L 28.96875,5 L 28.96875,45 L 28.96875,47.40625 L 31.125,46.34375 L 72.15625,26.34375 L 75,25 L 72.15625,23.65625 L 31.125,3.65625 L 28.96875,2.59375 z M 31.96875,7.40625 L 68.09375,25 L 31.96875,42.59375 L 31.96875,7.40625 z\r\n    `\r\n  },\r\n  inputs: {\r\n    IN: {\r\n      name: \"IN\",\r\n      x: 0,\r\n      y: 25\r\n    }\r\n  },\r\n  outputs: {\r\n    OUT: {\r\n      name: \"OUT\",\r\n      x: 100,\r\n      y: 25\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 2,\r\n          value: inputs.IN\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default bufferNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nconst bufferNodeDefinition: NodeDefinition = {\r\n  type: \"not\",\r\n  visual: {\r\n    hitPath: `\r\n    M28.96875 2.59375v44.8125l2.15625-1.0625 41.03125-20v-2.6875l-41.03125-20-2.15625-1.0625z\r\n    `,\r\n    // https://commons.wikimedia.org/wiki/File:NOT_ANSI.svg\r\n    shapePath: `\r\n      M79.15691 25H95\r\n      M29.043478 25h-24\r\n      M28.96875 2.59375v44.8125l2.15625-1.0625 41.03125-20v-2.6875l-41.03125-20-2.15625-1.0625z\r\n      m3 4.8125L68.09375 25l-36.125 17.59375V7.40625z\r\n      M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z\r\n    `\r\n  },\r\n  inputs: {\r\n    IN: {\r\n      name: \"IN\",\r\n      x: 0,\r\n      y: 25\r\n    }\r\n  },\r\n  outputs: {\r\n    OUT: {\r\n      name: \"OUT\",\r\n      x: 100,\r\n      y: 25\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 4,\r\n          value: !inputs.IN\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default bufferNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nconst norNodeDefinition: NodeDefinition = {\r\n  type: \"nor\",\r\n  visual: {\r\n    hitPath: `\r\n    M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z\r\n    `,\r\n    // https://commons.wikimedia.org/wiki/File:NOR_ANSI.svg\r\n    shapePath: `\r\n      M79 25h16M31 15H5M32 35H5\r\n      \r\n      M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z\r\n      m5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z\r\n      M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z\r\n    `\r\n  },\r\n  inputs: {\r\n    A: {\r\n      name: \"A\",\r\n      x: 0,\r\n      y: 14.5\r\n    },\r\n    B: {\r\n      name: \"B\",\r\n      x: 0,\r\n      y: 35\r\n    }\r\n  },\r\n  outputs: {\r\n    OUT: {\r\n      name: \"OUT\",\r\n      x: 100,\r\n      y: 25\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 4,\r\n          value: !(inputs.A || inputs.B)\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default norNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nconst orNodeDefinition: NodeDefinition = {\r\n  type: \"or\",\r\n  visual: {\r\n    hitPath: `\r\n    M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z\r\n    `,\r\n    // https://commons.wikimedia.org/wiki/File:OR_ANSI.svg\r\n    shapePath: `\r\n      M70 25h25\r\n      M31 15H5\r\n      M32 35H5\r\n      M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z\r\n      m5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z\r\n    `\r\n  },\r\n  inputs: {\r\n    A: {\r\n      name: \"A\",\r\n      x: 0,\r\n      y: 14.5\r\n    },\r\n    B: {\r\n      name: \"B\",\r\n      x: 0,\r\n      y: 35\r\n    }\r\n  },\r\n  outputs: {\r\n    OUT: {\r\n      name: \"OUT\",\r\n      x: 100,\r\n      y: 25\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 4,\r\n          value: inputs.A || inputs.B\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default orNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nconst andNodeDefinition: NodeDefinition = {\r\n  type: \"and\",\r\n  visual: {\r\n    hitPath: `\r\n      M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30z\r\n    `,\r\n    // https://commons.wikimedia.org/wiki/File:AND_ANSI.svg\r\n    shapePath: `\r\n      M70 25h25\r\n      M31 15H5\r\n      M32 35H5\r\n      M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30z\r\n      m2.857143 2.857143H50.47619c9.760663 0 16.666667 7.639955 16.666667 17.142857 0 9.502902-7.382195 17.142857-17.142857 17.142857H32.857143V7.857143z\r\n    `\r\n  },\r\n  inputs: {\r\n    A: {\r\n      name: \"A\",\r\n      x: 0,\r\n      y: 14.5\r\n    },\r\n    B: {\r\n      name: \"B\",\r\n      x: 0,\r\n      y: 35\r\n    }\r\n  },\r\n  outputs: {\r\n    OUT: {\r\n      name: \"OUT\",\r\n      x: 100,\r\n      y: 25\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 4,\r\n          value: inputs.A && inputs.B\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default andNodeDefinition;\r\n","exports = module.exports = require(\"../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"html, body, #root {\\r\\n  width: 100%;\\r\\n  height: 100%;\\r\\n  margin: 0;\\r\\n  padding: 0;\\r\\n}\", \"\"]);\n\n// exports\n","\nvar content = require(\"!!../../node_modules/css-loader/index.js!./body.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../node_modules/css-loader/index.js!./body.css\", function() {\n\t\tvar newContent = require(\"!!../../node_modules/css-loader/index.js!./body.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","import { mapValues } from \"lodash-es\";\r\n\r\nexport function typedKeys<T>(obj: T): (keyof T)[] {\r\n  return Object.keys(obj) as (keyof T)[];\r\n}\r\n\r\nexport interface FunctionKeyedObject {\r\n  [key: string]: Function;\r\n}\r\nexport function bindFuncMap<T extends FunctionKeyedObject>(\r\n  obj: T,\r\n  target: any\r\n): T {\r\n  return mapValues(obj, v => v.bind(target)) as T;\r\n}\r\n","import { Action } from \"redux\";\r\n\r\nimport uuidV4 from \"uuid/v4\";\r\n\r\nimport { NodeType } from \"./node-types\";\r\n\r\nexport const ACTION_EVOLVE = \"@sim/evolve\" as \"@sim/evolve\";\r\nexport const evolveSim = (tickCount: number) => ({\r\n  type: ACTION_EVOLVE,\r\n  payload: { tickCount }\r\n});\r\nexport type EvolveSimAction = ReturnType<typeof evolveSim>;\r\n\r\nexport const ACTION_FASTFORWARD = \"@sim/fastforward\" as \"@sim/fastforward\";\r\nexport const fastForwardSim = () => ({\r\n  type: ACTION_FASTFORWARD\r\n});\r\nexport type FastForwardSimAction = ReturnType<typeof fastForwardSim>;\r\n\r\nexport const ACTION_NODE_ADD = \"@sim/node/add\" as \"@sim/node/add\";\r\n// TODO: Including x and y pos in simulator logic, which so far has tried to not concern itself with this.\r\n//  Probably a sign that these actions need to be at a higher level.\r\nexport const addNode = (\r\n  nodeType: NodeType,\r\n  x?: number,\r\n  y?: number,\r\n  nodeId?: string\r\n) => ({\r\n  type: ACTION_NODE_ADD,\r\n  payload: { nodeId: nodeId || uuidV4(), nodeType, x, y }\r\n});\r\nexport type AddNodeAction = ReturnType<typeof addNode>;\r\n\r\nexport const ACTION_INTERACT = \"@sim/interact\" as \"@sim/interact\";\r\nexport const interactNode = (nodeId: string) => ({\r\n  type: ACTION_INTERACT,\r\n  payload: { nodeId }\r\n});\r\nexport type InteractNodeAction = ReturnType<typeof interactNode>;\r\n\r\nexport const ACTION_WIRE = \"@sim/wire/add\" as \"@sim/wire/add\";\r\nexport const wireNode = (\r\n  sourceNodeId: string,\r\n  sourcePin: string,\r\n  targetNodeId: string,\r\n  targetPin: string\r\n) => ({\r\n  type: ACTION_WIRE,\r\n  payload: {\r\n    sourceNodeId,\r\n    sourcePin,\r\n    targetNodeId,\r\n    targetPin\r\n  }\r\n});\r\nexport type WireNodeAction = ReturnType<typeof wireNode>;\r\n\r\nexport const ACTION_UNWIRE = \"@sim/wire/remove\" as \"@sim/wire/remove\";\r\nexport const unwireNode = (\r\n  sourceNodeId: string,\r\n  sourcePin: string,\r\n  targetNodeId: string,\r\n  targetPin: string\r\n) => ({\r\n  type: ACTION_UNWIRE,\r\n  payload: {\r\n    sourceNodeId,\r\n    sourcePin,\r\n    targetNodeId,\r\n    targetPin\r\n  }\r\n});\r\nexport type UnwireNodeAction = ReturnType<typeof unwireNode>;\r\n\r\nexport const ACTION_TOGGLEWIRE = \"@sim/wire/toggle\" as \"@sim/wire/toggle\";\r\nexport const toggleWireNode = (\r\n  sourceNodeId: string,\r\n  sourcePin: string,\r\n  targetNodeId: string,\r\n  targetPin: string\r\n) => ({\r\n  type: ACTION_TOGGLEWIRE,\r\n  payload: {\r\n    sourceNodeId,\r\n    sourcePin,\r\n    targetNodeId,\r\n    targetPin\r\n  }\r\n});\r\nexport type ToggleWireNodeAction = ReturnType<typeof toggleWireNode>;\r\n\r\nexport type SimulatorAction =\r\n  | EvolveSimAction\r\n  | FastForwardSimAction\r\n  | AddNodeAction\r\n  | InteractNodeAction\r\n  | WireNodeAction\r\n  | UnwireNodeAction\r\n  | ToggleWireNodeAction;\r\n","import { NodeVisualPath } from \"./types\";\r\n\r\nexport function normalizeVisuals(\r\n  v: NodeVisualPath | NodeVisualPath[],\r\n  state: any\r\n): { path: string; fill?: string; stroke?: string; strokeWidth?: number }[] {\r\n  const asArray = Array.isArray(v) ? v : [v];\r\n\r\n  return asArray.map(x => {\r\n    if (typeof x === \"string\") {\r\n      return {\r\n        path: x,\r\n        fill: \"black\",\r\n        stroke: \"black\",\r\n        strokeWidth: 2\r\n      };\r\n    }\r\n    const fill = typeof x.fill === \"function\" ? x.fill(state || {}) : x.fill;\r\n    const stroke =\r\n      typeof x.stroke === \"function\" ? x.stroke(state || {}) : x.stroke;\r\n    const strokeWidth =\r\n      typeof x.strokeWidth === \"function\"\r\n        ? x.strokeWidth(state || {})\r\n        : x.strokeWidth;\r\n    return {\r\n      path: x.path,\r\n      fill,\r\n      stroke,\r\n      strokeWidth\r\n    };\r\n  });\r\n}\r\n","import { Action } from \"redux\";\r\n\r\nimport { Dispatch } from \"react-redux\";\r\n\r\nimport uuidV4 from \"uuid/v4\";\r\nimport { values, zipObject, map } from \"lodash-es\";\r\n\r\nimport { Rectangle } from \"@/types\";\r\nimport { GetState } from \"@/store\";\r\nimport { typedKeys } from \"@/utils\";\r\n\r\nimport { addNode, wireNode } from \"@/services/simulator/actions\";\r\n\r\nimport { selectedNodeIds } from \"./selectors\";\r\n\r\nexport type SelectionMode = \"set\" | \"append\" | \"remove\" | \"toggle\";\r\n\r\nexport const ACTION_NODE_HOVER = \"@editor/node/hover\" as \"@editor/node/hover\";\r\nexport const hoverNode = (nodeId: string | null) => ({\r\n  type: ACTION_NODE_HOVER,\r\n  payload: { nodeId }\r\n});\r\nexport type HoverNodeAction = ReturnType<typeof hoverNode>;\r\n\r\nexport const ACTION_MOVE_SELECTED = \"@editor/move-selected\" as \"@editor/move-selected\";\r\nexport const moveSelected = (offsetX: number, offsetY: number) => ({\r\n  type: ACTION_MOVE_SELECTED,\r\n  payload: { offsetX, offsetY }\r\n});\r\nexport type MoveNodeAction = ReturnType<typeof moveSelected>;\r\n\r\nexport const ACTION_COPY_SELECTED = \"@editor/copy-selected\" as \"@editor/copy-selected\";\r\nexport const copySelected = () => ({\r\n  type: ACTION_COPY_SELECTED\r\n});\r\nexport type CopySelectedAction = ReturnType<typeof copySelected>;\r\n\r\nexport const ACTION_PASTE = \"@editor/paste\" as \"@editor/paste\";\r\nexport const paste = () => (dispatch: Dispatch, getState: GetState) => {\r\n  // TODO: Make a cross-cutting reducer for this.\r\n  //  This should not be a thunk, as it can be implemented as a pure action.\r\n  const state = getState();\r\n  const clipboardNodes = state.ui.circuitEditor.clipboardContent;\r\n\r\n  const pasteIds = zipObject(\r\n    clipboardNodes.map(x => x.id),\r\n    map(clipboardNodes, () => uuidV4())\r\n  );\r\n\r\n  // Two passes: Create and Wire.\r\n\r\n  // Create the nodes.\r\n  for (let node of clipboardNodes) {\r\n    const {\r\n      id,\r\n      type,\r\n      offset: { x, y }\r\n    } = node;\r\n    dispatch(addNode(type, x, y, pasteIds[id]));\r\n  }\r\n\r\n  // Wire the nodes\r\n  for (let node of clipboardNodes) {\r\n    const { id, outputs } = node;\r\n    const sourceId = pasteIds[id];\r\n    for (let outputPin of typedKeys(outputs)) {\r\n      for (let output of outputs[outputPin]) {\r\n        const { nodeId: targetCopyId, pin: targetPin } = output;\r\n        const targetId = pasteIds[targetCopyId];\r\n        dispatch(wireNode(sourceId, outputPin, targetId, targetPin));\r\n      }\r\n    }\r\n\r\n    // Now this is just getting silly.  This really needs to be a real reducer.\r\n    dispatch(selectNodes(values(pasteIds)));\r\n  }\r\n};\r\n\r\nexport const ACTION_SELECT_NODES = \"@editor/select/nodes\" as \"@editor/select/nodes\";\r\nexport const selectNodes = (\r\n  nodeId: string | string[],\r\n  mode: SelectionMode = \"set\"\r\n) => ({\r\n  type: ACTION_SELECT_NODES,\r\n  payload: {\r\n    nodeIds: Array.isArray(nodeId) ? nodeId : [nodeId],\r\n    mode\r\n  }\r\n});\r\nexport type SelectNodesAction = ReturnType<typeof selectNodes>;\r\n\r\nexport const ACTION_SELECT_REGION = \"@editor/select/region\" as \"@editor/select/region\";\r\nexport const selectRegion = (\r\n  region: Rectangle,\r\n  mode: SelectionMode = \"set\"\r\n) => ({\r\n  type: ACTION_SELECT_REGION,\r\n  payload: {\r\n    region,\r\n    mode\r\n  }\r\n});\r\nexport type SelectRegionAction = ReturnType<typeof selectRegion>;\r\n\r\nexport const ACTION_SELECT_CLEAR = \"@editor/select/clear\" as \"@editor/select/clear\";\r\nexport const clearSelection = () => ({\r\n  type: ACTION_SELECT_CLEAR\r\n});\r\nexport type ClearSelectionAction = ReturnType<typeof clearSelection>;\r\n\r\nexport type CircuitEditorAction =\r\n  | HoverNodeAction\r\n  | MoveNodeAction\r\n  | CopySelectedAction\r\n  | SelectNodesAction\r\n  | SelectRegionAction\r\n  | ClearSelectionAction;\r\n","import * as React from \"react\";\r\n\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport styled from \"styled-components\";\r\n\r\nimport readmeContent from \"@/../README.md\";\r\n\r\nexport interface IntroProps {\r\n  dismiss(): void;\r\n}\r\ntype Props = IntroProps;\r\nexport default class IntroPage extends React.Component<Props> {\r\n  render() {\r\n    const {\r\n      dismiss\r\n    } = this.props;\r\n    return (\r\n      <IntroContainer>\r\n        <IntroContent>\r\n          <HeaderContainer>\r\n            <h3>\r\n              <b>UNDER CONSTRUCTION</b>\r\n              <p>\r\n                This is an as-yet-unfinished experiment.  The user interface is frustrating at best,\r\n                and you cannot save your work.  It is made available as a playground for the\r\n                current state of the project.\r\n              </p>\r\n              <p>Scan through the readme below, and click the button at the bottom to enter</p>\r\n              <p>The source can be found at <a href=\"https://github.com/RoboPhred/discrelog\">https://github.com/RoboPhred/discrelog</a></p>\r\n            </h3>\r\n          </HeaderContainer>\r\n          <MarkdownContainer>\r\n            <ReactMarkdown source={readmeContent}/>\r\n          </MarkdownContainer>\r\n          <DismissButton onClick={dismiss}>Let me break things</DismissButton>\r\n        </IntroContent>\r\n      </IntroContainer>\r\n    );\r\n  }\r\n}\r\n\r\nconst IntroContainer = styled.div`\r\n  box-sizing: border-box;\r\n  position: fixed;\r\n  left: 0;\r\n  top: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 25px;\r\n  z-index: 9999;\r\n`;\r\n\r\nconst IntroContent = styled.div`\r\n  box-sizing: border-box;\r\n  border: 1px solid #888;\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 5px;\r\n  display: flex;\r\n  flex-direction: column;\r\n`;\r\n\r\nconst HeaderContainer = styled.div`\r\n  flex: 0 1 auto;\r\n`;\r\n\r\nconst MarkdownContainer = styled.div`\r\n  flex: 0 1 auto;\r\n  overflow-y: scroll;\r\n  background: lightgray;\r\n  margin: 5px;\r\n  padding: 5px;\r\n`;\r\n\r\nconst DismissButton = styled.button`\r\n  min-height: 10em;\r\n`","import Intro from \"./Intro\";\r\nexport default Intro;\r\n","import styled from \"styled-components\";\r\n\r\nconst LayoutContainer = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: stretch;\r\n`;\r\nexport default LayoutContainer;\r\n","import styled from \"styled-components\";\r\n\r\nexport interface SidebarPanelProps {\r\n  width?: number;\r\n  height?: number;\r\n}\r\nconst SidebarPanel = styled<SidebarPanelProps, any>(\"div\")`\r\n  flex: none;\r\n  display: flex;\r\n  flex-direction: column;\r\n  box-sizing: border-box;\r\n  background: lightgrey;\r\n  border: 1 solid darkgray;\r\n  width: ${props => (props.width != null ? `${props.width}px` : undefined)};\r\n  height: ${props => (props.height != null ? `${props.height}px` : undefined)};\r\n`;\r\nexport default SidebarPanel;\r\n","import styled from \"styled-components\";\r\n\r\nconst ContentPanel = styled.div`\r\n  flex: 1 1 auto;\r\n  background: darkgray;\r\n  min-width: 10px;\r\n`;\r\nexport default ContentPanel;\r\n","import * as React from \"react\";\r\n\r\nimport styled from \"styled-components\";\r\n\r\nimport { DraggableCore, DraggableData } from \"react-draggable\";\r\n\r\nexport interface ResizeHandleProps {\r\n  onResize(delta: number): void;\r\n}\r\n\r\ntype Props = ResizeHandleProps;\r\nclass ResizeHandle extends React.Component<Props> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this._onDrag = this._onDrag.bind(this);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <DraggableCore onDrag={this._onDrag}>\r\n        <DragHandleDiv />\r\n      </DraggableCore>\r\n    );\r\n  }\r\n\r\n  private _onDrag(e: MouseEvent, d: DraggableData) {\r\n    const { onResize } = this.props;\r\n    onResize(d.deltaX);\r\n  }\r\n}\r\nexport default ResizeHandle;\r\n\r\nconst DragHandleDiv = styled.div`\r\n  width: 5px;\r\n  height: 100%;\r\n  background: black;\r\n  flex: none;\r\n  cursor: ew-resize;\r\n`;\r\n","import * as React from \"react\";\r\n\r\nimport styled from \"styled-components\";\r\n\r\nclass ToolWindow extends React.Component {\r\n  render() {\r\n    return <ToolWindowDiv>{this.props.children}</ToolWindowDiv>;\r\n  }\r\n}\r\nexport default ToolWindow;\r\n\r\nconst ToolWindowDiv = styled.div`\r\n  box-sizing: border-box;\r\n  width: 100%;\r\n  max-height: 100%;\r\n  flex: none;\r\n  padding: 5px;\r\n  overflow: auto;\r\n`;\r\n","import EditorLayout from \"./EditorLayout\";\r\nexport default EditorLayout;\r\n\r\nimport ToolWindow from \"./ToolWindow\";\r\nexport { ToolWindow };\r\n","import * as React from \"react\";\r\n\r\nimport LayoutContainer from \"./components/LayoutContainer\";\r\nimport SidebarPanel from \"./components/SidebarPanel\";\r\nimport ContentPanel from \"./components/ContentPanel\";\r\n\r\nimport ResizeHandle from \"./components/ResizeHandle\";\r\n\r\nexport interface EditorPanelProps {\r\n  className?: string;\r\n  leftSidebar?: React.ReactNode;\r\n  rightSidebar?: React.ReactNode;\r\n  defaultLeftSidebarWidth?: number;\r\n  defaultRightSidebarWidth?: number;\r\n}\r\ntype Props = EditorPanelProps;\r\ninterface State {\r\n  leftSidebarSize: number;\r\n  rightSidebarSize: number;\r\n}\r\nclass EditorLayout extends React.Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      leftSidebarSize: props.defaultLeftSidebarWidth || 100,\r\n      rightSidebarSize: props.defaultRightSidebarWidth || 100\r\n    };\r\n\r\n    this._leftSidebarResize = this._leftSidebarResize.bind(this);\r\n    this._rightSidebarResize = this._rightSidebarResize.bind(this);\r\n  }\r\n\r\n  render() {\r\n    const { leftSidebar, rightSidebar, children } = this.props;\r\n    const { leftSidebarSize, rightSidebarSize } = this.state;\r\n\r\n    return (\r\n      <LayoutContainer className={this.props.className}>\r\n        {leftSidebar && (\r\n          <React.Fragment>\r\n            <SidebarPanel width={leftSidebarSize}>{leftSidebar}</SidebarPanel>\r\n            <ResizeHandle onResize={this._leftSidebarResize} />\r\n          </React.Fragment>\r\n        )}\r\n        <ContentPanel>{children}</ContentPanel>\r\n        {rightSidebar && (\r\n          <React.Fragment>\r\n            <ResizeHandle onResize={this._rightSidebarResize} />\r\n            <SidebarPanel width={rightSidebarSize}>{rightSidebar}</SidebarPanel>\r\n          </React.Fragment>\r\n        )}\r\n      </LayoutContainer>\r\n    );\r\n  }\r\n\r\n  private _leftSidebarResize(delta: number) {\r\n    this.setState(s => ({\r\n      leftSidebarSize: s.leftSidebarSize + delta\r\n    }));\r\n  }\r\n\r\n  private _rightSidebarResize(delta: number) {\r\n    this.setState(s => ({\r\n      rightSidebarSize: s.rightSidebarSize - delta\r\n    }));\r\n  }\r\n}\r\nexport default EditorLayout;\r\n","import * as React from \"react\";\r\n\r\nimport { ContainerConfig } from \"konva\";\r\n\r\nimport {\r\n  Path,\r\n  Group,\r\n  Rect,\r\n  KonvaNodeComponent,\r\n  KonvaNodeProps\r\n} from \"react-konva\";\r\n\r\nimport {\r\n  NodeVisualDefinition,\r\n  NodeVisualPath,\r\n  NodeType,\r\n  NodeTypes,\r\n  NodePinDefinition\r\n} from \"@/services/simulator/node-types\";\r\nimport { normalizeVisuals } from \"@/services/simulator/node-types/utils\";\r\nimport { NodePinDirection } from \"@/services/simulator/types\";\r\n\r\nexport interface RenderPinProps extends NodePinDefinition {\r\n  id: string;\r\n  direction: NodePinDirection;\r\n}\r\nexport interface NodeVisualProps extends ContainerConfig, KonvaNodeProps {\r\n  nodeType: NodeType;\r\n  nodeState: any;\r\n  renderPin?(props: RenderPinProps): React.ReactElement<any>;\r\n  onClick?(e: KonvaMouseEvent): void;\r\n}\r\n\r\ntype Props = NodeVisualProps;\r\nclass NodeVisual extends React.Component<Props> {\r\n  render() {\r\n    const {\r\n      nodeType,\r\n      nodeState,\r\n      renderPin,\r\n      onClick,\r\n      ...konvaProps\r\n    } = this.props;\r\n\r\n    const def = NodeTypes[nodeType];\r\n    if (!def) {\r\n      return <Rect width={50} height={50} fill=\"red\" />;\r\n    }\r\n    const { hitPath, shapePath } = def.visual;\r\n\r\n    const visualOnClick = hitPath ? undefined : onClick;\r\n    const visuals = normalizeVisuals(shapePath, nodeState);\r\n    const pathElements = visuals.map((v, i) => (\r\n      <Path\r\n        key={i}\r\n        data={v.path}\r\n        fill={v.fill}\r\n        stroke={v.stroke}\r\n        strokeWidth={v.strokeWidth}\r\n        onClick={visualOnClick}\r\n      />\r\n    ));\r\n\r\n    const inputs = def.inputs || [];\r\n    const outputs = def.outputs || [];\r\n\r\n    let inputPins: React.ReactNode = null;\r\n    let outputPins: React.ReactNode = null;\r\n\r\n    if (renderPin) {\r\n      inputPins = Object.keys(inputs).map(key => {\r\n        const input = inputs[key];\r\n        let element = renderPin({\r\n          direction: \"input\",\r\n          id: key,\r\n          ...input\r\n        });\r\n        return React.cloneElement(element, { key: `input-${key}` });\r\n      });\r\n\r\n      outputPins = Object.keys(outputs).map(key => {\r\n        const output = outputs[key];\r\n        let element = renderPin({\r\n          direction: \"output\",\r\n          id: key,\r\n          ...output\r\n        });\r\n        return React.cloneElement(element, { key: `output-${key}` });\r\n      });\r\n    }\r\n\r\n    return (\r\n      <Group {...konvaProps}>\r\n        {hitPath && (\r\n          <Path data={hitPath} fill=\"transparent\" onClick={onClick} />\r\n        )}\r\n        {pathElements}\r\n        {inputPins}\r\n        {outputPins}\r\n      </Group>\r\n    );\r\n  }\r\n}\r\nexport default NodeVisual;\r\n","import * as React from \"react\";\r\n\r\nimport styled from \"styled-components\";\r\n\r\nimport { connect } from \"react-redux\";\r\n\r\nimport { Stage, Layer } from \"react-konva\";\r\n\r\nimport { addNode } from \"@/services/simulator/actions\";\r\nimport { NodeTypes } from \"@/services/simulator/node-types\";\r\n\r\nimport { typedKeys } from \"@/utils\";\r\n\r\nimport NodeVisual from \"../components/NodeVisual\";\r\n\r\nconst mapDispatchToProps = {\r\n  addNode\r\n};\r\ntype DispatchProps = typeof mapDispatchToProps;\r\n\r\ntype Props = DispatchProps;\r\nclass CircuitTray extends React.Component<Props> {\r\n  render() {\r\n    const { addNode } = this.props;\r\n\r\n    const elements = typedKeys(NodeTypes).map(type => {\r\n      return (\r\n        <div key={type} onClick={() => addNode(type)}>\r\n          <Stage width={110} height={110}>\r\n            <Layer>\r\n              <NodeVisual nodeType={type} nodeState={{}} />\r\n            </Layer>\r\n          </Stage>\r\n        </div>\r\n      );\r\n    });\r\n\r\n    return <CircuitTrayContainer>{elements}</CircuitTrayContainer>;\r\n  }\r\n}\r\nexport default connect(null, mapDispatchToProps)(CircuitTray);\r\n\r\nconst CircuitTrayContainer = styled.div`\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n`;\r\n","import * as React from \"react\";\r\n\r\nimport { connect } from \"react-redux\";\r\nimport { createStructuredSelector } from \"reselect\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nimport { evolveSim } from \"@/services/simulator/actions\";\r\n\r\ninterface StateProps {\r\n  tick: number;\r\n}\r\n\r\nconst mapStateToProps = createStructuredSelector<AppState, StateProps>({\r\n  tick: s => s.services.simulator.tick\r\n});\r\n\r\nconst mapDispatchToProps = {\r\n  evolveSim\r\n};\r\ntype DispatchProps = typeof mapDispatchToProps;\r\n\r\ntype Props = StateProps & DispatchProps;\r\nclass TimingControls extends React.Component<Props> {\r\n  render() {\r\n    const { tick, evolveSim } = this.props;\r\n\r\n    return (\r\n      <div>\r\n        Ticks: {tick} <button onClick={evolveSim.bind(null, 1)}>Tick</button>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TimingControls);\r\n","import * as React from \"react\";\r\n\r\nimport { connect } from \"react-redux\";\r\nimport { createStructuredSelector, createSelector } from \"reselect\";\r\n\r\nimport { mapValues } from \"lodash-es\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nconst mouseOverNode = createSelector(\r\n  (s: AppState) => s.ui.circuitEditor.mouseOverNodeId,\r\n  (s: AppState) => s.services.simulator.nodesById,\r\n  (id, nodesById) => (id ? nodesById[id] : null)\r\n);\r\n\r\nconst mouseOverNodeInputsSelector = createSelector(\r\n  mouseOverNode,\r\n  (s: AppState) => s.services.simulator.nodeOutputValuesByNodeId,\r\n  (node, outputsByNodeId) =>\r\n    node\r\n      ? mapValues(node.inputConnectionsByPin, (v, k) => {\r\n          if (!v) {\r\n            return null;\r\n          }\r\n          return outputsByNodeId[v.nodeId][v.pin];\r\n        })\r\n      : {}\r\n);\r\n\r\nconst mouseOverNodeOutputsSelector = createSelector(\r\n  (s: AppState) => s.services.simulator.nodeOutputValuesByNodeId,\r\n  (s: AppState) => s.ui.circuitEditor.mouseOverNodeId,\r\n  (outputs, nodeId) => (nodeId != null ? outputs[nodeId] : {})\r\n);\r\n\r\ninterface StateProps {\r\n  nodeInputValues: ReturnType<typeof mouseOverNodeInputsSelector>;\r\n  nodeOutputValues: ReturnType<typeof mouseOverNodeOutputsSelector>;\r\n}\r\n\r\nconst mapStateToProps = createStructuredSelector<AppState, StateProps>({\r\n  nodeInputValues: mouseOverNodeInputsSelector,\r\n  nodeOutputValues: mouseOverNodeOutputsSelector\r\n});\r\n\r\ntype Props = StateProps;\r\nclass NodeInfo extends React.Component<Props> {\r\n  render() {\r\n    const { nodeInputValues, nodeOutputValues } = this.props;\r\n    return (\r\n      <div>\r\n        <div>Node Inputs</div>\r\n        <pre>\r\n          <code>{JSON.stringify(nodeInputValues)}</code>\r\n        </pre>\r\n        <div>Node Outputs</div>\r\n        <pre>\r\n          <code>{JSON.stringify(nodeOutputValues, null, 2)}</code>\r\n        </pre>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nexport default connect(mapStateToProps)(NodeInfo);\r\n","import * as React from \"react\";\r\n\r\nimport { connect } from \"react-redux\";\r\nimport { createStructuredSelector } from \"reselect\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nconst transitionWindowsSelector = (s: AppState) =>\r\n  s.services.simulator.transitionWindows;\r\n\r\ninterface StateProps {\r\n  transitionWindows: ReturnType<typeof transitionWindowsSelector>;\r\n}\r\n\r\nconst mapStateToProps = createStructuredSelector<AppState, StateProps>({\r\n  transitionWindows: transitionWindowsSelector\r\n});\r\n\r\ntype Props = StateProps;\r\nclass PendingTransitions extends React.Component<Props> {\r\n  render() {\r\n    const { transitionWindows } = this.props;\r\n\r\n    return (\r\n      <div>\r\n        <div>Pending Transitions</div>\r\n        <pre>\r\n          <code>{JSON.stringify(transitionWindows, null, 2)}</code>\r\n        </pre>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nexport default connect(mapStateToProps)(PendingTransitions);\r\n","import { os } from \"platform\";\r\n\r\nconst OS_MAC = /(Mac|iOS|OS\\ X)/;\r\n\r\nexport const keyboardIsMac = OS_MAC.test((os || \"undefined\").toString());\r\n\r\nexport const keyboardCommandModifier = keyboardIsMac ? \"command\" : \"ctrl\";\r\n","import { keyboardCommandModifier } from \"@/runtime-env\";\r\n\r\nexport const KEYMAP_SIM_STEP = \"keymap:CircuitEditor/SimStep\" as \"keymap:CircuitEditor/SimStep\";\r\nexport const KEYMAP_SIM_FASTFORWARD = \"keymap:CircuitEditor/SimFastForward\" as \"keymap:CircuitEditor/SimFastForward\";\r\nexport const KEYMAP_NODE_COPY = \"keymap:CircuitEditor/Copy\" as \"keymap:CircuitEditor/Copy\";\r\nexport const KEYMAP_NODE_PASTE = \"keymap:CircuitEditor/Paste\" as \"keymap:CircuitEditor/Paste\";\r\n\r\nconst keymap = {\r\n  [KEYMAP_SIM_STEP]: \"space\",\r\n  [KEYMAP_SIM_FASTFORWARD]: \"shift+space\",\r\n  [KEYMAP_NODE_COPY]: `${keyboardCommandModifier}+c`,\r\n  [KEYMAP_NODE_PASTE]: `${keyboardCommandModifier}+v`\r\n};\r\nexport default keymap;\r\n\r\nexport type KeymapKeys = keyof typeof keymap;\r\nexport type KeymapHandler = Record<KeymapKeys, HotkeyHandler>;\r\n","import styled from \"styled-components\";\r\n\r\nconst FieldContainer = styled.div`\r\n  overflow: hidden;\r\n`;\r\n\r\nexport default FieldContainer;\r\n","import { createSelector } from \"reselect\";\r\n\r\nimport { AppState } from \"@/store\";\r\nimport { normalizeRectangle, pointSubtract } from \"@/geometry\";\r\n\r\nimport { CircuitFieldState } from \"./state\";\r\n\r\nexport const circuitFieldState = (state: AppState) =>\r\n  state.ui.circuitEditor.circuitField;\r\n\r\nexport const selectionRect = createSelector(\r\n  circuitFieldState,\r\n  (s: CircuitFieldState) =>\r\n    s.dragMode === \"select\" && s.dragStart && s.dragEnd\r\n      ? normalizeRectangle(s.dragStart, s.dragEnd)\r\n      : null\r\n);\r\n\r\nexport const dragMoveOffset = createSelector(\r\n  circuitFieldState,\r\n  (s: CircuitFieldState) =>\r\n    s.dragMode === \"move\" && s.dragStart && s.dragEnd\r\n      ? pointSubtract(s.dragEnd, s.dragStart)\r\n      : null\r\n);\r\n","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport { pick, mapValues, values } from \"lodash-es\";\r\n\r\nimport { createStructuredSelector, createSelector } from \"reselect\";\r\n\r\nimport { Layer, Group } from \"react-konva\";\r\n\r\nimport { AppState } from \"@/store\";\r\nimport { IDMap, Point } from \"@/types\";\r\n\r\nimport { nodeTypesById, nodeStatesById } from \"@/services/simulator/selectors\";\r\nimport { NodeType } from \"@/services/simulator/node-types\";\r\n\r\nimport {\r\n  selectedNodeIds,\r\n  nodePositionsById\r\n} from \"@/pages/CircuitEditor/selectors\";\r\n\r\nimport NodeVisual from \"@/pages/CircuitEditor/components/NodeVisual\";\r\n\r\nimport { dragMoveOffset } from \"../selectors\";\r\n\r\nconst selectedNodePositionsById = createSelector(\r\n  selectedNodeIds,\r\n  nodePositionsById,\r\n  (selectedNodeIds, nodePositionsById) =>\r\n    pick(nodePositionsById, selectedNodeIds)\r\n);\r\n\r\nconst selectedNodeTypesById = createSelector(\r\n  selectedNodeIds,\r\n  nodeTypesById,\r\n  (selectedNodeIds, nodeTypesById) => pick(nodeTypesById, selectedNodeIds)\r\n);\r\n\r\nconst selectedNodeStatesById = createSelector(\r\n  selectedNodeIds,\r\n  nodeStatesById,\r\n  (selectedNodeIds, nodeStatesById) => pick(nodeStatesById, selectedNodeIds)\r\n);\r\n\r\n// TODO: Pretty sure we can just pass an object in with these.\r\n//  react-redux was not accepting it though, need to figure out why.\r\nconst mapStateToProps = createStructuredSelector<AppState, StateProps>({\r\n  selectedNodePositionsById,\r\n  selectedNodeTypesById,\r\n  selectedNodeStatesById,\r\n  dragMoveOffset\r\n});\r\ninterface StateProps {\r\n  selectedNodePositionsById: IDMap<Point>;\r\n  selectedNodeTypesById: IDMap<NodeType>;\r\n  selectedNodeStatesById: IDMap<any>;\r\n  dragMoveOffset: Point | null;\r\n}\r\n\r\ntype Props = StateProps;\r\nclass DragPreviewLayer extends React.Component<Props> {\r\n  render() {\r\n    const {\r\n      selectedNodePositionsById,\r\n      selectedNodeTypesById,\r\n      selectedNodeStatesById,\r\n      dragMoveOffset\r\n    } = this.props;\r\n\r\n    let elements: React.ReactNode | null = null;\r\n    if (dragMoveOffset) {\r\n      elements = values(\r\n        mapValues(selectedNodePositionsById, (p, nodeId) => (\r\n          <NodeVisual\r\n            key={nodeId}\r\n            nodeType={selectedNodeTypesById[nodeId]}\r\n            nodeState={selectedNodeStatesById[nodeId]}\r\n            x={p.x + dragMoveOffset.x}\r\n            y={p.y + dragMoveOffset.y}\r\n          />\r\n        ))\r\n      );\r\n    }\r\n    return <Layer>{elements}</Layer>;\r\n  }\r\n}\r\nexport default connect(mapStateToProps)(DragPreviewLayer);\r\n","import * as React from \"react\";\r\nimport { connect, MapStateToProps } from \"react-redux\";\r\n\r\nimport { FastLayer, Rect } from \"react-konva\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nimport { selectionRect } from \"../selectors\";\r\n\r\nfunction mapStateToProps(state: AppState) {\r\n  return {\r\n    selectionRect: selectionRect(state)\r\n  };\r\n}\r\ntype StateProps = ReturnType<typeof mapStateToProps>;\r\n\r\ntype Props = StateProps;\r\nclass DragSelectLayer extends React.Component<Props> {\r\n  render() {\r\n    const { selectionRect: rect } = this.props;\r\n    return (\r\n      <FastLayer>\r\n        {rect && (\r\n          <Rect\r\n            x={rect.p1.x}\r\n            y={rect.p1.y}\r\n            width={rect.p2.x - rect.p1.x}\r\n            height={rect.p2.y - rect.p1.y}\r\n            fill=\"blue\"\r\n          />\r\n        )}\r\n      </FastLayer>\r\n    );\r\n  }\r\n}\r\nexport default connect(mapStateToProps)(DragSelectLayer);\r\n","import * as React from \"react\";\r\nimport { createSelector, createStructuredSelector } from \"reselect\";\r\n\r\nimport { connect } from \"react-redux\";\r\n\r\nimport { Layer, Line } from \"react-konva\";\r\n\r\nimport { mapValues } from \"lodash-es\";\r\n\r\nimport { Point } from \"@/types\";\r\n\r\nimport { Node, NodesById, NodePin } from \"@/services/simulator/types\";\r\nimport { NodeTypes } from \"@/services/simulator/node-types\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\ninterface Connection {\r\n  key: string;\r\n  source: {\r\n    x: number;\r\n    y: number;\r\n  };\r\n  target: {\r\n    x: number;\r\n    y: number;\r\n  };\r\n  value: boolean;\r\n}\r\n\r\nconst NO_POS = Object.freeze({ x: 0, y: 0 });\r\n\r\nconst nodesSelector = (s: AppState) => s.services.simulator.nodesById;\r\nconst edgeSelector = createSelector(nodesSelector, nodes =>\r\n  aggregateOutputs(Object.keys(nodes).map(k => nodes[k]))\r\n);\r\nconst nodeTypesSelector = createSelector(nodesSelector, nodes =>\r\n  mapValues(nodes, v => NodeTypes[v.type])\r\n);\r\nconst connectionSelector = createSelector(\r\n  edgeSelector,\r\n  (s: AppState) => s.ui.circuitEditor.nodePositions,\r\n  nodeTypesSelector,\r\n  (s: AppState) => s.services.simulator.nodeOutputValuesByNodeId,\r\n  (edges, nodePositions, nodeTypes, outputValues) => {\r\n    return edges.map<Connection>(edge => {\r\n      const {\r\n        source: { nodeId: sid, pin: spin },\r\n        target: { nodeId: tid, pin: tpin }\r\n      } = edge;\r\n\r\n      const sp = nodePositions[sid] || NO_POS;\r\n      const st = nodeTypes[sid];\r\n      const spp = (st && st.outputs[spin]) || NO_POS;\r\n\r\n      const tp = nodePositions[tid] || NO_POS;\r\n      const tt = nodeTypes[tid];\r\n      const tpp = (tt && tt.inputs[tpin]) || NO_POS;\r\n\r\n      const values = outputValues[sid];\r\n      const value = values ? values[spin] : false;\r\n\r\n      return {\r\n        key: `${sid}:${spin}-${tid}:${tpin}`,\r\n        source: {\r\n          x: sp.x + spp.x,\r\n          y: sp.y + spp.y\r\n        },\r\n        target: {\r\n          x: tp.x + tpp.x,\r\n          y: tp.y + tpp.y\r\n        },\r\n        value\r\n      };\r\n    });\r\n  }\r\n);\r\n\r\ninterface StateProps {\r\n  connections: ReturnType<typeof connectionSelector>;\r\n}\r\nconst mapStateToProps = createStructuredSelector<AppState, StateProps>({\r\n  connections: connectionSelector\r\n});\r\n\r\ntype Props = StateProps;\r\nclass WiresLayer extends React.Component<Props> {\r\n  render() {\r\n    const { connections } = this.props;\r\n\r\n    const connectorElements = connections.map(c => (\r\n      <Line\r\n        key={c.key}\r\n        points={getWirePoints(c.source, c.target)}\r\n        stroke={c.value ? \"green\" : \"black\"}\r\n      />\r\n    ));\r\n\r\n    return <Layer>{connectorElements}</Layer>;\r\n  }\r\n}\r\nexport default connect(mapStateToProps)(WiresLayer);\r\n\r\ninterface Edge {\r\n  source: NodePin;\r\n  target: NodePin;\r\n}\r\nfunction aggregateOutputs(nodes: Node[]): Edge[] {\r\n  return nodes.reduce<Edge[]>((a, node) => {\r\n    for (const outputPin of Object.keys(node.outputConnectionsByPin)) {\r\n      for (const outputConn of node.outputConnectionsByPin[outputPin]) {\r\n        a.push({\r\n          source: {\r\n            nodeId: node.id,\r\n            pin: outputPin\r\n          },\r\n          target: outputConn\r\n        });\r\n      }\r\n    }\r\n    return a;\r\n  }, []);\r\n}\r\n\r\nfunction getWirePoints(start: Point, end: Point): number[] {\r\n  if (Math.abs(start.x - end.x) > Math.abs(start.y - end.y)) {\r\n    return [\r\n      start.x,\r\n      start.y,\r\n\r\n      start.x + (end.x - start.x) / 2,\r\n      start.y,\r\n\r\n      start.x + (end.x - start.x) / 2,\r\n      end.y,\r\n\r\n      end.x,\r\n      end.y\r\n    ];\r\n  } else {\r\n    return [\r\n      start.x,\r\n      start.y,\r\n\r\n      start.x,\r\n      start.y + (end.y - start.y) / 2,\r\n\r\n      end.x,\r\n      start.y + (end.y - start.y) / 2,\r\n\r\n      end.x,\r\n      end.y\r\n    ];\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { ContainerConfig } from \"konva\";\r\nimport { KonvaNodeProps, Group, Circle, Line } from \"react-konva\";\r\n\r\nexport interface PinProps extends ContainerConfig, KonvaNodeProps {\r\n  onClick?(e: KonvaMouseEvent): void;\r\n}\r\n\r\nconst PIN_CIRCLE_RADIUS = 6;\r\n\r\ntype Props = PinProps;\r\nclass Pin extends React.Component<Props> {\r\n  render() {\r\n    const { onClick, ...groupProps } = this.props;\r\n    return (\r\n      <Group {...groupProps}>\r\n        <Circle\r\n          x={0}\r\n          y={0}\r\n          radius={PIN_CIRCLE_RADIUS}\r\n          fill=\"black\"\r\n          onClick={onClick}\r\n        />\r\n      </Group>\r\n    );\r\n  }\r\n}\r\nexport default Pin;\r\n","import * as React from \"react\";\r\n\r\nimport { connect } from \"react-redux\";\r\n\r\nimport { ContainerConfig } from \"konva\";\r\nimport { KonvaNodeProps, Group, Rect } from \"react-konva\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nimport { NodeDefinition, NodeType } from \"@/services/simulator/node-types\";\r\nimport { nodeTypesById, nodeStatesById } from \"@/services/simulator/selectors\";\r\nimport { Node, NodePinDirection } from \"@/services/simulator/types\";\r\n\r\nimport { selectedNodeIds } from \"@/pages/CircuitEditor/selectors\";\r\nimport NodeVisual, {\r\n  RenderPinProps\r\n} from \"@/pages/CircuitEditor/components/NodeVisual\";\r\n\r\nimport NodePin from \"./NodePin\";\r\nimport { ClipPathProperty } from \"csstype\";\r\n\r\nexport interface CircuitNodeProps extends ContainerConfig, KonvaNodeProps {\r\n  nodeId: string;\r\n  onPinClick(\r\n    direction: NodePinDirection,\r\n    pin: string,\r\n    e: KonvaMouseEvent\r\n  ): void;\r\n}\r\n\r\ninterface StateProps {\r\n  nodeType: NodeType;\r\n  nodeState: any;\r\n  isSelected: boolean;\r\n}\r\nfunction mapStateToProps(state: AppState, props: CircuitNodeProps): StateProps {\r\n  return {\r\n    nodeType: nodeTypesById(state)[props.nodeId],\r\n    nodeState: nodeStatesById(state)[props.nodeId],\r\n    isSelected: selectedNodeIds(state).indexOf(props.nodeId) !== -1\r\n  };\r\n}\r\n\r\ntype Props = CircuitNodeProps & StateProps;\r\nclass CircuitNode extends React.Component<Props> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this._renderPin = this._renderPin.bind(this);\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      nodeId,\r\n      nodeType,\r\n      nodeState,\r\n      isSelected,\r\n      onClick,\r\n      onPinClick,\r\n      ...groupProps\r\n    } = this.props;\r\n\r\n    return (\r\n      <Group {...groupProps}>\r\n        <NodeVisual\r\n          nodeType={nodeType}\r\n          nodeState={nodeState}\r\n          onClick={onClick}\r\n          renderPin={this._renderPin}\r\n        />\r\n        {isSelected && <Rect width={10} height={10} fill=\"yellow\" />}\r\n      </Group>\r\n    );\r\n  }\r\n\r\n  private _renderPin(props: RenderPinProps): React.ReactElement<any> {\r\n    return (\r\n      <CircuitNodePin\r\n        key={props.id}\r\n        onPinClick={this.props.onPinClick}\r\n        {...props}\r\n      />\r\n    );\r\n  }\r\n}\r\nexport default connect(mapStateToProps)(CircuitNode);\r\n\r\ntype CircuitNodePinProps = RenderPinProps & {\r\n  onPinClick?(\r\n    direction: NodePinDirection,\r\n    pin: string,\r\n    e: KonvaMouseEvent\r\n  ): void;\r\n};\r\nclass CircuitNodePin extends React.Component<CircuitNodePinProps> {\r\n  constructor(props: CircuitNodePinProps) {\r\n    super(props);\r\n\r\n    this._onClick = this._onClick.bind(this);\r\n  }\r\n\r\n  render() {\r\n    const { x, y } = this.props;\r\n    return <NodePin x={x} y={y} onClick={this._onClick} />;\r\n  }\r\n\r\n  private _onClick(e: KonvaMouseEvent) {\r\n    const { direction, id, onPinClick } = this.props;\r\n    if (onPinClick) {\r\n      onPinClick(direction, id, e);\r\n    }\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { connect } from \"react-redux\";\r\nimport { createStructuredSelector } from \"reselect\";\r\n\r\nimport { ContainerConfig } from \"konva\";\r\nimport { Layer, KonvaNodeProps } from \"react-konva\";\r\n\r\nimport { toggleWireNode } from \"@/services/simulator/actions\";\r\nimport { NodePinDirection } from \"@/services/simulator/types\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nimport { nodePositionsById } from \"@/pages/CircuitEditor/selectors\";\r\n\r\nimport CircuitNode from \"./CircuitNode\";\r\n\r\nexport interface NodesLayerProps {\r\n  onNodeMouseDown?(node: string, e: KonvaMouseEvent): void;\r\n  onNodeMouseUp?(node: string, e: KonvaMouseEvent): void;\r\n  onNodeMouseOver?(node: string, e: KonvaMouseEvent): void;\r\n  onNodeMouseLeave?(node: string, e: KonvaMouseEvent): void;\r\n}\r\n\r\ninterface StateProps {\r\n  nodePositionsById: ReturnType<typeof nodePositionsById>;\r\n}\r\n\r\nconst mapStateToProps = createStructuredSelector<AppState, StateProps>({\r\n  nodePositionsById\r\n});\r\n\r\nconst mapDispatchToProps = {\r\n  toggleWireNode\r\n};\r\ntype DispatchProps = typeof mapDispatchToProps;\r\n\r\ninterface State {\r\n  wireSourceNode: string | null;\r\n  wireSourcePin: string | null;\r\n}\r\n\r\ntype Props = NodesLayerProps & StateProps & DispatchProps;\r\nclass NodesLayer extends React.Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this._onPinClick = this._onPinClick.bind(this);\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      nodePositionsById,\r\n      onNodeMouseDown,\r\n      onNodeMouseUp,\r\n      onNodeMouseOver,\r\n      onNodeMouseLeave\r\n    } = this.props;\r\n\r\n    const nodeElements = Object.keys(nodePositionsById).map(key => {\r\n      const { x, y } = nodePositionsById[key];\r\n      return (\r\n        <BoundCicrcuitNode\r\n          key={key}\r\n          nodeId={key}\r\n          x={x}\r\n          y={y}\r\n          onMouseDown={onNodeMouseDown}\r\n          onMouseUp={onNodeMouseUp}\r\n          onMouseOver={onNodeMouseOver}\r\n          onMouseLeave={onNodeMouseLeave}\r\n          onPinClick={this._onPinClick}\r\n        />\r\n      );\r\n    });\r\n\r\n    return <Layer>{nodeElements}</Layer>;\r\n  }\r\n\r\n  private _onPinClick(\r\n    nodeId: string,\r\n    direction: NodePinDirection,\r\n    pin: string,\r\n    e: KonvaMouseEvent\r\n  ) {\r\n    e.evt.preventDefault();\r\n\r\n    if (direction === \"output\") {\r\n      this.setState({\r\n        wireSourceNode: nodeId,\r\n        wireSourcePin: pin\r\n      });\r\n      return;\r\n    }\r\n\r\n    const { wireSourceNode, wireSourcePin } = this.state;\r\n    if (!wireSourceNode || !wireSourcePin) {\r\n      return;\r\n    }\r\n\r\n    this.props.toggleWireNode(wireSourceNode, wireSourcePin, nodeId, pin);\r\n\r\n    this.setState({\r\n      wireSourceNode: null,\r\n      wireSourcePin: null\r\n    });\r\n  }\r\n}\r\nexport default connect(mapStateToProps, mapDispatchToProps)(NodesLayer);\r\n\r\ninterface BoundCicrcuitNodeProps extends ContainerConfig {\r\n  nodeId: string;\r\n  onMouseDown?(nodeId: string, e: KonvaMouseEvent): void;\r\n  onMouseUp?(nodeId: string, e: KonvaMouseEvent): void;\r\n  onMouseOver?(nodeId: string, e: KonvaMouseEvent): void;\r\n  onMouseLeave?(nodeId: string, e: KonvaMouseEvent): void;\r\n  onPinClick?(\r\n    nodeId: string,\r\n    direction: NodePinDirection,\r\n    pin: string,\r\n    e: KonvaMouseEvent\r\n  ): void;\r\n}\r\nclass BoundCicrcuitNode extends React.Component<BoundCicrcuitNodeProps> {\r\n  constructor(props: BoundCicrcuitNodeProps) {\r\n    super(props);\r\n\r\n    this._onMouseDown = this._onMouseDown.bind(this);\r\n    this._onMouseUp = this._onMouseUp.bind(this);\r\n    this._onMouseOver = this._onMouseOver.bind(this);\r\n    this._onMouseLeave = this._onMouseLeave.bind(this);\r\n    this._onPinClick = this._onPinClick.bind(this);\r\n  }\r\n  render() {\r\n    const {\r\n      onMouseDown,\r\n      onMouseUp,\r\n      onMouseOver,\r\n      onMouseLeave,\r\n      onPinClick,\r\n      ...otherProps\r\n    } = this.props;\r\n    return (\r\n      <CircuitNode\r\n        {...otherProps}\r\n        onMouseDown={this._onMouseDown}\r\n        onMouseUp={this._onMouseUp}\r\n        onMouseOver={this._onMouseOver}\r\n        onMouseLeave={this._onMouseLeave}\r\n        onPinClick={this._onPinClick}\r\n      />\r\n    );\r\n  }\r\n\r\n  private _onMouseDown(e: KonvaMouseEvent) {\r\n    const { nodeId, onMouseDown } = this.props;\r\n    if (onMouseDown) {\r\n      onMouseDown(nodeId, e);\r\n    }\r\n  }\r\n\r\n  private _onMouseUp(e: KonvaMouseEvent) {\r\n    const { nodeId, onMouseUp } = this.props;\r\n    if (onMouseUp) {\r\n      onMouseUp(nodeId, e);\r\n    }\r\n  }\r\n\r\n  private _onMouseOver(e: KonvaMouseEvent) {\r\n    const { nodeId, onMouseOver } = this.props;\r\n    if (onMouseOver) {\r\n      onMouseOver(nodeId, e);\r\n    }\r\n  }\r\n\r\n  private _onMouseLeave(e: KonvaMouseEvent) {\r\n    const { nodeId, onMouseLeave } = this.props;\r\n    if (onMouseLeave) {\r\n      onMouseLeave(nodeId, e);\r\n    }\r\n  }\r\n\r\n  private _onPinClick(\r\n    direction: NodePinDirection,\r\n    pin: string,\r\n    e: KonvaMouseEvent\r\n  ) {\r\n    const { nodeId, onPinClick } = this.props;\r\n    if (onPinClick) {\r\n      onPinClick(nodeId, direction, pin, e);\r\n    }\r\n  }\r\n}\r\n","import { Dispatch } from \"redux\";\r\n\r\nimport { normalizeRectangle, calcSize, pointSubtract } from \"@/geometry\";\r\nimport { GetState } from \"@/store\";\r\nimport { Point } from \"@/types\";\r\n\r\nimport {\r\n  interactNode,\r\n  evolveSim,\r\n  fastForwardSim\r\n} from \"@/services/simulator/actions\";\r\n\r\nimport {\r\n  clearSelection,\r\n  hoverNode,\r\n  selectNodes,\r\n  SelectionMode,\r\n  selectRegion,\r\n  moveSelected,\r\n  copySelected,\r\n  paste\r\n} from \"@/pages/CircuitEditor/actions\";\r\n\r\nimport { startDrag, continueDrag, endDrag } from \"./actions\";\r\n\r\nimport { circuitFieldState } from \"./selectors\";\r\n\r\nexport interface ModifierKeys {\r\n  ctrlMetaKey: boolean;\r\n  shiftKey: boolean;\r\n  altKey: boolean;\r\n}\r\n\r\nexport function onNodeClicked(nodeId: string, modifiers: ModifierKeys) {\r\n  if (modifiers.altKey) {\r\n    return interactNode(nodeId);\r\n  }\r\n\r\n  const mode = getSelectMode(modifiers);\r\n  return selectNodes(nodeId, mode);\r\n}\r\n\r\nexport function onFieldClicked(modifiers: ModifierKeys) {\r\n  return clearSelection();\r\n}\r\n\r\nexport function onNodeDragStart(\r\n  nodeId: string,\r\n  p: Point,\r\n  modifiers: ModifierKeys\r\n) {\r\n  return (dispatch: Dispatch, getState: GetState) => {\r\n    // TODO: Move logic into reducer.\r\n    const state = getState();\r\n    const isNodeSelected =\r\n      state.ui.circuitEditor.selectedNodeIds.indexOf(nodeId) !== -1;\r\n    if (!isNodeSelected) {\r\n      const mode = getSelectMode(modifiers);\r\n      dispatch(selectNodes(nodeId, mode));\r\n    }\r\n    dispatch(startDrag(p, \"move\"));\r\n  };\r\n}\r\n\r\nexport function onFieldDragStart(p: Point) {\r\n  return startDrag(p, \"select\");\r\n}\r\n\r\nexport function onDragMove(p: Point) {\r\n  return continueDrag(p);\r\n}\r\n\r\nexport function onDragEnd(p: Point, modifiers: ModifierKeys) {\r\n  return (dispatch: Dispatch, getState: GetState) => {\r\n    const fieldState = circuitFieldState(getState());\r\n    const { dragMode, dragStart, dragEnd } = fieldState;\r\n    if (dragStart && dragEnd) {\r\n      switch (dragMode) {\r\n        case \"select\": {\r\n          const rect = normalizeRectangle(dragStart, dragEnd);\r\n          const mode = getSelectMode(modifiers);\r\n          dispatch(selectRegion(rect, mode));\r\n          break;\r\n        }\r\n        case \"move\": {\r\n          const moveBy = pointSubtract(dragEnd, dragStart);\r\n          dispatch(moveSelected(moveBy.x, moveBy.y));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    dispatch(endDrag());\r\n  };\r\n}\r\n\r\nexport function onNodeHover(nodeId: string | null) {\r\n  return hoverNode(nodeId);\r\n}\r\n\r\nexport function onHotkeyStep() {\r\n  return evolveSim(1);\r\n}\r\n\r\nexport function onHotkeyFastForward() {\r\n  return fastForwardSim();\r\n}\r\n\r\nexport function onHotkeyCopy() {\r\n  return copySelected();\r\n}\r\n\r\nexport function onHotkeyPaste() {\r\n  return paste();\r\n}\r\n\r\nfunction getSelectMode(modifiers: ModifierKeys): SelectionMode {\r\n  if (modifiers.shiftKey && modifiers.ctrlMetaKey) {\r\n    return \"remove\";\r\n  }\r\n  if (modifiers.shiftKey) {\r\n    return \"append\";\r\n  }\r\n  if (modifiers.ctrlMetaKey) {\r\n    return \"toggle\";\r\n  }\r\n  return \"set\";\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { connect } from \"react-redux\";\r\n\r\nimport { Stage } from \"react-konva\";\r\nimport sizeme, { SizeProps } from \"react-sizeme\";\r\nimport { HotKeys, FocusTrap } from \"react-hotkeys\";\r\n\r\nimport { Point } from \"@/types\";\r\nimport { bindFuncMap } from \"@/utils\";\r\n\r\nimport keymap, {\r\n  KeymapHandler,\r\n  KEYMAP_SIM_STEP,\r\n  KEYMAP_SIM_FASTFORWARD,\r\n  KEYMAP_NODE_COPY,\r\n  KEYMAP_NODE_PASTE\r\n} from \"./keymap\";\r\n\r\nimport FieldContainer from \"./components/FieldContainer\";\r\nimport DragPreviewLayer from \"./components/DragPreviewLayer\";\r\nimport DragSelectLayer from \"./components/DragSelectLayer\";\r\nimport WiresLayer from \"./components/WiresLayer\";\r\nimport NodesLayer from \"./components/NodesLayer\";\r\n\r\nimport * as events from \"./events\";\r\nimport { keyboardIsMac } from \"@/runtime-env\";\r\n\r\nexport interface CircuitFieldProps {\r\n  className?: string;\r\n}\r\n\r\nconst mapDispatchToProps = events;\r\ntype DispatchProps = typeof mapDispatchToProps;\r\n\r\nconst DRAG_THRESHOLD = 5;\r\n\r\ntype Props = CircuitFieldProps & SizeProps & DispatchProps;\r\nclass CircuitField extends React.Component<Props> {\r\n  // Instance props as we do not require a re-render when these change.\r\n  private _isDragging: boolean = false;\r\n  private _mouseDownNodeId: string | null = null;\r\n  private _startMousePos: Point | null = null;\r\n  private _lastMousePos: Point | null = null;\r\n\r\n  private _hotkeysRef = React.createRef<HTMLDivElement>();\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this._onNodeMouseDown = this._onNodeMouseDown.bind(this);\r\n    this._onNodeMouseOver = this._onNodeMouseOver.bind(this);\r\n    this._onNodeMouseLeave = this._onNodeMouseLeave.bind(this);\r\n\r\n    this._onMouseDown = this._onMouseDown.bind(this);\r\n    this._onMouseMove = this._onMouseMove.bind(this);\r\n    this._onMouseUp = this._onMouseUp.bind(this);\r\n\r\n    this._keyHandlers = bindFuncMap(this._keyHandlers, this);\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      className,\r\n      size: { width, height }\r\n    } = this.props;\r\n\r\n    return (\r\n      <FieldContainer className={className}>\r\n        <HotKeys keyMap={keymap} handlers={this._keyHandlers}>\r\n          <div tabIndex={-1} ref={this._hotkeysRef}>\r\n            <Stage\r\n              width={width}\r\n              height={height}\r\n              onMouseDown={this._onMouseDown}\r\n              onMouseMove={this._onMouseMove}\r\n              onMouseUp={this._onMouseUp}\r\n            >\r\n              <DragSelectLayer />\r\n              <DragPreviewLayer />\r\n              <WiresLayer />\r\n              <NodesLayer\r\n                onNodeMouseDown={this._onNodeMouseDown}\r\n                onNodeMouseOver={this._onNodeMouseOver}\r\n                onNodeMouseLeave={this._onNodeMouseLeave}\r\n              />\r\n            </Stage>\r\n          </div>\r\n        </HotKeys>\r\n      </FieldContainer>\r\n    );\r\n  }\r\n\r\n  private _keyHandlers: KeymapHandler = {\r\n    [KEYMAP_SIM_STEP]: () => this.props.onHotkeyStep(),\r\n    [KEYMAP_SIM_FASTFORWARD]: () => this.props.onHotkeyFastForward(),\r\n    [KEYMAP_NODE_COPY]: () => this.props.onHotkeyCopy(),\r\n    [KEYMAP_NODE_PASTE]: () => this.props.onHotkeyPaste()\r\n  };\r\n\r\n  private _onNodeMouseOver(nodeId: string, e: KonvaMouseEvent) {\r\n    if (e.evt.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    this.props.onNodeHover(nodeId);\r\n  }\r\n\r\n  private _onNodeMouseLeave(nodeId: string, e: KonvaMouseEvent) {\r\n    this.props.onNodeHover(null);\r\n  }\r\n\r\n  private _onNodeMouseDown(nodeId: string, e: KonvaMouseEvent) {\r\n    if (e.evt.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    this._mouseDownNodeId = nodeId;\r\n  }\r\n\r\n  private _onMouseDown(e: KonvaMouseEvent) {\r\n    if (e.evt.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    if (this._hotkeysRef.current) {\r\n      this._hotkeysRef.current.focus();\r\n    }\r\n\r\n    this._startMousePos = {\r\n      x: e.evt.layerX,\r\n      y: e.evt.layerY\r\n    };\r\n  }\r\n\r\n  private _onMouseMove(e: KonvaMouseEvent) {\r\n    if (e.evt.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    if (!this._startMousePos) {\r\n      return;\r\n    }\r\n\r\n    const { x: sx, y: sy } = this._startMousePos;\r\n\r\n    const { layerX: x, layerY: y, ctrlKey, altKey, shiftKey, metaKey } = e.evt;\r\n    const modifiers = {\r\n      ctrlMetaKey: keyboardIsMac ? metaKey : ctrlKey,\r\n      altKey: altKey,\r\n      shiftKey\r\n    };\r\n\r\n    if (!this._isDragging) {\r\n      if (\r\n        Math.abs(x - sx) < DRAG_THRESHOLD &&\r\n        Math.abs(y - sy) < DRAG_THRESHOLD\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      this._isDragging = true;\r\n      if (this._mouseDownNodeId) {\r\n        this.props.onNodeDragStart(this._mouseDownNodeId, { x, y }, modifiers);\r\n      } else {\r\n        this.props.onFieldDragStart({ x, y });\r\n      }\r\n    } else {\r\n      this.props.onDragMove({ x, y });\r\n    }\r\n  }\r\n\r\n  private _onMouseUp(e: KonvaMouseEvent) {\r\n    if (e.evt.defaultPrevented) {\r\n      this._resetMouseTracking();\r\n      return;\r\n    }\r\n\r\n    const { layerX: x, layerY: y, ctrlKey, altKey, metaKey, shiftKey } = e.evt;\r\n    const modifiers = {\r\n      ctrlMetaKey: keyboardIsMac ? metaKey : ctrlKey,\r\n      altKey: altKey,\r\n      shiftKey\r\n    };\r\n\r\n    if (this._isDragging) {\r\n      this.props.onDragEnd({ x, y }, modifiers);\r\n    } else if (this._mouseDownNodeId) {\r\n      this.props.onNodeClicked(this._mouseDownNodeId, modifiers);\r\n    } else {\r\n      this.props.onFieldClicked(modifiers);\r\n    }\r\n\r\n    this._resetMouseTracking();\r\n  }\r\n\r\n  private _resetMouseTracking() {\r\n    this._isDragging = false;\r\n    this._mouseDownNodeId = null;\r\n    this._startMousePos = null;\r\n    this._lastMousePos = null;\r\n  }\r\n}\r\n\r\nexport default sizeme({\r\n  monitorWidth: true,\r\n  monitorHeight: true,\r\n  noPlaceholder: true\r\n})(connect(null, mapDispatchToProps)(CircuitField));\r\n","import CircuitField from \"./CircuitField\";\r\nexport default CircuitField;\r\n","import * as React from \"react\";\r\n\r\nimport styled from \"styled-components\";\r\n\r\nimport Hotkeys from \"react-hotkeys\";\r\n\r\nimport EditorLayout, { ToolWindow } from \"@/components/EditorLayout\";\r\n\r\nimport CircuitTray from \"./ToolWindows/CircuitTray\";\r\nimport TimingControls from \"./ToolWindows/TimingControls\";\r\nimport NodeInfo from \"./ToolWindows/NodeInfo\";\r\nimport PendingTransitions from \"./ToolWindows/PendingTransitions\";\r\nimport CircuitField from \"./ContentViews/CircuitField\";\r\n\r\nexport default class CircuitEditor extends React.Component {\r\n  render() {\r\n    return (\r\n      <FillParentEditorLayout\r\n        leftSidebar={\r\n          <ToolWindow>\r\n            <CircuitTray />\r\n          </ToolWindow>\r\n        }\r\n        defaultLeftSidebarWidth={100}\r\n        rightSidebar={\r\n          <React.Fragment>\r\n            <ToolWindow>\r\n              <TimingControls />\r\n            </ToolWindow>\r\n            <ToolWindow>\r\n              <NodeInfo />\r\n            </ToolWindow>\r\n            <ToolWindow>\r\n              <PendingTransitions />\r\n            </ToolWindow>\r\n          </React.Fragment>\r\n        }\r\n        defaultRightSidebarWidth={200}\r\n      >\r\n        <FillParentCircuitField />\r\n      </FillParentEditorLayout>\r\n    );\r\n  }\r\n}\r\n\r\nconst FillParentEditorLayout = styled(EditorLayout)`\r\n  width: 100%;\r\n  height: 100%;\r\n`;\r\n\r\nconst FillParentCircuitField = styled(CircuitField)`\r\n  width: 100%;\r\n  height: 100%;\r\n`;\r\n","import CircuitEditor from \"./CircuitEditor\";\r\nexport default CircuitEditor;\r\n","module.exports = \"# Discrelog / React-Logic / Working Title Logic Thing\\r\\n\\r\\nA discrete logic / circuit editor and simulator written in React and Redux.\\r\\n\\r\\n_This is a work in progress, and will be for some time. It is not suitable for use as of this time._\\r\\n\\r\\n## Live work-in-progress\\r\\n\\r\\n_The interface is very much a prototype. The current incarnation is under heavy development and is not final._\\r\\n\\r\\nhttp://robophred.github.io/discrelog\\r\\n\\r\\n### Usage:\\r\\n\\r\\nClick circuit elements on the left to create them. They will appear in the top-left corner.\\r\\nClick an element to select it. Click-drag an element to move it, and click-drag the field to select multiple elements.\\r\\n\\r\\nSelected elements appear with a small yellow square in the top left.\\r\\n\\r\\nConnect components by clicking an output pin, then clicking an input pin. Only output-to-input clicks work, and an output must be re-clicked when connecting multiple inputs to an output.\\r\\n\\r\\n### Controls:\\r\\n\\r\\n* Select element: `left-click`\\r\\n* Toggle element in current selection: `ctrl + left-click`\\r\\n* Add element to current selection: `shift + left-click`\\r\\n* Use element (buttons): `alt + left-click` or `option + left-click`\\r\\n* Copy Selected: `ctrl + c` or `command + c`\\r\\n* Paste: `ctrl + v` or `command + v`\\r\\n* Next tick: `spacebar`\\r\\n* Fast forward to next transition: `shift + spacebar`\\r\\n\\r\\n## Circuit structure and Simulation\\r\\n\\r\\nCircuits are built by connecting component output pins to input pins on a one-to-many relationship. A single output pin can connect to many input pins, but an input pin can only have a single output pin.\\r\\n\\r\\nConnections and pins are represented by a binary state. A connection can be active (true) or inactive (false); there is no way to simulate analog concepts such as pull-low/pull-high, resistors, voltages, or currents.\\r\\n\\r\\nWhen an output pin changes, all connected components are updated. The update process involves passing the entire state of its input pins, as well as the component's internal state, and allowed to produce an immediately-applied internal state change and a delay-applied output change. Changes to output pins must occur at least one tick in the future, and it is not possible to schedule more than one transition on the same output pin. This assures that logic signals steadily flow through on ticks, and allows such constructs as vibrators, latches, and flip-flops.\\r\\n\\r\\nIt is not possible for a component to change its pin on the current tick. This ensures components function consistently and predictably through cyclic connections and regardless of the order in which they update.\\r\\n\\r\\n## Supported Logic Components\\r\\n\\r\\nAs of the time of this writing, the available logic components consist of:\\r\\n\\r\\n* Combinational logic (4 tick response)\\r\\n  * AND\\r\\n  * OR\\r\\n  * NOR\\r\\n* Negate / NOT (4 tick response)\\r\\n* Toggle Switch (1 tick response)\\r\\n* Buffer (2 tick response)\\r\\n* 7 Segment Display (immediate visual response)\\r\\n* LED (immediate visual response)\\r\\n\\r\\n_For more details on the implementation of logic components, and how to add your own, see [/services/simulator/node-types](https://github.com/RoboPhred/discrelog/tree/master/src/services/simulator/node-types)._\\r\\n\\r\\n## Upcomming features\\r\\n\\r\\nI am notorious for not getting back to things, so anything I write here would just be bad juju.\\r\\n\\r\\n## Development Philosophy\\r\\n\\r\\nWhile the inspiration for this project is a lack of high quality, easily extensible discrete logic simulators, this is a formost a learning exercise. This means progress will be slow and most of it will be rewritten many times over. Finding the best solution and gaining a deeper understanding of the underlying problem will take priority over bringing the software to a usable state. Do not expect fast progress or a user friendly editor for some time.\\r\\n\\r\\n## Technology\\r\\n\\r\\nThis application is written to be a browser-ran desktop-scale application. It has no server component, and performs all work in the client's browser.\\r\\nThe UI renderer is React, with Redux providing the backing store.\\r\\n\\r\\n## License\\r\\n\\r\\nThis project is licenced under AGPL-3.0.\\r\\nThe SVG paths that make up some node types are public domain and sourced from wikimedia commons. These have been called out where used.\\r\\n\\r\\n## Alternatives\\r\\n\\r\\nThere are a few notable digital (and analog) circuit editors that I have come across and arbitrarily collected. Many more exist in the wild.\\r\\n\\r\\nOpen source:\\r\\n\\r\\n* http://www.cburch.com/logisim/ (desktop app, java)\\r\\n* https://github.com/willymcallister/circuit-sandbox (online, javascript, analog)\\r\\n\\r\\nClosed source:\\r\\n\\r\\n* https://www.circuitlab.com/ (online)\\r\\n* https://simulator.io/ (online)\\r\\n\""],"sourceRoot":""}