{"version":3,"sources":["webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/CircuitField.module.css?afa1","webpack:///./src/components/PopupMenu/PopupMenu.module.css?6172","webpack:///./src/node-defs/node-and.ts","webpack:///./src/node-defs/node-or.ts","webpack:///./src/node-defs/node-nor.ts","webpack:///./src/node-defs/node-not.ts","webpack:///./src/node-defs/node-buffer.ts","webpack:///./src/node-defs/node-led.ts","webpack:///./src/node-defs/node-toggle.ts","webpack:///./src/node-defs/node-seg7.ts","webpack:///./src/pages/Intro/Intro.module.css?62f7","webpack:///./src/geometry.ts","webpack:///./src/services/clipboard/state.ts","webpack:///./src/services/field/state.ts","webpack:///./src/services/graph/state.ts","webpack:///./src/services/selection/state.ts","webpack:///./src/services/simulator/state.ts","webpack:///./src/services/view/state.ts","webpack:///./src/store/state.ts","webpack:///./src/pages/CircuitEditor/state.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/state.ts","webpack:///./src/actions/init.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/actions/drag-continue.ts","webpack:///./src/actions/sim-tick.ts","webpack:///./src/actions/view-zoom.ts","webpack:///./src/store/devtool-sanitizer.ts","webpack:///./src/actions/sim-start.ts","webpack:///./src/utils.ts","webpack:///./src/services/service-state-utils.ts","webpack:///./src/services/simulator/utils.ts","webpack:///./src/services/simulator/selectors/run.ts","webpack:///./src/services/simulator/saga/mode-run.ts","webpack:///./src/services/simulator/saga/index.ts","webpack:///./src/store/utils.ts","webpack:///./src/actions/clipboard-copy.ts","webpack:///./src/node-defs/index.ts","webpack:///./src/services/graph/utils.ts","webpack:///./src/services/graph/selectors/nodes.ts","webpack:///./src/services/graph/selectors/wires.ts","webpack:///./src/services/field/utils.ts","webpack:///./src/services/field/selectors/positions.ts","webpack:///./src/services/clipboard/utils.ts","webpack:///./src/services/clipboard/reducer/clipboard-copy.ts","webpack:///./src/actions/wire-attach.ts","webpack:///./src/actions/node-add.ts","webpack:///./src/actions/clipboard-paste.ts","webpack:///./src/actions/select-nodes.ts","webpack:///./src/services/clipboard/reducer/clipboard-paste.ts","webpack:///./src/services/clipboard/reducer/index.ts","webpack:///./src/actions/file-new.ts","webpack:///./src/services/field/reducer/file-new.ts","webpack:///./src/services/field/reducer/node-add.ts","webpack:///./src/actions/node-delete.ts","webpack:///./src/services/field/reducer/node-delete.ts","webpack:///./src/actions/selection-move.ts","webpack:///./src/services/selection/utils.ts","webpack:///./src/services/selection/selectors/selection.ts","webpack:///./src/services/field/reducer/selection-move.ts","webpack:///./src/services/field/reducer/wire-attach.ts","webpack:///./src/actions/wire-detatch.ts","webpack:///./src/services/field/reducer/wire-detatch.ts","webpack:///./src/actions/wire-joint-add.ts","webpack:///./src/services/field/reducer/wire-joint-add.ts","webpack:///./src/actions/wire-joint-delete.ts","webpack:///./src/services/field/reducer/wire-joint-delete.ts","webpack:///./src/actions/wire-joint-move.ts","webpack:///./src/services/field/reducer/index.ts","webpack:///./src/services/field/reducer/wire-joint-move.ts","webpack:///./src/services/graph/reducer/file-new.ts","webpack:///./src/services/graph/reducer/node-add.ts","webpack:///./src/services/graph/reducer/index.ts","webpack:///./src/services/graph/reducer/node-delete.ts","webpack:///./src/services/graph/reducer/wire-attach.ts","webpack:///./src/services/graph/types.ts","webpack:///./src/services/graph/reducer/wire-detatch.ts","webpack:///./src/services/savedata/reducer/autosave.ts","webpack:///./src/services/savedata/reducer/index.ts","webpack:///./src/services/savedata/utils.ts","webpack:///./src/services/savedata/reducer/file-new.ts","webpack:///./src/services/savedata/reducer/init.ts","webpack:///./src/services/selection/reducer/file-new.ts","webpack:///./src/services/selection/reducer/node-delete.ts","webpack:///./src/actions/select-all.ts","webpack:///./src/services/field/selectors/wires.ts","webpack:///./src/services/selection/reducer/select-all.ts","webpack:///./src/actions/select-clear.ts","webpack:///./src/services/selection/reducer/select-clear.ts","webpack:///./src/actions/select-wire-joints.ts","webpack:///./src/services/selection/reducer/select-joints.ts","webpack:///./src/services/selection/reducer/select-nodes.ts","webpack:///./src/actions/select-region.ts","webpack:///./src/node-defs/utils.ts","webpack:///./src/services/simulator/selectors/nodes.ts","webpack:///./src/services/field/selectors/bounds.ts","webpack:///./src/services/selection/reducer/select-region.ts","webpack:///./src/actions/select-wires.ts","webpack:///./src/services/selection/reducer/select-wires.ts","webpack:///./src/actions/selection-copy.ts","webpack:///./src/actions/selection-delete.ts","webpack:///./src/services/selection/reducer/index.ts","webpack:///./src/services/selection/reducer/selection-copy.ts","webpack:///./src/services/selection/reducer/selection-delete.ts","webpack:///./src/services/selection/reducer/wire-detatch.ts","webpack:///./src/services/simulator/reducer/file-new.ts","webpack:///./src/services/simulator/reducer/node-add.ts","webpack:///./src/services/simulator/reducer/utils.ts","webpack:///./src/services/simulator/reducer/node-delete.ts","webpack:///./src/actions/node-interact.ts","webpack:///./src/services/simulator/reducer/node-interact.ts","webpack:///./src/services/simulator/reducer/sim-evolve.ts","webpack:///./src/actions/sim-fastforward.ts","webpack:///./src/services/simulator/reducer/sim-start.ts","webpack:///./src/actions/sim-stop.ts","webpack:///./src/services/simulator/reducer/sim-stop.ts","webpack:///./src/services/simulator/reducer/wire-attach.ts","webpack:///./src/services/simulator/reducer/wire-detatch.ts","webpack:///./src/services/simulator/reducer/index.ts","webpack:///./src/services/simulator/reducer/sim-fastforward.ts","webpack:///./src/services/view/utils.ts","webpack:///./src/services/view/reducer/view-zoom.ts","webpack:///./src/services/view/reducer/index.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/reducer/utils.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/reducer/drag-continue.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/actions/drag-end.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/actions/drag-start-node.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/actions/drag-start-select.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/reducer/drag-start-select.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/actions/select-pin.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/selectors.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/reducer/select-pin.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/reducer/selected-nodes-changed.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/reducer/index.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/reducer/drag-end.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/reducer/drag-start-node.ts","webpack:///./src/pages/CircuitEditor/reducer/index.ts","webpack:///./src/store/reducer.ts","webpack:///./src/store/store.ts","webpack:///./src/store/saga.ts","webpack:///./src/hooks/useSelector.ts","webpack:///./src/services/view/selectors/view.ts","webpack:///./src/runtime-env.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/keymap.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/contexts/fieldSvgElement.tsx","webpack:///./src/pages/CircuitEditor/components/NodeVisual.tsx","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/components/DragPreviewLayer.tsx","webpack:///./src/hooks/useMouseTracking.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/selection-mode.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/utils.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/hooks/useMouseCoords.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/components/DragSelectLayer.tsx","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/components/WireSegment.tsx","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/components/WireJoint.tsx","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/components/Wire.tsx","webpack:///./src/services/simulator/selectors/wires.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/components/WiresLayer.tsx","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/components/CircuitNodePin.tsx","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/components/CircuitNode.tsx","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/components/NodesLayer.tsx","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/CircuitField.tsx","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/index.ts","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/CircuitFieldView.tsx","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/index.ts","webpack:///./src/hooks/useNativeEvent.ts","webpack:///./src/pages/CircuitEditor/components/ElementTray/ElementTray.tsx","webpack:///./src/pages/CircuitEditor/components/ElementTray/index.ts","webpack:///./src/pages/CircuitEditor/CircuitEditor.tsx","webpack:///./src/pages/CircuitEditor/index.ts","webpack:///./src/pages/Intro/Intro.tsx","webpack:///./src/pages/Intro/index.ts","webpack:///./README.md","webpack:///./src/components/PopupMenu/popupMenuContext.ts","webpack:///./src/components/Popper.tsx","webpack:///./src/components/PopupMenu/PopupMenu.tsx","webpack:///./src/components/PopupMenu/index.ts","webpack:///./src/components/MenuItem/MenuItem.tsx","webpack:///./src/components/MenuItem/index.ts","webpack:///./src/components/Icons/Play.tsx","webpack:///./src/components/Icons/Stop.tsx","webpack:///./src/components/SimControls/SimControls.tsx","webpack:///./src/components/SimControls/index.ts","webpack:///./src/components/TitleBar/TitleBar.tsx","webpack:///./src/components/TitleBar/index.ts","webpack:///./src/hooks/useAction.ts","webpack:///./src/components/App/App.tsx","webpack:///./src/components/App/index.ts","webpack:///./src/env.ts","webpack:///./src/index.tsx","webpack:///./src/pages/CircuitEditor/components/ElementTray/ElementTray.module.css?5ac7","webpack:///./src/pages/CircuitEditor/CircuitEditor.module.css?cdec","webpack:///./src/components/TitleBar/TitleBar.module.css?40f1","webpack:///./src/styles/flex.module.css?5bb3","webpack:///./src/styles/sizing.module.css?e889","webpack:///./src/pages/CircuitEditor/components/CircuitFieldView/CircuitFieldView.module.css?848f","webpack:///./src/components/SimControls/SimControls.module.css?20e5"],"names":["module","exports","andNodeDefinition","type","visual","hitPath","shapePath","pins","A","name","direction","x","y","B","OUT","evolve","state","inputs","tick","transitions","tickOffset","value","orNodeDefinition","norNodeDefinition","bufferNodeDefinition","IN","genCirclePath","cx","cy","r","ledNodeDefinition","path","fill","defaultToggleState","toggleState","toggleSwitchNodeDefinition","interact","SCALE","OFFSET","createSeg","points","start","p","slice","seg7NodeDefinition","C","D","E","F","G","ZeroPoint","Object","freeze","normalize","m","v","Math","sqrt","normalizeRectangle","args","p1","p2","length","min","max","pointAdd","pointSubtract","defaultClipboardState","clipboardNodes","clipboardPasteOrigin","defaultFieldState","width","height","nodePositionsById","wireJointIdsByWireId","wireJointPositionsByJointId","defaultGraphState","nodesById","wiresById","defaultSelectionState","selectedNodeIds","selectedWireIds","selectedJointIds","defaultSimulatorState","mode","ticksPerSecond","nodeStatesByNodeId","nodeOutputValuesByNodeId","transitionsById","transitionWindows","defaultViewState","scale","_defaultAppState","services","clipboard","field","graph","selection","simulator","view","ui","circuitEditor","circuitField","dragMode","dragStart","dragEnd","selectedPin","defaultAppState","ACTION_INIT","ACTION_DRAG_CONTINUE","dragContinue","payload","ACTION_SIM_TICK","tickSim","tickCount","ACTION_VIEW_ZOOM","actionsBlacklist","ACTION_SIM_START","cls","values","filter","Boolean","join","fpSet","target","firstPaths","map","String","lastPath","newData","clone","seg","obj","Array","isArray","createServiceReducerCreator","service","reducer","action","newState","createServiceSelectorCreator","selector","appSelector","s","local","createSimulatorReducer","createSimulatorSelector","isRunningSelector","ticksPerSecondSelector","runModeSaga","handleRunSim","tps","timeToWait","ceil","simulatorSaga","reduceReducers","reducers","reduce","ACTION_COPY_NODES","nodeId","nodeIds","NodeTypes","and","default","or","nor","not","buffer","led","toggle","seg7","createGraphReducer","createGraphSelector","nodesByIdSelector","nodeIdsSelector","keys","nodeTypesByIdSelector","n","nodeDefsByIdSelector","nodeSelector","nodeTypeSelector","node","nodeDefSelector","wireIdsSelector","connectionsSelector","wireId","nodePinDirectionSelector","pin","def","pinDef","pinId","nodeInputConnectionsByPinSelector","_","connections","nodeDef","inputPins","inputConnections","inputPin","result","connection","outputPin","nodeOutputConnectionsSelector","nodeOutputConnectionsByPinSelector","outputPins","outputConnections","push","createFieldReducer","createFieldSelector","nodePositionsByIdSelector","nodePositionSelector","createClipboardReducer","appState","isCopyNodesAction","copyIds","rootPosition","copyNodes","outputs","id","offset","conns","nodeIsSelected","c","ACTION_WIRE_ATTACH","attachWire","isAttachWireAction","ACTION_NODE_ADD","nodeType","opts","isAddNodeAction","ACTION_PASTE","paste","ACTION_SELECT_NODES","selectNodes","CLIPBOARD_PASTE_OFFSET","isPasteAction","pastePosition","pasteIds","position","sourceId","output","targetCopyId","targetPin","targetId","ACTION_FILE_NEW","newFile","isNewFileAction","ACTION_NODE_DELETE","deleteNode","isDeleteNodeAction","ACTION_SELECTION_MOVE","moveSelection","offsetX","offsetY","createSelectionReducer","createSelectionSelector","combineSelection","selectedIds","chosenIds","concat","selectedNodeIdsSelector","isNodeSelectedSelector","indexOf","isWireSelectedSelector","selectedJointIdsSelector","isJointSelectedSelector","jointId","isMoveSelectionAction","movedNodePositions","jointIds","movedJoints","ACTION_WIRE_DETATCH","detatchWire","isDetatchWireAction","remainingWireIds","ACTION_WIRE_JOINT_ADD","isAddWireJointAction","addAfterJointId","wireJoints","insertionIndex","ACTION_WIRE_JOINT_DELETE","deleteWireJoint","isDeleteWireJointAction","remainingJointIds","wireIds","wireJointsByJointId","ACTION_WIRE_JOINT_MOVE","moveWireJoint","isMoveWireJointAction","remainingIds","conn","p1Node","p2Node","p1Def","p2Def","p1Pin","p2Pin","pinsToConnection","a","b","nodePinEquals","AUTOSAVE_TRIGGERS","save","localStorage","setItem","JSON","stringify","storeAutosave","createSave","removeItem","isInitAction","str","getItem","parse","loadAutosave","loadSave","ACTION_SELECT_CLEAR","selectAll","startPositionCacheByWireId","endPositionCacheByWireId","allJointIdsSelector","wireJointIdsSelector","wireJointPositionSelector","isSelectAllAction","isClearSelectionAction","ACTION_SELECT_WIRE_JOINTS","isSelectWireJointsAction","isSelectNodesAction","ACTION_SELECT_REGION","selectRegion","region","normalizeVisuals","stroke","strokeWidth","inputsOf","outputsOf","nodeStatesByIdSelector","nodeStateSelector","nodeOutputPinValue","fieldWidthSelector","fieldHeightSelector","nodeBoundsById","nodeDefsById","nodeStateById","shapePaths","nodeRectsByIdSelector","positionsById","boundsById","bounds","isSelectRegionAction","rects","chosenNodeIds","rect","r1","r2","intersects","ACTION_SELECT_WIRES","isSelectWiresAction","ACTION_SELECTION_COPY","selectionCopy","ACTION_SELECTION_DELETE","selectionDelete","isSelectionCopyAction","selectedNodes","isSelectionDeleteAction","undefined","nodeState","outputValues","simInit","initNode","collectNodeTransitions","inputConnectionsByPin","inputConn","sourceNodeId","sourcePin","nodeOutputs","outputId","transitionTick","removeTransitionByPin","addTransition","transitionId","newTransition","index","newWindow","transitionIds","splice","transition","t","removeTransitionById","transitionWindowIndex","transitionWindow","tickWindowTransitionIndex","removeTransitionIds","remainingNodeIds","deleteNodeById","ACTION_NODE_INTERACT","isInteractNodeAction","isTickSimAction","endTick","saftyCount","Error","window","shift","tickWindow","updatedNodes","tid","outConn","ACTION_SIM_FASTFORWARD","fastForwardSim","isStartSimAction","ACTION_SIM_STOP","isStopSimAction","isFastForwardSimAction","nextWindowTick","createViewReducer","createViewSelector","isViewZoomAction","delta","isDragContinueAction","ACTION_DRAG_END","point","selectionMode","ACTION_DRAG_START_NODE","ACTION_DRAG_START_SELECT","isDragStartSelectAction","ACTION_SELECT_PIN","circuitFieldState","selectionRectSelector","dragMoveOffsetSelector","selectedPinSelector","doSelectPinReducer","fieldState","SELECTED_NODE_CHANGE_ACTIONS","circuitFieldReducer","isDragEndAction","moveBy","isDragStartNodeAction","isSelectPinAction","clickedPinDirection","selectedPinDirection","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","actionSanitizer","stateSanitizer","sagaMiddleware","store","run","dispatch","doInit","useSelector","viewScaleSelector","keyboardIsMac","test","toString","keyboardCommandModifier","fieldSvgElementContext","ContextProvider","Provider","FieldSvgElementProvider","children","svgElement","setSvgElement","current","colorOverride","renderPin","onClick","onMouseDown","onMouseOver","onMouseUp","onMouseLeave","this","props","console","warn","body","i","key","d","element","transform","className","stateSelectors","selectedNodePositionsById","selectedNodeTypesById","nodeTypesById","selectedNodeStatesById","nodeStatesById","dragMoveOffset","mapStateToProps","elements","opacity","useMouseTracking","dragThreshold","onDragStart","onDragMove","onDragEnd","isTracking","setTracking","isTrackingRef","isDraggingRef","mouseDownRef","startTracking","e","pageX","pageY","cancelTracking","document","addEventListener","onMouseMove","removeEventListener","abs","getModifiers","ctrlKey","altKey","shiftKey","metaKey","ctrlMetaKey","getSelectMode","modifiers","getFieldCoord","ctm","getScreenCTM","pt","createSVGPoint","translated","matrixTransform","inverse","useEventMouseCoords","fieldRef","selectionRect","getCoords","clearSelection","dragStartSelect","defaultPrevented","preventDefault","strokeDasharray","startJointId","endJointId","color","getMouseCoords","nodePosition","cacheData","inputNodeDef","inputNodePosition","outputPosition","wireStartPositionSelector","end","wireEndPositionSelector","mousePos","setMousePos","addedJointRef","addWireJoint","selectWires","onJointInsertMouseDown","insertJointPos","lineDir","scaler","dotProduct","x1","y1","x2","y2","isSelected","mouseOver","setMouseOver","onJointDragMove","selectWireJoints","startMoveJointTracking","onMouseOut","mouseDown","wireValueSelector","segmentElements","jointElements","connectorElements","stopPropagation","selectPin","interactNode","dragStartNode","nodeElements","svgRef","focus","style","tabIndex","ref","viewRef","keyHandlers","createEventDispatcher","listener","options","listenTarget","useNativeEvent","viewZoom","deltaY","passive","keyMap","handlers","mapDispatchToProps","addNode","typedKeys","editor","dismiss","intro","href","source","onClose","isOpen","placement","anchorEl","contentRef","popperRef","handleClose","destroy","popperNode","preventOverflow","boundariesElement","handleOpen","contentNode","divProps","popupmenu","enabled","onClickOutside","onEscapeKey","title","childPlacement","onClosePopup","setOpen","isParentItem","count","onItemClick","item","popup","Play","Stop","isRunning","onPlayClick","startSim","onStopClick","stopSim","onFileNew","actionCreator","useAction","titlebar","introShown","setIntroShown","onDismiss","rootEl","getElementById"],"mappings":"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","file":"client.dc24496dcaef324a221b.bundle.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"circuit-editor\":\"CircuitField-module__circuit-editor___Xrh6Y\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"popupmenu\":\"PopupMenu-module__popupmenu___Z6R_G\"};","import { NodeDefinition } from \"./types\";\r\n\r\nconst andNodeDefinition: NodeDefinition = {\r\n  type: \"and\",\r\n  visual: {\r\n    hitPath: `\r\n      M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30z\r\n    `,\r\n    // https://commons.wikimedia.org/wiki/File:AND_ANSI.svg\r\n    shapePath: `\r\n      M70 25h25\r\n      M31 15H5\r\n      M32 35H5\r\n      M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30z\r\n      m2.857143 2.857143H50.47619c9.760663 0 16.666667 7.639955 16.666667 17.142857 0 9.502902-7.382195 17.142857-17.142857 17.142857H32.857143V7.857143z\r\n    `\r\n  },\r\n  pins: {\r\n    A: {\r\n      name: \"A\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 14.5\r\n    },\r\n    B: {\r\n      name: \"B\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 35\r\n    },\r\n    OUT: {\r\n      name: \"OUT\",\r\n      direction: \"output\",\r\n      x: 100,\r\n      y: 25\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 4,\r\n          value: inputs.A && inputs.B\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default andNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nconst orNodeDefinition: NodeDefinition = {\r\n  type: \"or\",\r\n  visual: {\r\n    hitPath: `\r\n    M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z\r\n    `,\r\n    // https://commons.wikimedia.org/wiki/File:OR_ANSI.svg\r\n    shapePath: `\r\n      M70 25h25\r\n      M31 15H5\r\n      M32 35H5\r\n      M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z\r\n      m5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z\r\n    `\r\n  },\r\n  pins: {\r\n    A: {\r\n      name: \"A\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 14.5\r\n    },\r\n    B: {\r\n      name: \"B\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 35\r\n    },\r\n    OUT: {\r\n      name: \"OUT\",\r\n      direction: \"output\",\r\n      x: 100,\r\n      y: 25\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 4,\r\n          value: inputs.A || inputs.B\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default orNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nconst norNodeDefinition: NodeDefinition = {\r\n  type: \"nor\",\r\n  visual: {\r\n    hitPath: `\r\n    M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z\r\n    `,\r\n    // https://commons.wikimedia.org/wiki/File:NOR_ANSI.svg\r\n    shapePath: `\r\n      M79 25h16M31 15H5M32 35H5\r\n      \r\n      M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375z\r\n      m5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z\r\n      M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z\r\n    `\r\n  },\r\n  pins: {\r\n    A: {\r\n      name: \"A\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 14.5\r\n    },\r\n    B: {\r\n      name: \"B\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 35\r\n    },\r\n    OUT: {\r\n      name: \"OUT\",\r\n      direction: \"output\",\r\n      x: 100,\r\n      y: 25\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 4,\r\n          value: !(inputs.A || inputs.B)\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default norNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nconst bufferNodeDefinition: NodeDefinition = {\r\n  type: \"not\",\r\n  visual: {\r\n    hitPath: `\r\n    M28.96875 2.59375v44.8125l2.15625-1.0625 41.03125-20v-2.6875l-41.03125-20-2.15625-1.0625z\r\n    `,\r\n    // https://commons.wikimedia.org/wiki/File:NOT_ANSI.svg\r\n    shapePath: `\r\n      M79.15691 25H95\r\n      M29.043478 25h-24\r\n      M28.96875 2.59375v44.8125l2.15625-1.0625 41.03125-20v-2.6875l-41.03125-20-2.15625-1.0625z\r\n      m3 4.8125L68.09375 25l-36.125 17.59375V7.40625z\r\n      M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z\r\n    `\r\n  },\r\n  pins: {\r\n    IN: {\r\n      name: \"IN\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 25\r\n    },\r\n    OUT: {\r\n      name: \"OUT\",\r\n      direction: \"output\",\r\n      x: 100,\r\n      y: 25\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 4,\r\n          value: !inputs.IN\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default bufferNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nconst bufferNodeDefinition: NodeDefinition = {\r\n  type: \"buffer\",\r\n  visual: {\r\n    hitPath: `\r\n    M 28.96875,2.59375 L 28.96875,5 L 28.96875,45 L 28.96875,47.40625 L 31.125,46.34375 L 72.15625,26.34375 L 75,25 L 72.15625,23.65625 L 31.125,3.65625 L 28.96875,2.59375 z\r\n    `,\r\n    // https://commons.wikimedia.org/wiki/File:Buffer_ANSI.svg\r\n    shapePath: `\r\n      M 72,25 L 95.085706,25\r\n      M 29.043478,25 L 5.0434781,25\r\n      M 28.96875,2.59375 L 28.96875,5 L 28.96875,45 L 28.96875,47.40625 L 31.125,46.34375 L 72.15625,26.34375 L 75,25 L 72.15625,23.65625 L 31.125,3.65625 L 28.96875,2.59375 z M 31.96875,7.40625 L 68.09375,25 L 31.96875,42.59375 L 31.96875,7.40625 z\r\n    `\r\n  },\r\n  pins: {\r\n    IN: {\r\n      name: \"IN\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 25\r\n    },\r\n    OUT: {\r\n      name: \"OUT\",\r\n      direction: \"output\",\r\n      x: 100,\r\n      y: 25\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 2,\r\n          value: inputs.IN\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default bufferNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nfunction genCirclePath(cx: number, cy: number, r: number): string {\r\n  return `M ${cx - r}, ${cy}\r\n    a ${r},${r} 0 1,0 ${r * 2},0\r\n    a ${r},${r} 0 1,0 ${-(r * 2)},0`;\r\n}\r\n\r\nconst ledNodeDefinition: NodeDefinition = {\r\n  type: \"led\",\r\n  visual: {\r\n    shapePath: [\r\n      genCirclePath(25, 25, 25),\r\n      {\r\n        path: genCirclePath(25, 25, 20),\r\n        fill: state => (state.value ? \"lightgreen\" : \"darkgreen\")\r\n      }\r\n    ]\r\n  },\r\n  pins: {\r\n    IN: {\r\n      name: \"IN\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 25\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      state: {\r\n        value: inputs.IN\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default ledNodeDefinition;\r\n","import { NodeDefinition } from \"./types\";\r\n\r\ninterface ToggleState {\r\n  toggleState: boolean;\r\n}\r\nconst defaultToggleState: ToggleState = {\r\n  toggleState: false\r\n};\r\n\r\nconst toggleSwitchNodeDefinition: NodeDefinition = {\r\n  type: \"toggle\",\r\n  visual: {\r\n    shapePath: {\r\n      path: `M0,0 L0,50 L25,50 L25,0 z`,\r\n      fill: (state: ToggleState) => (state.toggleState ? \"green\" : \"red\")\r\n    }\r\n  },\r\n  pins: {\r\n    OUT: {\r\n      name: \"OUT\",\r\n      direction: \"output\",\r\n      x: 25,\r\n      y: 25\r\n    }\r\n  },\r\n  interact(state: ToggleState = defaultToggleState) {\r\n    return {\r\n      ...state,\r\n      toggleState: !state.toggleState\r\n    };\r\n  },\r\n  evolve(state = defaultToggleState, inputs, tick) {\r\n    return {\r\n      state,\r\n      transitions: {\r\n        OUT: {\r\n          tickOffset: 1,\r\n          value: state.toggleState\r\n        }\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default toggleSwitchNodeDefinition;\r\n","import { NodeDefinition, NodeVisualPathDefinition } from \"./types\";\r\n\r\nconst SCALE = 3;\r\nconst OFFSET = [15, 0];\r\n\r\n/**\r\n * Produce a visual path definition of a segment given a series of polygon points.\r\n * The path definition will color itself based on the state key specified by 'name'\r\n * @param name The state key to select color based on.  The key should represent a boolean value.\r\n * @param points An array of [x,y] pairs that make up the polygon.\r\n */\r\nfunction createSeg(\r\n  name: string,\r\n  points: [number, number][]\r\n): NodeVisualPathDefinition {\r\n  const start = points[0];\r\n  let path = `M${start[0] * SCALE + OFFSET[0]},${start[1] * SCALE + OFFSET[1]}`;\r\n  for (let p of points.slice(1)) {\r\n    const [x, y] = p;\r\n    path += `L${x * SCALE + OFFSET[0]},${y * SCALE + OFFSET[1]}`;\r\n  }\r\n  path += \"z\";\r\n  return {\r\n    path,\r\n    fill: state => (state[name] ? \"red\" : \"gray\")\r\n  };\r\n}\r\n\r\nconst seg7NodeDefinition: NodeDefinition = {\r\n  type: \"seg7\",\r\n  visual: {\r\n    hitPath: `M0,0 V63 H45 V0 z`,\r\n    // https://commons.wikimedia.org/wiki/File:7-segment_abcdefg.svg\r\n    shapePath: [\r\n      createSeg(\"A\", [\r\n        [1, 1],\r\n        [2, 0],\r\n        [8, 0],\r\n        [9, 1],\r\n        [8, 2],\r\n        [2, 2]\r\n      ]),\r\n      createSeg(\"B\", [\r\n        [9, 1],\r\n        [10, 2],\r\n        [10, 8],\r\n        [9, 9],\r\n        [8, 8],\r\n        [8, 2]\r\n      ]),\r\n      createSeg(\"C\", [\r\n        [9, 9],\r\n        [10, 10],\r\n        [10, 16],\r\n        [9, 17],\r\n        [8, 16],\r\n        [8, 10]\r\n      ]),\r\n      createSeg(\"D\", [\r\n        [9, 17],\r\n        [8, 18],\r\n        [2, 18],\r\n        [1, 17],\r\n        [2, 16],\r\n        [8, 16]\r\n      ]),\r\n      createSeg(\"E\", [\r\n        [1, 17],\r\n        [0, 16],\r\n        [0, 10],\r\n        [1, 9],\r\n        [2, 10],\r\n        [2, 16]\r\n      ]),\r\n      createSeg(\"F\", [\r\n        [1, 9],\r\n        [0, 8],\r\n        [0, 2],\r\n        [1, 1],\r\n        [2, 2],\r\n        [2, 8]\r\n      ]),\r\n      createSeg(\"G\", [\r\n        [1, 9],\r\n        [2, 8],\r\n        [8, 8],\r\n        [9, 9],\r\n        [8, 10],\r\n        [2, 10]\r\n      ])\r\n    ]\r\n  },\r\n  pins: {\r\n    A: {\r\n      name: \"A\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 5\r\n    },\r\n    B: {\r\n      name: \"B\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 15\r\n    },\r\n    C: {\r\n      name: \"C\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 25\r\n    },\r\n    D: {\r\n      name: \"D\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 35\r\n    },\r\n    E: {\r\n      name: \"E\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 45\r\n    },\r\n    F: {\r\n      name: \"F\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 55\r\n    },\r\n    G: {\r\n      name: \"G\",\r\n      direction: \"input\",\r\n      x: 0,\r\n      y: 65\r\n    }\r\n  },\r\n  evolve(state, inputs, tick) {\r\n    return {\r\n      state: { ...inputs }\r\n    };\r\n  }\r\n};\r\nexport default seg7NodeDefinition;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"intro\":\"Intro-module__intro___11OUj\",\"intro-content\":\"Intro-module__intro-content___3fJQP\",\"intro-header\":\"Intro-module__intro-header___38sbJ\",\"intro-markdown\":\"Intro-module__intro-markdown___1qZ0W\",\"intro-dismiss\":\"Intro-module__intro-dismiss___2fMU7\"};","import { Point, Size, Rectangle } from \"@/types\";\r\n\r\nexport const ZeroPoint = Object.freeze({ x: 0, y: 0 });\r\n\r\nexport function magnitude(v: Point): number {\r\n  return Math.sqrt(v.x * v.x + v.y * v.y);\r\n}\r\nexport function normalize(p: Point): Point {\r\n  const m = magnitude(p);\r\n  return {\r\n    x: p.x / m,\r\n    y: p.y / m\r\n  };\r\n}\r\n\r\nexport function dotProduct(a: Point, b: Point): number {\r\n  return a.x * b.x + a.y * b.y;\r\n}\r\n\r\nexport function scale(p: Point, scaler: number) {\r\n  return { x: p.x * scaler, y: p.y * scaler };\r\n}\r\n\r\nexport function normalizeRectangle(p1: Point, p2: Point): Rectangle;\r\nexport function normalizeRectangle(r: Rectangle): Rectangle;\r\nexport function normalizeRectangle(...args: any[]): Rectangle {\r\n  let p1: Point;\r\n  let p2: Point;\r\n  if (args.length === 1) {\r\n    const r = args[0] as Rectangle;\r\n    p1 = r.p1;\r\n    p2 = r.p2;\r\n  } else {\r\n    p1 = args[0] as Point;\r\n    p2 = args[1] as Point;\r\n  }\r\n  return {\r\n    p1: {\r\n      x: Math.min(p1.x, p2.x),\r\n      y: Math.min(p1.y, p2.y)\r\n    },\r\n    p2: {\r\n      x: Math.max(p1.x, p2.x),\r\n      y: Math.max(p1.y, p2.y)\r\n    }\r\n  };\r\n}\r\n\r\nexport function pointAdd(p1: Point, p2: Point): Point {\r\n  return {\r\n    x: p1.x + p2.x,\r\n    y: p1.y + p2.y\r\n  };\r\n}\r\nexport function pointSubtract(p1: Point, p2: Point): Point {\r\n  return {\r\n    x: p1.x - p2.x,\r\n    y: p1.y - p2.y\r\n  };\r\n}\r\n\r\nexport function calcSize(r: Rectangle): Size {\r\n  r = normalizeRectangle(r);\r\n  return {\r\n    width: r.p2.x - r.p1.x,\r\n    height: r.p2.y - r.p1.y\r\n  };\r\n}\r\n\r\nexport function intersects(r1: Rectangle, r2: Rectangle) {\r\n  r1 = normalizeRectangle(r1);\r\n  r2 = normalizeRectangle(r2);\r\n\r\n  // r1 starts after p2's extent, or does not reach r2's start.\r\n  if (r1.p1.x > r2.p2.x || r1.p2.x < r2.p1.x) {\r\n    return false;\r\n  }\r\n\r\n  // r1 starts after p2's extent, or does not reach r2's start.\r\n  if (r1.p1.y > r2.p2.y || r1.p2.y < r2.p1.y) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n","import { Point } from \"@/types\";\r\nimport { ZeroPoint } from \"@/geometry\";\r\n\r\nimport { ClipboardNode } from \"./types\";\r\n\r\nexport interface ClipboardState {\r\n  clipboardNodes: ClipboardNode[];\r\n  clipboardPasteOrigin: Point;\r\n}\r\n\r\nexport const defaultClipboardState: Readonly<ClipboardState> = Object.freeze({\r\n  clipboardNodes: [],\r\n  clipboardPasteOrigin: ZeroPoint\r\n});\r\n","import { IDMap, Point } from \"@/types\";\r\n\r\nexport interface FieldState {\r\n  width: number;\r\n  height: number;\r\n  nodePositionsById: IDMap<Point>;\r\n  wireJointIdsByWireId: IDMap<string[]>;\r\n  wireJointPositionsByJointId: IDMap<Point>;\r\n}\r\n\r\nconst _defaultState: FieldState = {\r\n  width: 1024,\r\n  height: 768,\r\n  nodePositionsById: {},\r\n  wireJointIdsByWireId: {},\r\n  wireJointPositionsByJointId: {}\r\n};\r\n\r\nexport const defaultFieldState: Readonly<FieldState> = Object.freeze(\r\n  _defaultState\r\n);\r\n","import { IDMap } from \"@/types\";\r\n\r\nimport { Wire, GraphNode } from \"./types\";\r\n\r\nexport interface GraphState {\r\n  /**\r\n   * A map of nodes by node id.\r\n   */\r\n  nodesById: IDMap<GraphNode>;\r\n\r\n  /**\r\n   * A map of wires connecting nodes.\r\n   */\r\n  wiresById: IDMap<Wire>;\r\n}\r\n\r\nconst _defaultState: GraphState = {\r\n  nodesById: {},\r\n  wiresById: {}\r\n};\r\n\r\nexport const defaultGraphState = Object.freeze(_defaultState);\r\n","export interface SelectionState {\r\n  selectedNodeIds: string[];\r\n  selectedWireIds: string[];\r\n  selectedJointIds: string[];\r\n}\r\n\r\nconst _defaultState: SelectionState = {\r\n  selectedNodeIds: [],\r\n  selectedWireIds: [],\r\n  selectedJointIds: []\r\n};\r\n\r\nexport const defaultSelectionState = Object.freeze(_defaultState);\r\n","import { IDMap } from \"@/types\";\r\n\r\nimport { SimNodePinTransition, SimTransitionWindow } from \"./types\";\r\n\r\nexport interface SimulatorState {\r\n  /**\r\n   * The overall application mode.\r\n   * Might not belong in simulator state?\r\n   *\r\n   * - edit: User is editing, no simulator is running\r\n   * - step: Sim is paused and only ticks on user command\r\n   * - run: Sim is actively running and ticking forwards on its own.\r\n   */\r\n  mode: \"edit\" | \"step\" | \"run\";\r\n\r\n  /**\r\n   * Tick speed in ticks per second when running.\r\n   */\r\n  ticksPerSecond: number;\r\n\r\n  /**\r\n   * The current tick the simulator is on.\r\n   */\r\n  tick: number;\r\n\r\n  /**\r\n   * A map of node states by node id.\r\n   */\r\n  nodeStatesByNodeId: IDMap<any>;\r\n\r\n  /**\r\n   * A map of output-to-value maps by node id.\r\n   */\r\n  nodeOutputValuesByNodeId: IDMap<IDMap<boolean>>;\r\n\r\n  /**\r\n   * A map of pending transitions by id.\r\n   */\r\n  transitionsById: IDMap<SimNodePinTransition>;\r\n\r\n  /**\r\n   * Transition windows in ascending order of tick.\r\n   */\r\n  transitionWindows: SimTransitionWindow[];\r\n}\r\n\r\nconst _defaultState: SimulatorState = {\r\n  mode: \"edit\",\r\n  ticksPerSecond: 10,\r\n  tick: 0,\r\n  nodeStatesByNodeId: {},\r\n  nodeOutputValuesByNodeId: {},\r\n  transitionsById: {},\r\n  transitionWindows: []\r\n};\r\n\r\nexport const defaultSimulatorState = Object.freeze(_defaultState);\r\n","export interface ViewState {\r\n  scale: number;\r\n}\r\n\r\nconst _defaultState: ViewState = {\r\n  scale: 1\r\n};\r\n\r\nexport const defaultViewState = Object.freeze(_defaultState);\r\n","import {\r\n  ClipboardState,\r\n  defaultClipboardState\r\n} from \"@/services/clipboard/state\";\r\nimport { FieldState, defaultFieldState } from \"@/services/field/state\";\r\nimport { GraphState, defaultGraphState } from \"@/services/graph/state\";\r\nimport {\r\n  SelectionState,\r\n  defaultSelectionState\r\n} from \"@/services/selection/state\";\r\nimport {\r\n  SimulatorState,\r\n  defaultSimulatorState\r\n} from \"@/services/simulator/state\";\r\nimport { ViewState, defaultViewState } from \"@/services/view/state\";\r\n\r\nimport {\r\n  CircuitEditorState,\r\n  defaultCircuitEditorState\r\n} from \"@/pages/CircuitEditor/state\";\r\n\r\nexport interface AppState {\r\n  services: {\r\n    clipboard: ClipboardState;\r\n    field: FieldState;\r\n    graph: GraphState;\r\n    selection: SelectionState;\r\n    simulator: SimulatorState;\r\n    view: ViewState;\r\n  };\r\n  ui: {\r\n    circuitEditor: CircuitEditorState;\r\n  };\r\n}\r\n\r\nconst _defaultAppState: AppState = {\r\n  services: {\r\n    clipboard: defaultClipboardState,\r\n    field: defaultFieldState,\r\n    graph: defaultGraphState,\r\n    selection: defaultSelectionState,\r\n    simulator: defaultSimulatorState,\r\n    view: defaultViewState\r\n  },\r\n  ui: {\r\n    circuitEditor: defaultCircuitEditorState\r\n  }\r\n};\r\n\r\nexport const defaultAppState = Object.freeze(_defaultAppState);\r\n","import {\r\n  CircuitFieldState,\r\n  defaultCircuitFieldState\r\n} from \"./components/CircuitFieldView/components/CircuitField/state\";\r\n\r\nexport interface CircuitEditorState {\r\n  circuitField: CircuitFieldState;\r\n}\r\n\r\nexport const defaultCircuitEditorState: CircuitEditorState = {\r\n  circuitField: defaultCircuitFieldState\r\n};\r\n","import { Point } from \"@/types\";\r\n\r\nimport { NodePin } from \"@/services/graph/types\";\r\n\r\nimport { DragModeType } from \"./types\";\r\n\r\nexport interface CircuitFieldState {\r\n  dragMode: DragModeType | null;\r\n  dragStart: Point | null;\r\n  dragEnd: Point | null;\r\n  selectedPin: NodePin | null;\r\n}\r\n\r\nexport const defaultCircuitFieldState: CircuitFieldState = {\r\n  dragMode: null,\r\n  dragStart: null,\r\n  dragEnd: null,\r\n  selectedPin: null\r\n};\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_INIT = \"@init\";\r\nexport const doInit = () => ({ type: ACTION_INIT });\r\nexport type InitAction = ReturnType<typeof doInit>;\r\nexport function isInitAction(action: AnyAction): action is InitAction {\r\n  return action.type === ACTION_INIT;\r\n}\r\n","import { Point } from \"@/types\";\r\nimport { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_DRAG_CONTINUE = \"@editor/field/drag/continue\" as const;\r\nexport const dragContinue = (p: Point) => ({\r\n  type: ACTION_DRAG_CONTINUE,\r\n  payload: p\r\n});\r\nexport type DragContinueAction = ReturnType<typeof dragContinue>;\r\nexport function isDragContinueAction(\r\n  action: AnyAction\r\n): action is DragContinueAction {\r\n  return action.type === ACTION_DRAG_CONTINUE;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SIM_TICK = \"@sim/tick\" as const;\r\nexport const tickSim = (tickCount: number) => ({\r\n  type: ACTION_SIM_TICK,\r\n  payload: { tickCount }\r\n});\r\nexport type TickSimAction = ReturnType<typeof tickSim>;\r\nexport function isTickSimAction(action: AnyAction): action is TickSimAction {\r\n  return action.type === ACTION_SIM_TICK;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_VIEW_ZOOM = \"@view/zoom\" as const;\r\nexport const viewZoom = (delta: number) => ({\r\n  type: ACTION_VIEW_ZOOM,\r\n  payload: { delta }\r\n});\r\nexport type ViewZoomAction = ReturnType<typeof viewZoom>;\r\nexport function isViewZoomAction(action: AnyAction): action is ViewZoomAction {\r\n  return action.type === ACTION_VIEW_ZOOM;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nimport { ACTION_DRAG_CONTINUE } from \"@/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/actions/drag-continue\";\r\nimport { ACTION_SIM_TICK } from \"@/actions/sim-tick\";\r\nimport { ACTION_VIEW_ZOOM } from \"@/actions/view-zoom\";\r\n\r\nexport const actionsBlacklist: string[] = [\r\n  ACTION_DRAG_CONTINUE,\r\n  ACTION_SIM_TICK,\r\n  ACTION_VIEW_ZOOM\r\n];\r\n\r\nexport function actionSanitizer(action: AnyAction): AnyAction {\r\n  return action;\r\n}\r\n\r\nexport function stateSanitizer(state: AppState): any {\r\n  return state;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SIM_START = \"@sim/start\" as const;\r\nexport const startSim = () => ({\r\n  type: ACTION_SIM_START\r\n});\r\nexport type StartSimAction = ReturnType<typeof startSim>;\r\nexport function isStartSimAction(action: AnyAction): action is StartSimAction {\r\n  return action.type === ACTION_SIM_START;\r\n}\r\n","export function cls(...values: (string | false | undefined)[]): string {\r\n  return values.filter(x => Boolean(x) && x != \"\").join(\" \");\r\n}\r\n\r\nexport function typedKeys<T extends object>(obj: T): (keyof T)[] {\r\n  return Object.keys(obj) as (keyof T)[];\r\n}\r\n\r\nexport function fpSet<\r\n  Target extends Record<string, any> | any[],\r\n  P1 extends keyof Target,\r\n  T extends Target[P1]\r\n>(target: Target, p1: P1, value: T): Target;\r\nexport function fpSet<\r\n  Target extends Record<string, any> | any[],\r\n  P1 extends keyof Target,\r\n  P2 extends keyof Target[P1],\r\n  T extends Target[P1][P2]\r\n>(target: Target, p1: P1, p2: P2, value: T): Target;\r\nexport function fpSet<\r\n  Target extends Record<string, any> | any[],\r\n  P1 extends keyof Target,\r\n  P2 extends keyof Target[P1],\r\n  P3 extends keyof Target[P1][P2],\r\n  T extends Target[P1][P2][P3]\r\n>(target: Target, p1: P1, p2: P2, p3: P3, value: T): Target;\r\nexport function fpSet(...args: any[]) {\r\n  let target = args[0];\r\n  const firstPaths = args.slice(1, args.length - 2).map(String);\r\n  const lastPath = args[args.length - 2];\r\n  const value = args[args.length - 1];\r\n\r\n  const newData = clone(target);\r\n  target = newData;\r\n\r\n  for (const seg of firstPaths) {\r\n    target[seg] = clone(target[seg]);\r\n    target = target[seg];\r\n  }\r\n\r\n  target[lastPath] = value;\r\n\r\n  return newData;\r\n}\r\n\r\nfunction clone<T extends object | any[]>(obj: T): T {\r\n  if (Array.isArray(obj)) {\r\n    return [...obj] as T;\r\n  }\r\n  return { ...obj };\r\n}\r\n","import { AnyAction, Reducer } from \"redux\";\r\n\r\nimport { AppState, defaultAppState } from \"@/store\";\r\nimport { fpSet } from \"@/utils\";\r\n\r\nexport type ServiceKey = keyof AppState[\"services\"];\r\nexport type ServiceState<\r\n  TServiceKey extends ServiceKey\r\n> = AppState[\"services\"][TServiceKey];\r\n\r\nexport interface ServiceReducer<TServiceState> {\r\n  (\r\n    state: Readonly<TServiceState>,\r\n    action: AnyAction,\r\n    appState: AppState\r\n  ): TServiceState;\r\n}\r\n\r\nexport function createServiceReducerCreator<TServiceKey extends ServiceKey>(\r\n  service: TServiceKey\r\n): (\r\n  reducer: ServiceReducer<AppState[\"services\"][TServiceKey]>\r\n) => Reducer<AppState, AnyAction> {\r\n  return (reducer: ServiceReducer<AppState[\"services\"][TServiceKey]>) => {\r\n    return (state: AppState = defaultAppState, action: AnyAction) => {\r\n      const newState = reducer(state.services[service], action, state);\r\n      if (state.services.field != newState) {\r\n        return fpSet(state, \"services\", service, newState);\r\n      }\r\n      return state;\r\n    };\r\n  };\r\n}\r\n\r\nexport interface ServiceSelectorA0<TServiceKey extends ServiceKey, TReturn> {\r\n  (s: AppState): TReturn;\r\n  local(s: ServiceState<TServiceKey>): TReturn;\r\n}\r\n\r\nexport interface ServiceSelectorA1<\r\n  TServiceKey extends ServiceKey,\r\n  TA1,\r\n  TReturn\r\n> {\r\n  (s: AppState, a1: TA1): TReturn;\r\n  local(s: ServiceState<TServiceKey>, a1: TA1): TReturn;\r\n}\r\n\r\nexport interface ServiceSelectorA2<\r\n  TServiceKey extends ServiceKey,\r\n  TA1,\r\n  TA2,\r\n  TReturn\r\n> {\r\n  (s: AppState, a1: TA1, a2: TA2): TReturn;\r\n  local(s: ServiceState<TServiceKey>, a1: TA1, a2: TA2): TReturn;\r\n}\r\n\r\nexport interface ServiceSelectorCreator<TServiceKey extends ServiceKey> {\r\n  <TReturn>(\r\n    selector: (s: ServiceState<TServiceKey>) => TReturn\r\n  ): ServiceSelectorA0<TServiceKey, TReturn>;\r\n  <TA1, TReturn>(\r\n    selector: (s: ServiceState<TServiceKey>, a1: TA1) => TReturn\r\n  ): ServiceSelectorA1<TServiceKey, TA1, TReturn>;\r\n  <TA1, TA2, TReturn>(\r\n    selector: (s: ServiceState<TServiceKey>, a1: TA1, a2: TA2) => TReturn\r\n  ): ServiceSelectorA2<TServiceKey, TA1, TA2, TReturn>;\r\n}\r\n\r\nexport function createServiceSelectorCreator<TServiceKey extends ServiceKey>(\r\n  service: TServiceKey\r\n): ServiceSelectorCreator<TServiceKey> {\r\n  return <TArgs, TReturn>(\r\n    selector: (s: ServiceState<TServiceKey>, ...args: TArgs[]) => TReturn\r\n  ) => {\r\n    const appSelector: any = (s: AppState, ...args: TArgs[]) =>\r\n      selector(s.services[service], ...args);\r\n    appSelector.local = selector;\r\n    return appSelector;\r\n  };\r\n}\r\n","import {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator\r\n} from \"../service-state-utils\";\r\n\r\nexport const createSimulatorReducer = createServiceReducerCreator(\"simulator\");\r\nexport const createSimulatorSelector = createServiceSelectorCreator(\r\n  \"simulator\"\r\n);\r\n","import { createSimulatorSelector } from \"../utils\";\r\n\r\nexport const isRunningSelector = createSimulatorSelector(\r\n  state => state.mode === \"run\"\r\n);\r\nexport const ticksPerSecondSelector = createSimulatorSelector(\r\n  state => state.ticksPerSecond\r\n);\r\n","import { takeLeading, select, put, delay } from \"redux-saga/effects\";\r\n\r\nimport { ACTION_SIM_START } from \"@/actions/sim-start\";\r\nimport { tickSim } from \"@/actions/sim-tick\";\r\n\r\nimport { isRunningSelector, ticksPerSecondSelector } from \"../selectors/run\";\r\n\r\nexport default function* runModeSaga() {\r\n  yield takeLeading(ACTION_SIM_START, handleRunSim);\r\n}\r\n\r\nfunction* handleRunSim() {\r\n  while (true) {\r\n    const isRunning = yield select(isRunningSelector);\r\n    if (!isRunning) {\r\n      break;\r\n    }\r\n\r\n    yield put(tickSim(1));\r\n\r\n    const tps = yield select(ticksPerSecondSelector);\r\n    const timeToWait = Math.max(Math.ceil(1000 / tps), 1);\r\n    yield delay(timeToWait);\r\n  }\r\n}\r\n","import { fork } from \"redux-saga/effects\";\r\n\r\nimport runModeSaga from \"./mode-run\";\r\n\r\nexport default function* simulatorSaga() {\r\n  yield fork(runModeSaga);\r\n}\r\n","import { AnyAction, Reducer } from \"redux\";\r\nimport { AppState } from \"./state\";\r\n\r\nexport function reduceReducers(\r\n  ...reducers: Reducer<AppState, AnyAction>[]\r\n): Reducer<AppState, AnyAction> {\r\n  return (state: AppState | undefined, action: AnyAction) => {\r\n    return reducers.reduce<AppState>(\r\n      (state, reducer) => reducer(state, action),\r\n      state as any\r\n    );\r\n  };\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_COPY_NODES = \"@clipboard/copy\" as const;\r\nexport const copyNodes = (nodeId: string | string[]) => ({\r\n  type: ACTION_COPY_NODES,\r\n  payload: {\r\n    nodeIds: Array.isArray(nodeId) ? nodeId : [nodeId]\r\n  }\r\n});\r\nexport type CopyNodesAction = ReturnType<typeof copyNodes>;\r\nexport function isCopyNodesAction(\r\n  action: AnyAction\r\n): action is CopyNodesAction {\r\n  return action.type === ACTION_COPY_NODES;\r\n}\r\n","import { NodeDefinition } from \"./types\";\r\n\r\nexport * from \"./types\";\r\n\r\n// Many of these art assets used in these files are public domain and sourced from\r\n//  https://commons.wikimedia.org/wiki/Logic_gates_unified_symbols\r\n// Some assets have been modified for formatting or added functionality.\r\n// Assets that have been pulled from external sources are marked as such.\r\n\r\nexport const NodeTypes = {\r\n  and: require(\"./node-and\").default as NodeDefinition,\r\n  or: require(\"./node-or\").default as NodeDefinition,\r\n  nor: require(\"./node-nor\").default as NodeDefinition,\r\n  not: require(\"./node-not\").default as NodeDefinition,\r\n  buffer: require(\"./node-buffer\").default as NodeDefinition,\r\n  led: require(\"./node-led\").default as NodeDefinition,\r\n  toggle: require(\"./node-toggle\").default as NodeDefinition,\r\n  seg7: require(\"./node-seg7\").default as NodeDefinition\r\n};\r\nexport type NodeType = keyof typeof NodeTypes;\r\n","import find from \"lodash/find\";\r\n\r\nimport { NodeTypes } from \"@/node-defs\";\r\n\r\nimport {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator\r\n} from \"../service-state-utils\";\r\nimport { GraphState } from \"./state\";\r\nimport { NodePin, Connection } from \"./types\";\r\n\r\nexport const createGraphReducer = createServiceReducerCreator(\"graph\");\r\nexport const createGraphSelector = createServiceSelectorCreator(\"graph\");\r\n\r\n/**\r\n * Check two pins to see if they can form a valid connection.\r\n * Returns null if no connection can be made (both inputs or both outputs)\r\n *\r\n * Does not check to see if the pins are already connected, or other connections prevent this connection from forming.\r\n */\r\nexport function pinsToConnection(\r\n  state: GraphState,\r\n  p1: NodePin,\r\n  p2: NodePin\r\n): Connection | null {\r\n  const p1Node = state.nodesById[p1.nodeId];\r\n  const p2Node = state.nodesById[p2.nodeId];\r\n\r\n  if (!p1Node || !p2Node) {\r\n    return null;\r\n  }\r\n\r\n  const p1Def = NodeTypes[p1Node.type];\r\n  const p2Def = NodeTypes[p2Node.type];\r\n\r\n  if (!p1Def || !p2Def) {\r\n    return null;\r\n  }\r\n\r\n  const p1Pin = find(p1Def.pins, x => x.name == p1.pinId);\r\n  const p2Pin = find(p2Def.pins, x => x.name == p2.pinId);\r\n\r\n  if (!p1Pin || !p2Pin) {\r\n    return null;\r\n  }\r\n\r\n  // Pins are in same direction and cannot be connected.\r\n  if (p1Pin.direction === p2Pin.direction) {\r\n    return null;\r\n  }\r\n\r\n  const outputPin = p1Pin.direction === \"output\" ? p1 : p2;\r\n  const inputPin = p1Pin.direction === \"input\" ? p1 : p2;\r\n\r\n  return {\r\n    outputPin,\r\n    inputPin\r\n  };\r\n}\r\n","import mapValues from \"lodash/mapValues\";\r\n\r\nimport { NodeTypes } from \"@/node-defs\";\r\n\r\nimport { createGraphSelector } from \"../utils\";\r\nimport { GraphState } from \"../state\";\r\n\r\nexport const nodesByIdSelector = createGraphSelector(s => s.nodesById);\r\nexport const nodeIdsSelector = createGraphSelector(s =>\r\n  Object.keys(s.nodesById)\r\n);\r\n\r\nexport const nodeTypesByIdSelector = createGraphSelector(s =>\r\n  mapValues(nodesByIdSelector.local(s), n => n.type)\r\n);\r\n\r\nexport const nodeDefsByIdSelector = createGraphSelector(s =>\r\n  mapValues(nodeTypesByIdSelector.local(s), type => NodeTypes[type] || null)\r\n);\r\n\r\nexport const nodeSelector = createGraphSelector(\r\n  (s: GraphState, nodeId: string) => s.nodesById[nodeId] || null\r\n);\r\n\r\nexport const nodeTypeSelector = createGraphSelector(\r\n  (s: GraphState, nodeId: string) => {\r\n    const node = nodeSelector.local(s, nodeId);\r\n    if (!node) {\r\n      return null;\r\n    }\r\n    return node.type;\r\n  }\r\n);\r\n\r\nexport const nodeDefSelector = createGraphSelector(\r\n  (s: GraphState, nodeId: string) => {\r\n    const node = nodeSelector.local(s, nodeId);\r\n    if (!node) {\r\n      return null;\r\n    }\r\n    return NodeTypes[node.type] || null;\r\n  }\r\n);\r\n","import find from \"lodash/find\";\r\nimport values from \"lodash/values\";\r\nimport { createSelector } from \"reselect\";\r\nimport createCachedSelector from \"re-reselect\";\r\n\r\nimport { NodePin } from \"../types\";\r\n\r\nimport { GraphState } from \"../state\";\r\nimport { createGraphSelector } from \"../utils\";\r\n\r\nimport { nodeDefSelector } from \"./nodes\";\r\n\r\nexport const wireIdsSelector = createGraphSelector(\r\n  createSelector(\r\n    s => s.wiresById,\r\n    wiresById => Object.keys(wiresById)\r\n  )\r\n);\r\n\r\nexport const wireByIdSelector = createGraphSelector(\r\n  (s: GraphState, wireId: string) => s.wiresById[wireId]\r\n);\r\n\r\nconst connectionsSelector = createGraphSelector(\r\n  createSelector(\r\n    (state: GraphState) => state.wiresById,\r\n    wiresById => values(wiresById)\r\n  )\r\n);\r\n\r\nexport const nodePinDirectionSelector = createGraphSelector(\r\n  (s: GraphState, pin: NodePin) => {\r\n    const def = nodeDefSelector.local(s, pin.nodeId);\r\n    if (!def) {\r\n      return null;\r\n    }\r\n\r\n    const pinDef = find(def.pins, p => p.name === pin.pinId);\r\n    if (!pinDef) {\r\n      return null;\r\n    }\r\n    return pinDef.direction;\r\n  }\r\n);\r\n\r\n/**\r\n * Gets an object mapping input pin names to their connection source pins.\r\n */\r\nexport const nodeInputConnectionsByPinSelector = createGraphSelector(\r\n  createCachedSelector(\r\n    connectionsSelector.local,\r\n    (_: any, nodeId: string) => nodeId,\r\n    nodeDefSelector.local,\r\n    (connections, nodeId, nodeDef) => {\r\n      if (!nodeDef) {\r\n        return {};\r\n      }\r\n\r\n      let inputPins: string[] = [];\r\n      inputPins = Object.keys(nodeDef.pins).filter(\r\n        x => nodeDef.pins[x].direction === \"input\"\r\n      );\r\n\r\n      const inputConnections = connections.filter(\r\n        x => x.inputPin.nodeId === nodeId\r\n      );\r\n\r\n      const result: Record<string, NodePin | null> = {};\r\n      for (const pin of inputPins) {\r\n        result[pin] = null;\r\n      }\r\n\r\n      for (const connection of inputConnections) {\r\n        const { outputPin, inputPin } = connection;\r\n        result[inputPin.pinId] = outputPin;\r\n      }\r\n\r\n      return result;\r\n    }\r\n  )((_: any, nodeId: string) => nodeId)\r\n);\r\n\r\n/**\r\n * Gets an array of outgoing connections from the given node id.\r\n */\r\nexport const nodeOutputConnectionsSelector = createGraphSelector(\r\n  (state: GraphState, nodeId: string) =>\r\n    connectionsSelector.local(state).filter(x => x.outputPin.nodeId === nodeId)\r\n);\r\n\r\n/**\r\n * Gets an object mapping output pin names to their connection target pins.\r\n */\r\nexport const nodeOutputConnectionsByPinSelector = createGraphSelector(\r\n  createCachedSelector(\r\n    connectionsSelector.local,\r\n    (_: any, nodeId: string) => nodeId,\r\n    nodeDefSelector.local,\r\n    (connections, nodeId, nodeDef) => {\r\n      if (!nodeDef) {\r\n        return {};\r\n      }\r\n\r\n      let outputPins: string[] = [];\r\n      outputPins = Object.keys(nodeDef.pins).filter(\r\n        x => nodeDef.pins[x].direction === \"output\"\r\n      );\r\n\r\n      const outputConnections = connections.filter(\r\n        x => x.outputPin.nodeId === nodeId\r\n      );\r\n\r\n      const result: Record<string, NodePin[]> = {};\r\n      for (const pin of outputPins) {\r\n        result[pin] = [];\r\n      }\r\n\r\n      for (const connection of outputConnections) {\r\n        const { outputPin, inputPin } = connection;\r\n        result[outputPin.pinId].push(inputPin);\r\n      }\r\n\r\n      return result;\r\n    }\r\n  )((_: any, nodeId: string) => nodeId)\r\n);\r\n","import {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator\r\n} from \"../service-state-utils\";\r\n\r\nexport const createFieldReducer = createServiceReducerCreator(\"field\");\r\nexport const createFieldSelector = createServiceSelectorCreator(\"field\");\r\n","import { createFieldSelector } from \"../utils\";\r\nimport { FieldState } from \"../state\";\r\n\r\nexport const nodePositionsByIdSelector = createFieldSelector(\r\n  state => state.nodePositionsById\r\n);\r\n\r\nexport const nodePositionSelector = createFieldSelector(\r\n  (state: FieldState, nodeId: string) => state.nodePositionsById[nodeId]\r\n);\r\n","import {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator\r\n} from \"../service-state-utils\";\r\n\r\nexport const createClipboardReducer = createServiceReducerCreator(\"clipboard\");\r\nexport const createClipboardSelector = createServiceSelectorCreator(\r\n  \"clipboard\"\r\n);\r\n","import uuidV4 from \"uuid/v4\";\r\nimport map from \"lodash/map\";\r\nimport mapValues from \"lodash/mapValues\";\r\nimport findIndex from \"lodash/findIndex\";\r\nimport zipObject from \"lodash/zipObject\";\r\n\r\nimport { pointSubtract } from \"@/geometry\";\r\n\r\nimport { isCopyNodesAction } from \"@/actions/clipboard-copy\";\r\n\r\nimport { nodeSelector } from \"@/services/graph/selectors/nodes\";\r\nimport { nodeOutputConnectionsByPinSelector } from \"@/services/graph/selectors/wires\";\r\nimport { nodePositionsByIdSelector } from \"@/services/field/selectors/positions\";\r\n\r\nimport { ClipboardNode } from \"../types\";\r\nimport { createClipboardReducer } from \"../utils\";\r\n\r\nexport default createClipboardReducer((state, action, appState) => {\r\n  if (!isCopyNodesAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { nodeIds } = action.payload;\r\n  if (nodeIds.length === 0) {\r\n    return state;\r\n  }\r\n\r\n  const nodePositionsById = nodePositionsByIdSelector(appState);\r\n\r\n  const copyIds = zipObject(\r\n    nodeIds,\r\n    map(nodeIds, () => uuidV4())\r\n  );\r\n\r\n  function nodeIsSelected(id: string): boolean {\r\n    return findIndex(nodeIds, x => x === id) !== -1;\r\n  }\r\n\r\n  const rootPosition = nodePositionsById[nodeIds[0]];\r\n\r\n  const copyNodes: ClipboardNode[] = nodeIds.map(nodeId => {\r\n    const node = nodeSelector(appState, nodeId);\r\n    const outputs = nodeOutputConnectionsByPinSelector(appState, nodeId);\r\n    const copyNode: ClipboardNode = {\r\n      id: copyIds[nodeId],\r\n      type: node.type,\r\n      offset: pointSubtract(nodePositionsById[nodeId], rootPosition),\r\n      outputs: mapValues(outputs, conns =>\r\n        conns\r\n          .filter(x => nodeIsSelected(x.nodeId))\r\n          .map(c => ({ nodeId: copyIds[c.nodeId], pinId: c.pinId }))\r\n      )\r\n    };\r\n    return copyNode;\r\n  });\r\n\r\n  return {\r\n    ...state,\r\n    clipboardNodes: copyNodes,\r\n    clipboardPasteOrigin: rootPosition\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\nimport uuidV4 from \"uuid/v4\";\r\n\r\nimport { NodePin } from \"@/services/graph/types\";\r\n\r\nexport const ACTION_WIRE_ATTACH = \"@wire/attach\" as const;\r\nexport const attachWire = (p1: NodePin, p2: NodePin) => ({\r\n  type: ACTION_WIRE_ATTACH,\r\n  payload: {\r\n    wireId: uuidV4(),\r\n    p1,\r\n    p2\r\n  }\r\n});\r\nexport type AttachWireAction = ReturnType<typeof attachWire>;\r\nexport function isAttachWireAction(\r\n  action: AnyAction\r\n): action is AttachWireAction {\r\n  return action.type === ACTION_WIRE_ATTACH;\r\n}\r\n","import uuidV4 from \"uuid/v4\";\r\nimport { AnyAction } from \"redux\";\r\n\r\nimport { NodeType } from \"@/node-defs\";\r\nimport { Point } from \"@/types\";\r\n\r\nexport interface AddNodeOptions {\r\n  nodeId?: string;\r\n  position?: Point;\r\n}\r\nexport const ACTION_NODE_ADD = \"@node/add\" as const;\r\nexport const addNode = (nodeType: NodeType, opts?: AddNodeOptions) => ({\r\n  type: ACTION_NODE_ADD,\r\n  payload: { nodeId: uuidV4(), nodeType, ...(opts || {}) }\r\n});\r\nexport type AddNodeAction = ReturnType<typeof addNode>;\r\nexport function isAddNodeAction(action: AnyAction): action is AddNodeAction {\r\n  return action.type === ACTION_NODE_ADD;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_PASTE = \"@clipboard/paste\" as const;\r\nexport const paste = () => ({\r\n  type: ACTION_PASTE\r\n});\r\nexport type PasteAction = ReturnType<typeof paste>;\r\nexport function isPasteAction(action: AnyAction): action is PasteAction {\r\n  return action.type === ACTION_PASTE;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { SelectionMode } from \"@/types\";\r\n\r\nexport const ACTION_SELECT_NODES = \"@select/nodes\" as const;\r\nexport const selectNodes = (\r\n  nodeId: string | string[],\r\n  mode: SelectionMode = \"set\"\r\n) => ({\r\n  type: ACTION_SELECT_NODES,\r\n  payload: {\r\n    nodeIds: Array.isArray(nodeId) ? nodeId : [nodeId],\r\n    mode\r\n  }\r\n});\r\nexport type SelectNodesAction = ReturnType<typeof selectNodes>;\r\nexport function isSelectNodesAction(\r\n  action: AnyAction\r\n): action is SelectNodesAction {\r\n  return action.type === ACTION_SELECT_NODES;\r\n}\r\n","import { AnyAction } from \"redux\";\r\nimport zipObject from \"lodash/zipObject\";\r\nimport map from \"lodash/map\";\r\nimport values from \"lodash/values\";\r\nimport uuidV4 from \"uuid/v4\";\r\n\r\nimport { Point } from \"@/types\";\r\nimport { pointAdd, ZeroPoint } from \"@/geometry\";\r\nimport { AppState, defaultAppState } from \"@/store\";\r\nimport { fpSet } from \"@/utils\";\r\n\r\nimport rootReducer from \"@/store/reducer\";\r\n\r\nimport { attachWire } from \"@/actions/wire-attach\";\r\nimport { addNode } from \"@/actions/node-add\";\r\nimport { isPasteAction } from \"@/actions/clipboard-paste\";\r\nimport { selectNodes } from \"@/actions/select-nodes\";\r\n\r\nexport const CLIPBOARD_PASTE_OFFSET: Point = { x: 10, y: 10 };\r\n\r\nexport default function clipboardPasteReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n): AppState {\r\n  if (!isPasteAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { clipboardNodes, clipboardPasteOrigin } = state.services.clipboard;\r\n  const pastePosition = pointAdd(clipboardPasteOrigin, CLIPBOARD_PASTE_OFFSET);\r\n\r\n  const pasteIds = zipObject(\r\n    clipboardNodes.map(x => x.id),\r\n    map(clipboardNodes, () => uuidV4())\r\n  );\r\n\r\n  // Two passes: Create and Wire.\r\n\r\n  // Create the nodes.\r\n  for (let node of clipboardNodes) {\r\n    const { id, type, offset } = node;\r\n    const p = pointAdd(pastePosition, offset);\r\n    state = rootReducer(\r\n      state,\r\n      addNode(type, { position: p, nodeId: pasteIds[id] })\r\n    );\r\n  }\r\n\r\n  // Wire the nodes\r\n  for (let node of clipboardNodes) {\r\n    const { id, outputs } = node;\r\n    const sourceId = pasteIds[id];\r\n    for (let outputPin of Object.keys(outputs)) {\r\n      for (let output of outputs[outputPin]) {\r\n        const { nodeId: targetCopyId, pinId: targetPin } = output;\r\n        const targetId = pasteIds[targetCopyId];\r\n        state = rootReducer(\r\n          state,\r\n          attachWire(\r\n            { nodeId: sourceId, pinId: outputPin },\r\n            { nodeId: targetId, pinId: targetPin }\r\n          )\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  state = fpSet(\r\n    state,\r\n    \"services\",\r\n    \"clipboard\",\r\n    \"clipboardPasteOrigin\",\r\n    pastePosition\r\n  );\r\n  state = rootReducer(state, selectNodes(values(pasteIds)));\r\n\r\n  return state;\r\n}\r\n","import { reduceReducers } from \"@/store/utils\";\r\n\r\nimport clipboardCopyReducer from \"./clipboard-copy\";\r\nimport clipboardPasteReducer from \"./clipboard-paste\";\r\n\r\nconst clipboardReducer = reduceReducers(\r\n  clipboardCopyReducer,\r\n  clipboardPasteReducer\r\n);\r\n\r\nexport default clipboardReducer;\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_FILE_NEW = \"@file/new\" as const;\r\nexport const newFile = () => ({\r\n  type: ACTION_FILE_NEW\r\n});\r\nexport type NewFileAction = ReturnType<typeof newFile>;\r\nexport function isNewFileAction(action: AnyAction): action is NewFileAction {\r\n  return action.type === ACTION_FILE_NEW;\r\n}\r\n","import { isNewFileAction } from \"@/actions/file-new\";\r\n\r\nimport { createFieldReducer } from \"../utils\";\r\nimport { defaultFieldState } from \"../state\";\r\n\r\nexport default createFieldReducer((state, action) => {\r\n  if (!isNewFileAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  return defaultFieldState;\r\n});\r\n","import { fpSet } from \"@/utils\";\r\n\r\nimport { ZeroPoint } from \"@/geometry\";\r\nimport { isAddNodeAction } from \"@/actions/node-add\";\r\n\r\nimport { createFieldReducer } from \"../utils\";\r\n\r\nexport default createFieldReducer((state, action) => {\r\n  if (!isAddNodeAction(action)) {\r\n    return state;\r\n  }\r\n  const { nodeId: id, position = ZeroPoint } = action.payload;\r\n\r\n  return fpSet(state, \"nodePositionsById\", id, position);\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_NODE_DELETE = \"@node/delete\" as const;\r\nexport const deleteNode = (nodeId: string | string[]) => ({\r\n  type: ACTION_NODE_DELETE,\r\n  payload: { nodeIds: Array.isArray(nodeId) ? nodeId : [nodeId] }\r\n});\r\nexport type DeleteNodeAction = ReturnType<typeof deleteNode>;\r\nexport function isDeleteNodeAction(\r\n  action: AnyAction\r\n): action is DeleteNodeAction {\r\n  return action.type === ACTION_NODE_DELETE;\r\n}\r\n","import pick from \"lodash/pick\";\r\nimport difference from \"lodash/difference\";\r\n\r\nimport { isDeleteNodeAction } from \"@/actions/node-delete\";\r\n\r\nimport { createFieldReducer } from \"../utils\";\r\n\r\nexport default createFieldReducer((state, action) => {\r\n  if (!isDeleteNodeAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { nodeIds } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    nodePositionsById: pick(\r\n      state.nodePositionsById,\r\n      difference(Object.keys(state.nodePositionsById), nodeIds)\r\n    )\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SELECTION_MOVE = \"@selection/move\" as const;\r\nexport const moveSelection = (offsetX: number, offsetY: number) => ({\r\n  type: ACTION_SELECTION_MOVE,\r\n  payload: { offsetX, offsetY }\r\n});\r\nexport type MoveSelectionAction = ReturnType<typeof moveSelection>;\r\nexport function isMoveSelectionAction(\r\n  action: AnyAction\r\n): action is MoveSelectionAction {\r\n  return action.type === ACTION_SELECTION_MOVE;\r\n}\r\n","import union from \"lodash/union\";\r\nimport difference from \"lodash/difference\";\r\n\r\nimport { SelectionMode } from \"@/types\";\r\n\r\nimport {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator\r\n} from \"../service-state-utils\";\r\n\r\nexport const createSelectionReducer = createServiceReducerCreator(\"selection\");\r\nexport const createSelectionSelector = createServiceSelectorCreator(\r\n  \"selection\"\r\n);\r\n\r\nexport function combineSelection(\r\n  selectedIds: string[],\r\n  chosenIds: string[],\r\n  mode: SelectionMode\r\n) {\r\n  switch (mode) {\r\n    case \"set\":\r\n      return chosenIds;\r\n    case \"append\":\r\n      return union(selectedIds, chosenIds);\r\n    case \"remove\":\r\n      return difference(selectedIds, chosenIds);\r\n    case \"toggle\": {\r\n      return difference(selectedIds, chosenIds).concat(\r\n        difference(chosenIds, selectedIds)\r\n      );\r\n    }\r\n  }\r\n\r\n  return chosenIds;\r\n}\r\n","import { createSelector } from \"reselect\";\r\n\r\nimport pick from \"lodash/pick\";\r\n\r\nimport { nodesByIdSelector } from \"@/services/graph/selectors/nodes\";\r\n\r\nimport { createSelectionSelector } from \"../utils\";\r\nimport { SelectionState } from \"../state\";\r\n\r\nexport const selectedNodeIdsSelector = createSelectionSelector(\r\n  state => state.selectedNodeIds\r\n);\r\n\r\nexport const isNodeSelectedSelector = createSelectionSelector(\r\n  (s: SelectionState, nodeId: string) =>\r\n    s.selectedNodeIds.indexOf(nodeId) !== -1\r\n);\r\n\r\nexport const selectedNodesByIdSelector = createSelector(\r\n  nodesByIdSelector,\r\n  selectedNodeIdsSelector,\r\n  (nodesById, selectedNodeIds) => pick(nodesById, selectedNodeIds)\r\n);\r\n\r\nexport const selectedWireIdsSelector = createSelectionSelector(\r\n  state => state.selectedWireIds\r\n);\r\n\r\nexport const isWireSelectedSelector = createSelectionSelector(\r\n  (s: SelectionState, wireId: string) =>\r\n    s.selectedWireIds.indexOf(wireId) !== -1\r\n);\r\n\r\nexport const selectedJointIdsSelector = createSelectionSelector(\r\n  state => state.selectedJointIds\r\n);\r\n\r\nexport const isJointSelectedSelector = createSelectionSelector(\r\n  (s: SelectionState, jointId: string) =>\r\n    s.selectedJointIds.indexOf(jointId) !== -1\r\n);\r\n","import mapValues from \"lodash/mapValues\";\r\nimport pick from \"lodash/pick\";\r\n\r\nimport { isMoveSelectionAction } from \"@/actions/selection-move\";\r\nimport {\r\n  selectedNodeIdsSelector,\r\n  selectedJointIdsSelector\r\n} from \"@/services/selection/selectors/selection\";\r\n\r\nimport { createFieldReducer } from \"../utils\";\r\n\r\nexport default createFieldReducer((state, action, appState) => {\r\n  if (!isMoveSelectionAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { offsetX, offsetY } = action.payload;\r\n\r\n  const nodeIds = selectedNodeIdsSelector(appState);\r\n  const movedNodePositions = mapValues(\r\n    pick(state.nodePositionsById, nodeIds),\r\n    p => ({\r\n      x: p.x + offsetX,\r\n      y: p.y + offsetY\r\n    })\r\n  );\r\n\r\n  const jointIds = selectedJointIdsSelector(appState);\r\n  const movedJoints = mapValues(\r\n    pick(state.wireJointPositionsByJointId, jointIds),\r\n    p => ({\r\n      x: p.x + offsetX,\r\n      y: p.y + offsetY\r\n    })\r\n  );\r\n\r\n  return {\r\n    ...state,\r\n    nodePositionsById: {\r\n      ...state.nodePositionsById,\r\n      ...movedNodePositions\r\n    },\r\n    wireJointPositionsByJointId: {\r\n      ...state.wireJointPositionsByJointId,\r\n      ...movedJoints\r\n    }\r\n  };\r\n});\r\n","import { isAttachWireAction } from \"@/actions/wire-attach\";\r\nimport { fpSet } from \"@/utils\";\r\n\r\nimport { createFieldReducer } from \"../utils\";\r\n\r\nexport default createFieldReducer((state, action) => {\r\n  if (!isAttachWireAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { wireId } = action.payload;\r\n\r\n  return fpSet(state, \"wireJointIdsByWireId\", wireId, []);\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_WIRE_DETATCH = \"@wire/detatch\" as const;\r\nexport const detatchWire = (wireId: string) => ({\r\n  type: ACTION_WIRE_DETATCH,\r\n  payload: {\r\n    wireId\r\n  }\r\n});\r\nexport type DetatchWireNodeAction = ReturnType<typeof detatchWire>;\r\nexport function isDetatchWireAction(\r\n  action: AnyAction\r\n): action is DetatchWireNodeAction {\r\n  return action.type === ACTION_WIRE_DETATCH;\r\n}\r\n","import pick from \"lodash/pick\";\r\n\r\nimport { isDetatchWireAction } from \"@/actions/wire-detatch\";\r\nimport { createFieldReducer } from \"../utils\";\r\n\r\nexport default createFieldReducer((state, action) => {\r\n  if (!isDetatchWireAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { wireId } = action.payload;\r\n\r\n  const remainingWireIds = Object.keys(state.wireJointIdsByWireId).filter(\r\n    x => x != wireId\r\n  );\r\n\r\n  return {\r\n    ...state,\r\n    wireJointIdsByWireId: pick(state.wireJointIdsByWireId, remainingWireIds)\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\nimport uuidV4 from \"uuid/v4\";\r\nimport { Point } from \"@/types\";\r\n\r\nexport const ACTION_WIRE_JOINT_ADD = \"@wire/joint/add\" as const;\r\nexport const addWireJoint = (\r\n  wireId: string,\r\n  addAfterJointId: string | null,\r\n  position: Point,\r\n  jointId?: string\r\n) => ({\r\n  type: ACTION_WIRE_JOINT_ADD,\r\n  payload: {\r\n    wireId,\r\n    jointId: jointId || uuidV4(),\r\n    addAfterJointId,\r\n    position\r\n  }\r\n});\r\nexport type AddWireJointAction = ReturnType<typeof addWireJoint>;\r\nexport function isAddWireJointAction(\r\n  action: AnyAction\r\n): action is AddWireJointAction {\r\n  return action.type === ACTION_WIRE_JOINT_ADD;\r\n}\r\n","import { isAddWireJointAction } from \"@/actions/wire-joint-add\";\r\n\r\nimport { createFieldReducer } from \"../utils\";\r\n\r\nexport default createFieldReducer((state, action) => {\r\n  if (!isAddWireJointAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { wireId, addAfterJointId, position, jointId } = action.payload;\r\n  let wireJoints = state.wireJointIdsByWireId[wireId];\r\n  let insertionIndex = addAfterJointId\r\n    ? wireJoints.indexOf(addAfterJointId) + 1\r\n    : 0;\r\n\r\n  wireJoints = [\r\n    ...wireJoints.slice(0, insertionIndex),\r\n    jointId,\r\n    ...wireJoints.slice(insertionIndex)\r\n  ];\r\n\r\n  return {\r\n    ...state,\r\n    wireJointIdsByWireId: {\r\n      ...state.wireJointIdsByWireId,\r\n      [wireId]: wireJoints\r\n    },\r\n    wireJointPositionsByJointId: {\r\n      ...state.wireJointPositionsByJointId,\r\n      [jointId]: position\r\n    }\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_WIRE_JOINT_DELETE = \"@wire/joint/delete\" as const;\r\nexport const deleteWireJoint = (jointId: string) => ({\r\n  type: ACTION_WIRE_JOINT_DELETE,\r\n  payload: { jointId }\r\n});\r\nexport type DeleteWireJointAction = ReturnType<typeof deleteWireJoint>;\r\nexport function isDeleteWireJointAction(\r\n  action: AnyAction\r\n): action is DeleteWireJointAction {\r\n  return action.type === ACTION_WIRE_JOINT_DELETE;\r\n}\r\n","import pick from \"lodash/pick\";\r\n\r\nimport { isDeleteWireJointAction } from \"@/actions/wire-joint-delete\";\r\n\r\nimport { createFieldReducer } from \"../utils\";\r\nimport mapValues from \"lodash/mapValues\";\r\n\r\nexport default createFieldReducer((state, action) => {\r\n  if (!isDeleteWireJointAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { jointId } = action.payload;\r\n\r\n  const remainingJointIds = Object.keys(\r\n    state.wireJointPositionsByJointId\r\n  ).filter(x => x !== jointId);\r\n\r\n  return {\r\n    ...state,\r\n    wireJointIdsByWireId: mapValues(state.wireJointIdsByWireId, wireIds =>\r\n      wireIds.filter(x => x !== jointId)\r\n    ),\r\n    wireJointsByJointId: pick(\r\n      state.wireJointPositionsByJointId,\r\n      remainingJointIds\r\n    )\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\nimport { Point } from \"@/types\";\r\n\r\nexport const ACTION_WIRE_JOINT_MOVE = \"@wire/joint/move\" as const;\r\nexport const moveWireJoint = (jointId: string, position: Point) => ({\r\n  type: ACTION_WIRE_JOINT_MOVE,\r\n  payload: {\r\n    jointId,\r\n    position\r\n  }\r\n});\r\nexport type MoveWireJointAction = ReturnType<typeof moveWireJoint>;\r\nexport function isMoveWireJointAction(\r\n  action: AnyAction\r\n): action is MoveWireJointAction {\r\n  return action.type === ACTION_WIRE_JOINT_MOVE;\r\n}\r\n","import { reduceReducers } from \"@/store/utils\";\r\n\r\nimport fileNewReducer from \"./file-new\";\r\nimport nodeAddReducer from \"./node-add\";\r\nimport nodeDeleteReducer from \"./node-delete\";\r\nimport nodeMoveReducer from \"./selection-move\";\r\nimport wireAttachReducer from \"./wire-attach\";\r\nimport wireDetatchReducer from \"./wire-detatch\";\r\nimport wireJointAddReducer from \"./wire-joint-add\";\r\nimport wireJointDeleteReducer from \"./wire-joint-delete\";\r\nimport wireJointMoveReducer from \"./wire-joint-move\";\r\n\r\nconst fieldReducer = reduceReducers(\r\n  fileNewReducer,\r\n  nodeAddReducer,\r\n  nodeDeleteReducer,\r\n  nodeMoveReducer,\r\n  wireAttachReducer,\r\n  wireDetatchReducer,\r\n  wireJointAddReducer,\r\n  wireJointDeleteReducer,\r\n  wireJointMoveReducer\r\n);\r\n\r\nexport default fieldReducer;\r\n","import { fpSet } from \"@/utils\";\r\nimport { isMoveWireJointAction } from \"@/actions/wire-joint-move\";\r\n\r\nimport { createFieldReducer } from \"../utils\";\r\n\r\nexport default createFieldReducer((state, action) => {\r\n  if (!isMoveWireJointAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { jointId, position } = action.payload;\r\n\r\n  return fpSet(state, \"wireJointPositionsByJointId\", jointId, position);\r\n});\r\n","import { isNewFileAction } from \"@/actions/file-new\";\r\n\r\nimport { createGraphReducer } from \"../utils\";\r\nimport { defaultGraphState } from \"../state\";\r\n\r\nexport default createGraphReducer((state, action) => {\r\n  if (!isNewFileAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  return defaultGraphState;\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { isAddNodeAction } from \"@/actions/node-add\";\r\n\r\nimport { createGraphReducer } from \"../utils\";\r\n\r\nexport default createGraphReducer((state, action: AnyAction) => {\r\n  if (!isAddNodeAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { nodeId: id, nodeType: type } = action.payload;\r\n  return {\r\n    ...state,\r\n    nodesById: {\r\n      ...state.nodesById,\r\n      [id]: {\r\n        id,\r\n        type\r\n      }\r\n    }\r\n  };\r\n});\r\n","import { reduceReducers } from \"@/store/utils\";\r\n\r\nimport fileNewReducer from \"./file-new\";\r\nimport nodeAddReducer from \"./node-add\";\r\nimport nodeDeleteReducer from \"./node-delete\";\r\nimport wireAttachReducer from \"./wire-attach\";\r\nimport wireDetatchReducer from \"./wire-detatch\";\r\n\r\nconst graphReducer = reduceReducers(\r\n  fileNewReducer,\r\n  nodeAddReducer,\r\n  nodeDeleteReducer,\r\n  wireAttachReducer,\r\n  wireDetatchReducer\r\n);\r\n\r\nexport default graphReducer;\r\n","import pick from \"lodash/pick\";\r\nimport difference from \"lodash/difference\";\r\nimport pickBy from \"lodash/pickBy\";\r\n\r\nimport { isDeleteNodeAction } from \"@/actions/node-delete\";\r\n\r\nimport { createGraphReducer } from \"../utils\";\r\nimport { Connection } from \"../types\";\r\n\r\nexport default createGraphReducer((state, action) => {\r\n  if (!isDeleteNodeAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { nodeIds } = action.payload;\r\n\r\n  const remainingIds = difference(Object.keys(state.nodesById), nodeIds);\r\n\r\n  function isRemainingConnection(c: Connection) {\r\n    return (\r\n      remainingIds.indexOf(c.inputPin.nodeId) !== -1 &&\r\n      remainingIds.indexOf(c.outputPin.nodeId) !== -1\r\n    );\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    nodesById: pick(state.nodesById, remainingIds),\r\n    wiresById: pickBy(state.wiresById, isRemainingConnection)\r\n  };\r\n});\r\n","import find from \"lodash/find\";\r\n\r\nimport { isAttachWireAction } from \"@/actions/wire-attach\";\r\n\r\nimport { createGraphReducer, pinsToConnection } from \"../utils\";\r\nimport { nodePinEquals } from \"../types\";\r\n\r\nexport default createGraphReducer((state, action) => {\r\n  if (!isAttachWireAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  if (!isAttachWireAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { wireId, p1, p2 } = action.payload;\r\n  const conn = pinsToConnection(state, p1, p2);\r\n  if (!conn) {\r\n    return state;\r\n  }\r\n\r\n  const { inputPin } = conn;\r\n\r\n  // Only one source per input.\r\n  if (find(state.wiresById, c => nodePinEquals(c.inputPin, inputPin))) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    wiresById: {\r\n      ...state.wiresById,\r\n      [wireId]: {\r\n        id: wireId,\r\n        ...conn\r\n      }\r\n    }\r\n  };\r\n});\r\n","import { NodeType } from \"@/node-defs\";\r\nimport { IDMap } from \"@/types\";\r\n\r\nexport interface GraphNode {\r\n  id: string;\r\n  type: NodeType;\r\n}\r\n\r\n/**\r\n * Identifies a pin on a specific node.\r\n */\r\nexport interface NodePin {\r\n  nodeId: string;\r\n  pinId: string;\r\n}\r\nexport function nodePinEquals(a: NodePin, b: NodePin) {\r\n  return a.nodeId === b.nodeId && a.pinId === b.pinId;\r\n}\r\n\r\n/**\r\n * A connection from a node input to a node output.\r\n */\r\nexport interface Connection {\r\n  outputPin: NodePin;\r\n  inputPin: NodePin;\r\n}\r\n\r\n/**\r\n * A wire connecting two nodes in the graph\r\n */\r\nexport interface Wire extends Connection {\r\n  id: string;\r\n}\r\n\r\nexport type PinValueMap = IDMap<boolean>;\r\n","import pick from \"lodash/pick\";\r\nimport difference from \"lodash/difference\";\r\n\r\nimport { isDetatchWireAction } from \"@/actions/wire-detatch\";\r\n\r\nimport { createGraphReducer } from \"../utils\";\r\n\r\nexport default createGraphReducer((state, action) => {\r\n  if (!isDetatchWireAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { wireId } = action.payload;\r\n\r\n  const remainingIds = Object.keys(state.wiresById).filter(x => x !== wireId);\r\n\r\n  return {\r\n    ...state,\r\n    wiresById: pick(state.wiresById, remainingIds)\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { AppState, defaultAppState } from \"@/store\";\r\n\r\nimport { ACTION_NODE_ADD } from \"@/actions/node-add\";\r\nimport { ACTION_NODE_DELETE } from \"@/actions/node-delete\";\r\nimport { ACTION_SELECTION_MOVE } from \"@/actions/selection-move\";\r\nimport { ACTION_WIRE_ATTACH } from \"@/actions/wire-attach\";\r\nimport { ACTION_WIRE_DETATCH } from \"@/actions/wire-detatch\";\r\nimport { ACTION_WIRE_JOINT_ADD } from \"@/actions/wire-joint-add\";\r\nimport { ACTION_WIRE_JOINT_MOVE } from \"@/actions/wire-joint-move\";\r\n\r\nimport { createSave, storeAutosave } from \"../utils\";\r\n\r\nconst AUTOSAVE_TRIGGERS = [\r\n  ACTION_NODE_ADD,\r\n  ACTION_NODE_DELETE,\r\n  ACTION_SELECTION_MOVE,\r\n  ACTION_WIRE_ATTACH,\r\n  ACTION_WIRE_DETATCH,\r\n  ACTION_WIRE_JOINT_ADD,\r\n  ACTION_WIRE_JOINT_MOVE\r\n];\r\n\r\nexport default function autoSaveReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n): AppState {\r\n  if (AUTOSAVE_TRIGGERS.indexOf(action.type) === -1) {\r\n    return state;\r\n  }\r\n\r\n  const save = createSave(state);\r\n  storeAutosave(save);\r\n\r\n  return state;\r\n}\r\n","import { reduceReducers } from \"@/store/utils\";\r\n\r\nimport autosaveReducer from \"./autosave\";\r\nimport fileNewReducer from \"./file-new\";\r\nimport initReducer from \"./init\";\r\n\r\nexport default reduceReducers(autosaveReducer, fileNewReducer, initReducer);\r\n","import { SaveData } from \"./types\";\r\nimport { AppState } from \"@/store\";\r\nimport { defaultSelectionState } from \"../selection/state\";\r\nimport { defaultSimulatorState } from \"../simulator/state\";\r\n\r\nexport function createSave(state: AppState): SaveData {\r\n  return {\r\n    field: state.services.field,\r\n    graph: state.services.graph\r\n  };\r\n}\r\n\r\nexport function loadSave(state: AppState, save: SaveData): AppState {\r\n  return {\r\n    ...state,\r\n    services: {\r\n      ...state.services,\r\n      field: save.field,\r\n      graph: save.graph,\r\n      selection: defaultSelectionState,\r\n      simulator: defaultSimulatorState\r\n    }\r\n  };\r\n}\r\n\r\nexport function storeAutosave(save: SaveData): void {\r\n  localStorage.setItem(\"autosave\", JSON.stringify(save));\r\n}\r\n\r\nexport function loadAutosave(): SaveData | null {\r\n  const str = localStorage.getItem(\"autosave\");\r\n  if (!str) {\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    return JSON.parse(str);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function deleteAutosave() {\r\n  localStorage.removeItem(\"autosave\");\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { AppState, defaultAppState } from \"@/store\";\r\nimport { isNewFileAction } from \"@/actions/file-new\";\r\n\r\nimport { deleteAutosave } from \"../utils\";\r\n\r\nexport default function fileNewReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n): AppState {\r\n  if (!isNewFileAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  deleteAutosave();\r\n  return state;\r\n}\r\n","import { AnyAction } from \"redux\";\r\nimport { AppState, defaultAppState } from \"@/store\";\r\n\r\nimport { isInitAction } from \"@/actions/init\";\r\n\r\nimport { loadAutosave, loadSave } from \"../utils\";\r\n\r\nexport default function initReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n): AppState {\r\n  if (!isInitAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const save = loadAutosave();\r\n  if (!save) {\r\n    return state;\r\n  }\r\n\r\n  return loadSave(state, save);\r\n}\r\n","import { isNewFileAction } from \"@/actions/file-new\";\r\n\r\nimport { createSelectionReducer } from \"../utils\";\r\nimport { defaultSelectionState } from \"../state\";\r\n\r\nexport default createSelectionReducer((state, action) => {\r\n  if (!isNewFileAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  return defaultSelectionState;\r\n});\r\n","import difference from \"lodash/difference\";\r\n\r\nimport { isDeleteNodeAction } from \"@/actions/node-delete\";\r\n\r\nimport { createSelectionReducer } from \"../utils\";\r\n\r\nexport default createSelectionReducer((state, action) => {\r\n  if (!isDeleteNodeAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { nodeIds } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    selectedNodeIds: difference(state.selectedNodeIds, nodeIds),\r\n    selectedWireIds: [] // Might be removing a node attached to a selected wire\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SELECT_CLEAR = \"@select/all\" as const;\r\nexport const selectAll = () => ({\r\n  type: ACTION_SELECT_CLEAR\r\n});\r\nexport type SelectAllAction = ReturnType<typeof selectAll>;\r\nexport function isSelectAllAction(\r\n  action: AnyAction\r\n): action is SelectAllAction {\r\n  return action.type === ACTION_SELECT_CLEAR;\r\n}\r\n","import { AppState } from \"@/store\";\r\nimport { pointAdd, ZeroPoint } from \"@/geometry\";\r\nimport { NodeDefinition } from \"@/node-defs\";\r\nimport { Point } from \"@/types\";\r\n\r\nimport { nodeDefSelector } from \"@/services/graph/selectors/nodes\";\r\n\r\nimport { createFieldSelector } from \"../utils\";\r\nimport { FieldState } from \"../state\";\r\n\r\nimport { nodePositionSelector } from \"./positions\";\r\nimport { FieldSvgElementProvider } from \"@/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/contexts/fieldSvgElement\";\r\n\r\ninterface PositionCache {\r\n  inputNodeDef: NodeDefinition | null;\r\n  inputNodePosition: Point;\r\n  outputPosition: Point;\r\n}\r\n\r\n// TODO: These build up forever, need to wipe it on occasion.\r\n// Probably should use LRU cache.\r\n// Not fixing it right now as we previously used re-reselect, which\r\n//  also builds up forever.\r\nconst startPositionCacheByWireId: Record<string, PositionCache> = {};\r\nconst endPositionCacheByWireId: Record<string, PositionCache> = {};\r\n\r\nexport const wireStartPositionSelector = (state: AppState, wireId: string) => {\r\n  const {\r\n    outputPin: { nodeId, pinId }\r\n  } = state.services.graph.wiresById[wireId];\r\n  const nodeDef = nodeDefSelector(state, nodeId);\r\n  const nodePosition = nodePositionSelector(state, nodeId) || ZeroPoint;\r\n\r\n  // Caching is to get a consistent reference to avoid component rerenders.\r\n  //  We are not concerned about performance here.\r\n  const cacheData = startPositionCacheByWireId[wireId];\r\n  if (\r\n    cacheData &&\r\n    cacheData.inputNodeDef === nodeDef &&\r\n    cacheData.inputNodePosition === nodePosition\r\n  ) {\r\n    return cacheData.outputPosition;\r\n  }\r\n\r\n  let offset = ZeroPoint;\r\n  if (nodeDef && nodeDef.pins[pinId]) {\r\n    offset = nodeDef.pins[pinId];\r\n  }\r\n  const position = pointAdd(nodePosition, offset);\r\n  startPositionCacheByWireId[wireId] = {\r\n    inputNodeDef: nodeDef,\r\n    inputNodePosition: nodePosition,\r\n    outputPosition: position\r\n  };\r\n\r\n  return position;\r\n};\r\n\r\nexport const wireEndPositionSelector = (state: AppState, wireId: string) => {\r\n  const {\r\n    inputPin: { nodeId, pinId }\r\n  } = state.services.graph.wiresById[wireId];\r\n  const nodeDef = nodeDefSelector(state, nodeId);\r\n  const nodePosition = nodePositionSelector(state, nodeId) || ZeroPoint;\r\n\r\n  // Caching is to get a consistent reference to avoid component rerenders.\r\n  //  We are not concerned about performance here.\r\n  const cacheData = endPositionCacheByWireId[wireId];\r\n  if (\r\n    cacheData &&\r\n    cacheData.inputNodeDef === nodeDef &&\r\n    cacheData.inputNodePosition === nodePosition\r\n  ) {\r\n    return cacheData.outputPosition;\r\n  }\r\n\r\n  let offset = ZeroPoint;\r\n  if (nodeDef && nodeDef.pins[pinId]) {\r\n    offset = nodeDef.pins[pinId];\r\n  }\r\n  const position = pointAdd(nodePosition, offset);\r\n  endPositionCacheByWireId[wireId] = {\r\n    inputNodeDef: nodeDef,\r\n    inputNodePosition: nodePosition,\r\n    outputPosition: position\r\n  };\r\n\r\n  return position;\r\n};\r\n\r\n// WARN: Returns new object with each invocation.  Not safe for react use.\r\n//  Currently used to get all joint ids in reducers.\r\nexport const allJointIdsSelector = createFieldSelector((state: FieldState) =>\r\n  Object.keys(state.wireJointPositionsByJointId)\r\n);\r\n\r\nexport const wireJointIdsSelector = createFieldSelector(\r\n  (state: FieldState, wireId: string) => state.wireJointIdsByWireId[wireId]\r\n);\r\n\r\nexport const wireJointPositionSelector = createFieldSelector(\r\n  (state: FieldState, jointId: string) =>\r\n    state.wireJointPositionsByJointId[jointId]\r\n);\r\n","import { isSelectAllAction } from \"@/actions/select-all\";\r\n\r\nimport { nodeIdsSelector } from \"@/services/graph/selectors/nodes\";\r\nimport { wireIdsSelector } from \"@/services/graph/selectors/wires\";\r\nimport { allJointIdsSelector } from \"@/services/field/selectors/wires\";\r\n\r\nimport { createSelectionReducer } from \"../utils\";\r\n\r\nexport default createSelectionReducer((state, action, appState) => {\r\n  if (!isSelectAllAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const nodeIds = nodeIdsSelector(appState);\r\n  const wireIds = wireIdsSelector(appState);\r\n  const jointIds = allJointIdsSelector(appState);\r\n\r\n  return {\r\n    ...state,\r\n    selectedNodeIds: nodeIds,\r\n    selectedWireIds: wireIds,\r\n    selectedJointIds: jointIds\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SELECT_CLEAR = \"@select/clear\" as const;\r\nexport const clearSelection = () => ({\r\n  type: ACTION_SELECT_CLEAR\r\n});\r\nexport type ClearSelectionAction = ReturnType<typeof clearSelection>;\r\nexport function isClearSelectionAction(\r\n  action: AnyAction\r\n): action is ClearSelectionAction {\r\n  return action.type === ACTION_SELECT_CLEAR;\r\n}\r\n","import { isClearSelectionAction } from \"@/actions/select-clear\";\r\n\r\nimport { createSelectionReducer } from \"../utils\";\r\n\r\nexport default createSelectionReducer((state, action) => {\r\n  if (!isClearSelectionAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    selectedNodeIds: [],\r\n    selectedWireIds: [],\r\n    selectedJointIds: []\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { SelectionMode } from \"@/types\";\r\n\r\nexport const ACTION_SELECT_WIRE_JOINTS = \"@select/wire-joints\" as const;\r\nexport const selectWireJoints = (\r\n  jointId: string | string[],\r\n  mode: SelectionMode = \"set\"\r\n) => ({\r\n  type: ACTION_SELECT_WIRE_JOINTS,\r\n  payload: {\r\n    jointIds: Array.isArray(jointId) ? jointId : [jointId],\r\n    mode\r\n  }\r\n});\r\nexport type SelectWireJointsAction = ReturnType<typeof selectWireJoints>;\r\nexport function isSelectWireJointsAction(\r\n  action: AnyAction\r\n): action is SelectWireJointsAction {\r\n  return action.type === ACTION_SELECT_WIRE_JOINTS;\r\n}\r\n","import { isSelectWireJointsAction } from \"@/actions/select-wire-joints\";\r\nimport { createSelectionReducer, combineSelection } from \"../utils\";\r\n\r\nexport default createSelectionReducer((state, action) => {\r\n  if (!isSelectWireJointsAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { jointIds, mode } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    selectedNodeIds: mode === \"set\" ? [] : state.selectedNodeIds,\r\n    selectedWireIds: mode === \"set\" ? [] : state.selectedWireIds,\r\n    selectedJointIds: combineSelection(state.selectedJointIds, jointIds, mode)\r\n  };\r\n});\r\n","import { isSelectNodesAction } from \"@/actions/select-nodes\";\r\n\r\nimport { combineSelection, createSelectionReducer } from \"../utils\";\r\n\r\nexport default createSelectionReducer((state, action) => {\r\n  if (!isSelectNodesAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { nodeIds, mode } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    selectedNodeIds: combineSelection(state.selectedNodeIds, nodeIds, mode),\r\n    selectedWireIds: mode === \"set\" ? [] : state.selectedWireIds,\r\n    selectedJointIds: mode === \"set\" ? [] : state.selectedJointIds\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { Rectangle, SelectionMode } from \"@/types\";\r\n\r\nexport const ACTION_SELECT_REGION = \"@select/region\" as const;\r\nexport const selectRegion = (\r\n  region: Rectangle,\r\n  mode: SelectionMode = \"set\"\r\n) => ({\r\n  type: ACTION_SELECT_REGION,\r\n  payload: {\r\n    region,\r\n    mode\r\n  }\r\n});\r\nexport type SelectRegionAction = ReturnType<typeof selectRegion>;\r\nexport function isSelectRegionAction(\r\n  action: AnyAction\r\n): action is SelectRegionAction {\r\n  return action.type === ACTION_SELECT_REGION;\r\n}\r\n","import pickBy from \"lodash/pickBy\";\r\n\r\nimport { IDMap } from \"@/types\";\r\n\r\nimport { NodeVisualPath, NodeDefinition, NodePinDefinition } from \"./types\";\r\n\r\nexport function normalizeVisuals(\r\n  v: NodeVisualPath | NodeVisualPath[],\r\n  state: any\r\n): { path: string; fill?: string; stroke?: string; strokeWidth?: number }[] {\r\n  const asArray = Array.isArray(v) ? v : [v];\r\n\r\n  return asArray.map(x => {\r\n    if (typeof x === \"string\") {\r\n      return {\r\n        path: x,\r\n        fill: \"black\",\r\n        stroke: \"black\",\r\n        strokeWidth: 2\r\n      };\r\n    }\r\n    const fill = typeof x.fill === \"function\" ? x.fill(state || {}) : x.fill;\r\n    const stroke =\r\n      typeof x.stroke === \"function\" ? x.stroke(state || {}) : x.stroke;\r\n    const strokeWidth =\r\n      typeof x.strokeWidth === \"function\"\r\n        ? x.strokeWidth(state || {})\r\n        : x.strokeWidth;\r\n    return {\r\n      path: x.path,\r\n      fill,\r\n      stroke,\r\n      strokeWidth\r\n    };\r\n  });\r\n}\r\n\r\nexport function inputsOf(def: NodeDefinition): IDMap<NodePinDefinition> {\r\n  return pickBy(def.pins, value => value.direction === \"input\") as IDMap<\r\n    NodePinDefinition\r\n  >;\r\n}\r\n\r\nexport function outputsOf(def: NodeDefinition): IDMap<NodePinDefinition> {\r\n  return pickBy(def.pins, value => value.direction === \"output\") as IDMap<\r\n    NodePinDefinition\r\n  >;\r\n}\r\n","import { createSimulatorSelector } from \"../utils\";\r\nimport { SimulatorState } from \"../state\";\r\n\r\nexport const nodeStatesByIdSelector = createSimulatorSelector(\r\n  s => s.nodeStatesByNodeId\r\n);\r\n\r\nexport const nodeStateSelector = createSimulatorSelector(\r\n  (s: SimulatorState, nodeId: string) => s.nodeStatesByNodeId[nodeId]\r\n);\r\n\r\nexport const nodeOutputPinValue = createSimulatorSelector(\r\n  (s: SimulatorState, nodeId: string, pinId: string) => {\r\n    return s.nodeOutputValuesByNodeId[nodeId]?.[pinId] || false;\r\n  }\r\n);\r\n","import { createSelector } from \"reselect\";\r\nimport getBounds from \"svg-path-bounds\";\r\n\r\nimport mapValues from \"lodash/mapValues\";\r\n\r\nimport { normalizeVisuals } from \"@/node-defs/utils\";\r\nimport { normalizeRectangle } from \"@/geometry\";\r\n\r\nimport { nodeDefsByIdSelector } from \"@/services/graph/selectors/nodes\";\r\nimport { nodeStatesByIdSelector } from \"@/services/simulator/selectors/nodes\";\r\n\r\nimport { nodePositionsByIdSelector } from \"./positions\";\r\nimport { createFieldSelector } from \"../utils\";\r\n\r\nexport const fieldWidthSelector = createFieldSelector(s => s.width);\r\nexport const fieldHeightSelector = createFieldSelector(s => s.height);\r\n\r\nexport const nodeBoundsById = createSelector(\r\n  nodeDefsByIdSelector,\r\n  nodeStatesByIdSelector,\r\n  (nodeDefsById, nodeStateById) =>\r\n    mapValues(nodeDefsById, (x, id) => {\r\n      if (x.visual.hitPath) {\r\n        return getBounds(x.visual.hitPath);\r\n      }\r\n      const shapePaths = normalizeVisuals(\r\n        x.visual.shapePath,\r\n        nodeStateById[id]\r\n      );\r\n      if (shapePaths.length > 0) {\r\n        return getBounds(shapePaths[0].path);\r\n      }\r\n      return [0, 0, 0, 0];\r\n    })\r\n);\r\n\r\nexport const nodeRectsByIdSelector = createSelector(\r\n  nodePositionsByIdSelector,\r\n  nodeBoundsById,\r\n  (positionsById, boundsById) =>\r\n    mapValues(positionsById, (p1, id) => {\r\n      const bounds = boundsById[id] || [0, 0, 0, 0];\r\n      return normalizeRectangle(\r\n        {\r\n          x: p1.x + bounds[0],\r\n          y: p1.y + bounds[1]\r\n        },\r\n        {\r\n          x: p1.x + bounds[2],\r\n          y: p1.y + bounds[3]\r\n        }\r\n      );\r\n    })\r\n);\r\n","import forOwn from \"lodash/forOwn\";\r\n\r\nimport { intersects } from \"@/geometry\";\r\n\r\nimport { isSelectRegionAction } from \"@/actions/select-region\";\r\n\r\nimport { nodeRectsByIdSelector } from \"@/services/field/selectors/bounds\";\r\n\r\nimport { combineSelection, createSelectionReducer } from \"../utils\";\r\n\r\nexport default createSelectionReducer((state, action, appState) => {\r\n  if (!isSelectRegionAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { region, mode } = action.payload;\r\n\r\n  const rects = nodeRectsByIdSelector(appState);\r\n  const chosenNodeIds: string[] = [];\r\n  forOwn(rects, (rect, id) => {\r\n    if (intersects(rect, region)) {\r\n      chosenNodeIds.push(id);\r\n    }\r\n  });\r\n\r\n  // TODO: Region select joints\r\n\r\n  return {\r\n    ...state,\r\n    selectedNodeIds: combineSelection(\r\n      state.selectedNodeIds,\r\n      chosenNodeIds,\r\n      mode\r\n    ),\r\n    selectedWireIds: mode === \"set\" ? [] : state.selectedWireIds,\r\n    selectedJointIds: mode === \"set\" ? [] : state.selectedJointIds\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { SelectionMode } from \"@/types\";\r\n\r\nexport const ACTION_SELECT_WIRES = \"@select/wires\" as const;\r\nexport const selectWires = (\r\n  wireId: string | string[],\r\n  mode: SelectionMode = \"set\"\r\n) => ({\r\n  type: ACTION_SELECT_WIRES,\r\n  payload: {\r\n    wireIds: Array.isArray(wireId) ? wireId : [wireId],\r\n    mode\r\n  }\r\n});\r\nexport type SelectWiresAction = ReturnType<typeof selectWires>;\r\nexport function isSelectWiresAction(\r\n  action: AnyAction\r\n): action is SelectWiresAction {\r\n  return action.type === ACTION_SELECT_WIRES;\r\n}\r\n","import { isSelectWiresAction } from \"@/actions/select-wires\";\r\nimport { createSelectionReducer, combineSelection } from \"../utils\";\r\n\r\nexport default createSelectionReducer((state, action) => {\r\n  if (!isSelectWiresAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { wireIds, mode } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    selectedNodeIds: mode === \"set\" ? [] : state.selectedNodeIds,\r\n    selectedWireIds: combineSelection(state.selectedWireIds, wireIds, mode),\r\n    selectedJointIds: mode === \"set\" ? [] : state.selectedJointIds\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SELECTION_COPY = \"@selection/copy\" as const;\r\nexport const selectionCopy = () => ({\r\n  type: ACTION_SELECTION_COPY\r\n});\r\nexport type SelectionCopyAction = ReturnType<typeof selectionCopy>;\r\nexport function isSelectionCopyAction(\r\n  action: AnyAction\r\n): action is SelectionCopyAction {\r\n  return action.type === ACTION_SELECTION_COPY;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SELECTION_DELETE = \"@selection/delete\" as const;\r\nexport const selectionDelete = () => ({\r\n  type: ACTION_SELECTION_DELETE\r\n});\r\nexport type SelectionDeleteAction = ReturnType<typeof selectionDelete>;\r\nexport function isSelectionDeleteAction(\r\n  action: AnyAction\r\n): action is SelectionDeleteAction {\r\n  return action.type === ACTION_SELECTION_DELETE;\r\n}\r\n","import { reduceReducers } from \"@/store/utils\";\r\n\r\nimport fileNewReducer from \"./file-new\";\r\nimport nodeDeleteReducer from \"./node-delete\";\r\nimport selectAllReducer from \"./select-all\";\r\nimport selectClearReducer from \"./select-clear\";\r\nimport selectJointsReducer from \"./select-joints\";\r\nimport selectNodesReducer from \"./select-nodes\";\r\nimport selectRegionReducer from \"./select-region\";\r\nimport selectWiresReducer from \"./select-wires\";\r\nimport selectionCopyReducer from \"./selection-copy\";\r\nimport selectionDeleteReducer from \"./selection-delete\";\r\nimport wireDetatchReducer from \"./wire-detatch\";\r\n\r\nconst selectionReducer = reduceReducers(\r\n  fileNewReducer,\r\n  nodeDeleteReducer,\r\n  selectAllReducer,\r\n  selectClearReducer,\r\n  selectJointsReducer,\r\n  selectNodesReducer,\r\n  selectRegionReducer,\r\n  selectWiresReducer,\r\n  selectionCopyReducer,\r\n  selectionDeleteReducer,\r\n  wireDetatchReducer\r\n);\r\n\r\nexport default selectionReducer;\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { AppState, defaultAppState } from \"@/store\";\r\nimport rootReducer from \"@/store/reducer\";\r\n\r\nimport { isSelectionCopyAction } from \"@/actions/selection-copy\";\r\nimport { copyNodes } from \"@/actions/clipboard-copy\";\r\n\r\nimport { selectedNodeIdsSelector } from \"@/services/selection/selectors/selection\";\r\n\r\nexport default function selectionCopyReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n): AppState {\r\n  if (!isSelectionCopyAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const selectedNodes = selectedNodeIdsSelector(state);\r\n  if (selectedNodes.length === 0) {\r\n    return state;\r\n  }\r\n\r\n  return rootReducer(state, copyNodes(selectedNodes));\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { AppState, defaultAppState } from \"@/store\";\r\nimport rootReducer from \"@/store/reducer\";\r\n\r\nimport { isSelectionDeleteAction } from \"@/actions/selection-delete\";\r\nimport { deleteNode } from \"@/actions/node-delete\";\r\nimport { detatchWire } from \"@/actions/wire-detatch\";\r\nimport { deleteWireJoint } from \"@/actions/wire-joint-delete\";\r\n\r\nexport default function selectionDeleteReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n): AppState {\r\n  if (!isSelectionDeleteAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const {\r\n    selectedNodeIds,\r\n    selectedWireIds,\r\n    selectedJointIds\r\n  } = state.services.selection;\r\n\r\n  state = rootReducer(state, deleteNode(selectedNodeIds));\r\n  state = selectedWireIds.reduce(\r\n    (state, wireId) => rootReducer(state, detatchWire(wireId)),\r\n    state\r\n  );\r\n  state = selectedJointIds.reduce(\r\n    (state, jointId) => rootReducer(state, deleteWireJoint(jointId)),\r\n    state\r\n  );\r\n\r\n  return state;\r\n}\r\n","import { isDetatchWireAction } from \"@/actions/wire-detatch\";\r\n\r\nimport { createSelectionReducer } from \"../utils\";\r\n\r\nexport default createSelectionReducer((state, action) => {\r\n  if (!isDetatchWireAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { wireId } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    selectedWireIds: state.selectedWireIds.filter(x => x !== wireId)\r\n  };\r\n});\r\n","import { isNewFileAction } from \"@/actions/file-new\";\r\n\r\nimport { createSimulatorReducer } from \"../utils\";\r\nimport { defaultSimulatorState } from \"../state\";\r\n\r\nexport default createSimulatorReducer((state, action) => {\r\n  if (!isNewFileAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  return defaultSimulatorState;\r\n});\r\n","import { AnyAction } from \"redux\";\r\nimport mapValues from \"lodash/mapValues\";\r\n\r\nimport { isAddNodeAction } from \"@/actions/node-add\";\r\n\r\nimport { NodeTypes } from \"@/node-defs\";\r\nimport { inputsOf, outputsOf } from \"@/node-defs/utils\";\r\n\r\nimport { createSimulatorReducer } from \"../utils\";\r\n\r\nexport default createSimulatorReducer((state, action: AnyAction) => {\r\n  if (!isAddNodeAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { nodeId: id, nodeType: type } = action.payload;\r\n\r\n  const def = NodeTypes[type];\r\n  if (!def) {\r\n    return state;\r\n  }\r\n\r\n  const inputs = inputsOf(def);\r\n  const outputs = outputsOf(def);\r\n\r\n  const result = def.evolve\r\n    ? def.evolve(\r\n        undefined,\r\n        mapValues(inputs, () => false),\r\n        state.tick\r\n      )\r\n    : {};\r\n\r\n  const nodeState = result.state || {};\r\n  const outputValues = result.transitions\r\n    ? mapValues(result.transitions, x => x.value)\r\n    : mapValues(outputs, () => false);\r\n\r\n  return {\r\n    ...state,\r\n    nodeStatesByNodeId: {\r\n      ...state.nodeStatesByNodeId,\r\n      [id]: nodeState\r\n    },\r\n    nodeOutputValuesByNodeId: {\r\n      ...state.nodeOutputValuesByNodeId,\r\n      [id]: outputValues\r\n    }\r\n  };\r\n});\r\n","import binarySearch from \"binary-search\";\r\nimport uuidV4 from \"uuid/v4\";\r\nimport find from \"lodash/find\";\r\nimport findIndex from \"lodash/findIndex\";\r\nimport pick from \"lodash/pick\";\r\nimport mapValues from \"lodash/mapValues\";\r\n\r\nimport { fpSet } from \"@/utils\";\r\nimport { IDMap } from \"@/types\";\r\nimport { AppState } from \"@/store\";\r\n\r\nimport { inputsOf, outputsOf } from \"@/node-defs/utils\";\r\n\r\nimport { nodeInputConnectionsByPinSelector } from \"@/services/graph/selectors/wires\";\r\nimport {\r\n  nodeDefSelector,\r\n  nodeIdsSelector\r\n} from \"@/services/graph/selectors/nodes\";\r\nimport { NodePin } from \"@/services/graph/types\";\r\n\r\nimport { SimulatorState, defaultSimulatorState } from \"../state\";\r\nimport { SimTransitionWindow, SimNodePinTransition } from \"../types\";\r\nimport { nodeOutputPinValue } from \"../selectors/nodes\";\r\n\r\nexport function simInit(\r\n  state: SimulatorState,\r\n  appState: AppState\r\n): SimulatorState {\r\n  // Switching away from edit mode, initialize the simulator.\r\n  const nodeIds = nodeIdsSelector(appState);\r\n\r\n  state = {\r\n    ...defaultSimulatorState,\r\n    ticksPerSecond: state.ticksPerSecond\r\n  };\r\n\r\n  state = nodeIds.reduce(\r\n    (state, nodeId) => initNode(state, nodeId, appState),\r\n    state\r\n  );\r\n\r\n  state = nodeIds.reduce(\r\n    (state, nodeId) => collectNodeTransitions(state, nodeId, appState),\r\n    state\r\n  );\r\n\r\n  return state;\r\n}\r\n\r\nfunction initNode(\r\n  state: SimulatorState,\r\n  nodeId: string,\r\n  appState: AppState\r\n): SimulatorState {\r\n  const def = nodeDefSelector(appState, nodeId);\r\n  if (!def) {\r\n    return state;\r\n  }\r\n\r\n  const inputs = inputsOf(def);\r\n  const outputs = outputsOf(def);\r\n\r\n  const { state: nodeState = null, transitions = null } = def.evolve\r\n    ? def.evolve(\r\n        undefined,\r\n        mapValues(inputs, () => false),\r\n        state.tick\r\n      )\r\n    : {};\r\n\r\n  const outputValues = transitions\r\n    ? mapValues(transitions, x => x.value)\r\n    : mapValues(outputs, () => false);\r\n\r\n  return {\r\n    ...state,\r\n    nodeStatesByNodeId: {\r\n      ...state.nodeStatesByNodeId,\r\n      [nodeId]: nodeState\r\n    },\r\n    nodeOutputValuesByNodeId: {\r\n      ...state.nodeOutputValuesByNodeId,\r\n      [nodeId]: outputValues\r\n    }\r\n  };\r\n}\r\n\r\nexport function collectNodeTransitions(\r\n  state: SimulatorState,\r\n  nodeId: string,\r\n  appState: AppState\r\n): SimulatorState {\r\n  const def = nodeDefSelector(appState, nodeId);\r\n  if (!def || !def.evolve) {\r\n    return state;\r\n  }\r\n\r\n  // Build the current input state from the connected pins.\r\n  const inputs: IDMap<boolean> = {};\r\n  const inputConnectionsByPin = nodeInputConnectionsByPinSelector(\r\n    appState,\r\n    nodeId\r\n  );\r\n\r\n  for (const inputPin of Object.keys(inputConnectionsByPin)) {\r\n    const inputConn = inputConnectionsByPin[inputPin];\r\n    if (!inputConn) {\r\n      inputs[inputPin] = false;\r\n      continue;\r\n    }\r\n    const { nodeId: sourceNodeId, pinId: sourcePin } = inputConn;\r\n\r\n    inputs[inputPin] = nodeOutputPinValue.local(state, sourceNodeId, sourcePin);\r\n  }\r\n\r\n  const result = def.evolve(\r\n    state.nodeStatesByNodeId[nodeId],\r\n    inputs,\r\n    state.tick\r\n  );\r\n\r\n  if (result.state) {\r\n    state = fpSet(state, \"nodeStatesByNodeId\", nodeId, result.state);\r\n  }\r\n\r\n  if (result.transitions) {\r\n    const nodeOutputs = state.nodeOutputValuesByNodeId[nodeId] || {};\r\n    for (const outputId of Object.keys(result.transitions)) {\r\n      const { tickOffset, value } = result.transitions[outputId];\r\n\r\n      // Sanity check that we are not producing transitions for the past or current tick.\r\n      const transitionTick = state.tick + (tickOffset > 0 ? tickOffset : 1);\r\n\r\n      state = removeTransitionByPin(state, {\r\n        nodeId: nodeId,\r\n        pinId: outputId\r\n      });\r\n\r\n      if (nodeOutputs[outputId] !== value) {\r\n        state = addTransition(state, nodeId, outputId, transitionTick, value);\r\n      }\r\n    }\r\n  }\r\n\r\n  return state;\r\n}\r\n\r\nfunction addTransition(\r\n  state: Readonly<SimulatorState>,\r\n  nodeId: string,\r\n  outputId: string,\r\n  tick: number,\r\n  value: boolean\r\n): SimulatorState {\r\n  const transitionId = uuidV4();\r\n\r\n  const newTransition: SimNodePinTransition = {\r\n    id: transitionId,\r\n    nodeId,\r\n    outputId,\r\n    tick,\r\n    value\r\n  };\r\n\r\n  // Add the transition to the state, and clone transitionWindows for mutation below.\r\n  state = {\r\n    ...state,\r\n    transitionsById: {\r\n      ...state.transitionsById,\r\n      [transitionId]: newTransition\r\n    },\r\n    transitionWindows: [...state.transitionWindows]\r\n  };\r\n\r\n  let index = binarySearch(state.transitionWindows, tick, (a, b) => a.tick - b);\r\n  if (index < 0) {\r\n    // Need to create a new window\r\n    index = -index - 1;\r\n    const newWindow: SimTransitionWindow = {\r\n      tick,\r\n      transitionIds: []\r\n    };\r\n    // Mutation is safe here as we cloned the array above.\r\n    state.transitionWindows.splice(index, 0, newWindow);\r\n  }\r\n\r\n  // Mutation is safe here as we cloned the array above.\r\n  state.transitionWindows[index] = {\r\n    ...state.transitionWindows[index],\r\n    transitionIds: [\r\n      ...state.transitionWindows[index].transitionIds,\r\n      transitionId\r\n    ]\r\n  };\r\n  return state;\r\n}\r\n\r\nfunction removeTransitionByPin(\r\n  state: Readonly<SimulatorState>,\r\n  pin: NodePin\r\n): SimulatorState {\r\n  const { nodeId, pinId: outputId } = pin;\r\n\r\n  const transition = find(\r\n    state.transitionsById,\r\n    t => t.nodeId === nodeId && t.outputId === outputId\r\n  );\r\n  if (!transition) {\r\n    return state;\r\n  }\r\n\r\n  const { id } = transition;\r\n  return removeTransitionById(state, id);\r\n}\r\n\r\nexport function removeTransitionById(\r\n  state: Readonly<SimulatorState>,\r\n  transitionId: string\r\n): SimulatorState {\r\n  const transition = state.transitionsById[transitionId];\r\n  if (!transition) {\r\n    return state;\r\n  }\r\n\r\n  const transitionsById = pick(\r\n    state.transitionsById,\r\n    Object.keys(state.transitionsById).filter(x => x !== transitionId)\r\n  );\r\n  let transitionWindows = state.transitionWindows;\r\n\r\n  const transitionWindowIndex = findIndex(\r\n    transitionWindows,\r\n    x => x.tick === transition.tick\r\n  );\r\n  if (transitionWindowIndex !== -1) {\r\n    const transitionWindow = transitionWindows[transitionWindowIndex];\r\n\r\n    const tickWindowTransitionIndex = transitionWindow.transitionIds.indexOf(\r\n      transitionId\r\n    );\r\n    if (tickWindowTransitionIndex !== -1) {\r\n      if (transitionWindow.transitionIds.length === 1) {\r\n        // Only one element left, remove the window.\r\n        transitionWindows = [\r\n          ...transitionWindows.slice(0, transitionWindowIndex),\r\n          ...transitionWindows.slice(transitionWindowIndex + 1)\r\n        ];\r\n      } else {\r\n        // Remove the transition from the tick window.\r\n        transitionWindows = [...transitionWindows];\r\n        const transitionIds =\r\n          transitionWindows[transitionWindowIndex].transitionIds;\r\n        transitionWindows[transitionWindowIndex] = {\r\n          ...transitionWindows[transitionWindowIndex],\r\n          transitionIds: [\r\n            ...transitionIds.slice(0, tickWindowTransitionIndex),\r\n            ...transitionIds.slice(tickWindowTransitionIndex + 1)\r\n          ]\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    transitionsById,\r\n    transitionWindows\r\n  };\r\n}\r\n","import pick from \"lodash/pick\";\r\n\r\nimport { AppState } from \"@/store\";\r\nimport { nodeIdsSelector } from \"@/services/graph/selectors/nodes\";\r\nimport { isDeleteNodeAction } from \"@/actions/node-delete\";\r\n\r\nimport { SimulatorState } from \"../state\";\r\n\r\nimport { createSimulatorReducer } from \"../utils\";\r\nimport { removeTransitionById } from \"./utils\";\r\n\r\nexport default createSimulatorReducer((state, action, appState) => {\r\n  if (!isDeleteNodeAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { nodeIds } = action.payload;\r\n\r\n  return nodeIds.reduce(\r\n    (state, nodeId) => deleteNodeById(state, nodeId, appState),\r\n    state\r\n  );\r\n});\r\n\r\nfunction deleteNodeById(\r\n  state: SimulatorState,\r\n  nodeId: string,\r\n  appState: AppState\r\n): SimulatorState {\r\n  const removeTransitionIds = Object.keys(state.transitionsById).filter(\r\n    id => state.transitionsById[id].nodeId === nodeId\r\n  );\r\n\r\n  state = removeTransitionIds.reduce(\r\n    (state, transitionId) => removeTransitionById(state, transitionId),\r\n    state\r\n  );\r\n\r\n  const remainingNodeIds = nodeIdsSelector(appState).filter(x => x !== nodeId);\r\n\r\n  return {\r\n    ...state,\r\n    nodeStatesByNodeId: pick(state.nodeStatesByNodeId, remainingNodeIds),\r\n    nodeOutputValuesByNodeId: pick(\r\n      state.nodeOutputValuesByNodeId,\r\n      remainingNodeIds\r\n    )\r\n  };\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_NODE_INTERACT = \"@node/interact\" as const;\r\nexport const interactNode = (nodeId: string) => ({\r\n  type: ACTION_NODE_INTERACT,\r\n  payload: { nodeId }\r\n});\r\nexport type InteractNodeAction = ReturnType<typeof interactNode>;\r\nexport function isInteractNodeAction(\r\n  action: AnyAction\r\n): action is InteractNodeAction {\r\n  return action.type === ACTION_NODE_INTERACT;\r\n}\r\n","import { fpSet } from \"@/utils\";\r\n\r\nimport { isInteractNodeAction } from \"@/actions/node-interact\";\r\n\r\nimport { createSimulatorReducer } from \"../utils\";\r\n\r\nimport { collectNodeTransitions } from \"./utils\";\r\nimport { nodeDefSelector } from \"@/services/graph/selectors/nodes\";\r\n\r\nexport default createSimulatorReducer((state, action, appState) => {\r\n  if (!isInteractNodeAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { nodeId } = action.payload;\r\n\r\n  const def = nodeDefSelector(appState, nodeId);\r\n\r\n  if (!def || !def.interact) {\r\n    return state;\r\n  }\r\n\r\n  const nodeState = state.nodeStatesByNodeId[nodeId];\r\n  const newState = def.interact(nodeState);\r\n  state = fpSet(state, \"nodeStatesByNodeId\", nodeId, newState);\r\n\r\n  return collectNodeTransitions(state, nodeId, appState);\r\n});\r\n","import pick from \"lodash/pick\";\r\nimport difference from \"lodash/difference\";\r\n\r\nimport { AppState } from \"@/store\";\r\nimport { isTickSimAction } from \"@/actions/sim-tick\";\r\nimport { nodeOutputConnectionsSelector } from \"@/services/graph/selectors/wires\";\r\n\r\nimport { SimulatorState } from \"../state\";\r\nimport { SimTransitionWindow } from \"../types\";\r\n\r\nimport { collectNodeTransitions } from \"./utils\";\r\nimport { createSimulatorReducer } from \"../utils\";\r\n\r\nexport default createSimulatorReducer((state, action, appState) => {\r\n  if (!isTickSimAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { tickCount } = action.payload;\r\n\r\n  const endTick = state.tick + tickCount;\r\n\r\n  // We cannot grab the windows ahead of time, as some windows might generate more windows\r\n  //  for future ticks.\r\n\r\n  // Pre-clone windows as we wil be repeatedly modifying it.\r\n  state = {\r\n    ...state,\r\n    transitionWindows: [...state.transitionWindows]\r\n  };\r\n\r\n  let saftyCount = tickCount + 1;\r\n  while (\r\n    state.transitionWindows.length > 0 &&\r\n    state.transitionWindows[0].tick <= endTick\r\n  ) {\r\n    if (--saftyCount === 0) {\r\n      // If we have seen more windows than ticks, something is creating windows for past ticks.\r\n      throw new Error(\r\n        `Maximum ticks per sim evolution exceeded.  This is an indication that windows are being generated for past ticks.`\r\n      );\r\n    }\r\n\r\n    // We can safely mutate here, as even if the array is regenerated\r\n    //  from a tick it will still be a fresh copy that has not yet been\r\n    //  consumed by redux.\r\n    const window = state.transitionWindows.shift()!;\r\n    state = tickWindow(state, window, appState);\r\n  }\r\n\r\n  // If we did not encounter a window on our last tick, jump ahead to that tick.\r\n  if (state.tick != endTick) {\r\n    state = {\r\n      ...state,\r\n      tick: endTick\r\n    };\r\n  }\r\n\r\n  return state;\r\n});\r\n\r\nfunction tickWindow(\r\n  state: SimulatorState,\r\n  window: SimTransitionWindow,\r\n  appState: AppState\r\n): SimulatorState {\r\n  // Update the current tick, as it is referenced\r\n  //  during transition collection.\r\n  state = {\r\n    ...state,\r\n    tick: window.tick,\r\n    // pre-clone outputs for mutation below\r\n    nodeOutputValuesByNodeId: {\r\n      ...state.nodeOutputValuesByNodeId\r\n    }\r\n  };\r\n\r\n  let updatedNodes = [];\r\n  for (const tid of window.transitionIds) {\r\n    const { nodeId, outputId, value } = state.transitionsById[tid];\r\n\r\n    // nodeOutputValuesByNodeId is pre-cloned\r\n    state.nodeOutputValuesByNodeId[nodeId] = {\r\n      ...state.nodeOutputValuesByNodeId[nodeId],\r\n      [outputId]: value\r\n    };\r\n\r\n    // Add each node we output to, to the output list.\r\n    const outputConnections = nodeOutputConnectionsSelector(appState, nodeId);\r\n    for (const outConn of outputConnections) {\r\n      const nodeId = outConn.inputPin.nodeId;\r\n      if (updatedNodes.indexOf(nodeId) === -1) {\r\n        updatedNodes.push(nodeId);\r\n      }\r\n    }\r\n  }\r\n\r\n  for (const nodeId of updatedNodes) {\r\n    state = collectNodeTransitions(state, nodeId, appState);\r\n  }\r\n\r\n  // Remove all window transitions as they have been consumed.\r\n  // State is cloned above\r\n  state.transitionsById = pick(\r\n    state.transitionsById,\r\n    difference(Object.keys(state.transitionsById), window.transitionIds)\r\n  );\r\n\r\n  return state;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SIM_FASTFORWARD = \"@sim/fastforward\" as const;\r\nexport const fastForwardSim = () => ({\r\n  type: ACTION_SIM_FASTFORWARD\r\n});\r\nexport type FastForwardSimAction = ReturnType<typeof fastForwardSim>;\r\nexport function isFastForwardSimAction(\r\n  action: AnyAction\r\n): action is FastForwardSimAction {\r\n  return action.type === ACTION_SIM_FASTFORWARD;\r\n}\r\n","import { isStartSimAction } from \"@/actions/sim-start\";\r\n\r\nimport { createSimulatorReducer } from \"../utils\";\r\n\r\nimport { simInit } from \"./utils\";\r\n\r\nexport default createSimulatorReducer((state, action, appState) => {\r\n  if (!isStartSimAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  state = simInit(state, appState);\r\n\r\n  return {\r\n    ...state,\r\n    mode: \"run\"\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SIM_STOP = \"@sim/stop\" as const;\r\nexport const stopSim = () => ({\r\n  type: ACTION_SIM_STOP\r\n});\r\nexport type StartSimAction = ReturnType<typeof stopSim>;\r\nexport function isStopSimAction(action: AnyAction): action is StartSimAction {\r\n  return action.type === ACTION_SIM_STOP;\r\n}\r\n","import { isStopSimAction } from \"@/actions/sim-stop\";\r\n\r\nimport { createSimulatorReducer } from \"../utils\";\r\n\r\nimport { defaultSimulatorState } from \"../state\";\r\n\r\nexport default createSimulatorReducer((state, action, appState) => {\r\n  if (!isStopSimAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  // Reset the simulator but keep the ticks per second choice.\r\n  return {\r\n    ...defaultSimulatorState,\r\n    ticksPerSecond: state.ticksPerSecond\r\n  };\r\n});\r\n","import { isAttachWireAction } from \"@/actions/wire-attach\";\r\n\r\nimport { createSimulatorReducer } from \"../utils\";\r\n\r\nimport { collectNodeTransitions } from \"./utils\";\r\n\r\nexport default createSimulatorReducer((state, action, appState) => {\r\n  if (!isAttachWireAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { p1, p2 } = action.payload;\r\n\r\n  // This is a bit messy.  We only want to recalculate the input,\r\n  //  but we do not know which one that is.\r\n\r\n  state = collectNodeTransitions(state, p1.nodeId, appState);\r\n  state = collectNodeTransitions(state, p2.nodeId, appState);\r\n  return state;\r\n});\r\n","import { nodeIdsSelector } from \"@/services/graph/selectors/nodes\";\r\nimport { isDetatchWireAction } from \"@/actions/wire-detatch\";\r\n\r\nimport { createSimulatorReducer } from \"../utils\";\r\n\r\nimport { collectNodeTransitions } from \"./utils\";\r\n\r\nexport default createSimulatorReducer((state, action, appState) => {\r\n  if (!isDetatchWireAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  // TODO: Make this reducer run before graph/wire-detatch so we can figure out\r\n  //  what node we need to collect transitions for.\r\n\r\n  // For now, just collect transitions on all nodes.\r\n  for (const nodeId of nodeIdsSelector(appState)) {\r\n    state = collectNodeTransitions(state, nodeId, appState);\r\n  }\r\n  return state;\r\n});\r\n","import { reduceReducers } from \"@/store/utils\";\r\n\r\nimport fileNewReducer from \"./file-new\";\r\nimport nodeAddReducer from \"./node-add\";\r\nimport nodeDeleteReducer from \"./node-delete\";\r\nimport nodeInteractReducer from \"./node-interact\";\r\nimport simEvolveReducer from \"./sim-evolve\";\r\nimport simFastforwardReducer from \"./sim-fastforward\";\r\nimport simStartReducer from \"./sim-start\";\r\nimport simStopReducer from \"./sim-stop\";\r\nimport wireAttachReducer from \"./wire-attach\";\r\nimport wireDetatchReducer from \"./wire-detatch\";\r\n\r\nconst simulatorReducer = reduceReducers(\r\n  fileNewReducer,\r\n  nodeAddReducer,\r\n  nodeDeleteReducer,\r\n  nodeInteractReducer,\r\n  simEvolveReducer,\r\n  simFastforwardReducer,\r\n  simStartReducer,\r\n  simStopReducer,\r\n  wireAttachReducer,\r\n  wireDetatchReducer\r\n);\r\n\r\nexport default simulatorReducer;\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { AppState, defaultAppState } from \"@/store\";\r\n\r\nimport { isFastForwardSimAction } from \"@/actions/sim-fastforward\";\r\nimport { tickSim } from \"@/actions/sim-tick\";\r\n\r\nimport evolveSimReducer from \"./sim-evolve\";\r\n\r\nexport default function simFastForwardReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n) {\r\n  if (!isFastForwardSimAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { tick, transitionWindows } = state.services.simulator;\r\n\r\n  if (transitionWindows.length === 0) {\r\n    return state;\r\n  }\r\n\r\n  const nextWindowTick = transitionWindows[0].tick - tick;\r\n  return evolveSimReducer(state, tickSim(nextWindowTick));\r\n}\r\n","import {\r\n  createServiceReducerCreator,\r\n  createServiceSelectorCreator\r\n} from \"../service-state-utils\";\r\n\r\nexport const createViewReducer = createServiceReducerCreator(\"view\");\r\nexport const createViewSelector = createServiceSelectorCreator(\"view\");\r\n","import { isViewZoomAction } from \"@/actions/view-zoom\";\r\nimport { createViewReducer } from \"../utils\";\r\n\r\nconst SCALE_FACTOR = 1.03;\r\n\r\nexport default createViewReducer((state, action) => {\r\n  if (!isViewZoomAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { scale } = state;\r\n  const { delta } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    scale:\r\n      delta > 0 ? scale * delta * SCALE_FACTOR : scale / (-delta * SCALE_FACTOR)\r\n  };\r\n});\r\n","import { reduceReducers } from \"@/store/utils\";\r\n\r\nimport viewZoomReducer from \"./view-zoom\";\r\n\r\nexport default reduceReducers(viewZoomReducer);\r\n","import { AnyAction, Reducer } from \"redux\";\r\n\r\nimport { AppState, defaultAppState } from \"@/store\";\r\nimport { fpSet } from \"@/utils\";\r\n\r\nimport { CircuitFieldState } from \"../state\";\r\n\r\nexport interface CircuitFieldReducer {\r\n  (state: CircuitFieldState, action: AnyAction): CircuitFieldState;\r\n}\r\n\r\nexport function createFieldReducer(\r\n  reducer: CircuitFieldReducer\r\n): Reducer<AppState, AnyAction> {\r\n  return (state: AppState = defaultAppState, action: AnyAction) => {\r\n    const newState = reducer(state.ui.circuitEditor.circuitField, action);\r\n    if (state.ui.circuitEditor.circuitField != newState) {\r\n      return fpSet(state, \"ui\", \"circuitEditor\", \"circuitField\", newState);\r\n    }\r\n    return state;\r\n  };\r\n}\r\n","import { isDragContinueAction } from \"../actions/drag-continue\";\r\n\r\nimport { createFieldReducer } from \"./utils\";\r\n\r\nexport default createFieldReducer((state, action) => {\r\n  if (!isDragContinueAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { x, y } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    dragEnd: {\r\n      x,\r\n      y\r\n    }\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { Point, SelectionMode } from \"@/types\";\r\n\r\nexport const ACTION_DRAG_END = \"@editor/field/drag/end\" as const;\r\nexport const dragEnd = (point: Point, selectionMode: SelectionMode) => ({\r\n  type: ACTION_DRAG_END,\r\n  payload: { ...point, selectionMode }\r\n});\r\nexport type DragEndAction = ReturnType<typeof dragEnd>;\r\nexport function isDragEndAction(action: AnyAction): action is DragEndAction {\r\n  return action.type === ACTION_DRAG_END;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { Point, SelectionMode } from \"@/types\";\r\n\r\nexport const ACTION_DRAG_START_NODE = \"@editor/field/drag/start/node\" as const;\r\nexport const dragStartNode = (\r\n  nodeId: string,\r\n  p: Point,\r\n  selectionMode: SelectionMode\r\n) => ({\r\n  type: ACTION_DRAG_START_NODE,\r\n  payload: {\r\n    ...p,\r\n    nodeId,\r\n    selectionMode\r\n  }\r\n});\r\nexport type DragStartNodeAction = ReturnType<typeof dragStartNode>;\r\nexport function isDragStartNodeAction(\r\n  action: AnyAction\r\n): action is DragStartNodeAction {\r\n  return action.type === ACTION_DRAG_START_NODE;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { Point } from \"@/types\";\r\n\r\nexport const ACTION_DRAG_START_SELECT = \"@editor/field/drag/start/select\" as const;\r\nexport const dragStartSelect = (p: Point) => ({\r\n  type: ACTION_DRAG_START_SELECT,\r\n  payload: {\r\n    ...p\r\n  }\r\n});\r\nexport type DragStartSelectAction = ReturnType<typeof dragStartSelect>;\r\nexport function isDragStartSelectAction(\r\n  action: AnyAction\r\n): action is DragStartSelectAction {\r\n  return action.type === ACTION_DRAG_START_SELECT;\r\n}\r\n","import { isDragStartSelectAction } from \"../actions/drag-start-select\";\r\n\r\nimport { createFieldReducer } from \"./utils\";\r\n\r\nexport default createFieldReducer((state, action) => {\r\n  if (!isDragStartSelectAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { x, y } = action.payload;\r\n\r\n  return {\r\n    ...state,\r\n    dragMode: \"select\",\r\n    dragStart: {\r\n      x,\r\n      y\r\n    }\r\n  };\r\n});\r\n","import { AnyAction } from \"redux\";\r\n\r\nexport const ACTION_SELECT_PIN = \"@editor/field/select-pin\" as const;\r\nexport const selectPin = (nodeId: string, pinId: string) => ({\r\n  type: ACTION_SELECT_PIN,\r\n  payload: {\r\n    nodeId,\r\n    pinId\r\n  }\r\n});\r\nexport type SelectPinAction = ReturnType<typeof selectPin>;\r\nexport function isSelectPinAction(\r\n  action: AnyAction\r\n): action is SelectPinAction {\r\n  return action.type === ACTION_SELECT_PIN;\r\n}\r\n","import { createSelector } from \"reselect\";\r\n\r\nimport { AppState } from \"@/store\";\r\nimport { normalizeRectangle, pointSubtract } from \"@/geometry\";\r\n\r\nimport { CircuitFieldState } from \"./state\";\r\n\r\nexport const circuitFieldState = (state: AppState) =>\r\n  state.ui.circuitEditor.circuitField;\r\n\r\nexport const selectionRectSelector = createSelector(\r\n  circuitFieldState,\r\n  (s: CircuitFieldState) =>\r\n    s.dragMode === \"select\" && s.dragStart && s.dragEnd\r\n      ? normalizeRectangle(s.dragStart, s.dragEnd)\r\n      : null\r\n);\r\n\r\nexport const dragMoveOffsetSelector = createSelector(\r\n  circuitFieldState,\r\n  (s: CircuitFieldState) =>\r\n    s.dragMode === \"move\" && s.dragStart && s.dragEnd\r\n      ? pointSubtract(s.dragEnd, s.dragStart)\r\n      : null\r\n);\r\n\r\nexport const selectedPinSelector = createSelector(\r\n  circuitFieldState,\r\n  (s: CircuitFieldState) => s.selectedPin\r\n);\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { fpSet } from \"@/utils\";\r\n\r\nimport { AppState, defaultAppState } from \"@/store\";\r\nimport rootReducer from \"@/store/reducer\";\r\n\r\nimport { attachWire } from \"@/actions/wire-attach\";\r\n\r\nimport { nodePinDirectionSelector } from \"@/services/graph/selectors/wires\";\r\n\r\nimport { isSelectPinAction, SelectPinAction } from \"../actions/select-pin\";\r\n\r\nimport { selectedPinSelector } from \"../selectors\";\r\n\r\nexport default function selectPinReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n) {\r\n  if (!isSelectPinAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { nodeId, pinId } = action.payload;\r\n\r\n  const clickedPinDirection = nodePinDirectionSelector(state, {\r\n    nodeId,\r\n    pinId\r\n  });\r\n  if (!clickedPinDirection) {\r\n    return state;\r\n  }\r\n\r\n  const selectedPin = selectedPinSelector(state);\r\n  if (!selectedPin) {\r\n    return doSelectPinReducer(state, action);\r\n  }\r\n\r\n  const selectedPinDirection = nodePinDirectionSelector(state, selectedPin);\r\n  if (!selectedPinDirection) {\r\n    return doSelectPinReducer(state, action);\r\n  }\r\n\r\n  if (selectedPinDirection !== clickedPinDirection) {\r\n    return rootReducer(state, attachWire(selectedPin, { nodeId, pinId }));\r\n  }\r\n\r\n  return doSelectPinReducer(state, action);\r\n}\r\n\r\nfunction doSelectPinReducer(\r\n  state: AppState,\r\n  action: SelectPinAction\r\n): AppState {\r\n  const { nodeId, pinId } = action.payload;\r\n  let fieldState = state.ui.circuitEditor.circuitField;\r\n  fieldState = {\r\n    ...fieldState,\r\n    selectedPin: {\r\n      nodeId,\r\n      pinId\r\n    }\r\n  };\r\n  return fpSet(state, \"ui\", \"circuitEditor\", \"circuitField\", fieldState);\r\n}\r\n","import { ACTION_SELECT_REGION } from \"@/actions/select-region\";\r\nimport { ACTION_SELECT_NODES } from \"@/actions/select-nodes\";\r\nimport { ACTION_SELECT_CLEAR } from \"@/actions/select-clear\";\r\n\r\nimport { createFieldReducer } from \"./utils\";\r\n\r\nconst SELECTED_NODE_CHANGE_ACTIONS = [\r\n  ACTION_SELECT_REGION,\r\n  ACTION_SELECT_NODES,\r\n  ACTION_SELECT_CLEAR\r\n];\r\nexport default createFieldReducer((state, action) => {\r\n  if (SELECTED_NODE_CHANGE_ACTIONS.indexOf(action.type) === -1) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    selectedPin: null\r\n  };\r\n});\r\n","import { reduceReducers } from \"@/store/utils\";\r\n\r\nimport dragContinueReducer from \"./drag-continue\";\r\nimport dragEndReducer from \"./drag-end\";\r\nimport dragStartNodeReducer from \"./drag-start-node\";\r\nimport dragStartSelectReducer from \"./drag-start-select\";\r\nimport selectPinReducer from \"./select-pin\";\r\nimport selectedNodesChangedReducer from \"./selected-nodes-changed\";\r\n\r\nconst circuitFieldReducer = reduceReducers(\r\n  dragContinueReducer,\r\n  dragEndReducer,\r\n  dragStartNodeReducer,\r\n  dragStartSelectReducer,\r\n  selectPinReducer,\r\n  selectedNodesChangedReducer\r\n);\r\n\r\nexport default circuitFieldReducer;\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { normalizeRectangle, pointSubtract } from \"@/geometry\";\r\n\r\nimport { fpSet } from \"@/utils\";\r\n\r\nimport { AppState, defaultAppState } from \"@/store\";\r\nimport rootReducer from \"@/store/reducer\";\r\n\r\nimport { selectRegion } from \"@/actions/select-region\";\r\nimport { moveSelection } from \"@/actions/selection-move\";\r\n\r\nimport { isDragEndAction } from \"../actions/drag-end\";\r\n\r\nexport default function dragEndReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n) {\r\n  if (!isDragEndAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { x, y, selectionMode } = action.payload;\r\n\r\n  let circuitField = state.ui.circuitEditor.circuitField;\r\n\r\n  const { dragMode, dragStart } = circuitField;\r\n\r\n  if (dragStart) {\r\n    switch (dragMode) {\r\n      case \"select\": {\r\n        const rect = normalizeRectangle(dragStart, { x, y });\r\n        state = rootReducer(state, selectRegion(rect, selectionMode));\r\n        break;\r\n      }\r\n      case \"move\": {\r\n        const moveBy = pointSubtract({ x, y }, dragStart);\r\n        state = rootReducer(state, moveSelection(moveBy.x, moveBy.y));\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  circuitField = {\r\n    ...circuitField,\r\n    dragMode: null,\r\n    dragStart: null,\r\n    dragEnd: null\r\n  };\r\n\r\n  state = fpSet(state, \"ui\", \"circuitEditor\", \"circuitField\", circuitField);\r\n\r\n  return state;\r\n}\r\n","import { AnyAction } from \"redux\";\r\n\r\nimport { fpSet } from \"@/utils\";\r\n\r\nimport { AppState, defaultAppState } from \"@/store\";\r\nimport rootReducer from \"@/store/reducer\";\r\n\r\nimport { selectNodes } from \"@/actions/select-nodes\";\r\n\r\nimport { selectedNodeIdsSelector } from \"@/services/selection/selectors/selection\";\r\n\r\nimport { isDragStartNodeAction } from \"../actions/drag-start-node\";\r\n\r\nexport default function dragNodesStartReducer(\r\n  state: AppState = defaultAppState,\r\n  action: AnyAction\r\n) {\r\n  if (!isDragStartNodeAction(action)) {\r\n    return state;\r\n  }\r\n\r\n  const { nodeId, x, y, selectionMode } = action.payload;\r\n\r\n  let fieldState = state.ui.circuitEditor.circuitField;\r\n  fieldState = {\r\n    ...fieldState,\r\n    dragMode: \"move\",\r\n    dragStart: {\r\n      x,\r\n      y\r\n    }\r\n  };\r\n  state = fpSet(state, \"ui\", \"circuitEditor\", \"circuitField\", fieldState);\r\n\r\n  // TODO: Use selector for this.\r\n  if (selectedNodeIdsSelector(state).indexOf(nodeId) === -1) {\r\n    // Dragging a node that was not previously selected.  Perform a selection on the node.\r\n    state = rootReducer(state, selectNodes(nodeId, selectionMode));\r\n  }\r\n\r\n  return state;\r\n}\r\n","import { reduceReducers } from \"@/store/utils\";\r\n\r\nimport circuitFieldReducer from \"../components/CircuitFieldView/components/CircuitField/reducer\";\r\n\r\nexport default reduceReducers(circuitFieldReducer);\r\n","import clipboardReducer from \"@/services/clipboard/reducer\";\r\nimport fieldReducer from \"@/services/field/reducer\";\r\nimport graphReducer from \"@/services/graph/reducer\";\r\nimport savedataReducer from \"@/services/savedata/reducer\";\r\nimport selectionReducer from \"@/services/selection/reducer\";\r\nimport simulatorReducer from \"@/services/simulator/reducer\";\r\nimport viewReducer from \"@/services/view/reducer\";\r\n\r\nimport circuitEditorReducer from \"@/pages/CircuitEditor/reducer\";\r\n\r\nimport { reduceReducers } from \"./utils\";\r\n\r\nconst reducer = reduceReducers(\r\n  // This reducer should run before the others.\r\n  //  Particularly simulatorReducer, which requires the graph to have been\r\n  //  updated before it\r\n  graphReducer,\r\n\r\n  clipboardReducer,\r\n  fieldReducer,\r\n  selectionReducer,\r\n  simulatorReducer,\r\n  viewReducer,\r\n\r\n  circuitEditorReducer,\r\n\r\n  // Place this last, so it always has the most up to date data.\r\n  savedataReducer\r\n);\r\n\r\nexport default reducer;\r\n","import { createStore, compose, applyMiddleware } from \"redux\";\r\nimport freeze from \"redux-freeze\";\r\nimport createSagaMiddleware from \"redux-saga\";\r\n\r\nimport { doInit } from \"@/actions/init\";\r\n\r\nimport {\r\n  actionSanitizer,\r\n  stateSanitizer,\r\n  actionsBlacklist\r\n} from \"./devtool-sanitizer\";\r\n\r\nimport saga from \"./saga\";\r\nimport reducer from \"./reducer\";\r\n\r\nconst composeEnhancers =\r\n  (window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ &&\r\n    window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({\r\n      actionSanitizer,\r\n      stateSanitizer,\r\n      actionsBlacklist\r\n    })) ||\r\n  compose;\r\n\r\nconst sagaMiddleware = createSagaMiddleware();\r\n\r\nexport const store = createStore(\r\n  reducer,\r\n  composeEnhancers(applyMiddleware(freeze, sagaMiddleware))\r\n);\r\n\r\nsagaMiddleware.run(saga);\r\nstore.dispatch(doInit());\r\n","import { fork } from \"redux-saga/effects\";\r\n\r\nimport simulatorSaga from \"@/services/simulator/saga\";\r\n\r\nexport default function* appSaga() {\r\n  yield fork(simulatorSaga);\r\n}\r\n","import { useSelector as useSelectorRedux } from \"react-redux\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nexport default function useSelector<T>(selector: (s: AppState) => T) {\r\n  return useSelectorRedux<AppState, T>(selector);\r\n}\r\n","import { createViewSelector } from \"../utils\";\r\n\r\nexport const viewScaleSelector = createViewSelector(s => s.scale);\r\n","import { os } from \"platform\";\r\n\r\nconst OS_MAC = /(Mac|iOS|OS\\ X)/;\r\n\r\nexport const keyboardIsMac = OS_MAC.test((os || \"undefined\").toString());\r\n\r\nexport const keyboardCommandModifier = keyboardIsMac ? \"command\" : \"ctrl\";\r\n","import { keyboardCommandModifier } from \"@/runtime-env\";\r\n\r\nexport const KEYMAP_SIM_STEP = \"keymap:CircuitEditor/SimStep\" as const;\r\nexport const KEYMAP_SIM_FASTFORWARD = \"keymap:CircuitEditor/SimFastForward\" as const;\r\nexport const KEYMAP_SELECT_ALL = \"keymap:CircuitEditor/SelectAll\" as const;\r\nexport const KEYMAP_COPY = \"keymap:CircuitEditor/Copy\" as const;\r\nexport const KEYMAP_PASTE = \"keymap:CircuitEditor/Paste\" as const;\r\nexport const KEYMAP_DELETE = \"keymap:CircuitEditor/Delete\" as const;\r\n\r\nconst keymap = {\r\n  [KEYMAP_SIM_STEP]: \"space\",\r\n  [KEYMAP_SIM_FASTFORWARD]: \"shift+space\",\r\n  [KEYMAP_SELECT_ALL]: `${keyboardCommandModifier}+a`,\r\n  [KEYMAP_COPY]: `${keyboardCommandModifier}+c`,\r\n  [KEYMAP_PASTE]: `${keyboardCommandModifier}+v`,\r\n  [KEYMAP_DELETE]: [\"backspace\", \"del\"]\r\n};\r\nexport default keymap;\r\n\r\nexport type KeymapKeys = keyof typeof keymap;\r\nexport type KeymapHandler = Record<KeymapKeys, HotkeyHandler>;\r\n","import * as React from \"react\";\r\n\r\nexport const fieldSvgElementContext = React.createContext<SVGSVGElement | null>(\r\n  null\r\n);\r\n\r\nconst ContextProvider = fieldSvgElementContext.Provider;\r\n\r\nexport const FieldSvgElementProvider: React.FC<{\r\n  value: React.RefObject<SVGSVGElement | null>;\r\n}> = ({ value, children }) => {\r\n  // Force the component to rerender when the ref changes.\r\n  const [svgElement, setSvgElement] = React.useState<SVGSVGElement | null>(\r\n    null\r\n  );\r\n  React.useEffect(() => {\r\n    setSvgElement(value.current);\r\n  }, [value.current]);\r\n\r\n  return <ContextProvider value={svgElement}>{children}</ContextProvider>;\r\n};\r\n","import * as React from \"react\";\r\n\r\nimport {\r\n  NodeType,\r\n  NodeTypes,\r\n  NodePinDefinition,\r\n  NodePinDirection\r\n} from \"@/node-defs\";\r\nimport { normalizeVisuals } from \"@/node-defs/utils\";\r\n\r\nexport interface RenderPinProps extends NodePinDefinition {\r\n  id: string;\r\n  direction: NodePinDirection;\r\n}\r\nexport interface NodeVisualProps {\r\n  x?: number;\r\n  y?: number;\r\n  nodeType: NodeType;\r\n  nodeState: any;\r\n  colorOverride?: string;\r\n  renderPin?(props: RenderPinProps): React.ReactElement<any>;\r\n  onClick?(e: React.MouseEvent): void;\r\n  onMouseDown?(e: React.MouseEvent): void;\r\n  onMouseOver?(e: React.MouseEvent): void;\r\n  onMouseUp?(e: React.MouseEvent): void;\r\n  onMouseLeave?(e: React.MouseEvent): void;\r\n}\r\n\r\ntype Props = NodeVisualProps;\r\nclass NodeVisual extends React.Component<Props> {\r\n  render() {\r\n    const {\r\n      x = 0,\r\n      y = 0,\r\n      nodeType,\r\n      nodeState,\r\n      colorOverride,\r\n      renderPin,\r\n      onClick,\r\n      onMouseDown,\r\n      onMouseOver,\r\n      onMouseUp,\r\n      onMouseLeave\r\n    } = this.props;\r\n\r\n    if (!nodeType) {\r\n      console.warn(\"NodeVisual received undefined nodeType\");\r\n      return null;\r\n    }\r\n\r\n    const def = NodeTypes[nodeType];\r\n\r\n    let body: React.ReactNode;\r\n    let hitPath: string | undefined;\r\n    let pins: React.ReactNode = null;\r\n    if (!def) {\r\n      body = <rect x={x} y={y} width={50} height={50} fill=\"red\" />;\r\n    } else {\r\n      const { shapePath } = def.visual;\r\n      const visuals = normalizeVisuals(shapePath, nodeState);\r\n      body = visuals.map((v, i) => (\r\n        <path\r\n          key={i}\r\n          d={v.path}\r\n          fill={colorOverride || v.fill}\r\n          stroke={colorOverride || v.stroke}\r\n          strokeWidth={v.strokeWidth}\r\n        />\r\n      ));\r\n      hitPath = def.visual.hitPath;\r\n\r\n      if (renderPin) {\r\n        pins = Object.keys(def.pins).map(key => {\r\n          const pin = def.pins[key];\r\n          let element = renderPin({\r\n            direction: pin.direction,\r\n            id: key,\r\n            ...pin\r\n          });\r\n          return React.cloneElement(element, { key: `input-${key}` });\r\n        });\r\n      }\r\n    }\r\n\r\n    const transform = x != 0 || y != 0 ? `translate(${x}, ${y})` : undefined;\r\n    return (\r\n      <g\r\n        className=\"node-visual\"\r\n        transform={transform}\r\n        onClick={onClick}\r\n        onMouseDown={onMouseDown}\r\n        onMouseOver={onMouseOver}\r\n        onMouseUp={onMouseUp}\r\n        onMouseLeave={onMouseLeave}\r\n      >\r\n        {hitPath && <path d={hitPath} fill=\"transparent\" onClick={onClick} />}\r\n        {body}\r\n        {pins}\r\n      </g>\r\n    );\r\n  }\r\n}\r\nexport default NodeVisual;\r\n","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport pick from \"lodash/pick\";\r\nimport mapValues from \"lodash/mapValues\";\r\nimport values from \"lodash/values\";\r\n\r\nimport { createStructuredSelector, createSelector } from \"reselect\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nimport { nodeTypesByIdSelector } from \"@/services/graph/selectors/nodes\";\r\nimport { nodeStatesByIdSelector } from \"@/services/simulator/selectors/nodes\";\r\nimport { nodePositionsByIdSelector } from \"@/services/field/selectors/positions\";\r\nimport { selectedNodeIdsSelector } from \"@/services/selection/selectors/selection\";\r\n\r\nimport NodeVisual from \"@/pages/CircuitEditor/components/NodeVisual\";\r\n\r\nimport { dragMoveOffsetSelector } from \"../selectors\";\r\n\r\nconst selectedNodePositionsById = createSelector(\r\n  selectedNodeIdsSelector,\r\n  nodePositionsByIdSelector,\r\n  (selectedNodeIds, nodePositionsById) =>\r\n    pick(nodePositionsById, selectedNodeIds)\r\n);\r\n\r\nconst selectedNodeTypesById = createSelector(\r\n  selectedNodeIdsSelector,\r\n  nodeTypesByIdSelector,\r\n  (selectedNodeIds, nodeTypesById) => pick(nodeTypesById, selectedNodeIds)\r\n);\r\n\r\nconst selectedNodeStatesById = createSelector(\r\n  selectedNodeIdsSelector,\r\n  nodeStatesByIdSelector,\r\n  (selectedNodeIds, nodeStatesById) => pick(nodeStatesById, selectedNodeIds)\r\n);\r\n\r\nconst stateSelectors = {\r\n  selectedNodePositionsById,\r\n  selectedNodeTypesById,\r\n  selectedNodeStatesById,\r\n  dragMoveOffset: dragMoveOffsetSelector\r\n};\r\ntype StateProps = ObjectValueReturnTypes<typeof stateSelectors>;\r\nconst mapStateToProps = createStructuredSelector<AppState, StateProps>(\r\n  stateSelectors\r\n);\r\n\r\ntype Props = StateProps;\r\nclass DragPreviewLayer extends React.Component<Props> {\r\n  render() {\r\n    const {\r\n      selectedNodePositionsById,\r\n      selectedNodeTypesById,\r\n      selectedNodeStatesById,\r\n      dragMoveOffset\r\n    } = this.props;\r\n\r\n    let elements: React.ReactNode | null = null;\r\n    if (dragMoveOffset) {\r\n      elements = values(\r\n        mapValues(selectedNodePositionsById, (p, nodeId) => (\r\n          <NodeVisual\r\n            key={nodeId}\r\n            nodeType={selectedNodeTypesById[nodeId]}\r\n            nodeState={selectedNodeStatesById[nodeId]}\r\n            x={p.x + dragMoveOffset.x}\r\n            y={p.y + dragMoveOffset.y}\r\n          />\r\n        ))\r\n      );\r\n    }\r\n    return (\r\n      <g id=\"drag-preview-layer\" opacity={0.3}>\r\n        {elements}\r\n      </g>\r\n    );\r\n  }\r\n}\r\nexport default connect(mapStateToProps)(DragPreviewLayer);\r\n","import * as React from \"react\";\r\nimport { ZeroPoint, pointSubtract } from \"@/geometry\";\r\nimport { Point } from \"@/types\";\r\n\r\nexport interface UseMouseTracking {\r\n  startTracking(e: React.MouseEvent): void;\r\n  cancelTracking(): void;\r\n}\r\n\r\nexport interface MouseTrackingOptions {\r\n  dragThreshold?: number;\r\n  onClick?(e: MouseEvent): void;\r\n  onDragStart?(e: MouseEvent): void;\r\n  onDragMove?(offset: Point, e: MouseEvent): void;\r\n  onDragEnd?(offset: Point, e: MouseEvent): void;\r\n}\r\n\r\nexport default function useMouseTracking(\r\n  opts: MouseTrackingOptions\r\n): UseMouseTracking {\r\n  const {\r\n    dragThreshold = 5,\r\n    onClick,\r\n    onDragStart,\r\n    onDragMove,\r\n    onDragEnd\r\n  } = opts;\r\n\r\n  // We need both state and ref for this.\r\n  //  State lets us trigger a rerender / useEffect.\r\n  //  Ref lets us check for cancellation when handling document events.\r\n  //  We seem to get a few rogue onMouseMove events after we try to stop tracking.\r\n  const [isTracking, setTracking] = React.useState(false);\r\n  const isTrackingRef = React.useRef(false);\r\n\r\n  const isDraggingRef = React.useRef(false);\r\n  const mouseDownRef = React.useRef<Point>(ZeroPoint);\r\n\r\n  const startTracking = React.useCallback((e: React.MouseEvent) => {\r\n    if (isTrackingRef.current) {\r\n      return;\r\n    }\r\n\r\n    isTrackingRef.current = true;\r\n    setTracking(true);\r\n    mouseDownRef.current = { x: e.pageX, y: e.pageY };\r\n  }, []);\r\n\r\n  const cancelTracking = React.useCallback(() => {\r\n    isTrackingRef.current = false;\r\n    setTracking(false);\r\n    isDraggingRef.current = false;\r\n    mouseDownRef.current = ZeroPoint;\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    if (!isTracking) {\r\n      return;\r\n    }\r\n\r\n    function onMouseMove(e: MouseEvent) {\r\n      if (!isTrackingRef.current) {\r\n        return;\r\n      }\r\n\r\n      if (isDraggingRef.current) {\r\n        if (onDragMove) {\r\n          const offset = pointSubtract(\r\n            { x: e.pageX, y: e.pageY },\r\n            mouseDownRef.current\r\n          );\r\n          onDragMove(offset, e);\r\n        }\r\n      } else {\r\n        const d = mouseDownRef.current;\r\n        if (\r\n          Math.abs(d.x - e.pageX) >= dragThreshold ||\r\n          Math.abs(d.y - e.pageY) >= dragThreshold\r\n        ) {\r\n          isDraggingRef.current = true;\r\n          if (onDragStart) {\r\n            onDragStart(e);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    function onMouseUp(e: MouseEvent) {\r\n      if (!isTrackingRef.current) {\r\n        return;\r\n      }\r\n\r\n      if (isDraggingRef.current) {\r\n        if (onDragEnd) {\r\n          const offset = pointSubtract(\r\n            { x: e.pageX, y: e.pageY },\r\n            mouseDownRef.current\r\n          );\r\n          onDragEnd(offset, e);\r\n        }\r\n      } else {\r\n        if (onClick) {\r\n          onClick(e);\r\n        }\r\n      }\r\n\r\n      cancelTracking();\r\n    }\r\n\r\n    document.addEventListener(\"mousemove\", onMouseMove);\r\n    document.addEventListener(\"mouseup\", onMouseUp);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousemove\", onMouseMove);\r\n      document.removeEventListener(\"mouseup\", onMouseUp);\r\n    };\r\n  }, [isTracking]);\r\n\r\n  return {\r\n    startTracking,\r\n    cancelTracking\r\n  };\r\n}\r\n","import { SelectionMode } from \"@/types\";\r\nimport { ModifierKeys } from \"./types\";\r\nimport { keyboardIsMac } from \"@/runtime-env\";\r\n\r\nexport function getModifiers(e: MouseEvent): ModifierKeys {\r\n  const { ctrlKey, altKey, shiftKey, metaKey } = e;\r\n  return {\r\n    ctrlMetaKey: keyboardIsMac ? metaKey : ctrlKey,\r\n    altKey: altKey,\r\n    shiftKey\r\n  };\r\n}\r\n\r\nexport function getSelectMode(modifiers: ModifierKeys): SelectionMode {\r\n  if (modifiers.shiftKey && modifiers.ctrlMetaKey) {\r\n    return \"remove\";\r\n  }\r\n  if (modifiers.shiftKey) {\r\n    return \"append\";\r\n  }\r\n  if (modifiers.ctrlMetaKey) {\r\n    return \"toggle\";\r\n  }\r\n  return \"set\";\r\n}\r\n","import { Point } from \"@/types\";\r\n\r\nexport function getFieldCoord(field: SVGSVGElement, p: Point) {\r\n  const ctm = field.getScreenCTM();\r\n  if (!ctm) {\r\n    return p;\r\n  }\r\n\r\n  const pt = field.createSVGPoint();\r\n  pt.x = p.x;\r\n  pt.y = p.y;\r\n  const translated = pt.matrixTransform(ctm.inverse());\r\n  return { x: translated.x, y: translated.y };\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { Point } from \"@/types\";\r\n\r\nimport { fieldSvgElementContext } from \"../contexts/fieldSvgElement\";\r\nimport { getFieldCoord } from \"../utils\";\r\nimport { pointSubtract, ZeroPoint } from \"@/geometry\";\r\n\r\nexport function useMouseCoords(): (p: Point) => Point {\r\n  const fieldRef = React.useContext(fieldSvgElementContext);\r\n  return React.useCallback(\r\n    (p: Point) => {\r\n      if (!fieldRef) {\r\n        return p;\r\n      }\r\n      return getFieldCoord(fieldRef, p);\r\n    },\r\n    [fieldRef]\r\n  );\r\n}\r\n\r\nexport function useEventMouseCoords(): (\r\n  e: MouseEvent | React.MouseEvent\r\n) => Point {\r\n  const fieldRef = React.useContext(fieldSvgElementContext);\r\n  return React.useCallback(\r\n    (e: MouseEvent | React.MouseEvent) => {\r\n      if (!fieldRef) {\r\n        return ZeroPoint;\r\n      }\r\n      const p: Point = {\r\n        x: e.pageX,\r\n        y: e.pageY\r\n      };\r\n      return getFieldCoord(fieldRef, p);\r\n    },\r\n    [fieldRef]\r\n  );\r\n}\r\n","import * as React from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\n\r\nimport { Point } from \"@/types\";\r\n\r\nimport useMouseTracking from \"@/hooks/useMouseTracking\";\r\n\r\nimport { clearSelection } from \"@/actions/select-clear\";\r\n\r\nimport { getModifiers, getSelectMode } from \"../selection-mode\";\r\n\r\nimport { selectionRectSelector } from \"../selectors\";\r\n\r\nimport { useEventMouseCoords } from \"../hooks/useMouseCoords\";\r\n\r\nimport { dragStartSelect } from \"../actions/drag-start-select\";\r\nimport { dragContinue } from \"../actions/drag-continue\";\r\nimport { dragEnd } from \"../actions/drag-end\";\r\n\r\nconst DragSelectLayer: React.FC = () => {\r\n  const dispatch = useDispatch();\r\n  const selectionRect = useSelector(selectionRectSelector);\r\n\r\n  const getCoords = useEventMouseCoords();\r\n\r\n  const onClick = React.useCallback(() => {\r\n    dispatch(clearSelection());\r\n  }, []);\r\n\r\n  const onDragStart = React.useCallback(\r\n    (e: MouseEvent) => {\r\n      const p = getCoords(e);\r\n      dispatch(dragStartSelect(p));\r\n    },\r\n    [getCoords]\r\n  );\r\n\r\n  const onDragMove = React.useCallback(\r\n    (offset: Point, e: MouseEvent) => {\r\n      const p = getCoords(e);\r\n      dispatch(dragContinue(p));\r\n    },\r\n    [getCoords]\r\n  );\r\n\r\n  const onDragEnd = React.useCallback(\r\n    (offset: Point, e: MouseEvent) => {\r\n      const p = getCoords(e);\r\n      const modifiers = getModifiers(e);\r\n      const mode = getSelectMode(modifiers);\r\n      dispatch(dragEnd(p, mode));\r\n    },\r\n    [getCoords]\r\n  );\r\n\r\n  const { startTracking } = useMouseTracking({\r\n    onClick,\r\n    onDragStart,\r\n    onDragMove,\r\n    onDragEnd\r\n  });\r\n  const onMouseDown = React.useCallback(\r\n    (e: React.MouseEvent) => {\r\n      if (e.defaultPrevented) {\r\n        return;\r\n      }\r\n      e.preventDefault();\r\n      startTracking(e);\r\n    },\r\n    [getCoords]\r\n  );\r\n\r\n  return (\r\n    <g id=\"drag-select-layer\">\r\n      <rect\r\n        width=\"100%\"\r\n        height=\"100%\"\r\n        fill=\"transparent\"\r\n        onMouseDown={onMouseDown}\r\n      />\r\n      {selectionRect && (\r\n        <g\r\n          transform={`translate(${selectionRect.p1.x}, ${selectionRect.p1.y})`}\r\n        >\r\n          <rect\r\n            width={selectionRect.p2.x - selectionRect.p1.x}\r\n            height={selectionRect.p2.y - selectionRect.p1.y}\r\n            strokeWidth=\"2\"\r\n            strokeDasharray=\"5 3\"\r\n            stroke=\"skyblue\"\r\n            fill=\"transparent\"\r\n          />\r\n        </g>\r\n      )}\r\n    </g>\r\n  );\r\n};\r\n\r\nexport default DragSelectLayer;\r\n","import * as React from \"react\";\r\nimport uuidV4 from \"uuid/v4\";\r\nimport { useDispatch } from \"react-redux\";\r\n\r\nimport { Point } from \"@/types\";\r\nimport {\r\n  normalize,\r\n  pointSubtract,\r\n  dotProduct,\r\n  pointAdd,\r\n  scale\r\n} from \"@/geometry\";\r\n\r\nimport useSelector from \"@/hooks/useSelector\";\r\nimport useMouseTracking from \"@/hooks/useMouseTracking\";\r\n\r\nimport { addWireJoint } from \"@/actions/wire-joint-add\";\r\nimport { moveWireJoint } from \"@/actions/wire-joint-move\";\r\n\r\nimport {\r\n  wireJointPositionSelector,\r\n  wireStartPositionSelector,\r\n  wireEndPositionSelector\r\n} from \"@/services/field/selectors/wires\";\r\n\r\nimport { useEventMouseCoords } from \"../hooks/useMouseCoords\";\r\nimport { selectWires } from \"@/actions/select-wires\";\r\nimport { getSelectMode, getModifiers } from \"../selection-mode\";\r\n\r\nexport interface WireSegmentProps {\r\n  wireId: string;\r\n  startJointId: string | null;\r\n  endJointId: string | null;\r\n  color: string;\r\n}\r\nconst WireSegment: React.FC<WireSegmentProps> = ({\r\n  wireId,\r\n  startJointId,\r\n  endJointId,\r\n  color\r\n}) => {\r\n  const dispatch = useDispatch();\r\n  const getMouseCoords = useEventMouseCoords();\r\n\r\n  const start = useSelector(state => {\r\n    if (startJointId == null) {\r\n      return wireStartPositionSelector(state, wireId);\r\n    }\r\n    return wireJointPositionSelector(state, startJointId);\r\n  });\r\n\r\n  const end = useSelector(state => {\r\n    if (endJointId == null) {\r\n      return wireEndPositionSelector(state, wireId);\r\n    }\r\n    return wireJointPositionSelector(state, endJointId);\r\n  });\r\n\r\n  const [mousePos, setMousePos] = React.useState<Point | null>(null);\r\n  const addedJointRef = React.useRef<string | null>(null);\r\n\r\n  const onMouseMove = React.useCallback(\r\n    (e: React.MouseEvent) => {\r\n      const p = getMouseCoords(e);\r\n      setMousePos(p);\r\n    },\r\n    [getMouseCoords]\r\n  );\r\n\r\n  const onMouseLeave = React.useCallback(() => {\r\n    setMousePos(null);\r\n  }, []);\r\n\r\n  const onDragStart = React.useCallback(\r\n    (e: MouseEvent) => {\r\n      const p = getMouseCoords(e);\r\n      const jointId = uuidV4();\r\n      addedJointRef.current = jointId;\r\n      dispatch(addWireJoint(wireId, startJointId, p, jointId));\r\n    },\r\n    [getMouseCoords]\r\n  );\r\n\r\n  const onDragMove = React.useCallback(\r\n    (offset: Point, e: MouseEvent) => {\r\n      const jointId = addedJointRef.current;\r\n      if (!jointId) {\r\n        return;\r\n      }\r\n      const p = getMouseCoords(e);\r\n      dispatch(moveWireJoint(jointId, p));\r\n    },\r\n    [getMouseCoords]\r\n  );\r\n\r\n  const onClick = React.useCallback(\r\n    (e: MouseEvent) => {\r\n      const modifiers = getModifiers(e);\r\n      const mode = getSelectMode(modifiers);\r\n      dispatch(selectWires(wireId, mode));\r\n    },\r\n    [wireId]\r\n  );\r\n\r\n  const { startTracking } = useMouseTracking({\r\n    onClick,\r\n    onDragStart,\r\n    onDragMove\r\n  });\r\n\r\n  const onJointInsertMouseDown = React.useCallback((e: React.MouseEvent) => {\r\n    startTracking(e);\r\n  }, []);\r\n\r\n  let insertJointPos: Point | undefined;\r\n  if (mousePos) {\r\n    let lineDir = normalize(pointSubtract(end, start));\r\n    const v = pointSubtract(mousePos, start);\r\n    var d = dotProduct(v, lineDir);\r\n    insertJointPos = pointAdd(start, scale(lineDir, d));\r\n  }\r\n\r\n  return (\r\n    <g onMouseMove={onMouseMove} onMouseLeave={onMouseLeave}>\r\n      <line\r\n        x1={start.x}\r\n        y1={start.y}\r\n        x2={end.x}\r\n        y2={end.y}\r\n        stroke={color}\r\n        strokeWidth={2}\r\n      />\r\n      {insertJointPos && (\r\n        <circle\r\n          cx={insertJointPos.x}\r\n          cy={insertJointPos.y}\r\n          r={3}\r\n          fill=\"red\"\r\n          onMouseDown={onJointInsertMouseDown}\r\n        />\r\n      )}\r\n    </g>\r\n  );\r\n};\r\n\r\nexport default WireSegment;\r\n","import * as React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\n\r\nimport { Point } from \"@/types\";\r\n\r\nimport useSelector from \"@/hooks/useSelector\";\r\nimport useMouseTracking from \"@/hooks/useMouseTracking\";\r\n\r\nimport { wireJointPositionSelector } from \"@/services/field/selectors/wires\";\r\nimport { isJointSelectedSelector } from \"@/services/selection/selectors/selection\";\r\n\r\nimport { moveWireJoint } from \"@/actions/wire-joint-move\";\r\nimport { selectWireJoints } from \"@/actions/select-wire-joints\";\r\n\r\nimport { useEventMouseCoords } from \"../hooks/useMouseCoords\";\r\nimport { getSelectMode, getModifiers } from \"../selection-mode\";\r\n\r\ninterface WireJointProps {\r\n  jointId: string;\r\n}\r\n\r\nconst WireJoint: React.FC<WireJointProps> = ({ jointId }) => {\r\n  const getMouseCoords = useEventMouseCoords();\r\n  const dispatch = useDispatch();\r\n\r\n  const isSelected = useSelector(state =>\r\n    isJointSelectedSelector(state, jointId)\r\n  );\r\n\r\n  const position = useSelector(state =>\r\n    wireJointPositionSelector(state, jointId)\r\n  );\r\n  const [mouseOver, setMouseOver] = React.useState(false);\r\n\r\n  const onJointDragMove = React.useCallback(\r\n    (offset: Point, e: MouseEvent) => {\r\n      const p = getMouseCoords(e);\r\n      dispatch(moveWireJoint(jointId, p));\r\n    },\r\n    [getMouseCoords]\r\n  );\r\n\r\n  const onClick = React.useCallback(\r\n    (e: MouseEvent) => {\r\n      const modifiers = getModifiers(e);\r\n      const mode = getSelectMode(modifiers);\r\n      dispatch(selectWireJoints(jointId, mode));\r\n    },\r\n    [jointId]\r\n  );\r\n\r\n  const { startTracking: startMoveJointTracking } = useMouseTracking({\r\n    onClick,\r\n    onDragMove: onJointDragMove\r\n  });\r\n\r\n  const onMouseOver = React.useCallback(() => {\r\n    setMouseOver(true);\r\n  }, []);\r\n  const onMouseOut = React.useCallback(() => {\r\n    setMouseOver(false);\r\n  }, []);\r\n\r\n  const mouseDown = React.useCallback(\r\n    (e: React.MouseEvent) => {\r\n      startMoveJointTracking(e);\r\n    },\r\n    [startMoveJointTracking]\r\n  );\r\n\r\n  let color: string;\r\n  if (isSelected) {\r\n    color = \"yellow\";\r\n  } else {\r\n    color = \"black\";\r\n  }\r\n\r\n  return (\r\n    <circle\r\n      cx={position.x}\r\n      cy={position.y}\r\n      r={mouseOver ? 3 : 2}\r\n      onMouseOver={onMouseOver}\r\n      onMouseOut={onMouseOut}\r\n      onMouseDown={mouseDown}\r\n      fill={color}\r\n    />\r\n  );\r\n};\r\n\r\nexport default WireJoint;\r\n","import * as React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\n\r\nimport useSelector from \"@/hooks/useSelector\";\r\n\r\nimport { selectWires } from \"@/actions/select-wires\";\r\n\r\nimport { wireJointIdsSelector } from \"@/services/field/selectors/wires\";\r\nimport { isWireSelectedSelector } from \"@/services/selection/selectors/selection\";\r\nimport { wireValueSelector } from \"@/services/simulator/selectors/wires\";\r\n\r\nimport { useEventMouseCoords } from \"../hooks/useMouseCoords\";\r\n\r\nimport WireSegment from \"./WireSegment\";\r\nimport WireJoint from \"./WireJoint\";\r\n\r\nexport interface WireProps {\r\n  wireId: string;\r\n}\r\n\r\nconst Wire: React.FC<WireProps> = ({ wireId }) => {\r\n  const jointIds = useSelector(state => wireJointIdsSelector(state, wireId));\r\n  const value = useSelector(state => wireValueSelector(state, wireId));\r\n  const isSelected = useSelector(state =>\r\n    isWireSelectedSelector(state, wireId)\r\n  );\r\n\r\n  let color: string;\r\n  if (isSelected) {\r\n    color = \"yellow\";\r\n  } else if (value) {\r\n    color = \"green\";\r\n  } else {\r\n    color = \"black\";\r\n  }\r\n\r\n  // We need one extra array entry for starting on the last jointId and ending at null (end of wire)\r\n  const segmentElements = [...jointIds, null].map((endJointId, index) => {\r\n    const startJointId = index > 0 ? jointIds[index - 1] : null;\r\n    return (\r\n      <WireSegment\r\n        key={index}\r\n        wireId={wireId}\r\n        startJointId={startJointId}\r\n        endJointId={endJointId}\r\n        color={color}\r\n      />\r\n    );\r\n  });\r\n\r\n  const jointElements = jointIds.map(jointId => (\r\n    <WireJoint key={jointId} jointId={jointId} />\r\n  ));\r\n\r\n  return (\r\n    <>\r\n      {segmentElements}\r\n      {jointElements}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Wire;\r\n","import { AppState } from \"@/store\";\r\n\r\nimport { nodeOutputPinValue } from \"./nodes\";\r\n\r\nexport const wireValueSelector = (state: AppState, wireId: string) => {\r\n  const {\r\n    outputPin: { nodeId, pinId }\r\n  } = state.services.graph.wiresById[wireId];\r\n\r\n  return nodeOutputPinValue(state, nodeId, pinId);\r\n};\r\n","import * as React from \"react\";\r\n\r\nimport { connect } from \"react-redux\";\r\n\r\nimport { wireIdsSelector } from \"@/services/graph/selectors/wires\";\r\nimport useSelector from \"@/hooks/useSelector\";\r\n\r\nimport Wire from \"./Wire\";\r\n\r\nconst WiresLayer: React.FC = () => {\r\n  const wireIds = useSelector(wireIdsSelector);\r\n  const connectorElements = wireIds.map(wireId => (\r\n    <Wire key={wireId} wireId={wireId} />\r\n  ));\r\n\r\n  return <g id=\"wires-layer\">{connectorElements}</g>;\r\n};\r\nexport default WiresLayer;\r\n","import * as React from \"react\";\r\nimport { connect, useDispatch } from \"react-redux\";\r\n\r\nimport { AppState } from \"@/store\";\r\n\r\nimport { selectedPinSelector } from \"@/pages/CircuitEditor/components/CircuitFieldView/components/CircuitField/selectors\";\r\nimport useSelector from \"@/hooks/useSelector\";\r\nimport { selectPin } from \"../actions/select-pin\";\r\n\r\nconst PIN_CIRCLE_RADIUS_UNSELECTED = 4;\r\nconst PIN_CIRCLE_RADIUS_SELECTED = 6;\r\n\r\nexport interface CircuitNodePinProps {\r\n  nodeId: string;\r\n  pinId: string;\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nconst CircuitNodePin: React.FC<CircuitNodePinProps> = ({\r\n  nodeId,\r\n  pinId,\r\n  x,\r\n  y\r\n}) => {\r\n  const dispatch = useDispatch();\r\n  const selectedPin = useSelector(selectedPinSelector);\r\n  const isSelected =\r\n    selectedPin && selectedPin.nodeId === nodeId && selectedPin.pinId === pinId;\r\n\r\n  const onMouseDown = React.useCallback(\r\n    (e: React.MouseEvent) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      dispatch(selectPin(nodeId, pinId));\r\n    },\r\n    [nodeId, pinId]\r\n  );\r\n\r\n  return (\r\n    <circle\r\n      cx={x}\r\n      cy={y}\r\n      r={isSelected ? PIN_CIRCLE_RADIUS_SELECTED : PIN_CIRCLE_RADIUS_UNSELECTED}\r\n      fill={isSelected ? \"yellow\" : \"blue\"}\r\n      onMouseDown={onMouseDown}\r\n    />\r\n  );\r\n};\r\n\r\nexport default CircuitNodePin;\r\n","import * as React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\n\r\nimport { Point } from \"@/types\";\r\n\r\nimport useSelector from \"@/hooks/useSelector\";\r\nimport useMouseTracking from \"@/hooks/useMouseTracking\";\r\n\r\nimport { nodeTypeSelector } from \"@/services/graph/selectors/nodes\";\r\nimport { nodeStateSelector } from \"@/services/simulator/selectors/nodes\";\r\nimport { isNodeSelectedSelector } from \"@/services/selection/selectors/selection\";\r\n\r\nimport NodeVisual, {\r\n  RenderPinProps\r\n} from \"@/pages/CircuitEditor/components/NodeVisual\";\r\n\r\nimport { useEventMouseCoords } from \"../hooks/useMouseCoords\";\r\n\r\nimport { dragStartNode } from \"../actions/drag-start-node\";\r\nimport { dragContinue } from \"../actions/drag-continue\";\r\nimport { dragEnd } from \"../actions/drag-end\";\r\n\r\nimport { getModifiers, getSelectMode } from \"../selection-mode\";\r\n\r\nimport CircuitNodePin from \"./CircuitNodePin\";\r\nimport { interactNode } from \"@/actions/node-interact\";\r\nimport { selectNodes } from \"@/actions/select-nodes\";\r\n\r\nexport interface CircuitNodeProps {\r\n  nodeId: string;\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nconst CircuitNode: React.FC<CircuitNodeProps> = ({ nodeId, x, y }) => {\r\n  const dispatch = useDispatch();\r\n\r\n  const nodeType = useSelector(s => nodeTypeSelector(s, nodeId));\r\n  const nodeState = useSelector(s => nodeStateSelector(s, nodeId));\r\n  const isSelected = useSelector(s => isNodeSelectedSelector(s, nodeId));\r\n\r\n  const getCoords = useEventMouseCoords();\r\n\r\n  const onClick = React.useCallback((e: MouseEvent) => {\r\n    const modifiers = getModifiers(e);\r\n    if (modifiers.altKey) {\r\n      dispatch(interactNode(nodeId));\r\n    } else {\r\n      const mode = getSelectMode(modifiers);\r\n      dispatch(selectNodes(nodeId, mode));\r\n    }\r\n  }, []);\r\n\r\n  const onDragStart = React.useCallback(\r\n    (e: MouseEvent) => {\r\n      const p = getCoords(e);\r\n      const modifiers = getModifiers(e);\r\n      const mode = getSelectMode(modifiers);\r\n      dispatch(dragStartNode(nodeId, p, mode));\r\n    },\r\n    [nodeId, getCoords]\r\n  );\r\n\r\n  const onDragMove = React.useCallback(\r\n    (offset: Point, e: MouseEvent) => {\r\n      const p = getCoords(e);\r\n      dispatch(dragContinue(p));\r\n    },\r\n    [getCoords]\r\n  );\r\n\r\n  const onDragEnd = React.useCallback(\r\n    (offset: Point, e: MouseEvent) => {\r\n      const p = getCoords(e);\r\n      const modifiers = getModifiers(e);\r\n      const mode = getSelectMode(modifiers);\r\n      dispatch(dragEnd(p, mode));\r\n    },\r\n    [getCoords]\r\n  );\r\n\r\n  const { startTracking } = useMouseTracking({\r\n    onClick,\r\n    onDragStart,\r\n    onDragMove,\r\n    onDragEnd\r\n  });\r\n  const onMouseDown = React.useCallback(\r\n    (e: React.MouseEvent) => {\r\n      if (e.defaultPrevented) {\r\n        return;\r\n      }\r\n      e.preventDefault();\r\n      startTracking(e);\r\n    },\r\n    [getCoords]\r\n  );\r\n\r\n  const renderPin = React.useCallback(\r\n    (props: RenderPinProps) => {\r\n      const { id, x, y } = props;\r\n      return <CircuitNodePin key={id} nodeId={nodeId} pinId={id} x={x} y={y} />;\r\n    },\r\n    [nodeId]\r\n  );\r\n\r\n  if (!nodeType) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <NodeVisual\r\n      x={x}\r\n      y={y}\r\n      nodeType={nodeType}\r\n      nodeState={nodeState}\r\n      colorOverride={isSelected ? \"yellow\" : undefined}\r\n      renderPin={renderPin}\r\n      onMouseDown={onMouseDown}\r\n    />\r\n  );\r\n};\r\n\r\nexport default CircuitNode;\r\n","import * as React from \"react\";\r\n\r\nimport useSelector from \"@/hooks/useSelector\";\r\nimport { nodePositionsByIdSelector } from \"@/services/field/selectors/positions\";\r\n\r\nimport CircuitNode from \"./CircuitNode\";\r\n\r\nconst NodesLayer: React.FC = () => {\r\n  const nodePositionsById = useSelector(nodePositionsByIdSelector);\r\n\r\n  const nodeElements = Object.keys(nodePositionsById).map(nodeId => {\r\n    const { x, y } = nodePositionsById[nodeId];\r\n    return <CircuitNode key={nodeId} nodeId={nodeId} x={x} y={y} />;\r\n  });\r\n\r\n  return <g id=\"nodes-layer\">{nodeElements}</g>;\r\n};\r\nexport default NodesLayer;\r\n","import * as React from \"react\";\r\n\r\nimport { cls } from \"@/utils\";\r\nimport useSelector from \"@/hooks/useSelector\";\r\nimport {\r\n  fieldWidthSelector,\r\n  fieldHeightSelector\r\n} from \"@/services/field/selectors/bounds\";\r\n\r\nimport { FieldSvgElementProvider } from \"./contexts/fieldSvgElement\";\r\n\r\nimport DragPreviewLayer from \"./components/DragPreviewLayer\";\r\nimport DragSelectLayer from \"./components/DragSelectLayer\";\r\nimport WiresLayer from \"./components/WiresLayer\";\r\nimport NodesLayer from \"./components/NodesLayer\";\r\n\r\nimport styles from \"./CircuitField.module.css\";\r\n\r\nconst CircuitField: React.FC = () => {\r\n  const width = useSelector(fieldWidthSelector);\r\n  const height = useSelector(fieldHeightSelector);\r\n  const svgRef = React.useRef<SVGSVGElement>(null);\r\n\r\n  const onMouseDown = React.useCallback(() => {\r\n    svgRef.current?.focus();\r\n  }, []);\r\n\r\n  return (\r\n    // svg seems to have an implicit bottom margin against its parent div.\r\n    //  Wrapping it in a div of the same size fixes it.\r\n    <div\r\n      className={cls(\"circuit-field\", styles[\"circuit-editor\"])}\r\n      style={{\r\n        width: `${width}px`,\r\n        height: `${height}px`\r\n      }}\r\n    >\r\n      <svg\r\n        tabIndex={-1}\r\n        ref={svgRef}\r\n        width={width}\r\n        height={height}\r\n        onMouseDown={onMouseDown}\r\n      >\r\n        <FieldSvgElementProvider value={svgRef}>\r\n          <DragSelectLayer />\r\n          <WiresLayer />\r\n          <NodesLayer />\r\n          <DragPreviewLayer />\r\n        </FieldSvgElementProvider>\r\n      </svg>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CircuitField;\r\n","import CircuitField from \"./CircuitField\";\r\nexport default CircuitField;\r\n","import * as React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { HotKeys } from \"react-hotkeys\";\r\n\r\nimport { cls } from \"@/utils\";\r\nimport { useNativeEvent } from \"@/hooks/useNativeEvent\";\r\nimport useSelector from \"@/hooks/useSelector\";\r\n\r\nimport { viewScaleSelector } from \"@/services/view/selectors/view\";\r\n\r\nimport { viewZoom } from \"@/actions/view-zoom\";\r\nimport { tickSim } from \"@/actions/sim-tick\";\r\nimport { fastForwardSim } from \"@/actions/sim-fastforward\";\r\nimport { paste } from \"@/actions/clipboard-paste\";\r\nimport { selectionCopy } from \"@/actions/selection-copy\";\r\nimport { selectionDelete } from \"@/actions/selection-delete\";\r\nimport { selectAll } from \"@/actions/select-all\";\r\n\r\nimport keymap, {\r\n  KeymapHandler,\r\n  KEYMAP_SIM_STEP,\r\n  KEYMAP_SIM_FASTFORWARD,\r\n  KEYMAP_COPY,\r\n  KEYMAP_PASTE,\r\n  KEYMAP_DELETE,\r\n  KEYMAP_SELECT_ALL\r\n} from \"./keymap\";\r\n\r\nimport CircuitField from \"./components/CircuitField\";\r\n\r\nimport styles from \"./CircuitFieldView.module.css\";\r\nimport { AnyAction } from \"redux\";\r\n\r\nexport interface CircuitFieldViewProps {\r\n  className?: string;\r\n}\r\n\r\nconst CircuitFieldView: React.FC<CircuitFieldViewProps> = ({ className }) => {\r\n  const viewRef = React.useRef<HTMLDivElement | null>(null);\r\n  const dispatch = useDispatch();\r\n  const scale = useSelector(viewScaleSelector);\r\n\r\n  const keyHandlers = React.useMemo(() => {\r\n    function createEventDispatcher(action: AnyAction): HotkeyHandler {\r\n      return (e?: KeyboardEvent) => {\r\n        if (e) {\r\n          if (e.defaultPrevented) {\r\n            return;\r\n          }\r\n          e.preventDefault();\r\n        }\r\n        dispatch(action);\r\n      };\r\n    }\r\n    let keyHandlers: KeymapHandler = {\r\n      [KEYMAP_SIM_STEP]: createEventDispatcher(tickSim(1)),\r\n      [KEYMAP_SIM_FASTFORWARD]: createEventDispatcher(fastForwardSim()),\r\n      [KEYMAP_SELECT_ALL]: createEventDispatcher(selectAll()),\r\n      [KEYMAP_COPY]: createEventDispatcher(selectionCopy()),\r\n      [KEYMAP_PASTE]: createEventDispatcher(paste()),\r\n      [KEYMAP_DELETE]: createEventDispatcher(selectionDelete())\r\n    };\r\n    return keyHandlers;\r\n  }, []);\r\n\r\n  const onWheel = React.useCallback((e: WheelEvent) => {\r\n    if (e.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    if (e.ctrlKey) {\r\n      dispatch(viewZoom(e.deltaY > 0 ? -1 : 1));\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }, []);\r\n\r\n  // React listens to the root listener for all events,\r\n  //  and chrome assumes the root event listener for mouse events\r\n  //  never wants to preventDefault.\r\n  // We need to take a local event listener and mark it as not passive.\r\n  // https://github.com/facebook/react/issues/14856\r\n  useNativeEvent(viewRef, \"wheel\", onWheel, { passive: false });\r\n\r\n  return (\r\n    <div\r\n      className={cls(\r\n        \"circuit-field-view\",\r\n        className,\r\n        styles[\"circuit-field-view\"]\r\n      )}\r\n      ref={viewRef}\r\n    >\r\n      <div\r\n        className={cls(\r\n          \"zoom-container\",\r\n          styles[\"circuit-field-zoom-container\"]\r\n        )}\r\n        style={{\r\n          transform: `scale(${scale})`\r\n        }}\r\n      >\r\n        <HotKeys keyMap={keymap} handlers={keyHandlers}>\r\n          <CircuitField />\r\n        </HotKeys>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CircuitFieldView;\r\n","import CircuitFieldView from \"./CircuitFieldView\";\r\nexport default CircuitFieldView;\r\n","import * as React from \"react\";\r\n\r\nexport function useNativeEvent<\r\n  T extends GlobalEventHandlers,\r\n  K extends keyof GlobalEventHandlersEventMap\r\n>(\r\n  ref: React.RefObject<T | null>,\r\n  type: K,\r\n  listener: (\r\n    this: GlobalEventHandlers,\r\n    ev: GlobalEventHandlersEventMap[K]\r\n  ) => any,\r\n  options?: boolean | AddEventListenerOptions\r\n) {\r\n  React.useEffect(() => {\r\n    if (!ref.current) {\r\n      return;\r\n    }\r\n\r\n    // De-reference the target so we remove from the right element.\r\n    const listenTarget = ref.current;\r\n\r\n    listenTarget.addEventListener(type, listener, options);\r\n    return () => {\r\n      listenTarget.removeEventListener(type, listener, options);\r\n    };\r\n  }, [ref.current, type, listener]);\r\n}\r\n","import * as React from \"react\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport { typedKeys } from \"@/utils\";\r\nimport { NodeTypes } from \"@/node-defs\";\r\n\r\nimport { addNode } from \"@/actions/node-add\";\r\n\r\nimport NodeVisual from \"../NodeVisual\";\r\n\r\nimport styles from \"./ElementTray.module.css\";\r\n\r\nconst mapDispatchToProps = {\r\n  addNode\r\n};\r\ntype DispatchProps = typeof mapDispatchToProps;\r\n\r\ntype Props = DispatchProps;\r\n\r\nconst ElementTray: React.FC<Props> = ({ addNode }) => {\r\n  const elements = typedKeys(NodeTypes).map(type => {\r\n    return (\r\n      <div key={type} onClick={() => addNode(type)}>\r\n        <svg width={110} height={70}>\r\n          <NodeVisual nodeType={type} nodeState={{}} />\r\n        </svg>\r\n      </div>\r\n    );\r\n  });\r\n\r\n  return (\r\n    <div className={styles[\"circuittray\"]}>\r\n      <div className={styles[\"circuittray-title\"]}>Elements</div>\r\n      <div className={styles[\"circuittray-elements\"]}>{elements}</div>\r\n    </div>\r\n  );\r\n};\r\nexport default connect(null, mapDispatchToProps)(ElementTray);\r\n","import ElementTray from \"./ElementTray\";\r\nexport default ElementTray;\r\n","import * as React from \"react\";\r\n\r\nimport { cls } from \"@/utils\";\r\n\r\nimport CircuitFieldView from \"./components/CircuitFieldView\";\r\nimport ElementTray from \"./components/ElementTray\";\r\n\r\nimport styles from \"./CircuitEditor.module.css\";\r\n\r\nexport interface CircuitEditorProps {\r\n  className?: string;\r\n}\r\n\r\nconst CircuitEditor: React.FC<CircuitEditorProps> = ({ className }) => {\r\n  return (\r\n    <div className={cls(className, styles.editor)}>\r\n      <div className={styles[\"editor-fieldcontainer\"]}>\r\n        <CircuitFieldView />\r\n      </div>\r\n      <div className={styles[\"editor-toolwindow-horizontal\"]}>\r\n        <ElementTray />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CircuitEditor;\r\n","import CircuitEditor from \"./CircuitEditor\";\r\nexport default CircuitEditor;\r\n","import * as React from \"react\";\r\n\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nimport readmeContent from \"@/../README.md\";\r\n\r\nimport styles from \"./Intro.module.css\";\r\n\r\nexport interface IntroProps {\r\n  dismiss(): void;\r\n}\r\ntype Props = IntroProps;\r\n\r\nconst IntroPage: React.FC<Props> = ({ dismiss }) => {\r\n  return (\r\n    <div className={styles.intro}>\r\n      <div className={styles[\"intro-content\"]}>\r\n        <div className={styles[\"intro-header\"]}>\r\n          <h3>\r\n            <b>UNDER CONSTRUCTION</b>\r\n            <p>\r\n              This is an as-yet-unfinished experiment. The user interface is\r\n              frustrating at best, and you cannot save your work. It is made\r\n              available as a playground for the current state of the project.\r\n            </p>\r\n            <p>\r\n              Scan through the readme below, and click the button at the bottom\r\n              to enter\r\n            </p>\r\n            <p>\r\n              The source can be found at{\" \"}\r\n              <a href=\"https://github.com/RoboPhred/discrelog\">\r\n                https://github.com/RoboPhred/discrelog\r\n              </a>\r\n            </p>\r\n          </h3>\r\n        </div>\r\n        <div className={styles[\"intro-markdown\"]}>\r\n          <ReactMarkdown source={readmeContent} />\r\n        </div>\r\n        <button className={styles[\"intro-dismiss\"]} onClick={dismiss}>\r\n          Let me break things\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default IntroPage;\r\n","import Intro from \"./Intro\";\r\nexport default Intro;\r\n","export default \"# Discrelog / React-Logic / Working Title Logic Thing\\r\\n\\r\\nA discrete logic / circuit editor and simulator written in React and Redux.\\r\\n\\r\\n_This is a work in progress, and will be for some time. It is not suitable for use as of this time._\\r\\n\\r\\n## Live work-in-progress\\r\\n\\r\\n_The interface is very much a prototype. The current incarnation is under heavy development and is not final._\\r\\n\\r\\nhttp://robophred.github.io/discrelog\\r\\n\\r\\n### Usage:\\r\\n\\r\\nClick circuit elements on the left to create them. They will appear in the top-left corner.\\r\\nClick an element to select it. Click-drag an element to move it, and click-drag the field to select multiple elements.\\r\\n\\r\\nSelected elements appear with a small yellow square in the top left.\\r\\n\\r\\nClick on pins to select them. While a pin is selected, click on other pins to connect them. Output pins can only connect to input pins, and that input pins can only have one connection. Output pins can connect to more than one input pin.\\r\\n\\r\\n### Controls:\\r\\n\\r\\n- Select element: `left-click`\\r\\n- Toggle element in current selection: `ctrl + left-click`\\r\\n- Add element to current selection: `shift + left-click`\\r\\n- Activate Button: `alt + left-click` or `option + left-click`\\r\\n- Delete Element: `backspace` or `delete`\\r\\n- Copy Selected: `ctrl + c` or `command + c`\\r\\n- Paste: `ctrl + v` or `command + v`\\r\\n- Select All: `ctrl + a`\\r\\n- Next tick: `spacebar`\\r\\n- Fast forward to next transition: `shift + spacebar`\\r\\n\\r\\n## Circuit structure and Simulation\\r\\n\\r\\nCircuits are built by connecting component output pins to input pins on a one-to-many relationship. A single output pin can connect to many input pins, but an input pin can only have a single output pin.\\r\\n\\r\\nConnections and pins are represented by a binary state. A connection can be active (true) or inactive (false); there is no way to simulate analog concepts such as pull-low/pull-high, resistors, voltages, or currents.\\r\\n\\r\\nWhen an output pin changes, all connected components are updated. The update process involves computing the output pin states given the input pins and the component's internal state. The component will then immediately update its state, and schedule pin changes on a future update. Changes to output pins must occur at least one tick in the future, and it is not possible to schedule more than one transition on the same output pin. This ensures that logic remains predictable even in the case of loops, and allows such constructs as vibrators, latches, and flip-flops.\\r\\n\\r\\nIt is not possible for a component to change its pin on the current tick. This ensures components function consistently and predictably through cyclic connections and regardless of the order in which they update.\\r\\n\\r\\n## Supported Logic Components\\r\\n\\r\\nAs of the time of this writing, the available logic components consist of:\\r\\n\\r\\n- Combinational logic (4 tick response)\\r\\n  - AND\\r\\n  - OR\\r\\n  - NOR\\r\\n- Negate / NOT (4 tick response)\\r\\n- Toggle Switch (1 tick response)\\r\\n- Buffer (2 tick response)\\r\\n- 7 Segment Display (immediate visual response)\\r\\n- LED (immediate visual response)\\r\\n\\r\\n_For more details on the implementation of logic components, and how to add your own, see [/node-types](https://github.com/RoboPhred/discrelog/tree/master/src/node-types)._\\r\\n\\r\\n## Upcomming features\\r\\n\\r\\nI am notorious for not getting back to things, so anything I write here would just be bad juju.\\r\\n\\r\\n## Development Philosophy\\r\\n\\r\\nWhile the inspiration for this project is a lack of high quality, easily extensible discrete logic simulators, this is a formost a learning exercise. This means progress will be slow and most of it will be rewritten many times over. Finding the best solution and gaining a deeper understanding of the underlying problem will take priority over bringing the software to a usable state. Do not expect fast progress or a user friendly editor for some time.\\r\\n\\r\\n## Technology\\r\\n\\r\\nThis application is written to be a browser-ran desktop-scale application. It has no server component, and performs all work in the client's browser.\\r\\nThe UI renderer is React, with Redux providing the backing store.\\r\\n\\r\\n## License\\r\\n\\r\\nThis project is licenced under AGPL-3.0.\\r\\n\\r\\nSome logic symbol artwork has been provided by wikimedia commons under the public domain license. These have been called out where used.\\r\\n\\r\\n## Alternatives\\r\\n\\r\\nThere are a few notable digital (and analog) circuit editors that I have come across and arbitrarily collected. Many more exist in the wild.\\r\\n\\r\\nOpen source:\\r\\n\\r\\n- http://www.cburch.com/logisim/ (desktop app, java)\\r\\n- https://github.com/willymcallister/circuit-sandbox (online, javascript, analog)\\r\\n\\r\\nClosed source:\\r\\n\\r\\n- https://www.circuitlab.com/ (online)\\r\\n- https://simulator.io/ (online)\\r\\n\";","import * as React from \"react\";\r\n\r\nexport interface PopupMenuContext {\r\n  onClose(): void;\r\n}\r\nexport default React.createContext<PopupMenuContext>({\r\n  onClose: () => {}\r\n});\r\n","import * as React from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\n\r\nimport PopperJS from \"popper.js\";\r\n\r\nexport type PopperPlacement =\r\n  | \"top-start\"\r\n  | \"top\"\r\n  | \"top-end\"\r\n  | \"left-start\"\r\n  | \"left\"\r\n  | \"left-end\"\r\n  | \"right-start\"\r\n  | \"right\"\r\n  | \"right-end\"\r\n  | \"bottom-start\"\r\n  | \"bottom\"\r\n  | \"bottom-end\";\r\nexport interface PopperProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  isOpen: boolean;\r\n  placement: PopperPlacement;\r\n  anchorEl: Element | null;\r\n}\r\n\r\nconst Popper: React.FC<PopperProps> = ({\r\n  isOpen,\r\n  placement,\r\n  anchorEl,\r\n  children,\r\n  ...divProps\r\n}) => {\r\n  const contentRef = React.useRef<HTMLDivElement>(null);\r\n  const popperRef = React.useRef<PopperJS | null>(null);\r\n\r\n  const handleClose = () => {\r\n    if (!popperRef.current) {\r\n      return;\r\n    }\r\n\r\n    popperRef.current.destroy();\r\n    popperRef.current = null;\r\n  };\r\n\r\n  const handleOpen = () => {\r\n    const popperNode = contentRef.current;\r\n    if (!popperNode || !anchorEl || !isOpen) {\r\n      return;\r\n    }\r\n\r\n    handleClose();\r\n\r\n    popperRef.current = new PopperJS(anchorEl, popperNode, {\r\n      placement,\r\n      modifiers: {\r\n        // We portal into document.body,\r\n        //  so set the boundary element to the window.\r\n        preventOverflow: {\r\n          boundariesElement: \"window\"\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  // Handle open/closed transition.\r\n  React.useEffect(() => {\r\n    if (isOpen) {\r\n      handleOpen();\r\n    } else {\r\n      handleClose();\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Destroy instance on unmount.\r\n  React.useEffect(() => {\r\n    return handleClose;\r\n  }, []);\r\n\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  const contentNode = (\r\n    <div ref={contentRef} {...divProps}>\r\n      {children}\r\n    </div>\r\n  );\r\n\r\n  return createPortal(contentNode, document.body);\r\n};\r\n\r\nexport default Popper;\r\n","import * as React from \"react\";\r\nimport { FocusOn } from \"react-focus-on\";\r\n\r\nimport Popper, { PopperPlacement } from \"../Popper\";\r\n\r\nimport PopupMenuContext from \"./popupMenuContext\";\r\n\r\nimport styles from \"./PopupMenu.module.css\";\r\n\r\nexport interface PopupMenuProps {\r\n  isOpen: boolean;\r\n  placement: PopperPlacement;\r\n  anchorEl: Element | null;\r\n  onClose(): void;\r\n}\r\n\r\nconst PopupMenu: React.FC<PopupMenuProps> = ({\r\n  isOpen,\r\n  placement,\r\n  anchorEl,\r\n  onClose,\r\n  children\r\n}) => {\r\n  return (\r\n    <Popper\r\n      className={styles.popupmenu}\r\n      isOpen={isOpen}\r\n      placement={placement}\r\n      anchorEl={anchorEl}\r\n    >\r\n      <PopupMenuContext.Provider value={{ onClose }}>\r\n        <FocusOn\r\n          enabled={isOpen}\r\n          onClickOutside={onClose}\r\n          onEscapeKey={onClose}\r\n        >\r\n          {children}\r\n        </FocusOn>\r\n      </PopupMenuContext.Provider>\r\n    </Popper>\r\n  );\r\n};\r\n\r\nexport default PopupMenu;\r\n","import PopupMenu from \"./PopupMenu\";\r\nexport default PopupMenu;\r\n","import * as React from \"react\";\r\n\r\nimport { cls } from \"@/utils\";\r\n\r\nimport PopupMenuContext from \"../PopupMenu/popupMenuContext\";\r\n\r\nimport PopupMenu from \"../PopupMenu\";\r\nimport { PopperPlacement } from \"../Popper\";\r\n\r\nimport \"./MenuItem.module.css\";\r\n\r\nexport interface MenuItemProps {\r\n  title: string;\r\n  className?: string;\r\n  childPlacement?: PopperPlacement;\r\n  onClick?(e: React.MouseEvent): void;\r\n}\r\n\r\nconst MenuItem: React.FC<MenuItemProps> = ({\r\n  title,\r\n  className,\r\n  childPlacement = \"right-end\",\r\n  onClick,\r\n  children\r\n}) => {\r\n  const { onClose: onClosePopup } = React.useContext(PopupMenuContext);\r\n\r\n  const [isOpen, setOpen] = React.useState(false);\r\n  const ref = React.useRef<HTMLDivElement | null>(null);\r\n\r\n  const isParentItem = React.Children.count(children) > 0;\r\n\r\n  const onItemClick = React.useCallback(\r\n    (e: React.MouseEvent) => {\r\n      if (isParentItem) {\r\n        setOpen(!isOpen);\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n      if (onClick) {\r\n        onClick(e);\r\n        onClosePopup();\r\n      }\r\n    },\r\n    [isOpen, isParentItem, onClick]\r\n  );\r\n\r\n  const onClose = React.useCallback(() => {\r\n    setOpen(false);\r\n  }, [isOpen]);\r\n\r\n  const item = (\r\n    <div\r\n      className={cls(\"menu-item\", className)}\r\n      ref={ref}\r\n      tabIndex={0}\r\n      onClick={onItemClick}\r\n    >\r\n      {title}\r\n    </div>\r\n  );\r\n\r\n  let popup: React.ReactNode = null;\r\n  if (isParentItem) {\r\n    popup = (\r\n      <PopupMenu\r\n        isOpen={isOpen}\r\n        anchorEl={ref.current}\r\n        placement={childPlacement}\r\n        onClose={onClose}\r\n      >\r\n        {children}\r\n      </PopupMenu>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {item}\r\n      {popup}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MenuItem;\r\n","import MenuItem from \"./MenuItem\";\r\nexport default MenuItem;\r\n","import * as React from \"react\";\r\n\r\nconst PlayIcon: React.FC<React.SVGProps<SVGSVGElement>> = props => {\r\n  return (\r\n    <svg width={16} height={16} {...props}>\r\n      <path d=\"M0,0 L10,8 L0,16 z\" />\r\n    </svg>\r\n  );\r\n};\r\n\r\nexport default PlayIcon;\r\n","import * as React from \"react\";\r\n\r\nconst StopIcon: React.FC<React.SVGProps<SVGSVGElement>> = props => {\r\n  return (\r\n    <svg width={16} height={16} {...props}>\r\n      <path d=\"M0,0 L16,0 L16,16 L0,16 z\" />\r\n    </svg>\r\n  );\r\n};\r\n\r\nexport default StopIcon;\r\n","import * as React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\n\r\nimport { startSim } from \"@/actions/sim-start\";\r\nimport { stopSim } from \"@/actions/sim-stop\";\r\nimport { isRunningSelector } from \"@/services/simulator/selectors/run\";\r\n\r\nimport useSelector from \"@/hooks/useSelector\";\r\n\r\nimport PlayIcon from \"../Icons/Play\";\r\n\r\nimport styles from \"./SimControls.module.css\";\r\nimport StopIcon from \"../Icons/Stop\";\r\n\r\nconst PlayPauseButton: React.FC = () => {\r\n  const dispatch = useDispatch();\r\n  const isRunning = useSelector(isRunningSelector);\r\n\r\n  const onPlayClick = React.useCallback(() => {\r\n    dispatch(startSim());\r\n  }, []);\r\n\r\n  const onStopClick = React.useCallback(() => {\r\n    dispatch(stopSim());\r\n  }, []);\r\n\r\n  return (\r\n    <span>\r\n      {isRunning && (\r\n        <StopIcon\r\n          className={styles[\"simctrls-button-stop\"]}\r\n          onClick={onStopClick}\r\n        />\r\n      )}\r\n      {!isRunning && (\r\n        <PlayIcon\r\n          className={styles[\"simctrls-buttom-play\"]}\r\n          onClick={onPlayClick}\r\n        />\r\n      )}\r\n    </span>\r\n  );\r\n};\r\n\r\nexport default PlayPauseButton;\r\n","import SimControls from \"./SimControls\";\r\nexport default SimControls;\r\n","import * as React from \"react\";\r\n\r\nimport { useAction } from \"@/hooks/useAction\";\r\nimport { newFile } from \"@/actions/file-new\";\r\n\r\nimport MenuItem from \"../MenuItem\";\r\nimport SimControls from \"../SimControls\";\r\n\r\nimport styles from \"./TitleBar.module.css\";\r\n\r\nconst TitleBar: React.FC = () => {\r\n  const onFileNew = useAction(newFile);\r\n\r\n  return (\r\n    <div className={styles.titlebar}>\r\n      <span className={styles[\"titlebar-brand\"]}>Discrelog</span>\r\n      <MenuItem title=\"File\" childPlacement=\"bottom-start\">\r\n        <MenuItem title=\"New\" onClick={onFileNew} />\r\n      </MenuItem>\r\n      <div className={styles[\"titlebar-buttons\"]}>\r\n        <SimControls />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TitleBar;\r\n","import TitleBar from \"./TitleBar\";\r\nexport default TitleBar;\r\n","import * as React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AnyAction } from \"redux\";\r\n\r\nexport function useAction<T extends (...args: any[]) => AnyAction>(\r\n  actionCreator: T\r\n): T {\r\n  const dispatch = useDispatch();\r\n  return React.useCallback((...args: any[]) => {\r\n    dispatch(actionCreator(...args));\r\n  }, []) as any;\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { isDev } from \"@/env\";\r\n\r\nimport flex from \"@/styles/flex.module.css\";\r\nimport sizing from \"@/styles/sizing.module.css\";\r\n\r\nimport CircuitEditor from \"@/pages/CircuitEditor\";\r\nimport Intro from \"@/pages/Intro\";\r\n\r\nimport TitleBar from \"../TitleBar\";\r\nimport { cls } from \"@/utils\";\r\n\r\nconst App: React.FC = () => {\r\n  const [introShown, setIntroShown] = React.useState(isDev);\r\n  const onDismiss = React.useCallback(() => {\r\n    setIntroShown(true);\r\n  }, []);\r\n\r\n  if (!introShown) {\r\n    return <Intro dismiss={onDismiss} />;\r\n  }\r\n\r\n  return (\r\n    <div className={cls(sizing[\"fill-parent\"], flex[\"flex-column\"])}>\r\n      <TitleBar />\r\n      <CircuitEditor\r\n        className={cls(sizing[\"fill-parent\"], flex[\"flexitem-shrink\"])}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","import App from \"./App\";\r\nexport default App;\r\n","export const isProd = process.env.NODE_ENV === \"production\";\r\nexport const isDev = process.env.NODE_ENV === \"development\";\r\n","import * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\n\r\nimport { Provider } from \"react-redux\";\r\n\r\nimport \"./styles\";\r\n\r\nimport { store } from \"./store\";\r\nimport App from \"./components/App\";\r\n\r\nconst rootEl = document.getElementById(\"root\");\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <App />\r\n  </Provider>,\r\n  rootEl\r\n);\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"circuittray\":\"ElementTray-module__circuittray___38QqX\",\"circuittray-title\":\"ElementTray-module__circuittray-title___2yi9d\",\"circuittray-elements\":\"ElementTray-module__circuittray-elements___hNZuh\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"editor\":\"CircuitEditor-module__editor___UL8qT\",\"editor-fieldcontainer\":\"CircuitEditor-module__editor-fieldcontainer___bMu2Y\",\"editor-toolwindow-horizontal\":\"CircuitEditor-module__editor-toolwindow-horizontal___1PhL8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"titlebar\":\"TitleBar-module__titlebar___3fEaN\",\"titlebar-buttons\":\"TitleBar-module__titlebar-buttons___3h7Tw\",\"titlebar-brand\":\"TitleBar-module__titlebar-brand___34og_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"flex-row\":\"flex-module__flex-row___2HFWh\",\"flex-column\":\"flex-module__flex-column___3GRAs\",\"flexitem-shrink\":\"flex-module__flexitem-shrink___ixBNI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fill-parent\":\"sizing-module__fill-parent___2SiAH\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"circuit-field-view\":\"CircuitFieldView-module__circuit-field-view___2A5Yu\",\"circuit-field-zoom-container\":\"CircuitFieldView-module__circuit-field-zoom-container___2fQiO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"simctrls-buttom-play\":\"SimControls-module__simctrls-buttom-play___3XU45\",\"simctrls-button-stop\":\"SimControls-module__simctrls-button-stop___3Wdm8\"};"],"sourceRoot":""}